<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Future of VR Sociotechnical Imaginaries</title>
<style title="Twine CSS">@keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes rumble{25%{top:-0.1em}75%{top:0.1em}0%,to{top:0px}}@keyframes shudder{25%{left:0.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes buoy{25%{top:0.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes sway{25%{left:0.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes shudder-in{0%, to{transform:translateX(0em)}5%, 25%, 45%{transform:translateX(-1em)}15%, 35%, 55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes rumble-in{0%, to{transform:translateY(0em)}5%, 25%, 45%{transform:translateY(-1em)}15%, 35%, 55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes fidget{0%, 8.1%, 82.1%, 31.1%, 38.1%, 44.1%, 40.1%, 47.1%, 74.1%, 16.1%, 27.1%, 72.1%, 24.1%, 95.1%, 6.1%, 36.1%, 20.1%, 4.1%, 91.1%, 14.1%, 87.1%, to{left:0px;top:0px}8%, 82%, 31%, 38%, 44%{left:-1px}40%, 47%, 74%, 16%, 27%{left:1px}72%, 24%, 95%, 6%, 36%{top:-1px}20%, 4%, 91%, 14%, 87%{top:1px}}@keyframes slide-right{0%{transform:translateX(-100vw)}}@keyframes slide-left{0%{transform:translateX(100vw)}}@keyframes slide-up{0%{transform:translateY(100vh)}}@keyframes slide-down{0%{transform:translateY(-100vh)}}@keyframes fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:0.2}64%{opacity:0.4}78%{opacity:0.6}87%{opacity:0.8}92%, to{opacity:1}}@keyframes blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}.dom-debug-mode tw-story,.dom-debug-mode tw-passage,.dom-debug-mode tw-sidebar,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{outline:1px solid #f5a3da;min-height:32px;display:block !important}.dom-debug-mode tw-story::before,.dom-debug-mode tw-passage::before,.dom-debug-mode tw-sidebar::before,.dom-debug-mode tw-include::before,.dom-debug-mode tw-hook::before,.dom-debug-mode tw-expression::before,.dom-debug-mode tw-link::before,.dom-debug-mode tw-dialog::before,.dom-debug-mode tw-columns::before,.dom-debug-mode tw-column::before,.dom-debug-mode tw-align::before{position:absolute;top:0;left:0;height:16px;background-color:#f5a3da;color:black;font-size:16px;font-weight:normal;font-style:normal;font-family:monospace;display:inline-block;line-height:100%;white-space:pre;z-index:999997}.dom-debug-mode tw-story:hover,.dom-debug-mode tw-passage:hover,.dom-debug-mode tw-sidebar:hover,.dom-debug-mode tw-include:hover,.dom-debug-mode tw-hook:hover,.dom-debug-mode tw-expression:hover,.dom-debug-mode tw-link:hover,.dom-debug-mode tw-dialog:hover,.dom-debug-mode tw-columns:hover,.dom-debug-mode tw-column:hover,.dom-debug-mode tw-align:hover{outline:1px solid #fc9}.dom-debug-mode tw-story:hover::before,.dom-debug-mode tw-passage:hover::before,.dom-debug-mode tw-sidebar:hover::before,.dom-debug-mode tw-include:hover::before,.dom-debug-mode tw-hook:hover::before,.dom-debug-mode tw-expression:hover::before,.dom-debug-mode tw-link:hover::before,.dom-debug-mode tw-dialog:hover::before,.dom-debug-mode tw-columns:hover::before,.dom-debug-mode tw-column:hover::before,.dom-debug-mode tw-align:hover::before{background-color:#fc9;transition:background-color 1s}.dom-debug-mode tw-passage,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{padding:1em;margin:0}.dom-debug-mode tw-story::before{content:'<tw-story tags="' attr(tags) '">'}.dom-debug-mode tw-passage::before{top:-16px;content:'<tw-passage tags="' attr(tags) '">'}.dom-debug-mode tw-sidebar::before{top:-16px;content:"<tw-sidebar>"}.dom-debug-mode tw-hook::before{content:'<tw-hook name="' attr(name) '">'}.dom-debug-mode tw-expression::before{content:'<tw-expression name="' attr(name) '">'}.dom-debug-mode tw-link::before{content:'<tw-link name="' attr(name) '">'}.dom-debug-mode tw-dialog::before{content:"<tw-dialog>"}.dom-debug-mode tw-columns::before{content:"<tw-columns>"}.dom-debug-mode tw-column::before{content:"<tw-column>"}.dom-debug-mode tw-align::before{content:"<tw-align>"}.dom-debug-mode tw-include::before{content:'<tw-include type="' attr(type) '" name="' attr(name) '">'}.debug-mode tw-expression{display:inline-block !important}.debug-mode tw-expression[type=variable]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"$" attr(name)}.debug-mode tw-expression[type=tempVariable]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"_" attr(name)}.debug-mode tw-expression[return=boolean]{background-color:rgba(179,179,179,0.2)}.debug-mode tw-expression[return=array]{background-color:rgba(255,102,102,0.2)}.debug-mode tw-expression[return=dataset]{background-color:rgba(255,128,0,0.2)}.debug-mode tw-expression[return=number]{background-color:rgba(255,179,102,0.2)}.debug-mode tw-expression[return=datamap]{background-color:rgba(255,255,102,0.2)}.debug-mode tw-expression[return=changer]{background-color:rgba(179,255,102,0.2)}.debug-mode tw-expression[return=lambda]{background-color:rgba(102,255,102,0.2)}.debug-mode tw-expression[return=hookname]{background-color:rgba(102,255,204,0.2)}.debug-mode tw-expression[return=string]{background-color:rgba(102,255,255,0.2)}.debug-mode tw-expression[return=datatype]{background-color:rgba(102,153,255,0.2)}.debug-mode tw-expression[return=gradient],.debug-mode tw-expression[return=colour]{background-color:rgba(204,102,255,0.2)}.debug-mode tw-expression[return=instant],.debug-mode tw-expression[return=macro]{background-color:rgba(240,117,199,0.2)}.debug-mode tw-expression[return=command]{background-color:rgba(153,153,255,0.2)}.debug-mode tw-expression.false{background-color:rgba(255,0,0,0.2) !important}.debug-mode tw-expression[type=macro]::before{content:"(" attr(name) ":)";padding:0 0.5rem;font-size:1rem;vertical-align:middle;line-height:normal;background-color:inherit;border:1px solid rgba(255,255,255,0.5)}.debug-mode tw-hook{background-color:rgba(0,85,255,0.1) !important}.debug-mode tw-hook::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"["}.debug-mode tw-hook::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"]"}.debug-mode tw-hook[name]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"]<" attr(name) "|"}.debug-mode tw-pseudo-hook{background-color:rgba(255,170,0,0.1) !important}.debug-mode tw-collapsed::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"{"}.debug-mode tw-collapsed::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"}"}.debug-mode tw-verbatim::before,.debug-mode tw-verbatim::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"`"}.debug-mode tw-align[style*="text-align: center"]{background:linear-gradient(to right, rgba(255,204,189,0) 0%, rgba(255,204,189,0.25) 50%, rgba(255,204,189,0) 100%)}.debug-mode tw-align[style*="text-align: left"]{background:linear-gradient(to right, rgba(255,204,189,0.25) 0%, rgba(255,204,189,0) 100%)}.debug-mode tw-align[style*="text-align: right"]{background:linear-gradient(to right, rgba(255,204,189,0) 0%, rgba(255,204,189,0.25) 100%)}.debug-mode tw-column{background-color:rgba(189,228,255,0.2)}.debug-mode tw-enchantment{animation:enchantment 0.5s infinite;border:1px solid}.debug-mode tw-link::after,.debug-mode tw-broken-link::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:attr(passage-name)}.debug-mode tw-include{background-color:rgba(204,128,51,0.1)}.debug-mode tw-include::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:attr(type) ' "' attr(name) '"'}@keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}tw-debugger{position:fixed;box-sizing:border-box;bottom:0;right:0;z-index:999999;min-width:10em;min-height:1em;padding:0em 0.5em 0.5em 1em;font-size:1.25em;font-family:sans-serif;color:#000;border-left:solid #000 2px;border-top:solid #000 2px;border-top-left-radius:.5em;background:#fff;opacity:1}tw-debugger select{margin-right:1em;width:12em}tw-debugger button{border-radius:3px;border:solid #999 1px;margin:auto 4px;background-color:#fff;font-size:inherit;color:#000}tw-debugger button.enabled{background-color:#eee;box-shadow:inset #ddd 3px 5px 0.5em}tw-debugger .panel{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:absolute;bottom:100%;left:-2px;right:0;padding:1em;max-height:40vh;overflow-y:scroll;overflow-x:hidden;z-index:999998;background:#fff;border:inherit;border-bottom:solid #999 2px;border-top-left-radius:.5em;border-bottom-left-radius:.5em;font-size:0.8em}tw-debugger .panel:empty,tw-debugger .panel[hidden]{display:none}tw-debugger .panel-source,tw-debugger .panel-row-source{font-family:monospace;overflow-x:scroll;white-space:pre;-ms-flex-preferred-size:100%;flex-basis:100%}tw-debugger .panel-row-source{margin:5px 0}tw-debugger .panel-rows{width:100%;overflow-x:scroll}tw-debugger .panel-rows>*{display:table-row}tw-debugger .panel-rows>div:nth-of-type(2n){background:#EEE}tw-debugger .panel-row-buttons{text-align:right}tw-debugger .panel-variables .panel-rows:empty::before{content:"~ No variables ~";font-style:italic;color:#888;text-align:center}tw-debugger .panel-enchantments .panel-rows:empty::before{content:"~ No enchantments ~";font-style:italic;color:#888;text-align:center}tw-debugger .panel-errors .panel-rows:empty::before{content:"~ No errors... for now. ~";font-style:italic;color:#888;text-align:center}tw-debugger .panel-rows:empty+.panel-variables-bottom{display:none}tw-debugger .panel-storylets:not(.panel-exclusive) .storylet-exclusive,tw-debugger .panel-storylets:not(.panel-urgent) .storylet-urgent{display:none}tw-debugger .panel-variables-bottom{padding-top:5px}tw-debugger .enchantment-row{min-height:1.5em}tw-debugger .variable-path{opacity:0.4}tw-debugger .temporary-variable-scope,tw-debugger .enchantment-local{font-family:sans-serif;font-weight:normal;opacity:0.8;font-size:0.75em}tw-debugger .temporary-variable-scope:not(:empty)::before,tw-debugger .enchantment-local:not(:empty)::before{content:" in "}tw-debugger .variable-name,tw-debugger .enchantment-name{font-family:monospace;font-weight:bold}tw-debugger .variable-type{color:#444;font-weight:normal;text-overflow:ellipsis;overflow:hidden;max-width:10em}tw-debugger .error-row{display:table-row;background-color:rgba(230,101,204,0.3)}tw-debugger .error-row:nth-of-type(2n){background-color:rgba(237,145,219,0.3)}tw-debugger .error-row>*{display:table-cell;padding:0.25em 0.5em}tw-debugger .error-row .error-message{cursor:help}tw-debugger .error-row .error-passage{color:#444}tw-debugger .storylet-row{background-color:rgba(201,233,222,0.3)}tw-debugger .storylet-row:nth-child(2n){background-color:rgba(128,203,178,0.3)}tw-debugger .storylet-row.storylet-closed{font-style:italic;opacity:0.4;background-color:rgba(217,217,217,0.3)}tw-debugger .storylet-row.storylet-closed:nth-child(2n){background-color:rgba(166,166,166,0.3)}.storylet-error tw-debugger .storylet-row{background-color:rgba(230,101,204,0.3)}.storylet-error tw-debugger .storylet-row:nth-child(2n){background-color:rgba(237,145,219,0.3)}tw-debugger .storylet-row .storylet-name,tw-debugger .storylet-row .storylet-value{display:inline-block;width:50%}tw-debugger .tabs{padding-bottom:0.5em}tw-debugger .tab{border-radius:0px 0px 0.5em 0.5em;border-top:none}tw-debugger .resizer{position:absolute;height:3em;border-left:2px solid #ccc;border-right:2px solid #ccc;top:10px;left:4px;width:8px;cursor:ew-resize}tw-dialog{z-index:999997;border:#fff solid 2px;padding:2em;color:#fff;background-color:#000;display:block}@media (min-width: 576px){tw-dialog{max-width:50vw}}tw-dialog input[type=text]{font-size:inherit;width:100%}tw-dialog-links{text-align:right;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}tw-backdrop{z-index:999996;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0.8);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}tw-backdrop ~ tw-backdrop{display:none}tw-link,.link,tw-icon,.enchantment-clickblock{cursor:pointer}tw-link,.enchantment-link{color:#4169E1;font-weight:bold;text-decoration:none;transition:color 0.2s ease-in-out}tw-passage [style^="color"] tw-link:not(:hover),tw-passage [style*=" color"] tw-link:not(:hover),tw-passage [style^="color"][hover="true"] tw-link:hover,tw-passage [style*=" color"][hover="true"] tw-link:hover,tw-passage [style^="color"] .enchantment-link:not(:hover),tw-passage [style*=" color"] .enchantment-link:not(:hover),tw-passage [style^="color"][hover="true"] .enchantment-link:hover,tw-passage [style*=" color"][hover="true"] .enchantment-link:hover{color:inherit}tw-link:hover,.enchantment-link:hover{color:#00bfff}tw-link:active,.enchantment-link:active{color:#DD4B39}.visited{color:#6941e1}tw-passage [style^="color"] .visited:not(:hover),tw-passage [style*=" color"] .visited:not(:hover),tw-passage [style^="color"][hover="true"] .visited:hover,tw-passage [style*=" color"][hover="true"] .visited:hover{color:inherit}.visited:hover{color:#E3E}tw-broken-link{color:#993333;border-bottom:2px solid #993333;cursor:not-allowed}tw-passage [style^="color"] tw-broken-link:not(:hover),tw-passage [style*=" color"] tw-broken-link:not(:hover),tw-passage [style^="color"][hover="true"] tw-broken-link:hover,tw-passage [style*=" color"][hover="true"] tw-broken-link:hover{color:inherit}.enchantment-mouseover{border-bottom:2px dashed #999}.enchantment-mouseout{border:rgba(64,149,191,0.6) 1px solid}.enchantment-mouseout:hover{background-color:rgba(175,197,207,0.75);border:transparent 1px solid;border-radius:0.2em}.enchantment-clickblock{width:100%;height:100%;display:block}.enchantment-clickblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;color:rgba(65,105,225,0.5);transition:color 0.2s ease-in-out}.enchantment-clickblock>:not(tw-enchantment):hover::after{color:rgba(0,191,255,0.5)}.enchantment-clickblock>:not(tw-enchantment):active::after{color:rgba(222,78,59,0.5)}.enchantment-clickblock>:not(tw-enchantment)::after{box-shadow:inset 0 0 0 0.5vmax}.enchantment-clickblock>tw-passage::after,.enchantment-clickblock>tw-sidebar::after{box-shadow:0 0 0 0.5vmax}.enchantment-mouseoverblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:2px dashed #999}.enchantment-mouseoutblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:rgba(64,149,191,0.6) 2px solid}.enchantment-mouseoutblock:hover>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;background-color:rgba(175,197,207,0.75);border:transparent 2px solid;border-radius:0.2em}tw-link.enchantment-button,.enchantment-link.enchantment-button,.enchantment-button:not(.enchantment-link) tw-link,.enchantment-button:not(.enchantment-link) .enchantment-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}tw-dialog-links{padding-top:1.5em}tw-dialog-links tw-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block;display:inline-block}html{margin:0;height:100%;overflow-x:hidden}*,:before,:after{position:relative;box-sizing:inherit}body{margin:0;height:100%}tw-storydata{display:none}tw-story{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;font:100% Georgia, serif;box-sizing:border-box;width:100%;min-height:100%;font-size:1.5em;line-height:1.5em;padding:5% 5%;overflow:hidden;background-color:#000;color:#fff}tw-story [style*=content-box] *{box-sizing:border-box}@media (min-width: 576px){tw-story{padding:5% 20%}}tw-story tw-consecutive-br{display:block;height:1.6ex;visibility:hidden}tw-story select{background-color:transparent;font:inherit;border-style:solid;padding:2px}tw-story select:not([disabled]){color:inherit}tw-story textarea{resize:none;background-color:transparent;font:inherit;color:inherit;border-style:none;padding:2px}tw-story input[type=checkbox]{transform:scale(1.5);margin:0 0.5em}tw-story tw-noscript{animation:appear 0.8s}tw-passage{display:block}tw-sidebar{text-align:center;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}@media (min-width: 576px){tw-sidebar{left:-5em;width:3em;position:absolute;-ms-flex-direction:column;flex-direction:column}tw-enchantment[style*="width"]>tw-sidebar{width:inherit}}tw-icon{display:inline-block;margin:0.5em 0;font-size:66px;font-family:"Verdana",sans-serif}tw-icon[alt]{opacity:0.2}tw-icon[alt]:hover{opacity:0.4}tw-icon[data-label]::after{font-weight:bold;content:attr(data-label);font-size:20px;bottom:-20px;left:-50%;white-space:nowrap}tw-meter{display:block}tw-hook:empty,tw-expression:empty{display:none}tw-error{display:inline-block;border-radius:0.2em;padding:0.2em;font-size:1rem;cursor:help;white-space:pre-wrap}tw-error.error{background-color:rgba(223,58,190,0.6);color:#fff}tw-error.warning{background-color:rgba(223,140,58,0.6);color:#fff;display:none}.debug-mode tw-error.warning{display:inline}tw-error-explanation{display:block;font-size:0.8rem;line-height:1rem}tw-open-button,tw-folddown{cursor:pointer;line-height:0em;border-radius:1px;border:1px solid black;font-size:0.8rem;margin:0 0.4rem;padding:2px;white-space:pre}tw-folddown::after{content:"\25b6"}tw-folddown.open::after{content:"\25bc"}tw-open-button::after{content:"Open"}tw-notifier{border-radius:0.2em;padding:0.2em;font-size:1rem;background-color:rgba(223,182,58,0.4);display:none}.debug-mode tw-notifier{display:inline}tw-notifier::before{content:attr(message)}tw-colour{border:1px solid black;display:inline-block;width:1em;height:1em}tw-enchantment:empty{display:none}h1{font-size:3em}h2{font-size:2.25em}h3{font-size:1.75em}h1,h2,h3,h4,h5,h6{line-height:1em;margin:0.3em 0 0.6em 0}pre{font-size:1rem;line-height:initial}small{font-size:70%}big{font-size:120%}mark{color:rgba(0,0,0,0.6);background-color:#ff9}ins{color:rgba(0,0,0,0.6);background-color:rgba(255,242,204,0.5);border-radius:0.5em;box-shadow:0em 0em 0.2em #ffe699;text-decoration:none}center{text-align:center;margin:0 auto;width:60%}blink{text-decoration:none;animation:fade-in-out 1s steps(1, end) infinite alternate}tw-align{display:block}tw-columns{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:justify;justify-content:space-between}.transition-in{animation:appear 0ms step-start}.transition-out{animation:appear 0ms step-end}[data-t8n^=dissolve].transition-in,[data-t8n=fade].transition-in{animation:appear .8s}[data-t8n^=dissolve].transition-out,[data-t8n=fade].transition-out{animation:appear .8s reverse}[data-t8n^=shudder].transition-in{display:inline-block !important;animation:shudder-in .8s}[data-t8n^=shudder].transition-out{display:inline-block !important;animation:shudder-in .8s reverse}[data-t8n^=rumble].transition-in{display:inline-block !important;animation:rumble-in .8s}[data-t8n^=rumble].transition-out{display:inline-block !important;animation:rumble-in .8s reverse}[data-t8n^=pulse].transition-in{animation:pulse .8s;display:inline-block !important}[data-t8n^=pulse].transition-out{animation:pulse .8s reverse;display:inline-block !important}[data-t8n^=zoom].transition-in{animation:zoom-in .8s;display:inline-block !important}[data-t8n^=zoom].transition-out{animation:zoom-in .8s reverse;display:inline-block !important}[data-t8n^=blur].transition-in{animation:blur .8s;display:inline-block !important}[data-t8n^=blur].transition-out{animation:blur .8s reverse;display:inline-block !important}[data-t8n^=slideleft].transition-in{animation:slide-left .8s;display:inline-block !important}[data-t8n^=slideleft].transition-out{animation:slide-right .8s reverse;display:inline-block !important}[data-t8n^=slideright].transition-in{animation:slide-right .8s;display:inline-block !important}[data-t8n^=slideright].transition-out{animation:slide-left .8s reverse;display:inline-block !important}[data-t8n^=slideup].transition-in{animation:slide-up .8s;display:inline-block !important}[data-t8n^=slideup].transition-out{animation:slide-down .8s reverse;display:inline-block !important}[data-t8n^=slidedown].transition-in{animation:slide-down .8s;display:inline-block !important}[data-t8n^=slidedown].transition-out{animation:slide-up .8s reverse;display:inline-block !important}[data-t8n^=fadeleft].transition-in{animation:fade-left .8s;display:inline-block !important}[data-t8n^=fadeleft].transition-out{animation:fade-right .8s reverse;display:inline-block !important}[data-t8n^=faderight].transition-in{animation:fade-right .8s;display:inline-block !important}[data-t8n^=faderight].transition-out{animation:fade-left .8s reverse;display:inline-block !important}[data-t8n^=fadeup].transition-in{animation:fade-up .8s;display:inline-block !important}[data-t8n^=fadeup].transition-out{animation:fade-down .8s reverse;display:inline-block !important}[data-t8n^=fadedown].transition-in{animation:fade-down .8s;display:inline-block !important}[data-t8n^=fadedown].transition-out{animation:fade-up .8s reverse;display:inline-block !important}[data-t8n^=flicker].transition-in{animation:flicker .8s}[data-t8n^=flicker].transition-out{animation:flicker .8s reverse}
</style>
</head>
<body>
<tw-story><noscript><tw-noscript>JavaScript needs to be enabled to play Future of VR Sociotechnical Imaginaries.</tw-noscript></noscript></tw-story>
<tw-storydata name="Future of VR Sociotechnical Imaginaries" startnode="65" creator="Twine" creator-version="2.3.16" ifid="28F3ECD1-FF7D-4463-AE34-057F28044073" zoom="0.25" format="Harlowe" format-version="3.2.3" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">@import url('https://fonts.googleapis.com/css?family=Lato&display=swap');
 
body, tw-story
{
  font-family: 'Lato', sans-serif;
  color: #4A4535;
  background-color: #D6D5D0;
  font-size: 18px
}

tw-passage img {
	display: block;
	margin: 0 auto;
}


/**
 * Harlowe Audio Library (HAL), by Chapel, v2.2.0
 * for Harlowe 2.1.0 and higher
 * Released under the Unlicense, and dedicated to the public domain.
**/
#audio-overlay{position:fixed;top:0;right:0;left:0;bottom:0;z-index:100000;background:#111}.lds-ring{display:block;position:relative;top:20%;margin:auto;width:20em;height:20em}.lds-ring div{box-sizing:border-box;display:block;position:absolute;width:18em;height:18em;margin:6px;border:6px solid #fff;border-radius:50%;-webkit-animation:lds-ring 1.2s cubic-bezier(.5,0,.5,1) infinite;animation:lds-ring 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:#fff transparent transparent transparent}.lds-ring div:nth-child(1){-webkit-animation-delay:-.45s;animation-delay:-.45s}.lds-ring div:nth-child(2){-webkit-animation-delay:-.3s;animation-delay:-.3s}.lds-ring div:nth-child(3){-webkit-animation-delay:-.15s;animation-delay:-.15s}@-webkit-keyframes lds-ring{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes lds-ring{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}input#audio-volume{width:100%;margin:2em 0}span#vol-title{position:relative;bottom:-1em;font-size:1rem;float:left}tw-link#audio-mute{display:inline-block;padding:.3em;width:90%;text-decoration:none;color:#111;background:#eee;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border:1px solid #000}tw-link#audio-mute:hover{opacity:.8}tw-link#audio-mute:active{opacity:.6}tw-link#audio-mute span{display:inline-block;width:1em;position:relative;height:1em;top:.2em;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAQAAABLCVATAAABF0lEQVR4Ae2VJVREYRSEB3ftuFUaLhF6I22iF7TgLr1XvAc849CwiBac9Xtm3e97cefp/Pec7+mdH0mZrGtMoBomyAEHfjGHXKg07gNxeUS3BuMAqGZswE7YcOIYgqgG7BFlSQgTAgKysC2jNjQmghFQCOpMxq+QmQgmFATU4kcq/YlgfKB1lALUqFSukRIbEwpy4BTZPM/Bu9TaQ362KAsl56sAtSR+Sgv6RCFdr/gjBYiuj65c3J0eNEmXz95TgybocvmoJj3avf5l59L1iD/WglZCP7/uh8zgeQ6epdahaZENFIPCCFvEYNPW4JdNazBGzhkj6caCbSc02DRRu0+8RR/+rb7wx6D505HxCVKvG0zpp+yknHe8MBDkT/s8AAAAAElFTkSuQmCC);background-size:contain}tw-link#audio-mute.muted span{right:4px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAASElEQVR4Ae3WsQ0AMAjAsJ7ez9MTGEmlRGL3BJzPq6prw2DDYMNgw2DDYMOwh1kAMUygQIEC2RejANVxnVE9aDOqJ39GVZWqB5Z3r1ndBX5oAAAAAElFTkSuQmCC)}div#audio-volume{float:left}div#audio-controls{font:100% Georgia,serif;font-size:1.5em;position:fixed;width:8em;height:100%;padding:1em 2em;z-index:10000;top:0;left:0;bottom:0;background:#333;color:#eee;-webkit-transition:left .3s;transition:left .3s;text-align:center}div#audio-controls.closed{left:-10.5em}div#audio-controls tw-link#audio-panel-toggle{display:inline-block;width:1.5em;position:absolute;height:1.5em;top:0;right:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;text-decoration:none;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAQAAABLCVATAAAAYklEQVR4Ae3MsQFAMAAEQMDEagCgN4EuVTrbPcACeUBugDNeSdMQomI0PmYdTEYD9DA5jcVoBKuxGY1kNQ6jGRSaGaIj8gw1aI/KYVUSNqsSzMpiVT2zMjlVN0fqVW5o2luMGHqkQmD9cPYAAAAASUVORK5CYII=);background-size:contain}div#audio-controls.closed tw-link#audio-panel-toggle{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAQAAABLCVATAAAAZElEQVR4Ae3TpwGAMBQAUfrEeHB0cDhcXBSO7ehlgBw9N8BL/YZO95r6uA/UEbOv+ylfHRJ9z1BWLynKJqmWohyS6ijKOygKCpmjZYqXTTA2xUiCsShGAMw8/Q3ArFgFMHek0w3WCaR74eO2YQAAAABJRU5ErkJggg==)}@media screen and (max-width:800px){div#audio-controls.closed{left:-12em}div#audio-controls.closed tw-link#audio-panel-toggle{right:-1.5em}}div#story-menu{margin:1em 0}tw-link.story-menu{width:100%;display:block;font-weight:400;background:#ccc;font-size:.9em;padding:.1em 0;color:#111;border:1px solid #333}tw-link.story-menu.hide{display:none}tw-link.story-menu:hover{opacity:.8}tw-link.story-menu:active{opacity:.6}input[type=range].hal{-webkit-appearance:none;width:100%;margin:2.25px 0}input[type=range].hal:focus{outline:0}input[type=range].hal::-webkit-slider-runnable-track{width:100%;height:15.5px;cursor:pointer;box-shadow:.4px .4px 1px #000,0 0 .4px #0d0d0d;background:#111;border-radius:0;border:0 solid #010101}input[type=range].hal::-webkit-slider-thumb{box-shadow:0 0 2.2px rgba(17,17,17,.1),0 0 0 rgba(30,30,30,.1);border:0 solid #fff;height:20px;width:11px;border-radius:0;background:rgba(255,255,255,.93);cursor:pointer;-webkit-appearance:none;margin-top:-2.25px}input[type=range].hal:focus::-webkit-slider-runnable-track{background:#444}input[type=range].hal::-moz-range-track{width:100%;height:15.5px;cursor:pointer;box-shadow:.4px .4px 1px #000,0 0 .4px #0d0d0d;background:#111;border-radius:0;border:0 solid #010101}input[type=range].hal::-moz-range-thumb{box-shadow:0 0 2.2px rgba(17,17,17,.1),0 0 0 rgba(30,30,30,.1);border:0 solid #fff;height:20px;width:11px;border-radius:0;background:rgba(255,255,255,.93);cursor:pointer}input[type=range].hal::-ms-track{width:100%;height:15.5px;cursor:pointer;background:0 0;border-color:transparent;color:transparent}input[type=range].hal::-ms-fill-lower{background:#000;border:0 solid #010101;border-radius:0;box-shadow:.4px .4px 1px #000,0 0 .4px #0d0d0d}input[type=range].hal::-ms-fill-upper{background:#111;border:0 solid #010101;border-radius:0;box-shadow:.4px .4px 1px #000,0 0 .4px #0d0d0d}input[type=range].hal::-ms-thumb{box-shadow:0 0 2.2px rgba(17,17,17,.1),0 0 0 rgba(30,30,30,.1);border:0 solid #fff;height:20px;width:11px;border-radius:0;background:rgba(255,255,255,.93);cursor:pointer;height:15.5px}input[type=range].hal:focus::-ms-fill-lower{background:#111}input[type=range].hal:focus::-ms-fill-upper{background:#444}
/** End of HAL code */





</style><script role="script" id="twine-user-script" type="text/twine-javascript">





/**
 * Harlowe Audio Library (HAL), by Chapel, v2.2.0
 * for Harlowe 2.1.0 and higher
 * Released under the Unlicense, and dedicated to the public domain.
**/
;!function(e){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),function(){"use strict";window.Fast={filter:function(e,t){var o,n=e.length,a=[];for(o=0;o<n;o++)t(e[o],o,e)&&a.push(e[o]);return a},forEach:function(e,t){var o,n=e.length;for(o=0;o<n;o++)t(e[o],o,e)},map:function(e,t){var o,n=e.length,a=new Array(n);for(o=0;o<n;o++)a[o]=t(e[o],o,e);return a},find:function(e,t){var o,n=e.length;for(o=0;o<n;o++)if(t(e[o],o,e))return e[o]},findIndex:function(e,t){var o,n=e.length;for(o=0;o<n;o++)if(t(e[o],o,e))return o;return-1},some:function(e,t){var o,n=e.length;for(o=0;o<n;o++)if(t(e[o],o,e))return!0;return!1}}}(),window.Chapel=window.Chapel||{},window.Chapel.options={preload:!0,loadDelay:0,muteOnBlur:!0,startingVol:.5,persistPrefs:!0,globalA:!0,showControls:!0,sidebarStartClosed:!0,volumeDisplay:!1,trackLoadLimit:500,totalLoadLimit:8e3,debug:!1},window.Chapel.debug=function(){Chapel.options.debug&&console.log.apply(null,arguments)},function(){"use strict";var n=$("tw-storydata"),o=/(.+?):(.+)/,t=/[\r\n]+/,a=/^["']/,r=/["']$/;function e(e){return Fast.map(Fast.filter(e.split(t),function(e){return e&&e.trim()&&e.includes(":")}),function(e){return e.trim()})}function i(e){return e.trim().replace(a,"").replace(r,"").trim()}function s(e){var t=e.match(o);return{key:i(t[1]),value:i(t[2])}}var u=n.find('tw-passagedata[name="hal.tracks"]'),l=null;if(u.length){var c=e(u.text());l=new Map(Fast.map(c,function(e){var t,o=s(e);return[o.key,(t=o.value,Fast.map(t.split(","),function(e){return i(e)}))]}))}var p=n.find('tw-passagedata[name="hal.config"]'),d=null;if(p.length){var m=e(p.text()),f={};Fast.forEach(Fast.map(m,function(e){return s(e)}),function(e){f[e.key]=e.value}),d=f}function h(e){var t=n.attr("format-version");if(e)return t;var o=t.split(".")[0];return o=Number(o),Number.isNaN(o)&&(o=3),o<1&&(o=3),o}d&&Fast.forEach(Object.keys(d),function(e){var t=e,o=f[e],n=typeof Chapel.options[e];"boolean"==n?"true"===o?Chapel.options[t]=!0:"false"===o&&(Chapel.options[t]=!1):"number"==n?(o=Number(o),Number.isNaN(o)||(Chapel.options[t]=o)):"string"==n&&o&&(Chapel.options[t]=o)});var g=require("macros");if(window.Chapel=window.Chapel||{},window.Chapel.Macros={add:function(n){n&&"object"==typeof n&&Fast.forEach(Object.keys(n),function(e){var t,o;o=n[t=e],g.add(t,function(){var e=[].slice.call(arguments).slice(1),t=o.apply(null,e);return"string"==typeof t||"boolean"==typeof t||"number"==typeof t?t:""},g.TypeSignature.zeroOrMore(g.TypeSignature.Any))})}},window.Chapel.Get={version:h(),isHarlowe3OrLater:3<=h(),storyTitle:n.attr("name"),IFID:n.attr("ifid"),fromPassage:l},Chapel.debug("Harlowe Version -> ",h(!0)),Chapel.debug("Harlowe Major Version -> ",Chapel.Get.version),Chapel.debug("Story Title -> ",Chapel.Get.storyTitle),Chapel.debug("Story IFID -> ",Chapel.Get.IFID),Chapel.Get.version<2)throw new Error("The Harlowe Audio Library is only designed to work with Harlowe 2 and 3; you appear to be using Harlowe 1 or an otherwise invalid story format.","get.js -> initialization",176);Chapel.options.storagekey="%%hal-"+Chapel.Get.IFID+"-{"+Chapel.Get.storyTitle+"}",Chapel.debug("Storage Key -> ",Chapel.options.storagekey)}(),function(){"use strict";var t=Chapel.options,e=function(e,t){if(window.localStorage)try{e=""+e,"string"!=typeof t&&(t=JSON.stringify(t)),window.localStorage.setItem(e,t)}catch(e){console.error(e)}},o=function(e){if(window.localStorage)try{return e=""+e,window.localStorage.getItem(e)}catch(e){console.error(e)}},n=function(e){if(window.localStorage)try{e=""+e,window.localStorage.removeItem(e)}catch(e){console.error(e)}},a={loaded:[],classes:{},master:{volume:t.startingVol,mute:!1},groups:{playing:[],looping:[],custom:{}},mute:function(e){a.master.mute=!!e,$(document).trigger({type:":master-mute",mute:!!e})},isMuted:function(){return!!a.master.mute},volume:function(e){e=Number(e),Number.isNaN(e)||(1<e?e=1:e<0&&(e=0),a.master.volume=e),$(document).trigger({type:":master-volume",volume:e})},getVolume:function(){return a.master.volume},stopAll:function(){a.classes.Track&&Fast.forEach(a.classes.Track.list,function(e){e.stop()})},audioPlaying:function(){return!!a.groups.playing.length},savePrefs:function(){e(t.storagekey,a.master)},loadPrefs:function(){var e=o(t.storagekey);e&&"object"==typeof e&&e.hasOwnProperty("volume")&&"number"==typeof e.volume&&e.hasOwnProperty("mute")&&"boolean"==typeof e.volume&&(delete a.master,a.master=e)},clearPrefs:function(){n(t.storagekey)}},r={track:[":available",":loaded",":play",":stop",":mute",":volume"],master:[":master-mute",":master-volume"]};var i=r.track.concat(r.master);function s(e,t){if(!e||"string"!=typeof e||!e.trim())return null;var o=Fast.filter(Fast.map(e.split(" "),function(e){return":"!==(e=e.split(".")[0])[0]&&(e=":"+e),e+".userland"}),function(e){return t?i.includes(e):r.track.includes(e)}).join(" ");return o&&o.trim()?o:null}a.data={parseEvent:s,bail:function(e){throw new Error(e,"audio.js -> bail()",140)}},a.on=function(e,t){t&&"function"==typeof t?(e=s(e,!0))&&$(document).on(e,t):console.error("Chapel.Audio.on() -> invalid callback")},a.one=function(e,t){t&&"function"==typeof t?(e=s(e,!0))&&$(document).one(e,t):console.error("Chapel.Audio.one() -> invalid callback")},a.off=function(e){(e=s(e,!0))&&$(document).off(e)},t.persistPrefs&&($(document).on(":master-mute",a.savePrefs),$(document).on(":master-volume",a.savePrefs)),$(document).on(":play",function(e){e.track.addToGroup("playing")}),$(document).on(":stop",function(e){e.track.removeFromGroup("playing")}),t.muteOnBlur&&$(window).on("blur",function(){a.isMuted()||(a.mute(!0),$(window).one("focus",function(){a.mute(!1)}))}),a.parseEvent=s,window.Chapel=window.Chapel||{},window.Chapel.Audio=a}(),function(){"use strict";var r=Chapel.Audio,o=r.data.pareEvent,a=r.data.bail,i=Chapel.options,t=$(document.createElement("div")).attr("id","audio-container").css("display","none").appendTo(document.body),s={aac:"audio/aac",caf:"audio/x-caf","x-caf":"audio/x-caf",mp3:'audio/mpeg; codecs="mp3"',mpeg:'audio/mpeg; codecs="mp3"',m4a:"audio/mp4",mp4:"audio/mp4","x-m4a":"audio/mp4","x-mp4":"audio/mp4",oga:"audio/ogg",ogg:"audio/ogg",opus:'audio/ogg; codecs="opus"',wav:"audio/wav",wave:"audio/wav",weba:"audio/webm",webm:"audio/webm"};function u(e,t,o){this instanceof u||a("Track: called without `new` operator"),e||a("Track: no id specified"),"string"!=typeof e&&a("Track: track id is not a string"),t&&(!Array.isArray(t)||t.length)||a("Track: no sources specified"),o?t=[].slice.call(arguments).slice(1):"string"==typeof t&&(t=[t]);var n=$(document.createElement("audio"));Fast.forEach(t,function(e){var t,o;$(document.createElement("source")).attr({src:e,type:(t=e.split("."),(o=t[t.length-1]).includes("?")&&(o=o.split("?")[0]),o=o.toLowerCase().trim(),Object.keys(s).includes(o)||a('Track: unsupported file type "'+o+'"'),s[o])}).appendTo(n)}),n.attr({"data-track":"id","data-volume":1,"data-mute":!1}).one("canplaythrough.hal",function(){r.loaded.push(e)}),i.preload&&n.attr("preload","auto"),n[0].volume=+r.master.volume,this.id=e,this.$el=n,this.unwrap=n[0],this.sources=t}Object.assign(u,{list:[],is:function(e){return e instanceof u},has:function(t){return Fast.some(u.list,function(e){return e.id===t})},emit:function(e,t){$(document).trigger({type:e,track:t}),t.emit(e)},add:function(e,t,o){o&&(t=[].slice.call(arguments).slice(1));var n=new u(e,t);return u.list.push(n),n.$el.on("canplay",function(){u.emit(":available",n)}),n.$el.on("canplaythrough",function(){u.emit(":loaded",n)}),n.attach(),n},renew:function(){Fast.forEach(u.list,function(e){e.mute(e.isMuted()),e.volume(e.getVolume())})},getIdx:function(t){return Fast.findIndex(u.list,function(e){return e.id===t})},get:function(t){var e=Fast.find(u.list,function(e){return e.id===t});if(!e)throw new ReferenceError('There is no track with the id "'+t+'". Please check your spelling and capitalization.',"track.js -> Track.get()",155);return e},removeFromDOM:function(e){"string"==typeof e&&(e=u.get(e)),e&&u.is(e)?e.unattach():t.remove()},_runOnMultiple:function(e,t,o){e instanceof Array&&u.prototype.hasOwnProperty(t)&&Fast.forEach(u.list,function(e){u.is(e)||(e=u.get(e)||null),e&&e[t].apply(e,o&&o instanceof Array?o:[])})}}),Object.assign(u.prototype,{constructor:u,emit:function(e){this.$el.trigger({type:e,track:this})},clone:function(){return new u(this.id,this.sources)},isAttached:function(){return $.contains(t[0],this.unwrap)},attach:function(){return this.isAttached()||this.$el.appendTo(t),this},unattach:function(){return this.isAttached()&&this.$el.remove(),this},isPlaying:function(){return!this.unwrap.paused},play:function(){var e=this;return this.unwrap.play(),u.emit(":play",this),this.$el.on("ended",function(){e.unwrap.loop||(e.unwrap.currentTime=0,u.emit(":stop",e))}),this},playWhenPossible:function(){var t=this;return this.unwrap.play().then(function(){u.emit(":play",t),t.$el.on("ended",function(){t.unwrap.loop||(t.unwrap.currentTime=0,u.emit(":stop",t))})},function(e){$(document).one("click mousedown keydown touchstart",function(){t.play()})}).catch(function(e){console.error(e)}),this},forcePlay:function(){var e=this,t=$(document.createElement("a")).css("display","none").appendTo(document.body).on("click",function(){e.play()});setTimeout(function(){t.trigger("click")},safeAudioStart)},pause:function(){return this.unwrap.pause(),u.emit(":pause",this),this},stop:function(){return this.unwrap.pause(),this.unwrap.currentTime=0,u.emit(":stop",this),this},mute:function(e){return e=!!e,this.$el.attr("data-mute",e),r.master.mute?this.unwrap.muted=!0:this.unwrap.muted=e,u.emit(":mute",this),this},isMuted:function(){var e=this.$el.attr("data-mute");return"boolean"==typeof e?e:"false"!==e},toggleMute:function(){return this.mute(!this.isMuted()),this},volume:function(e){return e=Number(e),Number.isNaN(e)||(1<e?e=1:e<0&&(e=0),this.$el.attr("data-volume",e),this.unwrap.volume=e*r.master.volume),u.emit(":volume",this),this},getVolume:function(){return Number(this.$el.attr("data-volume"))},addToGroup:function(e,t){var o=this,n=t?r.groups.custom[e]:r.groups[e];return Fast.some(n,function(e){return o.id===e.id})||n.push(this),this},removeFromGroup:function(e,t){var o=this,n=t?r.groups.custom[e]:r.groups[e],a=Fast.findIndex(n,function(e){return e.id&&e.id===o.id});return n.splice(a,1),this},loop:function(e){return this.unwrap.loop=!!e,this.unwrap.loop?this.addToGroup("looping"):this.removeFromGroup("looping"),this},isLooping:function(){return!!this.unwrap.loop},toggleLoop:function(){return this.loop(!this.isLooping()),this},seek:function(e){return e<0?e=this.unwrap.duration-e:e>this.unwrap.duration&&(e=this.unwrap.duration),this.unwrap.currentTime=e,this},fadeIn:function(e){var t=this;e=e||1;var o=this.getVolume();return this.volume(0),this.play(),this.$el.animate({volume:o*r.master.volume},1e3*e,function(){t.volume(o),u.emit(":volume",t),u.emit(":fade",t)}),this},fadeOut:function(e){e=e||1;var t=this,o=this.getVolume();return this.$el.animate({volume:0},1e3*e,function(){t.stop(),t.volume(o),u.emit(":volume",t),u.emit(":fade",t)}),this},fadeTo:function(e,t){var o=this;if(e=e||1,t=Number(t),!Number.isNaN(t))return 1<t?t=1:t<0&&(t=0),this.$el.animate({volume:t*r.master.volume},1e3*e,function(){o.volume(t),u.emit(":volume",o),u.emit(":fade",o)}),this;alert("ivalid volume level")},delay:function(e,t){var o=this;"function"==typeof t&&(e=Number(e),(Number.isNaN(e)||e<0)&&(e=0),setTimeout(function(){t.call(o,o,e)},e))},on:function(e,t){if(!t||"function"!=typeof t)return console.error("<track>.on() -> invalid callback"),this;(e=o(e))&&this.$el.on(e,t)},one:function(e,t){if(!t||"function"!=typeof t)return console.error("<track>.one() -> invalid callback"),this;(e=o(e))&&this.$el.one(e,t)},off:function(e){(e=o(e))&&this.$el.off(e)}}),r.classes.Track=u,r.newTrack=function(){try{return u.add.apply(null,arguments)}catch(e){console.error(e.message),alert("Error in A.newTrack() -> see the console for more information.")}},r.track=function(e){try{return u.get(e)}catch(e){console.error(e.message),alert("Error in A.track() -> see the console for more information.")}},$(document).on(":master-mute",u.renew),$(document).on(":master-volume",u.renew)}(),function(){"use strict";var i=Chapel.Audio,s=i.classes.Track,o=(i.data._extend,/(play)?list:(.+)/i);i.createGroup=function(e,t,o){var n,a,r;n=o?[].slice.call(arguments).slice(1):t,a=e,(r=n)&&Array.isArray(r)||(r=[]),i.groups.custom[a]=Fast.map(r,function(e){return s.get(e)})},i.group=function(e){if(!(this instanceof i.group))return new i.group(e);if(Object.keys(i.groups.custom).includes(e))this.members=i.groups.custom[e];else{if(!(i.groups[e]&&i.groups[e]instanceof Array))throw new ReferenceError('There is no group with the id "'+id+'". Please check your spelling and capitalization.',"group.js -> A.group()",29);this.members=i.groups[e]}if(o.test(e)){var t=e.match(o)[2];t&&t.trim()&&(this.members=i.playlist(t).tracks)}Array.isArray(this.members)||(this.members=[],console.error('Could not find members for track group "'+e+'"!'))},Object.assign(i.group,{is:function(e){return this instanceof i.group},_runOnAll:function(e,t,o,n){null!=n?o=[].slice.call(arguments).slice(2):o instanceof Array||(o=[o]);var a=[e.members,t,o];s._runOnMultiple.apply(null,a)}}),Object.assign(i.group.prototype,{constructor:i.group,_run:function(){i.group._runOnAll.apply(null,[this].concat([].slice.call(arguments)))},play:function(){return this._run("play"),this},pause:function(){return this._run("pause"),this},stop:function(){return this._run("stop"),this},mute:function(e){return this._run("mute",e),this},volume:function(e){return this._run("volume",e),this},loop:function(e){return this._run("loop",e),this}})}(),function(){"use strict";var e=Chapel.Audio,r=e.classes.Track;e.data._extend;function n(e,t){if(!(this instanceof n))return new n(e,t);this.id=e,this.tracks=t.map(function(e){return r.get(e)}),this.looping=!1,this.current="",this.playing=!1}Object.assign(n,{list:{},is:function(e){return e instanceof n},add:function(e,t,o){return o&&(t=[].slice.call(arguments).slice(1)),n.list[e]=new n(e,t),n.list[e]},_runOnAll:function(e,t,o,n){null!=n?o=[].slice.call(arguments).slice(2):o instanceof Array||(o=[o]);var a=[e.tracks,t,o];r._runOnMultiple.apply(null,a)}}),Object.assign(n.prototype,{constructor:n,clone:function(){return new n(this.id,this.tracks.map(function(e){return e.id}))},_run:function(){n._runOnAll.apply(null,[this].concat([].slice.call(arguments)))},volume:function(e){return this._run("volume",e),this},mute:function(e){return this._run("mute",e),this},shuffle:function(){var e,t,o,n=this.tracks;for(o=n.length-1;0<o;o--)e=Math.floor(Math.random()*(o+1)),t=n[o],n[o]=n[e],n[e]=t;return this.tracks=n,this},random:function(){return this.tracks[Math.floor(Math.random()*this.tracks.length)]},isPlaying:function(){return this.playing},nowPlaying:function(){return r.get(this.current)},play:function(e){var t=this;if((e=e||(t.current?Fast.findIndex(t.tracks,function(e){return e.id===t.current}):0))>=t.tracks.length&&t.looping)e=0;else if(e>=t.tracks.length)return t.current="",void(t.playing=!1);var o=t.tracks[e],n=o.isLooping();return o.loop(!1),o.play(),t.playing=!0,setTimeout(function(){o.isPlaying()||(t.playing=!1)},20),t.current=o.id,o.$el.one("ended.playlist",function(){e++,o.loop(n),t.play(e)}),t},loop:function(e){return this.looping=!!e,this},isLooping:function(){return this.looping},stop:function(){if(this.current&&this.isPlaying()){var e=this.nowPlaying();e&&(e.stop(),e.$el.off(".playlist"))}else this._run("stop");return this.current="",this.playing=!1,this},pause:function(){if(this.current&&this.isPlaying()){var e=this.nowPlaying();e&&e.pause()}return this.playing=!1,this}}),e.classes.Playlist=n,e.createPlaylist=function(){try{n.add.apply(null,arguments)}catch(e){console.error(e.message),alert("Error in A.createPlaylist() -> see the console for more information.")}},e.playlist=function(e){try{var t=n.list[e]||null;if(!t)throw new ReferenceError('There is no playlist with the id "'+e+'". Please check your spelling and capitalization.',"list.js -> A.playlist()",171);return t}catch(e){console.error(e.message),alert("Error in A.createPlaylist() -> see the console for more information.")}}}(),function(){"use strict";var t=Chapel.Audio,o=t.classes.Track,n=t.classes.Playlist;function a(t,o){if("object"!=typeof o)throw new TypeError("Invalid extension.","extensions.js -> _extend()",8);Fast.forEach(Object.keys(o),function(e){if(void 0!==t[e])throw new Error('Invalid extension: cannot clobber existing property "'+e+'".',"extensions.js -> _extend()",8);t[e]=o[e]})}t.extend=function(e){a(Audio,e)},o.extend=function(e){a(o,e)},o.extendPrototype=function(e){a(o.prototype,e)},t.extendTrack=o.extend,t.extendTrackProto=o.extendPrototype,t.group.extend=function(e){a(t.group,e)},t.group.extendPrototype=function(e){a(t.group.prototype,e)},t.extendGroup=t.group.extend,t.extendGroupProto=t.group.extendPrototype,n.extend=function(e){a(n,e)},n.extendPrototype=function(e){a(n.prototype,e)},t.extendPlaylist=n.extend,t.extendPlaylistProto=n.extendPrototype}(),function(){"use strict";var e=Chapel.options;if(e.showControls){var t=$(document.createElement("div")).attr("id","story-menu").css("display","none"),o=$(document.createElement("span")).attr("id","vol-title").append("Volume");e.volumeDisplay||o.css("display","none");var n=$(document.createElement("input")).attr({id:"audio-volume",type:"range",min:1,max:99,step:1,title:"Volume"}).addClass("hal"),a=Math.trunc(100*window.Chapel.Audio.master.volume);a<0?a=0:100<a&&(a=100),n.attr("value",a);var r=function(e){void 0===e&&(e=n.val()),o.empty().append("Volume "+e)};n.on("input",function(){window.Chapel.Audio.volume($(this).val()/100),r($(this).val())});var i=$(document.createElement("tw-link")).attr({id:"audio-mute",title:"Mute"}).append("Mute <span></span>").on("click",function(e){e.preventDefault(),$(this).toggleClass("muted"),Chapel.Audio.mute(!Chapel.Audio.isMuted())});Chapel.Audio.isMuted()&&i.addClass("muted");var s=$(document.createElement("tw-link")).attr("id","audio-panel-toggle").on("click",function(e){e.preventDefault(),u.toggleClass("closed")}),u=$(document.createElement("div")).attr("id","audio-controls").append(t,o,n,i,s).appendTo(document.body);e.sidebarStartClosed&&u.addClass("closed"),window.Chapel=window.Chapel||{},window.Chapel.Audio=window.Chapel.Audio||{},window.Chapel.Audio.controls={$panel:u,$volume:n,$mute:i,$user:t,close:function(){u.addClass("closed")},open:function(){u.removeClass("closed")},toggle:function(){u.toggleClass("closed")},hide:function(){u.css("display","none")},show:function(){u.css("display","block")},updateVolume:r}}}(),function(){"use strict";var s=Chapel.options,t=State,e=$(document.createElement("div")).attr("id","audio-overlay").css("display","none").appendTo(document.body);function o(){e.css("display","block").append('<div class="lds-ring"><div></div><div></div><div></div><div></div></div>')}function u(){e.fadeOut(function(){e.empty()})}window.Chapel=window.Chapel||{},window.Chapel.Audio=window.Chapel.Audio||{},window.Chapel.Audio.loadScreen={show:o,dismiss:u,kill:function(){$("#audio-overlay").remove()}},window.Chapel.Audio.$overlay=e,window.Chapel.Audio.preload=function(){if(Chapel.debug("This is a mobile browser -> ",$.browser.mobile),!(t.pastLength||t.futureLength||$.browser.mobile)){$(document).ready(function(){o()});var a=100+s.loadDelay,e=Chapel.Audio.classes.Track.list,r=Chapel.Audio.loaded;if(e.length){var i=Fast.map(e,function(e){return e.id});0<s.totalLoadLimit&&setTimeout(function(){u()},s.totalLoadLimit),function e(){if(i.length){var t=i.shift();if(r.includes(t))e();else{var o=Chapel.Audio.classes.Track.get(t);if(o.unwrap.readyState<2){var n=!1;o.$el.one("canplaythrough.hal",function(){e(),n=!0}),setTimeout(function(){n||(o.$el.off("canplaythrough.hal"),e())},s.trackLoadLimit)}else r.includes(t)||r.push(t),e()}}else setTimeout(u,a)}()}else setTimeout(u,a)}}}(),function(){"use strict";var o=Chapel.options.storagekey+"_hal_restart_";Chapel.debug("HAL Session Key -> ",o);var e,t,n=(window.sessionStorage?(Chapel.debug("Session Storage Available"),e=function(e,t){window.sessionStorage.setItem(o+e,t)},t=function(e){return window.sessionStorage.getItem(o+e)}):(Chapel.debug("Session Storage Unavailable"),e=function(){},t=function(){},console.warn("Session storage is unavailable...")),{save:e,load:t});window.Chapel.Audio.state={_store:n,saveTracks:function(){var e;try{e=Fast.map(Chapel.Audio.classes.Track.list,function(e){return{id:e.id,sources:e.sources}}),Chapel.debug("Session Saved (Tracks) -> ",e),e=JSON.stringify(e),n.save("tracks",e)}catch(e){console.error(e.message)}},loadTracks:function(){var e;try{e=(e=n.load("tracks"))&&JSON.parse(e),Array.isArray(e)&&e.length&&(Chapel.debug("Session Loaded (Tracks) -> ",e),Fast.forEach(e,function(e){e.id&&e.sources&&!Chapel.Audio.classes.Track.has(e.id)?Chapel.Audio.newTrack.apply(null,[e.id].concat(e.sources)):Chapel.debug("Track reloading skipped.")}))}catch(e){console.error(e.message)}},savePlaylists:function(){var e;try{var o=Chapel.Audio.classes.Playlist.list;e=Fast.map(Object.keys(o),function(e){var t={};return t.tracks=Fast.map(o[e].tracks,function(e){return e.id}),t.id=o[e].id,t}),Chapel.debug("Session Saved (Playlists) -> ",e),e=JSON.stringify(e),n.save("playlists",e)}catch(e){console.error(e.message)}},loadPlaylists:function(){var e;try{(e=(e=n.load("playlists"))&&JSON.parse(e))&&Array.isArray(e)&&e.length&&(Chapel.debug("Session Loaded (Playlists) -> ",e),Fast.forEach(e,function(e){e.id&&e.tracks&&Chapel.Audio.createPlaylist(e.id,e.tracks)}))}catch(e){console.error(e.message)}},saveGroups:function(){var t;try{t={},Fast.forEach(Object.keys(Chapel.Audio.groups.custom),function(e){t[e]=Fast.map(Chapel.Audio.groups.custom[e],function(e){return"string"==typeof e?e:e.id})}),Chapel.debug("Session Saved (Groups) -> ",t),t=JSON.stringify(t),n.save("groups",t)}catch(e){console.error(e.message)}},loadGroups:function(){var t;try{(t=(t=n.load("groups"))&&JSON.parse(t))&&"object"==typeof t&&(Chapel.debug("Session Loaded (Groups) -> ",t),Fast.forEach(Object.keys(t),function(e){Fast.map(t[e],function(e){return Chapel.Audio.classes.Track.get(e)})}),Chapel.Audio.groups.custom=t)}catch(e){console.error(e.message)}}}}(),function(){"use strict";var e=Chapel.options;e.globalA&&void 0===window.A&&(Chapel.debug("Created global A interface."),window.A=window.Chapel.Audio),Chapel.Get.fromPassage&&(Chapel.debug("Loading tracks from track def special passage -> ",Chapel.Get.fromPassage),Chapel.Get.fromPassage.forEach(function(e,t){Chapel.Audio.newTrack.apply(null,[t].concat(e))})),$(document).on("unload",function(){Chapel.debug("User Prefs Saved"),window.Chapel.Audio.savePrefs()}),Chapel.Audio.classes.Track.renew(),Chapel.Audio.controls&&Chapel.Audio.controls.updateVolume(),Chapel.Get.isHarlowe3OrLater&&($(window).on("unload",function(){Chapel.debug("HAL State Saved"),Chapel.Audio.state.saveTracks(),Chapel.Audio.state.savePlaylists(),Chapel.Audio.state.saveGroups()}),Chapel.debug("HAL State Loaded"),Chapel.Audio.state.loadTracks(),Chapel.Audio.state.loadPlaylists(),Chapel.Audio.state.loadGroups()),e.persistPrefs&&(Chapel.debug("User Prefs Loaded"),Chapel.Audio.loadPrefs())}(),function(){"use strict";if(Chapel.options.showControls){var s=Engine,u=Chapel.Audio.controls.$user,e=function(){return"none"!==u.css("display")},l=function(){return e()||u.css("display","block"),u},t=function(){return e()&&u.css("display","none"),u};Chapel.Audio.menu={hide:t,show:l,isShown:e,links:{add:function(e,t,o){var n,a;if(!e||"string"!=typeof e){var r="undefined";return alert(r),void console.error(r)}o||"function"!=typeof t?(t&&"string"==typeof t&&(n=t),o&&"function"==typeof o&&(a=o)):(a=t,n=null);var i=$(document.createElement("tw-link")).append(e).attr({tabindex:"0",name:e.toLowerCase().trim()}).on("click",function(){n&&s.goToPassage(n),a&&a()}).addClass("story-menu").appendTo(u);return l(),i},clear:function(){return u.empty(),t()},hide:function(e){e=e.toLowerCase().trim(),$('tw-link.story-menu[name="'+e+'"]').addClass("hide")},show:function(e){e=e.toLowerCase().trim(),$('tw-link.story-menu[name="'+e+'"]').removeClass("hide")},toggle:function(e){e=e.toLowerCase().trim(),$('tw-link.story-menu[name="'+e+'"]').toggleClass("hide")},remove:function(e){e=e.toLowerCase().trim(),$('tw-link.story-menu[name="'+e+'"]').remove()}}}}}(),function(){"use strict";var n=Chapel.Audio;function o(e){return e&&"function"==typeof e}function a(e,t){if(!e||"string"!=typeof e)return null;switch(e=e.toLowerCase().trim()){case"isplaying":e="isPlaying";break;case"playwhenpossible":e="playWhenPossible";break;case"ismuted":e="isAMuted";break;case"togglemute":e="toggleMute";break;case"getvolume":e="getVolume";break;case"islooping":e="isLooping";break;case"toggleloop":e="toggleLoop";break;case"fadein":e="fadeIn";break;case"fadeout":e="fadeOut";break;case"fadeto":e="fadeTo";break;case"stopall":e="stopAll"}if("isPlaying"===e&&"master"===t&&(e="audioPlaying"),"group"===t){if(o(n.group.prototype[e]))return e}else if("master"===t){if(o(n[e]))return e}else if(o(n.classes[t].prototype[e]))return e;throw new ReferenceError('Cannot run the command: "'+e+'" on the API "'+t+'". The command may be invalid, or this may be a bug in HAL.',"macros.js -> getCommand()",10)}var e={newtrack:function(){var e=[].slice.call(arguments);try{return n.newTrack.apply(null,e)}catch(e){alert("Error in the (newtrack:) macro: "+e.message)}},newplaylist:function(e,t){t=[].slice.call(arguments).slice(1);try{return n.createPlaylist(e,t)}catch(e){alert("Error in the (newplaylist:) macro: "+e.message)}},newgroup:function(e,t){t=[].slice.call(arguments).slice(1);try{return n.createGroup(e,t)}catch(e){alert("Error in the (newgroup:) macro: "+e.message)}},masteraudio:function(e){try{return e=a(e,"master"),n[e].apply(null,[].slice.call(arguments).slice(1))}catch(e){alert("Error in the (masteraudio:) macro: "+e.message)}},track:function(e,t){try{var o=n.track(e);return o[t=a(t,"Track")].apply(o,[].slice.call(arguments).slice(2))}catch(e){alert("Error in the (track:) macro: "+e.message)}},playlist:function(e,t){try{var o=n.playlist(e);return o[t=a(t,"Playlist")].apply(o,[].slice.call(arguments).slice(2))}catch(e){alert("Error in the (playlist:) macro: "+e.message)}},group:function(e,t){try{var o=n.group(e);return o[t=a(t,"group")].apply(o,[].slice.call(arguments).slice(2))}catch(e){alert("Error in the (group:) macro: "+e.message)}}};window.Chapel.Macros.add(e)}();
/** End of HAL code */















</script><tw-passagedata pid="1" name="VR maker" tags="" position="764,593" size="100,100">{
(track: &#39;intro&#39;, &#39;stop&#39;)
}
You are Brud, a mysterious 22 year old Silicon Valley entrepreneur. You call yourself an &#39;engineer, storyteller, and dreamer.&#39; Your uniform consists of jeans and striped t-shirts  and you are frequently found barefoot.  

You are simultaneously working on a variety of different projects but it is too much to manage, and you need to focus on one. Which of these do you wish to concentrate on?

[[an action-adventure game ]]

[[a self-enclosed virtual world for engaged learning]]

[[an interview training experience for university students]]

[[tourism inspired experiences]]

[[a wellness experience]]</tw-passagedata><tw-passagedata pid="2" name="VR consumer" tags="" position="3421,379" size="100,100">{
(track: &#39;intro&#39;, &#39;stop&#39;)
}
You are Yolanda, a 45 year old black woman and a single mum to three children, Sirius, 15, Despina, 13 and Perseus, 10. You’re already familiar with VR as you use it as part of your job as a real estate agent. Your children have been pestering you for a VR headset, so you have finally capitulated and bought them one. While they are interested in the games, you hope that they will explore other more educational experiences such as historical reconstructions. The headset arrives this morning and you have a full day ahead of you which includes:

[[breakfast with the kids while they fight over the headset]]
[[work]]
[[picking the kids up from school]]
[[parents&#39; evening]]
[[a glass of wine and some rest and relaxation when they are finally tucked up in bed]]</tw-passagedata><tw-passagedata pid="3" name="Advertiser" tags="" position="1123,414" size="100,100">{
(track: &#39;intro&#39;, &#39;stop&#39;)
}
You are Steve, a 35 year old white man and a Senior Account Manager at Breakthrough Media. Breakthrough is a mid-sized advertising agency, where you have been working since you graduated from university with a 2:1 in English literature. 

VR appeals to your creative side -- you are intrigued by the possibilities and you believe that it has the potential to tell brand stories in a more personal, compelling way. There is also potential to capture new kinds of consumer data that makes it appealing to clients. However, you&#39;re also wary about getting swept away in the VR tide. Not all your clients are as convinced that it&#39;s the future of advertising. 

You are working on several VR-related accounts at the moment, which one should you devote the most time and energy to?
* A number of significant clients want to get in on the latest [[VR game]]
* An investment company that wants to sponsor an educational [[VR film]] about climate change for school-aged children
* A travel company that wants to create a branded [[VR flight experience]] for potential customers to conquer their fear of flying.
* A VR creator has approached you with a prototype for a VR [[mindfulness app]] and wants to know which brands to approach to help fund a full version.
* None of these. You&#39;ve been in the same job too long and should rethink your [[career]].</tw-passagedata><tw-passagedata pid="4" name="Policy maker" tags="" position="1036,1593" size="100,100">{
(track: &#39;intro&#39;, &#39;stop&#39;)
}
Welcome to the world of Donna, a white, female 55-year old senior civil servant. You have a background in various innovation and technology portfolios, and until recently were the sole UK representative on a European Commission advisory committee for future and emerging technologies. You have a reputation for wordy but well-considered reports.

In a 2019 parliamentary report on immersive and addictive technologies, the government was portrayed as sluggish in its response to VR safeguarding issues. After a couple of high-profile teen suicides due to bullying in VR, it has created a new technology industry ombudsman, and you are appointed as its director. The ombudsman&#39;s office has oversight of the VR industry, which at the minute is showing signs that there isn’t enough available creative, technical, conceptual and ethical training to meet the demand for VR solutions. You and your team will also be collating industry and public concerns and inquiries about new tech for investigation, mediation and policy recommendations.

By the time your office is staffed and your regular cycle of meetings is scheduled, you have a stack of concerns that your staff have categorised. What do you choose to tackle first?
0. concerns about the [[addictive nature of VR]] in the entertainment industry
0. rising demand for [[VR instruction in higher education]] as one result of a global pandemic
0. concerns about the [[limitations of the nation&#39;s infrastructure]] to accommodate widespread development and adoption of VR
0. demand for investment in 3D scanning, volumetric capture, and documentation of [[items in national collections]] to facilitate the physical repatriation of these items to their countries of origin
0. calls for widespread [[integration of VR into the national healthcare system]] to achieve greater efficiency and efficacy</tw-passagedata><tw-passagedata pid="5" name="Forbidden Desires" tags="" position="366,810" size="100,100">No limits whatsoever. The game becomes extremely popular, smashing all previous sales records for VR. As players discover the game and share their insights on social media, the choices they make become increasingly dark. You soon realise that the most popular choices result in sexual assault and violence. Although the game received an 18-rating it soon becomes clear that teenagers are the key demographic playing the game. Despite media controversy, all 3 of the VR developers are clamouring to sign you up for exclusive rights for the next release. You have 2 options:

[[BookofVisages is the most lucrative offer: they have offered you $500 million but will require you to make changes in order to further monetise the game.]]

[[You prefer to keep working independently and monetise the game through advertising; alcohol, firearm and car companies have already shown interest.]] </tw-passagedata><tw-passagedata pid="6" name="Fantasy and Responsibility" tags="" position="484,832" size="100,100">There are no limits in the game, but players must face the consequences of their actions -- so, if they torture or kill the androids, they must then walk through a gory scene showing them the damage they have caused. This causes a media sensation. The game is framed in terms of questioning the uncritical use of violence as a subject for light entertainment and the role of the hero; you become the face of responsible game design. 

Despite strong sales in the first month, however, players quickly tire of the game and your 15 minutes of fame seems to be passing you by. A previous colleague who has now hit the big time recommends you seek help from futurist and digital nomad Skye. Skye is the co-founder of ALLSEEING, &#39;an agency and a platform for prototyping futures.&#39; The website lists some impressive previous clients including technology leaders such as Centillion, Hollywood studios and governments. The expertise of this ‘visionary’ does not come cheap though, initial consultations start at £1500 an hour. Do you choose to meet with Skye? 

[[Yes]]

[[No]] </tw-passagedata><tw-passagedata pid="7" name="Escape to Eden" tags="" position="617,918" size="100,100">You decide to prohibit the use of violence and material of an adult nature. The game never becomes a major hit but it does become a cult favourite, popular with underrepresented groups, particularly female and non-binary players. The imaginary, fictional space becomes a safe space which allows them to escape the chaos and persecution they face in the real world. Unfortunately, this is not commercial enough to allow for updates and within a few years the game is no longer supported by any of the platforms. The game’s community start a petition asking for the source code to be made available online so that they can update and support it themselves. Do you give it to them? 

[[You make Escape to Eden open source]]

[[You keep proprietary rights]]</tw-passagedata><tw-passagedata pid="8" name="Stay quiet, resign and go and live off of your winnings -- you are now a millionaire." tags="" position="367,1227" size="100,100">You buy a ranch in Argentina and spend your days away from screens, tending to your herd. Here no one recognises you and you live comfortably into old age. Your diary, published after your death, attests to the growing guilt you felt and exposes how BookofVisages exploits divisive content for financial gain. [[Unfortunately, it is too little, too late and the game is responsible for spreading deep social discord.-&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="9" name="Become a whistleblower and work towards increased regulation in the sector." tags="" position="487,1227" size="100,100">You start working with the European Commission to expose the workings of Forbidden Desires and leak the algorithm behind it. Your information leads to new regulation being created to stymie the use of haptics in VR. These regulations are not adopted outside of the EU and before you can escape the country, you are found guilty of theft of government property and arrested. [[You live the rest of your life in prison. -&gt;InstigaCapital Insurance Ltd.]] 

</tw-passagedata><tw-passagedata pid="10" name="The use of traditional brand placements from various companies." tags="" position="607,1227" size="100,100">At first brands are paying top dollars to be featured in //Forbidden Desires//, but as negative press starts to build, highlighting the psychological trauma associated to playing the game, most brands drop out. Within a year the only parties interested in paying to be featured in the game are extremist political groups of the Alt-Right. Your agent brokers the deals but you feel increasingly disillusioned. [[This is not the future you had imagined as a young maker. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="11" name="Yes" tags="" position="607,1077" size="100,100">You are ushered into a sleek, white, sterile office. Black, velvet cushions cover the floor and there are screens on the ceiling and every wall but no other furniture. At the centre of the room is Skye sitting cross-legged wearing a shapeless but expensive-looking white cloak, her neck and face  covered with intricate star constellations. After offering you a turmeric shot she asks you to lie down and starts projecting a series of images from //Fantasy and Responsibility// onto the ceiling. It is clear she has done her research and has a good understanding of the game. 

A sense of fatigue starts to overcome you, not helped by the soothing tone of her voice, at odds with the rather graphic imagery you have designed. Just as you are nodding off, she plays a video. It is a simulation of how your game could be used by the military in conjunction with international development agencies in anticipating and planning for the effects of war. Your heart starts to race. You hadn&#39;t previously considered the potential of your game design as a non-fictional blueprint for real-word violence but this could be extremely lucrative and Skye can introduce you to interested parties. As you leave Skye’s office do you – 

[[agree a meeting with her PA to follow her course of action]] 

or

[[run away screaming]]?</tw-passagedata><tw-passagedata pid="12" name="No" tags="" position="727,1077" size="100,100">Rather than seeing the futurist you decide to pay a marketing consultant to do some audience testing. Two agencies are recommended, one focuses on

[[neuromarketing, primarily through magnetic resonance imaging and eye tracking]], 

the other [[on semiotics to uncover the symbolic meanings of media consumption]].

Which one do you choose?</tw-passagedata><tw-passagedata pid="13" name="agree a meeting with her PA to follow her course of action" tags="" position="847,1227" size="100,100">After a series of meetings with Skye and her team, you are about to sign a contract with the military. Although you have accumulated significant debt in getting to this point, you are convinced that your troubles are about to pay off. Before anything is signed and agreed, however, you receive some tragic news. Skye has died after getting her cloak caught in the wheel of her luxury sports car. ALLSEEING closes down overnight, disappearing without a trace and you do not have any direct contact with her military clients. 

As a result, you are forced to sell //Fantasy and Responsibility// to a rival company in order to settle your debts. They let the game die, prioritising less controversial games. [[For years afterwards, rumours swirl about the notorious Skye, with some claiming her death was faked as she was about to be exposed as a fraud. -&gt;InstigaCapital Insurance Ltd.]]  </tw-passagedata><tw-passagedata pid="14" name="run away screaming" tags="" position="967,1227" size="100,100">Having recovered from the pseudo-psychology spouted by Skye you decide to do your own research. Trawling through reddit forums about //Fantasy and Responsibility//, you discover that there is a loyal group of super-fans who are clamouring for more. After further investigation, it emerges that this group is mainly composed of female former executives, now retired. You decide to crowdfund an updated version of the game which allows for a multi-player mode. You soon exceed your target, and your super-fans are excited about being able to connect with each other in order to plan new missions. Although these players embrace violence, they seem to get a kick out of seeing how this violence plays out in graphic detail. [[Interestingly, most of the android victims are male. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="15" name="neuromarketing, primarily through magnetic resonance imaging and eye tracking" tags="" position="1087,1227" size="100,100">You approach Control, a well-known neuromarketing consultancy to understand why players are not returning to Fantasy and Responsibility. After a series of tests, they produce a report which presents their findings. Tests show that gamers are overwhelmed by the endless choices available in the Garden of Eden, and Control recommends scaling these back and focusing on the most popular scenarios and settings. 

While the results are compelling, you are disappointed that this will result in a less artistically interesting game as the most popular choices tend to resemble other popular action-adventure games. 

[[Do you follow Control’s advice?]]

[[or not?]]</tw-passagedata><tw-passagedata pid="16" name="on semiotics to uncover the symbolic meanings of media consumption" tags="" position="1207,1227" size="100,100">You approach Parole, a boutique marketing consultancy which specialises in using semiotic methods to understand why players are not returning to //Fantasy and Responsibility//. After an extensive semiotic analysis designed to understand what aspects of the game resonate best with players, they produce a report which presents their findings. The findings take you by surprise: they suggest that it is the game’s inherent paradoxes which are most enjoyable. 

In order to further highlight these paradoxes, Parole recommends you provide players with more opportunities to mix and match aesthetic genres and styles. Whereas currently the Garden of Eden can be customised to look like a cartoon world, or a sci-fi inspired nuclear dystopia, or a lush, prehistoric tropical forest, Parole show the potential in mixing and matching these so that the androids can be styled, for example, as futuristic superheros while inhabiting a film noir world.

[[Do you follow Parole’s advice?]]

[[or do you ignore Parole&#39;s advice?]]</tw-passagedata><tw-passagedata pid="17" name="Do you follow Control’s advice?" tags="" position="1012,1377" size="100,100">You scale back the choices available in //Fantasy and Responsibility//. [[The response from players is polarised: while the game finds more success with the traditional target market of young, male gamers, the change alienates all other audiences and is slated by journalists. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="18" name="or not?" tags="" position="1149,1380" size="100,100">You ignore Control’s advice and decide to go in the opposite direction, allowing players to further customise their avatars. [[While this change does not receive much attention, sales do pick up slightly and provide you with a comfortable lifestyle. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="19" name="Do you follow Parole’s advice?" tags="" position="1282,1377" size="100,100">You release the new and improved //Fantasy and Responsibility// and it gains a cult following. While many players find the game too confusing, the levels of devotion exhibited by fans make //Fantasy and Responsibility// a household name. Fanfiction abounds and a Hollywood studio approaches you to buy the film rights. [[This eventually turns into a successful franchise providing you with a very comfortable early retirement. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="20" name="or do you ignore Parole&#39;s advice?" tags="" position="1402,1377" size="100,100">You ignore Parole’s advice in terms of changing the game design as this will be expensive and it is not clear there is a wide enough pool of players who would be interested. A small game studio approaches you to buy //Fantasy and Responsibility//, and you agree to sell it and make a tidy sum. The studio does not make any changes to the game but designs a new marketing campaign to highlight the complexity of the possibilities available in the Garden of Eden, and the game achieves steady sales for the next decade. [[While you don’t have many regrets, you have missed out on a stable source of income. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="21" name="You make Escape to Eden open source" tags="" position="847,1077" size="100,100">You do. The community go on to produce many mods, conversions and optimisation patches for the game so that it lives on. Over time //Escape to Eden// morphs into a social VR platform where marginalised individuals can become part of a wider community while staying anonymous. As the creator of the game you are still recognised as the unofficial leader of //Escape to Eden//. When you lose your job, the community comes together and starts paying you a regular stipend in return for continued support of the game. 

Now that you do not have to work, you become more involved in the community, exchanging hundreds of messages with players every day. You soon notice that there is the potential to enhance the player experience in two ways: 

[[focusing on intimate interpersonal relationships]] 

[[focusing on wider group relationships]]

Which do you decide to tackle?</tw-passagedata><tw-passagedata pid="22" name="You keep proprietary rights" tags="" position="967,1077" size="100,100">You decide to keep the proprietary license. A rival games maker creates a very similar game but it doesn’t have any of the in-built prohibitions for violence and material of an adult nature that //Escape to Eden// had. The game generates extensive media coverage and the European Commission sets up a select committee to investigate the effects of violence in VR. You are called to testify to the committee. Do you 

[[choose to appear]]

[[or fail to comply?]] </tw-passagedata><tw-passagedata pid="23" name="focusing on intimate interpersonal relationships" tags="" position="1327,1227" size="100,100">//Escape to Eden// has become a known dating hotspot for the non-binary community. You want to help people find their perfect matches more easily and create an algorithm based on gamers’ profiles. By comparing the types of settings and scenarios players have created in indulging their fantasies in the game, you can accurately assess compatibility. 

This works so well that you are approached by the largest online dating brand eKindling who want to headhunt you; this will result in a hefty pay packet. Do you go and work for them? 

[[You go and work for eKindling]] 

[[You say no]]</tw-passagedata><tw-passagedata pid="24" name="You go and work for eKindling" tags="" position="1521,1375" size="100,100">You go and work for eKindling. They have given you free rein and a fantastic budget to play with the data they have collected from their clients. You soon realise that their current algorithms only result in a 12% success rate, i.e. 12% of matched couples make it past the month mark. This is clearly the modern-day version of snake oil. 

You create a new, much simpler algorithm which ignores compatibility and individuals’ preferences and personality traits and simply works by random luck. You also make sure that users only receive one match option at a time so as to avoid the choice paradox (when overwhelmed with choices, we shut out a decision altogether). 

While the eKindling board are sceptical they agree to trial your changes. [[The response is overwhelmingly positive, soon the success rate is at 41%. -&gt;InstigaCapital Insurance Ltd.]]  </tw-passagedata><tw-passagedata pid="25" name="You say no" tags="" position="1642,1377" size="100,100">You decide you don’t want to work for another boss. Instead, you become a licensed wedding officiant and regularly officiate wedding ceremonies in //Escape to Eden//. You derive a lot of pleasure from seeing your work result in loving relationships. [[You don’t do it for the money but make a healthy income from officiating and are now the ‘VRfather’ of more than 1000 children. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="26" name="focusing on wider group relationships" tags="" position="1807,1227" size="100,100">You realise that the //Escape to Eden// community is extremely politically active. You see the potential for creating a new grassroots political party to counter the growing populist movements which are closing down civil society space. You create enhanced crowdsourcing features so that the community can come together to exchange ideas and build a manifesto for Propulsion! Soon, community members are actively mobilising in order to influence policy at local and national level, particularly on women’s rights, gender equality and LGBTQI rights. They are also using their technological knowledge to deploy political memes which go viral. 

Due to the enthusiasm around Propulsion! a major donor approaches you to head a young, relatively unknown candidate’s campaign for President. Despite the candidate’s youth he has a strong track record, having already served in Congress and is advocating a progressive platform. Do you agree to work for him? 

[[Yes, you welcome the challenge]] 

[[You refuse the offer]]</tw-passagedata><tw-passagedata pid="27" name="Yes, you welcome the challenge" tags="" position="1762,1377" size="100,100">You create an alliance between the candidate and Propulsion! which causes some instant buzz online. You decide to build a gamified crowdsourcing platform in order to revive society’s waning interest in politics. Although critics argue that the general population is not interested in taking a position on complex legislation, the platform is a hit. [[Your candidate eventually wins the election, largely due to a high turnout amongst the younger generation. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="28" name="You refuse the offer" tags="" position="1882,1377" size="100,100">You decide you prefer to continue nurturing Propulsion! activities within the community and focusing on smaller, more achievable wins. //Escape to Eden// slowly becomes an international hacktivist hangout which becomes known for its various cyber attacks, protests and pranks in seeking retaliation for injustices. [[Over the years the community successfully brings down a number of hate groups. -&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="29" name="choose to appear" tags="" position="1448,1227" size="100,100">You comply and appear before the committee. You are asked a series of questions about the design of games in VR, what kinds of actions are made possible within it and how these actions can be represented. You are then asked about your own views and why you chose to limit the range of actions available in //Escape to Eden//. 

At the end of the 18 month investigation, a report is published calling for a compulsory Code of Ethics for gaming to be overseen by independent regulators. Another committee is put together in order to start drafting this code and you are consulted as there is disagreement as to whether it should focus on -

[[a code of conduct for producers to prevent the creation of harmful content]]

or the [[implementation of a cross-industry rating scale so that users are given more agency and are pre-warned as to what they can expect to experience.]] </tw-passagedata><tw-passagedata pid="30" name="or fail to comply?" tags="" position="1567,1227" size="100,100">You fail to comply and choose not to appear before the committee. You have recently been disillusioned with the political process and accountability, or lack of, and decide instead to stay under the radar, not responding to any media requests. 

As the investigation proceeds, the press brands you as a mysterious but brilliant auteur who has expanded the notion of what VR games can be. You now have the opportunity to capitalise on this notoriety as all of the big VR developers are bidding for exclusive rights to re-release //Escape to Eden//; do you 

[[sell to the highest bidder]] 

or [[decide not to sell out.]] </tw-passagedata><tw-passagedata pid="31" name="a code of conduct for producers to prevent the creation of harmful content" tags="" position="2002,1377" size="100,100">You suggest a code of conduct for producers is needed. This establishes clear legal liabilities for game companies to act against harmful or illegal content on their sites. The compulsory Code of Ethics defines what constitutes harmful content. An independent regulator is created to monitor the industry and it is backed by statutory powers to launch legal action against companies in breach of the code. [[Companies failing obligations on harmful or illegal content face hefty fines. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="32" name="implementation of a cross-industry rating scale so that users are given more agency and are pre-warned as to what they can expect to experience." tags="" position="2122,1377" size="100,100">You argue that game designers should not be censored but rather that the implementation of a cross-industry rating scale is needed in order to credit users’ own intellect and free will. Drawing from existing broadcast and film ratings, a new rating system for VR is written up. This specifies whether what is being experienced is a reconstruction, how realistic the content appears and whether it contains disturbing content. [[Over time these ratings become well-known and understood and are applied globally. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="33" name="sell to the highest bidder" tags="" position="2242,1377" size="100,100">You sell to BookofVisages for $100 million and become a household name. //Escape to Eden// is heralded as an exemplar of morally responsible gaming. [[You hire a media manager and become a modern-day Warhol, an enigmatic presence in the public eye whose work is the subject of fierce debate. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="34" name="decide not to sell out." tags="" position="2362,1377" size="100,100">You decide to stay true to your artistic vision and not sell the rights to //Escape to Eden//. Instead, you throw yourself into a new project, creating add-on pre- and post- experiences for a range of trauma-inducing content. This highlights the significance of incorporating reflective areas in game design so that players can process what they are experiencing. [[This heralds a new approach to game design and leads to an uptake in VR counselling services. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="35" name="No choice, this is a training video, not a game" tags="" position="734,924" size="100,100">It soon becomes clear that the project’s mysterious backer is VenDoor, a leading multinational retail corporation that operates a chain of hypermarkets, discount department stores and grocery stores. They have recently created a fast-track management in training programme for recent graduates and want to promote this and ensure they get the best candidates. Your client’s brief makes it clear that although the rationale for the programme is educational, the focus should be on assessing the candidates’ communication and social interaction skills. You will have to build in a rating system, however you are not sure whether to design the programme so that 

 [[compliance is rewarded]] 
 
 or [[leadership qualities such as decisiveness and willingness to engage in conflict are prioritised]].</tw-passagedata><tw-passagedata pid="36" name="Some choice, the ability for the user to customise both their avatar and that of the employer" tags="" position="854,927" size="100,100">It soon becomes clear that the project’s mysterious backer is Bolencioga, a luxury fashion house. Due to the number of applicants they get for their summer internship programme, they want a faster and cheaper recruitment process. They ask you to be creative in your approach in order to reflect their brand identity: cutting-edge, creative, provocative and eccentric. 

A previous colleague who has now hit the big time recommends you seek help from futurist and digital nomad Skye. Skye is the co-founder of ALLSEEING, &#39;an agency and a platform for prototyping futures.&#39; The website lists some impressive previous clients including technology leaders such as Centillion, Hollywood studios and governments. The expertise of this ‘visionary’ does not come cheap though: initial consultations start at £1500 an hour. Do you choose to meet with Skye? 

[[You meet with her]]

[[You don&#39;t meet with her]] 
</tw-passagedata><tw-passagedata pid="37" name="Full choice, the ability for the user to customise their avatar and an AI employer which will respond to the users’ natural social signals." tags="" position="985,928" size="100,100">It soon becomes clear that the project’s mysterious backer is a benevolent self-made billionaire who has started up an educational non-profit. As she made her money in technology, she strongly believes technology is a key driver in equality and that technical and social progress go hand-in-hand. She is a VR evangelist and is convinced that greater access to VR will level the playing field by providing disadvantaged students with a leg-up through the training programme in line with meritocratic ideals. 

As you try to pin down the parameters of the brief, you soon realise you have carte blanche as she is more interested in the promotion and dissemination of the programme than the programme itself. You choose to allow students to customise their avatar and provide them with an AI employer which will respond to the users&#39; natural social signals as though in real life. You also tailor this to different industries. 

As soon as your backer sees an early prototype she asks you to create a more complex version of the programme where it encompasses not just interviews but also training so the students can enhance their skills and prepare themselves for the careers they want to pursue. You are frustrated with her micro-managing of the look of the programme (the aesthetics are important to her) but she is willing to pay you well for your work. 

[[Do you continue working with her]]

or [[finish the initial programme and move on to other more fulfilling projects?]]</tw-passagedata><tw-passagedata pid="38" name="compliance is rewarded" tags="" position="1092,1077" size="100,100">After talking to relevant human resource employees at VenDoor you put the focus on the amenability of the interviewees. You can do this in two ways:

[[analysis of the user’s kinematic fingerprint collected through the VR headsets i.e. traits including motor actions, patterns of eye movement and reflexes as they go through a virtual interview process]] 

alternatively, you could [[actually put the user in a lower management position and see how they respond to senior management instruction.]]</tw-passagedata><tw-passagedata pid="39" name="leadership qualities such as decisiveness and willingness to engage in conflict are prioritised" tags="" position="1207,1077" size="100,100">After talking to relevant human resource employees at VenDoor you put the focus on the candidates’ leadership potential. After doing some research you are choosing between two key types of leadership: 

[[forwards-looking leadership which will help move the company towards innovation and cultivate a new direction for VenDoor]] 

or [[inspiring leadership which will generate excitement around the mission and vision and help the company stay the course in a turbulent market.]] </tw-passagedata><tw-passagedata pid="40" name="analysis of the user’s kinematic fingerprint collected through the VR headsets i.e. traits including motor actions, patterns of eye movement and reflexes as they go through a virtual interview process" tags="" position="1687,1227" size="100,100">Your client wants the programme to look and feel as realistic as possible. You stick to designing a normal interview scenario and input hundreds of possible interview questions written by VenDoor HR. When users put on the headset they find themselves in an office facing a 40-year old, white male in a suit. You are considering creating two settings: 

[[‘easy’]] 

and [[‘hard’ mode]]. 

Which do you start with? </tw-passagedata><tw-passagedata pid="41" name="actually put the user in a lower management position and see how they respond to senior management instruction." tags="" position="1927,1227" size="100,100">Your client wants the programme to actually test the candidates’ management skills. You create a scenario where the candidate is given instructions by senior management and has to successfully accomplish the tasks required. You decide to gamify these tasks. VenDoor want you to create two different versions of the programme 

[[a free version]] 

and [[a paid for version which provides users with more tips and assistance.]] 

Which do you decide to tackle first?</tw-passagedata><tw-passagedata pid="42" name="‘easy’" tags="" position="2483,1377" size="100,100">You start with easy mode. The interviewer is programmed to be friendly and approachable. Meanwhile, the programme gathers intimate data: eye movement, skill flush, pupil dilation, nervous ticks. The interviewer begins to slowly mimic the client, taking on their body language in order to build rapport and ensure the interviewee drops their guard and enters a state of openness and suggestibility. The more easily influenced the interviewee is, the more likely they are to achieve a high score and ultimately to be hired. 

The client is so satisfied with the prototype you create that they decide a hard mode is not needed. Early tests show that the employees hired through your programme show exceptional compliance. This does eventually lead to boredom and a high employee turnover but this is not considered a problem by VenDoor management. [[Indeed, their lobbying has ensured that a perpetual pool of unemployed graduates is available, thereby ensuring labour stays cheap. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="43" name="‘hard’ mode" tags="" position="2604,1377" size="100,100">You start with hard mode. The interviewer is programmed to be argumentative and aggressive and there is a 30 second limit to respond to questions correctly. Interviewees fail if they answer back and challenge the interviewer or if they break down and cry. Successful candidates demonstrate that they adapt well to high-stress environments. 

The client is so satisfied with the prototype you create that they decide an easy mode is not needed and roll out the programme quickly. Short-term results show an increase in the VenDoor workforce compatibility and therefore increased efficiency. Within five years, however, rumours of a toxic work culture are widespread and applications for the fast-track programme have fallen significantly. Leaked messages and recordings are picked up by the media and it soon becomes clear that the CEO of VenDoor had knowledge of sexual harassment allegations within the company and failed to act, moreover he had a reputation for inappropriate behaviour himself. [[He is forced to resign. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="44" name="a free version" tags="" position="2722,1377" size="100,100">You start with the no-frills attached, free version of the programme. High quality visual realism is not so important here: the focus is on how willing candidates are to perform increasingly difficult tasks and how well they follow the script laid out, testing their emotional intelligence. While these tasks start with simple problem-solving activities, they build up to having to make the difficult choice of letting an employee go, and scores are weighted accordingly. Candidates are allowed three attempts in order to effectively execute the termination: they lose if they speak too softly or too aggressively. 

VenDoor are keen to distribute this version of the programme as quickly as possible, deciding the paid version can be designed as an optional upgrade to be released at some point in the future. The programme becomes an immediate success story, as it seems students love playing. Within a year VenDoor see a 200% increase in applications for their fast track programme and decide to launch a children’s version of the game. [[You are paid handsomely for creating this although you do receive some flack from critics who accuse you of creating ideal neoliberal subjects, de-sensitised to the structural inequalities of capitalism. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="45" name="a paid for version which provides users with more tips and assistance." tags="" position="2842,1377" size="100,100">You focus on the additional content for the paid upgrade to the programme. You introduce a number of levels -- the more the candidate will pay for, the more likely they are to receive privileged information to help them through the recruitment process. At bronze level they are given information about the business itself and how it operates, as well as the company culture; at silver level they are also provided with tips as to what to wear and how to act in order to do well in interviews; and at gold level they are additionally trained for the high-stress situations which interviewers will put them through as part of a pledging process. [[This content allows VenDoor to monetise their recruitment process and once word gets out, your services are much in demand by rival companies. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="46" name="forwards-looking leadership which will help move the company towards innovation and cultivate a new direction for VenDoor" tags="" position="2047,1227" size="100,100">You focus on forwards-looking leadership as your client is keen to capitalise on VenDoor’s market share and grow it further, quickly. After consulting a leadership coach you decide the programme should be screening and shortlisting for either 

[[visionary leaders]] 

or [[transformational leaders.]] 

Which do you choose?</tw-passagedata><tw-passagedata pid="47" name="inspiring leadership which will generate excitement around the mission and vision and help the company stay the course in a turbulent market." tags="" position="2167,1227" size="100,100">You focus on the here and now and design the programme to select leaders who can help VenDoor stay the course in a turbulent market. After consulting a leadership coach you decide the programme should be screening and shortlisting for either 

[[autocratic leaders]] 

or [[charismatic leaders.]] 

Which do you choose?</tw-passagedata><tw-passagedata pid="48" name="visionary leaders" tags="" position="2962,1377" size="100,100">You choose visionary leadership. This type of leadership asks candidates to show excellence in critical thinking skills, in order to effectively set strategic directions, but also in communication skills, in order to tell a story about why the change is worth pursuing and to inspire others to embrace the change. VenDoor soon rolls out and implements your programme which results in ambitious plans for international growth. 

Within two years VenDoor has expanded its operations to a further 13 countries. Fast-forward another two years, however, and this move has resulted in a bloated brand with too many stores, not enough online presence and major losses in the home market due to a diluted brand. You follow the news with interest as you suspect that the visionary leadership may have been overly optimistic and not anticipated any possible difficulties. [[You seize the opportunity and contact VenDoor to pitch a new, updated version of the programme. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="49" name="transformational leaders." tags="" position="3082,1377" size="100,100">You choose transformational leadership. This type of leadership seeks candidates who have excellent interpersonal skills and can inspire others to effect real change. VenDoor soon rolls out and implements your programme which results in an energised workforce which is constantly challenged to think beyond what has already been done in order to create new technological solutions. The new flagship project is using blockchain technology and augmented reality to provide live information about the food you buy (e.g. for vegetables: farm origination details, when it was planted, plucked, expiration date, storage temperatures, shipping details, carbon footprint, calorie intake) and rate it according to your already known taste preferences in the spirit of ‘ultra-customisation.’ 

This generates plenty of media buzz but this is soon overshadowed by reports of high burnout for VenDoor employees. A whistleblower leaks documents showing there are serious security flaws in the blockchain technology, meaning that hackers have taken control of the transaction history making it possible for the same cryptocurrency to be used more than once, resulting in ‘double spends’ for customers. Even worse, the leaked documents show that management are aware of these. An investigation finds that leaders were too focused on the big picture, refusing to listen to employees who were technically proficient, preferring to ‘stay positive’ leaving them blinkered and too willing to risk it all. [[The scandal results in a multi-billion dollar fine. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="50" name="autocratic leaders" tags="" position="3202,1377" size="100,100">You choose autocratic leadership. To perform well candidates must show attention to detail, authority, assertiveness and confidence. The programme is rolled out and the results are encouraging. Hiring costs go down and retention rates rise. 

Now that the job is finished you can concentrate on developing your passion project, a virtual reconstruction of the 7 wonders of the world. Within a year, however, VenDoor gets back into contact. They have realised that of the workforce hired through the programme, white males from privileged backgrounds are massively over-represented. This is at odds with the diversity discourses they celebrate in their PR and marketing campaigns. They are keen to demonstrate equality of opportunity and have decided that the best way of doing so is to change the avatar of the interviewer to a black female. [[This is an easy fix which you are happy to do in order to further fund your wonders. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="51" name="charismatic leaders." tags="" position="3322,1377" size="100,100">You choose charismatic leadership on advice of your client who brands himself as a charismatic leader. This type of leadership seeks candidates who demonstrate high energy and can make tough decisions and implement these. Candidates must also demonstrate influencing skills as demonstrated by an understanding of behavioural psychology and social media versatility. The programme is rolled out but results in lower recruitment due to clashes of personality during the interview process. Soon, the fast-track programme is dropped. 

Known for his long hair, a wardrobe that favours jeans and hoodies, and sunglasses worn at all times, including indoors, stories start to spread about the unconventional business approaches of VenDoor’s CEO. When it becomes clear that VenDoor is making significant losses due to over-reliance on this charismatic leader notorious for his intolerance for divergent opinions, he is ousted by the board. [[Unfortunately, this also means VenDoor lays off 2,400 employees globally as it seeks to drastically cut costs. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="52" name="You meet with her" tags="" position="1327,1077" size="100,100">You are ushered into a colossal, concrete office. Skye sits behind an oversized black desk; the only other furniture in the room is a chair facing her but it&#39;s about 3 meters from the desk. She asks you to take a seat while she finishes typing. You feel like a fish out of water as you watch this small figure type furiously, dwarfed by the size of her desk. Eventually, she looks up, pushing her laptop to one side. 

In a quiet but firm voice she launches into buzzword-heavy marketing spiel. You can’t hear every word but you get the general gist: it’s about staying authentic to the brand at a time when the fashion industry is undergoing a paradigm shift and is ripe for disruption. Just as you are zoning out, Skye suddenly buzzes in her assistant who brings you a glossy pamphlet, a recent report by ALLSEEING on the future of the fashion industry. She highlights the significance of digital customisation for Bolencioga and suggests this could be a good test for the first stage of the selection process. As you leave Skye’s office do you – 

[[push her waiting PA out of the way and escape as quickly as possible]] 

or [[agree a date for a next meeting in order to gain further understanding of customisation options]]?</tw-passagedata><tw-passagedata pid="53" name="You don&#39;t meet with her" tags="" position="1445,1077" size="100,100">You decide to avoid the futurist and instead do a focus group with recent graduates working in the fashion industry. You realise that the status and prestige associated to luxury brands is the main motivation for wanting to work in fashion. However, it is also clear that in order to survive, quick-thinking and problem solving skills are needed. On the basis of your research you decide to focus on the affordances unique to VR, i.e. either  

[[interactivity]] or 

[[immersion.]] 
</tw-passagedata><tw-passagedata pid="54" name="push her waiting PA out of the way and escape as quickly as possible" tags="" position="2647,1227" size="100,100">You were not impressed by the buzzword bingo Skye offered you. As someone uninterested by the latest fashion trends, you decide to do your own research and talk to a number of Bolencioga employees about their recruitment process. You soon realise two things: that recruitment is based almost entirely on word of mouth and networking and that the entry-level jobs entail long hours and poor conditions. You start dating one of the assistants you speak to and her disillusionment for the industry starts to rub off on you. You decide to either 

[[make the most straightforward VR experience, whereby users answer a series of tailored questions on the fashion industry and about themselves, thereby showing their knowledge]] 

or [[create a programme based on the day of a buying assistant where candidates must make sure not to be fired.]] </tw-passagedata><tw-passagedata pid="55" name="agree a date for a next meeting in order to gain further understanding of customisation options" tags="" position="2287,1227" size="100,100">You decide to follow Skye’s advice and go down the virtual customisation route. After a further meeting with Skye you narrow it down to two possibilities -

[[customisation of the avatars]] 

or [[customisation of the stores]].

Which do you choose?</tw-passagedata><tw-passagedata pid="56" name="create a programme based on the day of a buying assistant where candidates must make sure not to be fired." tags="" position="3442,1377" size="100,100">You create a branching narrative VR game where candidates must survive a day in the life of a buying assistant. It’s a lot harder than it sounds as the difficulty comes in trying to anticipate the whims of the buyer they are working for. If you don’t bring them the right coffee, choose the right hotel for fashion week, take care of their dog properly, or organise an exciting enough unicorn party for their 4 year old’s birthday, you are cut. Bolencioga are not impressed with what you show them, as it is not considered ‘on brand.’ [[Instead, you release it online and it goes viral, you are hired by one of the biggest game developers. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="57" name="customisation of the avatars" tags="" position="3682,1377" size="100,100">Users must customise both their avatar and that of their employer before sitting the virtual interview. They will then be scored on their styling and how on trend this is. As well as featuring the entire new season of Bolencioga including shoes and accessories, you also put in a few pieces by rivals, and candidates who pick these will be automatically disqualified. However, it is not just fashion pieces that must be chosen but the avatars themselves, i.e. body size, skin colour, hair style, make up, etc. Candidates that do not select diverse options are not shortlisted for further interviews. 

Bolencioga are happy with the prototype but before the programme can come out it becomes apparent that Skye has sold this idea to a number of Bolencioga rivals. Although Bolencioga sues her, she has already escaped the country and is reportedly in the Maldives on a private yacht. [[You are never fully paid for your work. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="58" name="customisation of the stores" tags="" position="3802,1377" size="100,100">Users must customise the Bolencioga flagship store and consider all four dimensions of customer experience in doing so: education, escapism, esthetics and entertainment. The programme provides candidates with a budget and the possibilities are endless: they can change the layout, furniture, fixtures, lighting, colours, smells, etc. Moreover, they must consider the customer journey. 

Your client loves the result of your work and rolls it out immediately, paying you a bonus. You find yourself doing more and more architectural projects in VR as a result of this work. [[A number of years later, it emerges that Bolencioga has been implementing the best ideas offered by candidates, giving them neither credit nor payment, of course. -&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="59" name="interactivity" tags="" position="2407,1227" size="100,100">You decide to design the programme with an emphasis on interactivity. You are deciding between 2 ideas: 

[[a social VR escape room with a puzzle to be solved before fashion week]] 

or [[having candidates train an artificial intelligence model/influencer.]] 

Which do you choose? </tw-passagedata><tw-passagedata pid="60" name="immersion." tags="" position="2527,1227" size="100,100">You decide to design the programme with an emphasis on immersion. You now need to choose how much you foreground the Bolencioga brand in the immersive world you will be creating: 

[[a full-on branded universe]] 

or [[more subtle, understated branding.]] </tw-passagedata><tw-passagedata pid="61" name="a social VR escape room with a puzzle to be solved before fashion week" tags="" position="3922,1377" size="100,100">You create a social VR fashion escape room experience. Five candidates at a time must cooperate in order to discover clues, solve puzzles and accomplish tasks to escape in time to catch the plane to Milan for fashion week. The tasks and challenges are all fashion related and require quick thinking and problem-solving. [[Bolencioga are extremely happy with the result and even allow customers to play it as part of a pop-up during fashion week. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="62" name="having candidates train an artificial intelligence model/influencer." tags="" position="4042,1377" size="100,100">You create a programme which allows candidates to design and style an AI model/influencer who is to become the face of Bolencioga. Those that create the best looking influencer, as decided by Bolencioga HR, must then plan her social media feed for the next month, planning posts, a themed feed and advice/tips she will be sharing. The most ‘on brand’ candidates win internships. 

Within a few years Bolencioga management realise the value of the influencers created and actually deploy the best ones online as a ‘Bolencioga army’ to represent their brand. This army’s engagement rate is squarely on par with the typical human influence but allows for full control over the message and, of course, is free. You are brought back in to run the AI part-time. Eventually interns are no longer needed as the army is increasingly powered by AI, so they can create their own social media posts and interact with people on social media platforms. 

This works very well until one AI influencer goes rogue, spewing racist and sexist remarks picked up from interacting online. You are fired but are secretly relieved as you’ve had enough of the narcissism and elitism of luxury influencers. [[Meanwhile, on the topic of narcissism, you see the news that tragedy has struck: the futurist you decided not to consult, Skye, died of a heart attack after reading a negative premature obituary of herself. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="63" name="a full-on branded universe" tags="" position="4162,1377" size="100,100">After speaking to your client again, you film a micro-movie for VR from a first-person perspective -- that first person, of course, being the viewer (in this case the candidate). The micro-movie features the brand heavily as fashion is at the heart of the storyline. Candidates’ data is collected as they watch the micro-movie, registering heart beat and pupil dilation; those candidates that show the most excitement are hired as they are believed to be the most immersed and passionate about the brand. 

The quality of the movie is so high that Bolencioga decides to capitalise on it by streaming it on WeVid, the largest video-sharing platform for VR. [[It generates instant buzz and is heralded as the future of branded entertainment, particularly effective as consumers are showing an increasing distrust of traditional advertisements. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="64" name="more subtle, understated branding." tags="" position="4282,1377" size="100,100">You decide that in order to test candidates&#39; ability to think quickly, you will design a VR rapid-cognition challenge. Candidates become the equivalent to Mechanical Turk crowdworkers and have a few seconds to identify fashion-related images taken from social media and then choose other similar images from a set. 

Although the images are not branded in themselves, subliminal branding comes through the mission statement being read at a frequency which cannot be detected by the ear, only by the subconscious brain. This would be illegal on television, but there are no regulations for VR content as of yet. [[Bolencioga find that candidates hired through the programme show more loyalty to the brand and retention rates rise. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="65" name="Welcome" tags="" position="979,11" size="100,100">(set: $visitedSkyePolicy to false)
#[&#39;&#39;Choose your Own Future:
The Sociotechnical Imaginaries of Virtual Reality&#39;&#39;]
&lt;span style=&quot;font-size: 85%&quot;&gt;Authors:
Dr Chloe Preece, ESCP Business School
Dr Laryssa Whittaker, Royal Holloway, University of London
Dr Stephanie Janes, Kings College London&lt;/span&gt;



Virtual Reality immerses users in a fully digital environment through a headset or surrounding display. This environment can be computer-generated or filmed in 360-degree video. Virtual Reality is increasingly touted as the technology of the future, promising a gateway to a whole new world where our lives will be transformed through both technological and social advances.

[[Next &gt; &gt;-&gt;continue VR immerses users]]





&lt;span style=&quot;font-size: 75%&quot;&gt;Authors&#39; Note: All characters and corporations or establishments appearing in this work are fictitious. Any resemblance to real persons, living or dead, is purely coincidental.


Media: &lt;a
href=&quot;https://freesound.org/s/339720/&quot; target=&quot;_blank&quot;&gt;&quot;FutureSweep&quot;&lt;/a&gt; by &lt;a
href=&quot;https://freesound.org/people/Ihaksi/&quot; target=&quot;_blank&quot;&gt;Ikhasi&lt;/a&gt; and &lt;a
href=&quot;https://freesound.org/s/458368/&quot; target=&quot;_blank&quot;&gt;&quot;Sci-Fi Theme&quot;&lt;/a&gt; by &lt;a
href=&quot;https://freesound.org/people/Infinita08/&quot; target=&quot;_blank&quot;&gt;Infinita08&lt;/a&gt; are licensed under &lt;a
href=&quot;https://creativecommons.org/publicdomain/zero/1.0/deed&quot; target=&quot;_blank&quot;&gt;CC0 1.0&lt;/a&gt;&lt;/span&gt;&lt;/p&gt; 

</tw-passagedata><tw-passagedata pid="66" name="continue VR immerses users" tags="" position="976,139" size="100,100">{
(track: &#39;intro&#39;, &#39;play&#39;)
}
(align: &quot;=&gt;&lt;=&quot;)[&#39;&#39;WARNING!!! PREPARE TO IMMERSE YOURSELF&#39;&#39;]
The future of civilisation as we know it is in your hands. The narrative you are about to follow contains many different alternate futures and it is up to you to choose the best one. As you make your choices, think carefully before you act… will you hand over our most intimate data so we become pawns for our technological overlords? Will you revel in the escapist fantasies of a virtual utopia while the world burns around us? Or will virtual reality finally live up to technology’s promise as society’s great equaliser? YOUR wits and judgement will decide. The question is, do you have the luck and skills needed to navigate these technological shifts? Will your decisions lead to a utopian or dystopian future? 

[[You’re about to find out.]]</tw-passagedata><tw-passagedata pid="67" name="You’re about to find out." tags="" position="968,284" size="100,100">Time for your first choice. Who are you?

[[VR maker]]

[[VR consumer]]

[[Advertiser]]

[[Policy maker]]</tw-passagedata><tw-passagedata pid="68" name="VR game" tags="" position="2508,307" size="100,100">//Forbidden Desires// has become the fastest growing VR game in history with over 1 billion registered users. Brands are lining up to get involved but they&#39;re not all clear on how best to proceed. The clients are concerned that with the ability to control their gaze and focus in 360 degrees, anything too subtle will simply be ignored by players, or might get lost in the plethora of visual content available for players to manipulate. 

You review the various options and decide to advise the clients to go for:

[[Pop-up ads]] which can surround up to 80% of the player&#39;s in-game visual field.
[[In-game product placement]] via sponsored loot boxes which contain rare and exclusive skins and branded accessories. 
[[A pop-up event]] at a location-based VR cafe in East London.</tw-passagedata><tw-passagedata pid="69" name="VR film" tags="" position="1271,452" size="100,100">Investiture Inc. doesn&#39;t have the greatest reputation for corporate responsibility, nor does its track record stand out in terms of supporting green investments. But they are hoping that by associating themselves with some educational 360 VR content, they might be able to generate a strong emotional response that customers might then associate with the company and encourage them to invest anyway. 

Several VR filmmakers express an interest in working with you on the project and eventually develop a piece that puts the viewer in the shoes of a polar bear struggling to survive on the melting polar ice caps, complete with immersive sound design and haptic feedback as the bear crunches through what is left of the snow and ice. A soothing but serious voiceover throughout the film explains several facts and figures related to the science of climate change which links into the relevant school curricula. As the final shot fades to black, a soothing voiceover describes how Investiture is passionately committed to making carbon neutral investments as much as possible over the next 50 years. 

Two distribution options are discussed:
* Immediately [[livecast]] the piece directly into headsets at schools. Investiture is keen on this option and the filmmakers are adamant that there should no be no previews and no content warnings. The material will have the greatest impact if viewers are completely unprepared.  
* [[Trial it first]] with a small sample of students in a focus group. This will put the brakes on Investiture&#39;s roll out schedule a little, and it will be difficult to convince the filmmakers to make any significant changes. However, it will mitigate some of the risks associated with the livecast, given that the material is potentially upsetting and the target audience is school-age children. Trials are to be supervised by teachers and trained VR facilitators will also be on hand. </tw-passagedata><tw-passagedata pid="70" name="VR flight experience" tags="" position="1470,809" size="100,100">A well-known airline wants to create a promotional piece of VR that also works to help those with a fear of flying. The earnest and excitable marketing team are well-meaning. They present you with some research they have found that suggests VR can assist with treatment for phobias, but it&#39;s hardly conclusive and the research is on-going. 

Moreover, you&#39;re concerned that there are no regulations or guidelines to suggest how long customers should spend with the experience, or with what frequency before they attempt to fly. Nor is there any suggestion about whether the effects are short or long term. You think the risks here are substantial, and the line between a clinical treatment and a promotional experience seem blurry here. 

Do you [[air your concerns]]?  

Or enthusiastically accept the project and approach a VR [[games company]] for production of a flight simulator?</tw-passagedata><tw-passagedata pid="71" name="career" tags="" position="1337,211" size="100,100">The workplace you once knew is starting to become unrecognisable. There&#39;s a beerpong table in the boardroom. Workflows are changing, everything is agile, and processes are becoming more iterative, moving towards rapid prototyping etc. You&#39;re no longer an agency of record and you&#39;re collaborating far more often with multiple other specialist agencies on one project. 

The company rolls out a new directive mandating that all client meetings are taken in VR, and all account directors must take a headset home with them so as to be available at all hours. You&#39;re not sure how to feel about this. You consider leaving the company for another role, but you&#39;re concerned that you haven&#39;t &#39;Futureproofed&#39; your career sufficiently to keep up with the world of VR marketing. 

A colleague recommends the services of a futurist company called ALLSEEING. A brief (but eye-wateringly expensive) consultation promises to give you some answers about your role in the future of virtual marketing. Skye, the futurist, is based in Silicon Valley but there&#39;s an option for a VR meeting. What do you do?
* Delve into your savings and [[arrange the call]]. 
* Save your pennies and decide to [[hedge your bets]], staying with the company for now.
* Save your pennies and decide to [[quit]] your job to look for something that is a better fit. 
</tw-passagedata><tw-passagedata pid="72" name="mindfulness app" tags="" position="2182,876" size="100,100">VR maker Brud approaches you with an idea for a multi-purpose mindfullness app. The app provides a range of mindful VR activities to choose from including virtual arts &amp; craft, meditation, yoga, archery, origami, calligraphy and petting virtual therapy dogs. Users can select any activity as long as it focuses their attention solely on the present moment. 

He&#39;s looking for brand sponsorships that might help finally move it out of the prototype stage and preferably into a workplace setting where it can not only improve the mental wellbeing of employees, but also boost productivity and offer some efficiencies. 

The app feeds user information back to a company&#39;s central HR team and provides an overall &#39;wellness score&#39;. HR can then monitor when individual or team scores start to dip and intervene as appropriate.

How do you approach the brief?
* Bundle a wide range of companies into a [[multi-brand deal]].
* Take it only to the wealthy corporate client, [[Risky Business Corp.]]
* Bring in a variety of [[charities]], including several that are involved in mental health research.  







</tw-passagedata><tw-passagedata pid="73" name="Pop-up ads" tags="" position="2662,293" size="100,100">You coordinate with multiple brands ranging from children&#39;s toys to car manufacturers, fashion brands, fast food companies and pharmaceuticals. Everyone wants their logo in the virtual space and 360 degrees of vision means there is plenty to go around.

The pop-ups are intrusive but, for the first few weeks at least, completely unavoidable. This suits the clients&#39; brief in terms of reach and the pinch through rate is reasonable (pinches are the equivalent of clicks in VR). You are assured by your in-house researchers that it is safe to fill the visual field up to 80% before inducing seizures.

All the contracts also stipulate that the client owns all the biometric data gathered by the headsets in relation to their ads. The analytics this provides them ranges from eyegaze, to facial muscle movements and expressions, heartrates and galvanic skin responses.

However, it&#39;s not long before the player backlash starts on social media networks. The pop-ups are difficult to remove and are invading gameplay in a way that is totally unacceptable - have these advertisers learned nothing from the early days of e-commerce and web-based pop-ups?! 

The more dedicated players have started to create blockers and are sharing the opensource code online. It&#39;s only a matter of time before it&#39;s impossible to get any eyeballs on this content at all. The shareholders start to panic. What do you do in response?

[[Drop the pop-ups]] entirely. 

Backtrack, apologise to clients and present an alternative plan for [[In-game product placement]]

Up the ante and [[increase the frequency of the pop-ups]], but work with the game&#39;s developer to offer an ad-free version for a monthly subscription fee. </tw-passagedata><tw-passagedata pid="74" name="In-game product placement" tags="" position="2662,446" size="100,100">You start by engaging a handful of more creative brands including fashion labels, makeup brands and one or two online influencers who have their own product lines. You propose a set of lootboxes which cost players relatively small amounts of money (real or crypto) for the chance to receive limited edition, exclusive branded skins and accessories. The uptake is huge and several of your other clients start to enquire about versions for themselves. This is particularly popular with younger players and a lot of teen-oriented brands start to come on board.

It&#39;s all going well until your skins start to acquire value on the internal &#39;skin betting&#39; black market in the game. Players start trading amongst themselves to complete their collections faster, rather than taking the risk on the loot boxes. It&#39;s not a market your clients want to get involved in and interest starts to wane as a result. 

In the meantime, the gambling commission in co-operation with the new FairPlay legislation has tightened restrictions on the game, due to its potentially addictive content and increasing cases of bodily neglect. It&#39;s now only available to players over 18 and age verification processes are moving towards iris scans that are harder to get around. This further demotivates clients who feel this restricts their reach and removes the lucrative adolescent market. What do you do?

Risk falling foul of the new legislation and [[continue to aim the content at under-18s]], albeit in a less obvious manner. Reassure clients that this demographic are still prevalent on the platform despite restrictions and that there are still ways to target them successfully.

[[Comply with the legislation]] and try to convince clients that there is enough mileage in the over-18s demographic that it&#39;s still worth their while. 
</tw-passagedata><tw-passagedata pid="75" name="A pop-up event" tags="" position="2661,159" size="100,100">Rather than trying to shoehorn as many brands into the space as possible, you decide to pitch to one. Sparklejuice, a well-established drinks company, is looking to promote its new alcohol-free range, amongst other things. Capitalising on the continuing prominence of the experience economy, your pop-up event idea goes down well with the client. It&#39;s a relatively tried and tested model with a VR twist. 

The chatter builds up on socials as you run a skin-design competition for players to win tickets to the event where they can get a free drink (in real life and in the virtual bars in the game) and see their creations come to life. The non-alcoholic ginger-based post-VR cocktails prove popular as they offset the cybersickness experienced by first-time VR users. Hundreds of thousands of users enter but only a few hundred are invited to the chain of VR bars to meet the developers, some brand reps and each other. You&#39;re lauded for the physicality of the operation. Winners rave about their experiences online and you create some genuine brand evangelists in the process.

You ensure that the project takes place in collaboration with FairPlay to ensure the safeguarding of all participants. Brands are able to view the biometric data captured by the headsets but all users sign an unusually non-exploitative user agreement which prevents them from selling it to third parties. Execs are pleased with the ROI/sales figures surrounding the campaign, and the event was deemed worth the risk. 

[[The project goes on to win awards at Cannes Lions and you&#39;re finally promoted. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="76" name="Drop the pop-ups" tags="" position="2809,265" size="100,100">Clients are furious and the blogosphere is full of commentaries asking why lessons were not learned from the early dot-com years and previous e-commerce failures with pop-ups. 

On the bright side, you got enough biometric data from the brief period when the pop-ups were running to keep targeting users through alternative channels. Regulation is looming around the use of biometrics and 3rd parties, but it hasn’t quite caught up yet with the industry. Having left the EU, several bits of data protection legislation have also been jettisoned, including GDPR (the demise of which was initially met with great enthusiasm). 

Seeing an opportunity, you help to broker sales deals between your clients and 3rd parties for ownership of the data as a kind of consolation prize. A bidding war erupts between a prominent social media platform and a data analytics firm. The successful party continues to use the data to refine already highly effective political advertising, increasing the speed of opinion polarisation and the [[destablisation of democratic society as a whole. -&gt;InstigaCapital Insurance Ltd.]]

</tw-passagedata><tw-passagedata pid="77" name="increase the frequency of the pop-ups" tags="" position="2807,102" size="100,100">The increased frequency of the pop-up ads starts to increase cases of severe VR sickess in players. Even worse, some start to experience seizures. Turns out the calculations from your in-house researchers were slightly off... Calls are now being made for the game developer and the brands to cover the medical costs which are starting to pile up and a class action suit is forthcoming.

Players who are not physically affected form a community to support those who are. They entirely reject the offer of an ad-free subscription service, and they move their activities to a rival game. The backlash and the accompanying memes circulating on the internet further damage the reputation of both the game developer and the brands involved in the pop-ups. 

As the lead on the account when the class action comes in and finally wins its case against Breakthrough, it is your head that has to roll. [[You lose your job and any credibility you might have had in the industry. -&gt;InstigaCapital Insurance Ltd.]]





</tw-passagedata><tw-passagedata pid="78" name="continue to aim the content at under-18s" tags="" position="2817,547" size="100,100">This approach works for a while but the regulator soon catches up with you. Your content wasn&#39;t subtle enough and it was entirely clear that you were aiming it at under-18s. An investigation into your practices results in enormous fines for Breakthrough, the game developer and all the associated brands. The press coverage of this positions you and your cohort of brands as vicious opportunists, profiting from the essentially captive online market represented by the growing communities calling themselves &#39;Hikikomori&#39;, who are spending increasing amounts of time in virtual spaces, finding them preferable to real world interactions. 

Breakthrough tells you that this is your mess, so you need to find a way to clear it up. You attempt to claim ignorance, arguing that the age restrictions of //Forbidden Desires// mean that there simply are not any under-age users to aim the content towards. You&#39;re not convinced this will fly: your bosses are not sold on it and neither are your clients, who have already withdrawn their business for the forseeable future. The legal team are busily finding an alternative workaround, but regardless, someone needs to be made an example of. [[Heads must roll and yours is the first to go. -&gt;InstigaCapital Insurance Ltd.]]

</tw-passagedata><tw-passagedata pid="79" name="Comply with the legislation" tags="" position="2815,421" size="100,100">With the reach restricted to adult players several clients pull out entirely. Those that remain see their ROI drop sharply until they can no longer convince bosses that this is a viable approach to the game. 

You&#39;re taken off the account and replaced with a younger colleague who is deemed more &#39;tech savvy&#39;, although you&#39;re pretty sure they know as much about this as you do. You&#39;re disappointed but also mildly relieved that no one has asked you to take the riskier option of trying to find loopholes in the legislation. 

Legal assures your successor that this is possible, but you&#39;re happy enough to [[play no further part in the debacle -&gt;InstigaCapital Insurance Ltd.]] and move back onto more familiar and clearly regulated print and broadcast campaigns. 


</tw-passagedata><tw-passagedata pid="80" name="arrange the call" tags="" position="1490,207" size="100,100">(set: $answers to (array:))
(set: $countA to 0)
(set: $countB to 0)
(set: $countC to 0)
You&#39;re late to join the VR meeting, which takes place in a sparsely furnished office with bright white walls. Skye&#39;s luminous avatar assures you that it&#39;s fine, and she knew you would be delayed. 

Somewhat unsettled you take a seat in the corner of the room on an uncomfortable hanging basket-chair which starts to sway gently back and forth. Skye explains that your future in the industry depends entirely on your attitudes and beliefs in the power of VR&#39;s brand storytelling. She requests that you complete a short personality test to determine your suitability for the adworld of the future. It will take no more than ten minutes of your time and if you leave your contact details you will be entered into a prize draw to win a brand new VR headset and suit with haptic feedback capabilities. 

This seems an unusually low-tech form of assessment for a futurist, but you pick up your virtual pen and start the [[questionnaire]] anyway. </tw-passagedata><tw-passagedata pid="81" name="questionnaire" tags="" position="1617,210" size="100,100">Q1. How would you describe your feelings about virtual reality in advertising?

(link: &quot;A. Deeply passionate and strongly held. This is the future and I&#39;m willing to bet my life on it.&quot;)[
	(set: $countA to it + 1)
	(set: $answers to it + (array: &quot;A&quot;))
	(goto: &quot;Question 2&quot;)
]
(link: &quot;B. Undecided. I can see its potential but it still seems like a risk.&quot;)[
	(set: $countB to it + 1)
	(set: $answers to it + (array: &quot;B&quot;))
	(goto: &quot;Question 2&quot;)
]
(link: &quot;C. Sceptical. It is a fad that will pass in time.&quot;)[
	(set: $countC to it + 1)
	(set: $answers to it + (array: &quot;C&quot;))
	(goto: &quot;Question 2&quot;)
]</tw-passagedata><tw-passagedata pid="82" name="Question 2" tags="" position="1749,211" size="100,100">Q2. Do you belive in the power of virtual reality to create meaningful brand/consumer relationships and emotional touchpoints?

(link: &quot;A. Absolutely and unconditionally&quot;)[
	(set: $countA to it + 1)
	(set: $answers to it + (array: &quot;A&quot;))
	(goto: &quot;Question 3&quot;)
]
(link: &quot;B. Possibly, but the evidence just isn&#39;t compelling enough for me yet.&quot;)[
	(set: $countB to it + 1)
	(set: $answers to it + (array: &quot;B&quot;))
	(goto: &quot;Question 3&quot;)
]
(link: &quot;C. I don&#39;t even know what that means.&quot;)[
	(set: $countC to it + 1)
	(set: $answers to it + (array: &quot;C&quot;))
	(goto: &quot;Question 3&quot;)
]</tw-passagedata><tw-passagedata pid="83" name="Results" tags="" position="1997,209" size="100,100">(if: $countA is &gt;1) [Skye considers your responses carefully and finally proclaims &quot;You are clearly a VR evangelist and have the passion, drive and curiosity to succeed in the future world of VR marketing. Your positive attitude to risk and experimentation is precisely what the field needs at the moment to drive innovation, push the envelope and create meaningful branded experiences and connections. Go forth and become a thought leader!

Emboldened by this advice, you decide to embrace all the coming changes and start a new [[Immersive Content department]], with a focus on VR. ]

(if: $countB is &gt;1) [Skye considers your responses carefully and finally says: &quot;You are a borderline case. You don&#39;t have the passion, drive and curiosity to succeed in this field yet. You&#39;ll need to believe in it more if you want to have a place in the workforce of the future.&quot;  

You scoff at Skye&#39;s prediction. You&#39;re interested enough, you just don&#39;t want to put all your eggs in that virtual basket. You decide to [[hedge your bets]] and stay where you are for the moment but you&#39;re not willing to go all in and become the company&#39;s VR evangelist. ]

(if: $countC is &gt;1) [Skye considers your responses carefully and finally speaks: &quot;You are a sceptic and there is no place for you in the workforce.

The feedback is short and blunt. You mull it over and figure you have 2 options. You can either [[quit]] and look for something else or [[hedge your bets]] and see how things go. Maybe this will be just a passing phase...] 

(if: $countC is 1 and $countB is 1 and $countA is 1) [Skye considers your responses carefully and finally says: &quot;You are a borderline case. You don&#39;t have the passion, drive and curiosity to succeed in this field yet. You&#39;ll need to believe in it more if you want to have a place in the workforce of the future.&quot;  

You scoff at Skye&#39;s prediction. You&#39;re interested enough, you just don&#39;t want to put all your eggs in that virtual basket. You decide to [[hedge your bets]] and stay where you are for the moment but you&#39;re not willing to go all in and become the company&#39;s VR evangelist.]

</tw-passagedata><tw-passagedata pid="84" name="Question 3" tags="" position="1876,211" size="100,100">Q3. Which three words do you associate most with VR?

(link: &quot;A. Revolutionary, powerful, persuasive&quot;)[
	(set: $countA to it + 1)
	(set: $answers to it + (array: &quot;A&quot;))
	(goto: &quot;Results&quot;)
]
(link: &quot;B. Risky, uncertain, gamble.&quot;)[
	(set: $countB to it + 1)
	(set: $answers to it + (array: &quot;B&quot;))
	(goto: &quot;Results&quot;)
]
(link: &quot;C. Unproven, fad, short-lived.&quot;)[
	(set: $countC to it + 1)
	(set: $answers to it + (array: &quot;C&quot;))
	(goto: &quot;Results&quot;)
]</tw-passagedata><tw-passagedata pid="85" name="Immersive Content department" tags="" position="2161,207" size="100,100">Embracing VR seriously works out well for you. You start interviewing potential hires in VR instead of in-person, programming an avatar of yourself to do the interviews and putting through only those who meet the specific criteria. You end up with a stellar team.

VR meetings make overseas clients a lot easier to communicate with and you  develop new lucrative business links abroad. The collaborative VR workspaces also encourage more collaborative processes and you meet lots of new people from companies that think and work very differently to you. You become much more open-minded and respond more positively to changes in the company, whereas some of your other colleagues are being asked (read forced) to move on to new companies or new jobs as it is deemed that they cannot keep up with the changing times. 

You&#39;re creatively inspired on a daily basis and your work-life balance improves because you can work from home more often, which cuts down on both  rent and commuting costs because you can live outside of London. [[Your health benefits and your personal life improves immeasurably. -&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="86" name="hedge your bets" tags="" position="2008,322" size="100,100">After deciding to remain with Breakthrough you continue to struggle with the shifts in the work patterns, cultures and expectations. The VR meetings are not the worst experience. They certainly cut costs and have encouraged more collaborative work but you still feel a bit nauseous in them so you avoid them where possible. 

You leave the headset at the office most of the time, but you have started to venture out to talk to more specialist VR companies who can help you take advantage of what it has to offer without you having to totally retrain. Working together on projects seems to be far more viable at this stage than trying to take this kind of work in-house, and the working relationships seem productive. 

VR doesn’t transform your working life but it does provide a creative outlet for experimentation which is different from the daily grind. You&#39;re not front of the line for promotions as a result, but you&#39;re also not risking your job on high-profile, experimental campaigns which could very easily crash and burn.

As you sip your coffee one morning you note in some trade press that a tragic, entirely unpredictable accident caused by an electrical malfunction in the VR network at ALLSEEING HQ has claimed the lives of several employees, poor Skye being one of them. [[You pause for a moment and reconsider your prior decisions, concluding that you made the right ones, as you log into your next virtual meeting with a client.-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="87" name="quit" tags="" position="2166,340" size="100,100">You go to interviews but the only jobs going in the sector are future-tech focused and you&#39;re not skilled up enough. Several of the job titles are mostly new to you and the job descriptions are often vague or so full of buzzwords that you don&#39;t even know how to start writing the cover letter.

But, you figure you&#39;ll give it a go though and see what happens. 

Do you apply for:

[[Chief Experience Officer]]
[[Omnichannel Marketer]]
[[VR Analyst]]
</tw-passagedata><tw-passagedata pid="88" name="Chief Experience Officer" tags="" position="2056,502" size="100,100">Somehow you manage to secure an interview for the role. You have no real idea what this means in practice, but you head off for the interview anyway. You come away with even less understanding of what the job entails, and you don&#39;t think you made a great first impression.

When the feedback comes, you&#39;re told that you were not passionate enough about the future of VR or empathetic enough about the consumer journey and/or experience. This upsets you a bit, given that most of your career to date has been focused on consumer marketing. You tell them this and slam the phone down in frustration. 

Despondent and unable to bring yourself to use the buzzwords that seem to be required to get these jobs, you&#39;re eventually pushed out of the sector. You end up taking an administrative job you hate to pay the rent. [[Your personal and social life suffers as a result. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="89" name="Omnichannel Marketer" tags="" position="2166,508" size="100,100">Somehow you manage to secure an interview for the role. You have no real idea what this means in practice, but you head off for the interview anyway. You come away with even less understanding of what the job entails, and you don&#39;t think you made a great first impression.

When the feedback comes, you&#39;re told that they are looking for generalists rather than specialists. Unfortunately you&#39;ve been honing your skills in social media and you just don&#39;t tick all of the boxes they need you to. You&#39;re convinced there&#39;s not a human being in the world who could tick all those boxes. You tell them so and slam the phone down in frustration. 

Despondent and unable to bring yourself to use the buzzwords that seem to be required to get these jobs, you&#39;re eventually pushed out of the sector. You end up taking an administrative job that you hate to pay the rent. [[Your personal and social life suffers as a result. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="90" name="VR Analyst" tags="" position="2272,507" size="100,100">Somehow you manage to secure an interview for the role. You have no real idea what this means in practice, but you head off for the interview anyway. You come away with even less understanding of what the job entails, and you don&#39;t think you made a great first impression.

When the feedback comes, you&#39;re told they want data scientists and since you didn’t do a degree in computing or maths and have no relevant postgraduate qualifications, you&#39;re not a suitable candidate. You wonder why they invited you to interview in the first place. You tell them this and slam the phone down in frustration. 

Despondent and unable to bring yourself to use the buzzwords that seem to be required to get these jobs, you&#39;re eventually pushed out of the sector. You end up taking an administrative job that you hate to pay the rent. [[Your personal and social life suffers as a result. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="91" name="‘Hikikomori’*" tags="" position="378,2032" size="100,100">*from the Japanese phenomenon of tech-enabled extreme social withdrawal 

[[Return to story-&gt;general guidelines already in place]]</tw-passagedata><tw-passagedata pid="92" name="1) fully endorse collaboration between universities and private providers in order to implement virtual education as soon as possible?" tags="" position="770,1924" size="100,100">In the process of implementation, universities are made aware that the anonymised personal data of all participants is being tracked by the VR headset company that provides the headsets. This is retained by both the VR headset company and VR4Ed for the development and support of their products and services. These data include records of interactions between students and instructors, data about gaze and gesture, and biometric data such as pupil response and heart rate variability. Because of the large numbers of students enrolled on these courses, assessment of student learning is challenging, and VR4Ed proposes that headset data can be used as a proxy for assessment. Certain courses are made Pass/Fail and gaze data is used as a proxy for attendance and attention, combined with results on multiple-choice examinations. Gaze data is also used as a proxy for the assessment of instructors, with certain percentage levels seen as indicators of their ability to engage students. Instructors who incorporate their pets into their teaching receive higher student satisfaction ratings than those who do not.

Although student feedback indicates this mode of education seems to be relatively engaging and viable, there are rumours that some students are paying substitutes to wear their headsets for exams; VR4Ed starts to offer a gold package that monitors biometric data to ensure the person in the headset is the enrolled student, and will, for a fee, provide this biometric data to assessment offence panels. 

VR4Ed also starts to pursue another potential avenue to monetise data: sale of datasets to a large player in the recruitment industry who wants to use the data to profile new entrants to the market. A whistleblower reports to your office that this deal is in progress. 

Do you:
0. [[recommend the sale go forward]] on the basis that all data is anonymised and a portion of profits is invested into the development of new modules, or 
0. [[recommend that the sale be delayed]] pending a full investigation as to whether students and instructors had the opportunity to give informed consent to the sale of their data?
</tw-passagedata><tw-passagedata pid="93" name="2) cautiously endorse collaboration, recommending that the deal go ahead for first-year students only, but that it be reevaluated after one year when the public health situation has been reassessed" tags="" position="922,1923" size="100,100">You recommend that the deal go ahead for first-year students only, but that it be reevaluated after one year when the public health situation has been reassessed. Uptake of the first-year online-only courses by overseas students is strong, although there is some diversion of domestic students towards universities offering traditionally-taught courses. First year results show the significant learning gains from VR modes of teaching in design, engineering, and medical courses.

You are asked for your position on further roll-out of VR instruction. Do you:

[[1) investigate arising concerns of MPs about potential political bias in VR instruction]] or

[[2) investigate arising student concerns about the privacy of personal data gained through VR instruction]]?
</tw-passagedata><tw-passagedata pid="94" name="1) investigate arising concerns of MPs about potential political bias in VR instruction" tags="" position="890,2087" size="100,100">The NUS has raised alarms that bias is less discernible in VR instruction than real-life instruction due to the transfer effects of the simulated learning situations from an instructor’s politically biased point of view. It is an election year, and the government is concerned that students are being unduly politically influenced and recommends a review of the use of VR in university instruction, and you are asked to head up a consultation.

Do you:
0. [[Agree to the consultation]] or 
0. [[Insist that this is an issue of academic freedom]] and that universities be responsible to monitor this mode of instruction as they would any other mode of instruction?
</tw-passagedata><tw-passagedata pid="95" name="2) investigate arising student concerns about the privacy of personal data gained through VR instruction" tags="" position="1023,2089" size="100,100">When the issue of data sharing arises, you recommend a hard line approach and VR4Ed is required to keep the biometric and interactivity data gathered from staff and student interactions private. 

The timing of all this is personally interesting, as your 19-year-old son has returned from a gap year and wants to enrol in an online-only course on ‘Virtual reality and games production’ at a Australian university. You would really prefer that he graduate with a UK credential; do you:

0. [[concede to his preference]] to enroll at the Australian university; or
0. [[insist that he enrol in a UK programme]]?
</tw-passagedata><tw-passagedata pid="96" name="air your concerns" tags="" position="1624,913" size="100,100">You tell the airline team that you appreciate the idea but express concerns about potentially misleading medical claims that the VR experience might not actually be able to fulfil.

The marketing team takes this on board and comes back to you two days later with an alternative proposal. They don&#39;t want to grapple with any medical or pharmaceutical regulations, and appreciate your concerns are well-founded.

Instead they suggest a VR promotion that demonstrates how smoothly their pilots can take off/land/deal with turbulence -- and just allude to the fact that it might help people conquer their fears. Disclaimers abound. They&#39;re insistent that they want to go ahead with the project and more than mildly insinuate that they are approaching other companies who are keen to take it on. What do you do?
* Agree to take it on and approach a [[games company]] for production. If it&#39;s not a medical product then this should be fine.
* Agree to take it on but only with the assistance of [[trained psychologists]] and with rigorous user testing. </tw-passagedata><tw-passagedata pid="97" name="games company" tags="" position="1615,656" size="100,100">The games company enthusiastically sets to work but they too raise concerns about being sued over potential misleading phobia-curing claims. They insist that all participants sign a disclaimer before the experience indemnifying the company from any liability whatsoever should the flight simulator have any negative effect on users at all. 

The airline agrees wholeheartedly and you can see the appeal, despite the fact this might be offputting for potential users and therefore limit promotional reach of the campaign... not to mention the PR risk if something should go awry and it turns out the brand was washing its hands of any responsibility. 

Do you agree and [[pass on the risk to the consumer?]]

Or do you [[push back]], and try to convince the clients that with the right advice during development you can mitigate these risks without passing them on to the consumer?</tw-passagedata><tw-passagedata pid="98" name="trained psychologists" tags="" position="1762,734" size="100,100">You insist on proper user testing at all stages until you’re happy with it and use professionals from the psychology field to assess it and to work on research that assesses the long-term impact. You make it clear to the client that this will take time and that you’re not willing to rush out something that might be even remotely harmful, even though there is technically no regulation preventing it. User data is to be kept completely confidential and participants agree only to a very limited liability waiver on taking part. 

The airline has an umblemished passenger safety record and are reluctant to have this tarnished for the sake of a promotional event. After some consideration they agree to your terms for the project. They view the extensive research as investment into a longer term product that might improve brand loyalty in the future. 

By the time the experience launches, the research is solid and you&#39;re able to make tentative claims in the press release to the short-term effectiveness of the experience to reduce flight anxiety in some users. 

People are more than happy to sign off on the disclaimer, desperate to overcome their fear of flying (for free!). Stories circulate on social media about participants hoping to be able to finally see long lost relatives in person after years of videochats and VR meetings. Several have expressed a longing to finally see a cherished work of art in real life. You can see pretty much any of these destinations and artefacts via VR tours now, but as a result, Benjaminian aura has come back into vogue and airlines are keen to take advantage of this trend.

While the long term effects are still hard to predict, in the short term the project is a huge success. Those who try the experience start booking flights in their droves and become fiercely brand loyal as predicted. Just hearing about the initiative prompts frequent flyers to switch. 

As the effectiveness become clearer, the airline starts to contemplate charging for the experience, but there have been grumblings about the environmental impact and there&#39;s still no clarity on what the long-term effects are. Moreover, charging will look like cynical profiteering. Your advice hasn&#39;t steered them wrong yet so they come back for your opinion. What do you suggest?

[[Keep the experience free, donate some of the profits associated with the increase in flight bookings to a carbon offsetting programme and fund further research into the long term effects of the experience.]] 

[[They could charge for the experience but only if they are willing to donate some of the profits to a carbon offsetting programme.]]

They only have a short window of time before the longer term effects become clear. So they should [[start charging now in order to profit as much as possible before this happens]] in case it turns out to be ineffective. 

 
</tw-passagedata><tw-passagedata pid="99" name="pass on the risk to the consumer?" tags="" position="1755,586" size="100,100">Any and all risk is fully passed on to consumers via a disclaimer which they simply swipe to accept on a tablet screen before they enter the experience. Safety net in place, the production company offers some vague guidelines for user safety, but the whole project is starting to run behind. In an attempt to rush the production through to the agreed deadlines they suggest reducing the planned user testing phases. The airline is starting to grumble about potential delays to launch dates which were due to coincide with other promotional activities for their 50th anniversary.  

Do you flat out refuse this suggestion and [[push back]] the launch?

Or [[rush the user testing]] to placate the client? </tw-passagedata><tw-passagedata pid="100" name="push back" tags="" position="1620,784" size="100,100">You appeal to the airline&#39;s reputation for umblemished safety records and they reluctantly agree to push the VR experience launch back to allow for further user testing. You can hear the production team breathing a sigh of relief and you know you&#39;ve done the right thing. 

When the experience launches, the press release is carefully worded to be suggestive enough to appeal to those with a fear of flying without suggesting there are any definitive medical benefits. Words like &#39;reassurance&#39;, &#39;comforting&#39;, and &#39;safety&#39; are judiciously used to send the message that the flight experience is so smooth that it will reassure &#39;even the most anxious of flyers&#39;.

People are more than happy to sign off on the disclaimer and sign up in their droves, desperate to overcome their fear of flying (for free!). Stories circulate on social media about participants hoping to be able to finally see long lost relatives in person after years of videochats and VR meetings. Several have expressed a longing to finally see a cherished work of art in real life. You can see pretty much any of these destinations and artefacts via VR tours now, but as a result Benjaminian aura has come back into vogue and airlines are keen to take advantage of this trend.

Aside from one or two instances of VR sickness, the experience is a success, at least in the short term. You won&#39;t know the long term effectiveness for a while, but for now there is an increase in flight booking so the client is happy -- so you&#39;re happy. 

But now the airline starts to contemplate charging for the experience, despite the lack of clarity about the short and long term effects of VR exposure. There have also been grumblings about the environmental impact of increased flights and, moreover, charging will look like cynical profiteering. Your advice hasn&#39;t steered them wrong yet so they come back for your opinion. What do you suggest?

[[Keep the experience free, donate some of the profits associated with the increase in flight bookings to a carbon offsetting programme and fund further research into the long term effects of the experience.]] 

[[They could charge for the experience but only if they are willing to donate some of the profits to a carbon offsetting programme.]]

They only have a short window of time before the longer-term effects become clear. So they should [[start charging now in order to profit as much as possible before this happens]] in case it turns out to be ineffective. </tw-passagedata><tw-passagedata pid="101" name="rush the user testing" tags="" position="1759,872" size="100,100">When the experience launches the press release is carefully worded to be suggestive enough to appeal to those with a fear of flying. Words like &#39;reassurance&#39;, &#39;comforting&#39;, and &#39;safety&#39; are judiciously used to send the message that the flight experience is so smooth that it will reassure &#39;even the most anxious of flyers&#39;.

People are more than happy to sign off on the disclaimer and sign up in their droves, desperate to overcome their fear of flying (for free!). Stories circulate on social media bout participants hoping to be able to finally see long lost relatives in person after years of videochats and VR meetings. Several have expressed a longing to finally see a cherished work of art in real life. You can see pretty much any of these destinations and artefacts via VR tours now, but as a result Benjaminian aura has come back into vogue and airlines are keen to take advantage of this trend.

But after the first two weeks of launch the consequences of rushing the user testing are abundantly clear. Several people have horrible VR experiences, experiencing nausea and anxiety attacks that actual reinforce their phobias. Some customers have such positive experiences in the first week that they rush to book their flights the following week, only to find that the effects have not transferred beyond the VR experience. Their reactions are severe enough that they are forced to disembark, delaying the flight and only increasing their fears of flying in the future.

Shares in the airline plummet and even regular customers stat to switch to more considerate competitors. You lose the client and have an ominous meeting scheduled with your manager in which you&#39;re pretty sure you&#39;re going to be asked to [[leave quietly. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="102" name="Keep the experience free, donate some of the profits associated with the increase in flight bookings to a carbon offsetting programme and fund further research into the long term effects of the experience." tags="" position="1912,650" size="100,100">This isn&#39;t a popular opinion with shareholders, but your unwavering belief in the ability of VR to do social good and change the world eventually sells your approach and they take your advice on board. 

In the short term, the carbon offsetting scheme mitigates some of the negative PR around the topic, though no one will ever know the extent of the actual impact of the programme. 

Although it takes many years, the research funded by the airline finally starts to yield results and the experience is eventually provided to patients on the NHS. Longer-term consumer loyalty is completely cemented by this, and new flyers flock to the airline as the innovators and leaders in passenger care and safety. 

Your role in the process does not go unnoticed and you are rewarded with several industry accolades as you rise up the company. [[You retire comfortably knowing you have done some good in the world. -&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="103" name="They could charge for the experience but only if they are willing to donate some of the profits to a carbon offsetting programme." tags="" position="1913,777" size="100,100">This seems like a fair middle ground which pleases both shareholders and the PR team who are worried about the increasing backlash against the campaign. It seems to mitigate the chatter around the enivronmental situation for the time being but there&#39;s no real way to know whether the carbon offsetting plan has any actual impact. 

The actions of the client do not stop some of the negative stories about profiteering, particularly since there is deemed to be a lack of research to suggest the experience has any long term effects, and so users might come back for repeat purchases. But the client seems unconcerned since this is not affecting profits negatively.  

Overall, the project is deemed a success, your innovation raises your profile with management at work and [[your case for promotion is starting to look stronger. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="104" name="start charging now in order to profit as much as possible before this happens" tags="" position="1913,915" size="100,100">Shareholders are delighted by the potential for extra income from the project and they immediately start charging for the experience as soon as possible. 

The PR team settle in for a rough ride as public opinion starts to turn sour and the press has a field day. The company is accused of lacking in corporate responsibility and going against some of their existing commitments to greener policies. The negative press around the lack of insight into long term effects of the experience also starts to gain momentum on social media and a boycott hashtag starts to trend. The airline is deemed opportunistic, money-grabbing and short-sighted. 

Foiled by their own hubris and profit driven attitudes, the airline actually starts to see a drop in bookings as a result. This is likely to be a short term problem - the project is scrapped and the PR team do some significant damage control. 

But it&#39;s not what the shareholders were expecting and they have made you the scapegoat. You lose the client and have an ominous meeting sheduled with your manager in which you&#39;re pretty sure you&#39;re going to be asked to [[leave quietly.-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="105" name="InstigaCapital Insurance Ltd." tags="" position="379,217" size="100,100">{
(track: &#39;InstigaCapital&#39;, &#39;play&#39;)
}
&lt;img src=&quot;./media/instigacapital.png&quot; width=&quot;400&quot; height=&quot;225&quot; alt=&quot;InstigaCapital logo&quot;&gt;
Thank you for playing. Please note that data collected throughout this experience will now be factored into your insurance premiums. 

These may rise or fall depending on your attitude to risk, indicated by your choices. 

Please follow the link below for some information sources relevant to your most recent journey. 
* &lt;a href=&quot;./bibliographies/advertiserbibliography.html&quot; target=&quot;_blank&quot;&gt;VR Advertiser References&lt;/a&gt;
* &lt;a href=&quot;./bibliographies/consumer-producerbibliography.html&quot; target=&quot;_blank&quot;&gt;VR Consumer References&lt;/a&gt;
* &lt;a href=&quot;./bibliographies/policybibliography.html&quot; target=&quot;_blank&quot;&gt;Policy Maker References&lt;/a&gt;
* &lt;a href=&quot;./bibliographies/consumer-producerbibliography.html&quot; target=&quot;_blank&quot;&gt;VR Maker References&lt;/a&gt;

Here at InstigaCapital we believe everyone deserves a second chance - we all make mistakes sometimes, we&#39;re still only human. If you would like to imagine a different future for yourself, please select an alernative identity.

[[VR maker]] 
[[VR consumer]] 
[[Policy maker]] 
[[Advertiser]] 





</tw-passagedata><tw-passagedata pid="106" name="addictive nature of VR" tags="" position="579,1757" size="100,100">The ‘bodily neglect’ case has raised public alarms about the addictiveness of virtual reality. Concerned parents and teachers are contacting your office about cases of children seemingly addicted to VR gameplay, particularly in connection to the rising popularity of a game called //Forbidden Desires//, with customisable environments and avatars and adult themes. There is an emerging lobby to bring in a rating system and regulation with enforceable age restrictions specific to VR gameplay. 

Do you recommend: 
* deferring to [[general guidelines already in place]] for the gaming industry and covered by the WHO definition of ‘disordered gaming’. These seem adequate to cover virtual reality and allow the flourishing of the VR gaming market;
* instituting a [[strict rating system]] restricting virtual reality experiences to 18+. This includes warnings and age verification of downloads for all virtual reality experiences, and criminalisation of underage playing; or
* collaborating with international committees to create an [[international code of conduct for virtual reality]], alongside establishing a support line for those concerned about psychosocial and physical effects of virtual reality?
</tw-passagedata><tw-passagedata pid="107" name="VR instruction in higher education" tags="" position="851,1754" size="100,100">A leading ed-tech startup, VR4Ed, has developed a product that would facilitate an entirely remotely-delivered learning experience, and virtual reality is central to its model. Making the most of new software that can generate a hologram from a 2D webcam image, it has a seminar mode in which students and instructors congregate in a chat-room type environment to simulate the classroom. The modules will accommodate simulation training, to be developed with the support of specialists. They also have an agreement with a VR headset company who will provide all enrolled students with a headset for the duration of their course as part of the package offered to their customers.

Due to a global pandemic, several universities with high proportions of international students are exploring VR4Ed’s solutions. They are looking to quickly convert several of their first-year courses to online-only and to implement a mixed economy of traditionally-taught and online-only delivery for second and third year students. Tuition fees are the same for online-only and traditionally-taught modules, but universities need to expand their student numbers to compensate for the lost student accommodation revenue. The National Union of Students has raised concerns to the Department for Education about how assessment will be handled and about the equality of the learning experience for online-only and traditionally-taught students. The latter do not receive headsets as this is not part of the agreement with VR4Ed. The DfE has approached your office for recommendations on the role of VR in higher education.

Does your recommendation:
0. [[fully endorse collaboration-&gt;1) fully endorse collaboration between universities and private providers in order to implement virtual education as soon as possible?]] between universities and private providers in order to implement virtual education as soon as possible?
0. [[cautiously endorse collaboration-&gt;2) cautiously endorse collaboration, recommending that the deal go ahead for first-year students only, but that it be reevaluated after one year when the public health situation has been reassessed]], recommending that the deal go ahead for first-year students only, but that it be reevaluated after one year when the public health situation has been reassessed</tw-passagedata><tw-passagedata pid="108" name="limitations of the nation&#39;s infrastructure" tags="" position="1504,1749" size="100,100">A number of industries are beginning to exploit the efficiencies of VR - manufacturing and construction firms in particular are realising significant productivity gains through virtual modelling of their designs and processes. However, several thorny issues are making their way to your desk, and you need to prioritise issues to investigate. 

Do you prioritise: 
0. [[challenges to digital infrastructure]] caused by increased VR/immersive technologies;
0. [[the VR skills crisis]] - there simply aren’t enough people coming up within the industry to meet the demand for developers; or
0. [[funding incentives]] to stimulate the development of VR technology?</tw-passagedata><tw-passagedata pid="109" name="items in national collections" tags="" position="2219,1753" size="100,100">With VR becoming more and more popular amongst heritage sites and museums, and with tourism experiencing an unanticipated decline in the wake of rising concerns about global health and climate change, the minister for culture and heritage is interested in monetising the UK’s significant cultural assets through virtual reality. You have been asked to serve on a committee that will advise on applications for funding to develop VR applications in the arts and heritage sector. 

Together with your committee, you are reviewing an application from a consortium of museums for a project that will embark on an ambitious schedule of 3D scanning and volumetric capture of key civilisational assets in the national collection, to be explorable in VR. The application presents various dissemination models: 

0. [[institutional subscription only]], making the entire collection available to museums and location-based experiences around the world;
0. [[freely available downloads]] via leading VR platforms of initial key resources, with purchase of additional packages of future collections as they are scanned, focused on consumers rather than institutions;
0. [[a yearly virtual individual, family or institutional membership]], featuring a gamified approach for consumer subscriptions and enhanced pedagogical materials for institutional subscriptions, targeted at all levels of education. There is no existing policy guidance in the arts, culture and heritage sector on these models. 

Which do you recommend?</tw-passagedata><tw-passagedata pid="110" name="integration of VR into the national healthcare system" tags="" position="2595,1755" size="100,100">VR has been successfully trialled in training for various medical professions - the ability to use simulations to practice procedures, patient care and interpersonal interactions has proven highly effective. It has also been trialled extensively in psychological, physical and occupational therapies. Various NHS regions have been approached by companies offering different healthcare applications for VR, and there is an emerging sense that a ‘VR revolution’ in health care could be at hand, if local authorities can realise economies of scale by sharing resources and findings. 

You have been asked to sit on a committee under the Department of Health and Social Care on the oversight of new technologies into public and private health. You are asked for policy recommendations on the regulation of VR in health applications. You recommend the institution of a new Quality Institute of Digital and Immersive Technologies in Health (QuIDITH) that certifies any new VR (and other immersive technologies) for health purposes, and requirement of this certification for direct or indirect use (i.e. by referral) in the public health sector. This is agreed. Now, who do you recommend to head up this institute?
0. The mononymous [[Skye, co-founder of ALLSEEING]], &#39;an agency and a platform for prototyping futures&#39;, who has an impressive list of previous clients, including the US Department of Health and Human Services and the Swedish Ministry of Health and Social Affairs.
0. [[Kai Northcliffe]], CEO of a widely-prescribed smoking cessation app, who topped the Forbes ‘Top 40 under 40’ list in 2018.
0. [[Amira Mahabir]], obstetrician, medical anthropologist, and professor of maternal health at University College of Manchester, whose pioneering work developing virtual childbirth support models has been adopted in the UK and in medically underserved communities in Pakistan.
</tw-passagedata><tw-passagedata pid="111" name="general guidelines already in place" tags="" position="416,1857" size="100,100">Public paranoia about the pathological potential of virtual reality has the counterintuitive effect of gaining //Forbidden Desires// a cult following, particularly among young people aged 13-21 experiencing body dysmorphia. Virtual reality’s customisable environments and avatars allow them to bypass the restrictions of their physical bodies and real-world social interactions; young people in this group increasingly prefer online to real-world interactions. 

An international movement begins that spreads to other communities of young people with concerns about the climate emergency, ableism, racism, and socioeconomic inequality. They spend innumerable hours congregating in virtual communities, and an online community called [[‘Hikikomori’*]] with a charismatic leader represented by a Pokemon avatar, grows in size, social presence and influence. The community begins to circulate doctrines reclaiming the term ‘Hikikomori’ from psychiatry, positioning their preference for virtual reality as the sensible pursuit of a better and more just world. Instances of bodily neglect increase as the movement becomes more and more ascetic, and anxious family members are faced with the decision to interrupt access to VR and hospitalise them, although the arguments for Hikikomori as a politically and morally valid life choice have become compelling. 

What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[Call it a day; you don&#39;t understand the world anymore and it&#39;s time to retire-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="112" name="strict rating system" tags="" position="428,2152" size="100,100">Video games are deemed as having less addictive potential than VR as they do not involve blocking people off from their physical environments. A new strict rating system is therefore implemented that makes 18 the legal age for virtual reality. Faced with the prospect of legal prosecution for underage gameplay, most VR gaming companies adjust their marketing strategy to focus on the adult market, and location-based experiences become strictly 18+. Informed consent becomes a nearly universal aspect of downloading an experience, but this is treated at times as a free pass to unrestricted violence and adult themes. 

Adolescents seek access to //Forbidden Desires// and other adult VR games through identity falsification services, and there is a sharp increase in ‘skin-betting’ as a black market emerges for those who are not able to provide debit or credit cards for in-game purchases. Many of these back-door avenues are identified and their proponents charged under the new legislation; a high-profile case involving a well-known celebrity, who is charged for neglecting to prohibit her underage son’s VR use, brings additional awareness to the situation. 

There is a dampening effect on the market as people decline to purchase headsets for home use. However, a niche market emerges for location-based VR bars, frequented by people celebrating their 18th birthday, eager to try VR and alcohol legally for the first time. Various non-alcoholic ginger-based post-VR cocktails prove the biggest sellers as they offset the cybersickness experienced by first-time VR users.

What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[Retire from the technology industry obudsman&#39;s office, and invest some savings into post-VR cocktails, which provides a modest, steady income for the rest of your life-&gt;InstigaCapital Insurance Ltd.]].</tw-passagedata><tw-passagedata pid="113" name="international code of conduct for virtual reality" tags="" position="535,2231" size="100,100">A European Commission committee on safeguarding and immersive technologies invites representation from policy-makers and industry representatives from EU and non-EU countries to establish an international code of conduct for virtual reality experiences. The committee considers outputs of research underway about the potentially addictive and harmful effects of virtual reality, and produces guidelines for experience design and conduct of the industry. 

This leads to a FairPlay Code, which smaller VR production companies are eager to sign on to. It becomes a badge of socially responsible VR experiences, and eventually BookofVisages gets on board and becomes the first large organisation to sign on. Others follow. 

Once the code is established, new discourses about responsibility in design and conduct become mainstream. Additional research into the prevention and mitigation of potential harms is funded and protocols for helping people affected by disordered gaming are developed, drawing on new methods in VR counselling practices. New virtual communities arise, offering social connection for people who experience some types of physical isolation, and studies demonstrate that social VR improves the mental health of isolated individuals.

What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[Request retirement from the technology industry ombudsman&#39;s office, but stay on an additional two years while a replacement is sought.-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="114" name="Agree to the consultation" tags="" position="885,2441" size="100,100">The consultation goes ahead, with evidence brought by students, academics, instructional designers, union representatives, politicians, and lobby groups. The process raises concerns that you feel are legitimate as there seems to be evidence that some students identify more deeply with an instructor with whom they can engage, albeit virtually, in close proximity and without the mitigating social dimension of their peers’ physical presence. Furthermore, some of the simulation training seems to have led some students to uncritically accept the hyperreal worlds they are exposed to even when the intended learning outcomes have been to exercise their criticality. 

The committee publishes a report with further guidelines for VR instruction; special interest groups in learning and teaching societies start to look more specifically into the implications of VR training for higher education; and Instructional Review Boards are established at several universities to monitor the application of VR pedagogies. 

The adoption of VR instruction slows somewhat due to additional bureaucracy, but over time it becomes known as a particularly effective learning tool in history and social science courses, particularly as teachers begin to set assessments requiring students to create VR experiences.

What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[Retirement. In your golden years, you frequently chat in VR with your grandchildren, taking particular pleasure in helping with their history homework, exploring historical sites around the world-&gt;InstigaCapital Insurance Ltd.]].</tw-passagedata><tw-passagedata pid="115" name="Insist that this is an issue of academic freedom" tags="" position="838,2297" size="100,100">Special interest groups in learning and teaching societies form, starting to look more specifically into the implications of VR training for higher education, and these produce additional best practice guidelines. Teaching and learning committees regularly discuss the implementation of virtual learning, and call for a reflexive approach to the design of VR that constantly prompts students to assess their own subjectivity and that of the developers and instructors. 

This has a lot of appeal in social sciences and humanities courses, but less in the sciences as the focus of simulation is on seemingly objective scientific knowledge. A medical anthropology department at one university collaborates with VR4Ed to create key first-year VR modules in ‘Fundamentals of clinical science programmes’ and VR finds its niche. Several other ed tech companies emerge and soon most universities have partnerships with one or more of these companies to incorporate VR modules into their courses.

What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[You retire from the civil service but take an advisory role on the board of VR4Ed. You move to the Lake District and participate in all board meetings via VR-&gt;InstigaCapital Insurance Ltd.]].</tw-passagedata><tw-passagedata pid="116" name="concede to his preference" tags="" position="991,2298" size="100,100">You get to observe firsthand the effectiveness of VR education, and this colours your thinking when the first-year reports start to come in. Comparing your son’s experience to your own university experience, you don’t think he has the same sense of student community that you did, and you suggest he find ways to address this. He joins his university’s e-sports team and by the end of the first year is in a long-distance relationship with one of his teammates. He spends much of his leisure time gaming and chatting with his partner, but they make plans to meet in Singapore over the summer to attend a big e-sports tournament and have a holiday. 

Meanwhile in the UK, uptake of the first-year online-only courses by overseas students is strong, although there is some diversion of domestic students towards universities offering traditionally-taught courses. However, your son is not the only one choosing to stay in the UK and study abroad virtually - several US and Australian universities are leading in this mode of delivery and attract a significant number of UK students. The HE sector over the next decade becomes more internationalised and collaborative, with UK universities accommodating transfer credits from online-only/VR taught courses from international universities into traditionally-based programmes. Several UK universities become leaders in VR education in particular fields. A management department at one university develops modules for various organisational management courses in which simulation has a transformational approach to learning. This leads to creation of a spin-off company that re-humanises the approach to personnel management and development within the industry. 

Meanwhile, your son wins a big e-sports tournament, gets a job designing VR games for a Singaporean company, and he and his partner divide their time between Australia and Singapore. 

As for you, [[retirement in Australia-&gt;InstigaCapital Insurance Ltd.]] sounds very appealing. You make plans to move to a condo in Melbourne. When your son and his partner adopt two children, you are able to see them regularly in person when they are in Australia and in VR when they are not.</tw-passagedata><tw-passagedata pid="117" name="insist that he enrol in a UK programme" tags="" position="1049,2435" size="100,100">Your son is initially resentful of your ‘meddling’ but he takes a first-year course in immersive storytelling and he is hooked. He spends hours of his spare time learning to develop VR environments and games in Unity and Unreal, beyond the course requirements, and joins the Interactive and Virtual Drama Society at his university. They develop a mixed VR/interactive theatre piece called ‘Exponential’ about the fallout of the previous year’s pandemic, and manage to get it on to the programme at the Edinburgh Fringe Festival, which was cancelled the previous year. The piece is a popular and critical success, and receives a lot of national and international press coverage. By the end of his degree, your son has been involved in two other productions and has formed his own company with two of his classmates. 

Meanwhile, the HE sector over the next decade becomes more internationalised and collaborative, with UK universities accommodating transfer credits from online-only/VR taught courses from international universities into traditionally-based programmes. Several university instructors go rogue and begin holding seminars via a popular massively multiplayer online role-playing game (MMORPG) called Combat Cosmos. This proves an enormously successful medium for instruction, accommodating both those with VR headsets and without. Pedagogues note the constructivist, experiential basis of active learning approaches possible in this medium, and promote the ‘community of practice’ philosophy as the basis for instructional design of VR-enabled MMORPG instruction. 

Several UK universities become leaders in VR education in particular fields. Universities and technical colleges expand their curricula to include digital skills as the demand for VR programmers and developers is expanding. All over the world, UK citizens are involved in developing and delivering training throughout the higher education sector and within the organisational development units of corporations.


What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[Join an OECD committee on virtual education; although you are now semi-retired, you frequently VR-in to committee meetings-&gt;InstigaCapital Insurance Ltd.]].
</tw-passagedata><tw-passagedata pid="118" name="challenges to digital infrastructure" tags="" position="1414,1918" size="100,100">With the rollout of 5G, the potential for fully wireless VR and other immersive technologies has become enormous. Uptake is rapidly placing pressures on digital infrastructure -- across Europe, people living in remote areas are demanding the rollout of 5G, while more densely populated areas are experiencing competition for spectrum bandwidth. However, 5G infrastructure is costly, and some very profitable sectors are demanding government investment and the release of additional frequencies for use to fully realise the potential of VR. 

The World Radiocommunications Conference has recommended globally harmonized plans for spectrum use to ensure roaming and compatibility. The government is seeking your input on several of its proposals. Do you support: 
* [[A £1.2 billion investment in infrastructure]] to be implemented between 2021-2025; 
* [[Immediate release of the 24.25-27.5 GHz spectrum band]] and considering release of additional spectrum bands from 2025? or 
* [[both]] of the above?</tw-passagedata><tw-passagedata pid="119" name="the VR skills crisis" tags="" position="1612,1918" size="100,100">The VR industry cannot keep up with the rising demand for skilled VR developers and coders, and many companies who want to exploit the potential of VR are unable to hire the staff they need. Moreover, there are conceptual and ethical issues arising in VR development, and there seem to be few people equipped to address these. 

Do you recommend: 
* that [[universities and industry should create partnerships]] to develop the training required because supply will follow demand; 
* that [[investment in coding is made at all levels of education]], with interdisciplinary technical and digital humanities approaches incorporated at secondary levels; or 
* that [[integrated arts, science and technology teaching]] be supported through the entire education system, with additional funding for professional upskilling and new post-secondary programmes?</tw-passagedata><tw-passagedata pid="120" name="funding incentives" tags="" position="1824,1919" size="100,100">Funding is a major problem for the VR industry, particularly the creative side which is waiting for industrial-based VR use cases to fund and stimulate development of VR technology that will enable greater accessibility and more widespread adoption, particularly in the home use sector. 

There are several potential approaches recommended, including the views of a notable futurist, Skye, the co-founder of ALLSEEING, &#39;an agency and a platform for prototyping futures.&#39; The website lists some impressive previous clients including technology leaders such as Centillion, Hollywood studios and governments. She offers her expertise for an hourly rate of £1500. Her portfolio is impressive and you consider consulting her further to understand whether the potential of the industry merits investment. Do you choose to engage Skye’s services? 

a) [[Yes-&gt;Skyefunding]]
b) [[No-&gt;Commonsense]]</tw-passagedata><tw-passagedata pid="121" name="A £1.2 billion investment in infrastructure" tags="" position="1259,2094" size="100,100">The government budgets £1.2 billion into 5G infrastructure, prioritising highly populated and industrial areas since these offer the greatest return on investment to the GDP. More remote parts of the UK lag under 3G and gaps in service. Although VR theoretically makes remote connection possible, those who are actually in remote areas rarely have the infrastructure to produce these uses. This results in a greater than ever digital divide and an eventual digital and social apartheid between 5G and non-5G geographical regions. However, people living in the 5G hotspots soon realise they are under constant surveillance as their devices track their locations and interactions. Non-5G regions become a desirable destination for fugitives and techno-sceptics alike. 

Meanwhile, an additional £8 billion is raised through public private partnerships, despite concerns about the political connections of some of the international partners. Simultaneously, international relations have been deteriorating between the UK and Iraq, and when a terrorist group carries out a cyberattack on the 5G network. Hundreds of people are killed in driverless car collisions, and people in industry, government and society at large are unable to communicate via VR chat or mobile phones. Eventually a Saudi firm that invested in UK infrastructure is found to have had links with an Iraqi firm with ties to this terrorist group, and the UK is faced with the enormous challenge of regaining sovereignty over its own data and networks. Wireless VR technologies become virtually unusable.

Your retirement has been requested; [[you don&#39;t really have any choice but to comply-&gt;InstigaCapital Insurance Ltd.]].</tw-passagedata><tw-passagedata pid="122" name="Immediate release of the 24.25-27.5 GHz spectrum band" tags="" position="1317,2209" size="100,100">The government immediately releases the 24.25-27.5 GHz spectrum band for use, and private companies are invited to invest in infrastructure development. Only companies based in the countries of political allies are allowed to participate. Initially these companies invest in highly populated areas.

A tax on digital transactions and an immersive technologies sales tax are instituted, and these revenues are earmarked for development of infrastructure in remote regions of the UK. As a result, new communities of remote workers emerge in Leeds, Newcastle and Stirling, working for leading firms based in London, Bristol and Manchester. Large geographical areas still lag behind, however, and there is an escalation of remote communities dying out as young people leave for 5G-serviced communities in order to participate in the emerging new economy.


What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[Retire with some regrets, but to a comfortable cottage near the coast in Arisaig, complacent about the fact that 3G cell service doesn&#39;t even work well there.-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="123" name="both" tags="" position="1400,2324" size="100,100">The government budgets £1.2 billion into 5G infrastructure, earmarking £25 million for further research and investment into efficient use of spectrum. A further £8 billion is raised through public/private partnerships, with an international body established to monitor compliance with international data protection and prevention of surveillance law. Vulnerable points in the infrastructure are identified, and safeguards built into infrastructure where possible and in bilateral agreements where not in order to protect it from foreign interference. 

The investment in research pays off, and new ways of using spectrum more efficiently allow for wider investment across less populated areas, allowing people living in these communities to finally participate fully in the new economy. Virtual reality becomes an indispensable tool in education and work, with people able to sustain their local social connections and lifestyles while connecting to urban workplaces hundreds of miles away. 


What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[Retire, satisfied with your impact on the industry-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="124" name="universities and industry should create partnerships" tags="" position="1485,2089" size="100,100">You insist that supply will follow demand, and so universities and industry should partner to develop the training required. This is a rather slow process, however, and other countries have invested heavily in training in this sector; growing numbers of international trained developers become highly sought after, and these become a new class of highly mobile and wealthy individuals. 

VR adoption in industry and society in the UK lags, however, as tough immigration laws, inflexible tax regimes for foreign workers, and an inadequate talent pool prevail. The UK becomes a VR customer rather than a VR producer and suffers significant virtual brain drain as creatives and programmers take up employment with overseas companies.

You [[retire quietly and without a leaving do-&gt;InstigaCapital Insurance Ltd.]].</tw-passagedata><tw-passagedata pid="125" name="investment in coding is made at all levels of education" tags="" position="1574,2209" size="100,100">Investment is made at all levels of education, with coding being added to the National Curriculum as early as primary school, and interdisciplinary digital humanities approaches adopted at secondary level. Additional funding is made available to universities to develop and expand programmes that support the VR industry. Year-in-industry courses, with an internship stipend shared between government and business, become very popular. Many students arrive in this year with the technical skills that are needed for these roles and gain valuable on-the-job experience. 

However, the sector continues to be dominated by approaches from computer science and video game design, and companies struggle to find personnel with the broader creative and managerial skill sets needed for roles at all levels. Exceptional ‘unicorns’ who seem to intuitively possess these skills become highly sought-after, although there is much disruption in the industry because these people are highly mobile and rarely stay in one position more than two years at a time. 

What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]].
* [[Retire with a sense that you probably could have made better choices, but at least there is still a VR industry-&gt;InstigaCapital Insurance Ltd.]].</tw-passagedata><tw-passagedata pid="126" name="integrated arts, science and technology teaching" tags="" position="1655,2328" size="100,100">Immediate investment is made at all levels of education, with coding being added to the National Curriculum as early as primary school, and interdisciplinary digital humanities approaches adopted at secondary level. Meanwhile, the government recognises evidence from the creative industries sector that the arts are an essential element of the skillbase required for VR and other industries. Art, dance, design and music programmes are well-supported throughout all education levels; the government makes an arts subject compulsory at GCSE and A-level; additionally, arts classes start to incorporate subject matter from sciences and maths. 

Students consequently begin their university studies with well-integrated technical and creative backgrounds, and universities expand programmes that support the VR sector in a variety of disciplines. These programmes develop both technical and creative skills, and new entrants to the market are quickly finding employment in a variety of industries. 

Meanwhile, investments in professional training for those already in the industry, or in parallel industries like film, television and video game design are made. Incentives are set up to match industrial contributions to provide funded places for programmes in game engine skills, including coding and workflow processes. Within a decade, the UK has leapt ahead of the international curve and becomes a world leader in the VR industry in a wide and growing range of use cases.


What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]].
* [[Retire comfortable in the knowledge that there will be a thriving industry for your grandchildren to take part in-&gt;InstigaCapital Insurance Ltd.]].</tw-passagedata><tw-passagedata pid="127" name="Skyefunding" tags="" position="1800,2074" size="100,100">(set: $visitedSkyePolicy to true)
You arrive at the 40th floor office of ALLSEEING. The receptionist is a suited man with sleekly-coiffed hair, and he ushers you into a white, sterile office. There is a single swivel stool and a VR headset dangling from a wire from the ceiling; the receptionist invites you to don the headset, then leaves the room and closes the door behind him. Once in virtual reality, you find yourself in a vast, black space, with images hovering like virtual screens all around you. 

A soothing, alto female voice introduces herself as Skye and welcomes you to the space, and in a type of voice-over, introduces you to the future modelling space. She asks about the specific advice you seek, and you tell her that you are wondering whether a laissez-faire approach to development funding in the VR sector is adequate, or whether the industry needs direct investment or perhaps even instruments such as R&amp;D tax credits. 

There is a dull silence, followed by a sort of cosmic muzak version of &#39;The Hustle&#39;, and you are wondering whether there has been a glitch in the programme. After about three minutes, three virtual screens proceed out of the depths of the space and arrange themselves in front of you. The voice-over explains: The screens show the contribution to GDP and growth in national share of the global industry projected by each of these scenarios. You realise you have seen all these projections and reports before, but now each of the virtual screens in turn becomes an interactive histograms and line graphs. 

What is your reaction? 
* [[Impressed]]
* [[Unimpressed]]
</tw-passagedata><tw-passagedata pid="128" name="Commonsense" tags="" position="2013,2071" size="100,100">(set: $visitedSkyePolicy to false)
You return to the pile of proposals prepared by your staff. You realise you have several options. Which do you choose? 
0. [[ambitious direct investment]] by the government into the sector; 
0. [[laissez-faire]] - the demand will naturally lead to the development the market needs; or 
0. [[modest direct investment plus an R&amp;D tax credit]] for innovation in the sector?</tw-passagedata><tw-passagedata pid="129" name="Impressed" tags="" position="1755,2211" size="100,100">You are impressed. You explore the models and choose the one that offers the most attractive return on investment. Skye suggests that you retain her services contractually in order to continue to provide you with models to guide policy decisions. You direct her to the government’s procurement policy and say you will consider her tender. 

Meanwhile, which of the following models have you chosen? 

0. [[ambitious direct investment]] by the government into the sector; 
0. [[laissez-faire]] - the demand will naturally lead to the development the market needs; or 
0. [[modest direct investment plus an R&amp;D tax credit]] for innovation in the sector?</tw-passagedata><tw-passagedata pid="130" name="Unimpressed" tags="" position="1882,2209" size="100,100">You are unimpressed - this is all meaningless bells and whistles. You take off the VR headset and leave the room, only to find the receptionist at his desk with a VR headset on, speaking the voiceover words that you had just been hearing, which were clearly voice-modified. 

You tell him to send the invoice for one hour, but that you won’t be engaging ALLSEEING’s services further. You [[return to your office-&gt;funding incentives]].</tw-passagedata><tw-passagedata pid="131" name="ambitious direct investment" tags="" position="1650,2546" size="100,100">Your recommendations are adopted, and the government makes a multimillion pound-per-year fund available through startup loans, matching investments raised through venture capital, angel investors and crowdfunding. Several VR companies emerge as industry leaders, and this causes a consolidation of technologies as smaller competitors are edged out of the market. 

One of the VR tech platforms becomes a multinational firm that has a near-ubiquitous hold on the market, with its technology used in a wide range of applications. When it is revealed that a foreign nation’s intelligence agencies have infiltrated this company, deploying its operatives throughout the range of industries using it, alarm bells ring. 

Your retirement is hastened by the discovery that the funding programme you recommended matched funds of a foreign government investment via a shell company. You [[move to the Shetland Islands, leaving your VR headset behind-&gt;InstigaCapital Insurance Ltd.]].</tw-passagedata><tw-passagedata pid="132" name="laissez-faire" tags="" position="1764,2547" size="100,100">As a result of a laissez-faire approach to funding in the industry, firms with substantial capital and known use-cases lead development. Educational, cultural and artistic use cases for VR never find traction, as the prevailing use cases do not encourage home use of headsets. 

There is never a real consolidation around industry standards, as industrial use cases encourage proprietary rather than open approaches to development. The more VR is incorporated into daily work and remote work, the less it becomes associated with use for personal or social reasons - people simply want to escape virtual reality at the end of the work day and immerse themselves in the real world. 

There is a massive upsurge in handicrafts, animal husbandry, hiking and home baking.

What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[If you can&#39;t beat &#39;em, join &#39;em. In your retirement, you take up macrame and build a small pond in your garden for your flock of Cayuga ducks-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="133" name="modest direct investment plus an R&amp;D tax credit" tags="" position="1879,2547" size="100,100">Your recommendations lead to the development of a funding programme that provides loans and grants to start-ups, with a proportion of scale-up R&amp;D funding and tax credits for SMEs. As a result, many companies with a wide range of use cases are established across the industrial, consumer and cultural sectors. The UK becomes a sought-after base for start-ups, attracting international talent and fostering strong international partnerships. 

(if: $visitedSkyePolicy)[The week before your retirement, you are approached by a journalist reporting on a strange story of the mysterious disappearance of a little-known but influential futurist, Skye, from the company ALLSEEING. The journalist has discovered that your department once engaged the company’s services. You minimise the role that this engagement had in any of your recommendations. 

In the weeks following your retirement, it emerges that Skye never really existed, and that her disappearance is due to the fact that the very ‘receptionist’ you once met, who voiced her persona, has died of poisoning resulting from the overuse of an off-label, non-approved scalp treatment.

What is your next move?

[[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
[[Retire with satisfaction after a fulfilling career, but thankful you&#39;ve dodged a last-minute bullet-&gt;InstigaCapital Insurance Ltd.]]]\
(else:)[What is your next move?

[[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
[[Retire with satisfaction after a fulfilling career-&gt;InstigaCapital Insurance Ltd.]]]

</tw-passagedata><tw-passagedata pid="134" name="institutional subscription only" tags="" position="2215,2045" size="100,100">The initial offering to consumers at first garners a small income stream for the museums and investors involved in the programme, not quite covering the costs of its development. This slows the next stage of development and the release of additional exhibit packs. The app has a relatively niche but dedicated following, who are highly anticipating the release of new exhibit packs. 

With the release of a collection of virtual medieval weapons, there is a surge of interest from people interested in fiction and historical fiction set in medieval contexts. Theatre companies, film studios, video game companies and live-action role playing/fantasy gaming societies clamour for access to the assets within the app. The museum consortium presents this to you in its annual report, as some members feel it is a valid means of capitalising on the investment and extending the influence of the app, and others feeling this is a cheap monetisation tactic that may proliferate inappropriate uses and interpretations of the virtual artefacts, without the careful curation of museum professionals. 

Do you recommend: 
0. [[Monetising the assets of the museum]] so that people can interact with them in creative ways and revenues can fund further digitisation? or 
0. [[Resisting such monetisation]] and instead trying to find ways to gamify your app in a way that will attract these communities to it?</tw-passagedata><tw-passagedata pid="135" name="freely available downloads" tags="" position="2149,1925" size="100,100">The recommendation to curate the museum consortium’s collections virtually via other museums is followed, with the rationale that the entire world is clamouring for access to collections held in the UK. Once the work is complete and the experience is released to the sector, there is some initial uptake from large, better-funded museums who can afford the subscription, the equipment, and the staff support required. 

Initial visitor responses are positive, and subscription fees help the UK project to continue its scanning and expand to other institutions. However, resistance starts to emerge from around the world with the accusation that this virtualisation of the spoils of colonisation merely perpetuates what is essentially theft of cultural property into a new virtual era. The virtualisation of collections becomes a rationale for some movements to call for the return of cultural artefacts to the nations or regions of origin, for other movements to demand the democratisation of collections by giving free virtual access to all of the nation’s collections, and for yet others to demand all proceeds of the programme be invested in national museum programmes around the world. 

A rogue movement called ‘NAC’ (No Appropriation of Culture) acquires newly-developed mobile volumetric capture equipment and deploys activists to museums around the world to scan key pieces on exhibit and make them freely available. The programme gets caught up in international court cases and controversy, and museums let their subscriptions lapse so as not to have their reputations tarnished by association. There is an attempt to redesign the funding model, but it’s too little too late; the programme fades into oblivion.

Your department is disbanded, and you are forced into [[early retirement-&gt;InstigaCapital Insurance Ltd.]].
</tw-passagedata><tw-passagedata pid="136" name="a yearly virtual individual, family or institutional membership" tags="" position="2329,2101" size="100,100">The museums consortium adopts a membership model, featuring gamified applications for consumer subscriptions (individual or family), but collaborates with ed tech company VR4Ed and a number of university education departments to develop enhanced pedagogical materials for institutional subscription. The packages are accessibly priced, so that even modestly-funded institutions can afford to purchase the core exhibition packs. 

This collaboration spins off to a new venture, having applied for and received lottery funding to further develop its offerings. Working with anthropologists, archaeologists, linguists, cultural theorists, learning theorists, and teaching practitioners, the app has multiple applications and entry points, is interactive and personalisable, and is well-supported at every stage by research. 

With the development of mobile scanning equipment, the spinoff company opens up the app to the public, allowing them to scan and contribute their own artefacts to the museum. This initiates a Virtual Time Capsule project, organising contributions by decade, and becomes a truly interactive resource with wide popular and academic appeal.


What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[It&#39;s time to retire; your leaving do is an affair you will remember fondly the rest of your days, with tributes from curators, academics and officials from the museums sector-&gt;InstigaCapital Insurance Ltd.]].</tw-passagedata><tw-passagedata pid="137" name="Monetising the assets of the museum" tags="" position="2175,2188" size="100,100">The museum consortium negotiates deals with various parties to provide virtual assets to them, which becomes the most profitable side of the business, funding the further digitisation of collections and their dissemination. This does not approach the levels of economic contribution that the heritage sector once offered via tourism, but becomes an active, creative and somewhat moderately lucrative revenue stream. 

The consortium develops this programme to ensure provided assets are sold with documentation about cultural context, but interestingly one result is that communities begin to feed back cultural interpretations and histories of these artefacts, revealing previously undocumented oral histories and alternate understandings. 

For film studio costumers and prop designers, these VR collections become invaluable assets for research, and rights to use digitised artefacts in computer generated imagery in filming becomes another lucrative revenue stream for the museums consortium. Some filmmakers are less concerned about authenticity in the use of the digitised collection, which leads to general consternation amongst the museums consortium, but others use the collection to pursue historically-accurate depictions that receive popular and critical acclaim.

What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[Retirement. You spend your senior years watching out for assets from the museums collections in your favourite films.-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="138" name="Resisting such monetisation" tags="" position="2285,2225" size="100,100">Rather than making the virtual assets available, new proprietary gamified apps are developed that use the digitised assets. Most of these remain somewhat niche, but the live-action/fantasy gaming sector app is a hit. The museums consortium spins this app off to a standalone company, and eventually it becomes a means by which most people recognise the names of the museums in the consortium. The museum draws a steady stream of committed enthusiasts who use their limited opportunities for tourism to ensure they see the artefacts they know from VR in real life.

What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[Retirement. You spend your senior years visiting your favourite museums virtually as they release new items in the collection.-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="139" name="Skye, co-founder of ALLSEEING" tags="" position="2445,1905" size="100,100">Skye agrees to take up the post. In the first three years of QuIDITH’s oversight, there is a proliferation of certified virtual health applications. The most pervasive of these is a VR Consultation app, which allows people to attend virtual surgeries run by private sector GPs in order to obtain medical health checks and diagnoses. In virtual reality, the clinician guides the patient through self-examination steps through a combination of demonstration and video uploads, and virtual interviews are found to be nearly as effective as face-to-face interviews. People are happy to avoid long waiting times for appointments and hours spent in waiting rooms with possibly contagious patients. 

Skye approves an application for the VR Consultation company to form a partnership with a private diagnostic company that uses AI to scan medical records for common patterns. She approves another partnership with a VR expansion microscopy company that will permit vastly improved diagnostic and therapeutic procedures. Patients start to be prescribed diagnostic tests and referred to private providers for elective preventative procedures. The NHS, under continued financial strain, looks to access this data in order to better assess risk factors. It begins to prescribe various self-management tools such as smoking cessation, weight management, and diabetes counselling, all of which are delivered through VR. 

These tools are very successful, leading the NHS to delist certain procedures for conditions that are subsequently deemed to be preventable. Patients who are not deemed successful in the VR health apps are seen as non-compliant, and become ineligible for certain procedures via the NHS. They turn to private providers for treatment, but private insurers, who also have access to their digital medical records, also won’t cover some of these procedures; consequently, people have to pay out of pocket. These people suffer a considerable amount of stigma as a result, and although some turn to crowd-funding measures to try to find funds for medical treatment, people are reluctant to contribute, deeming them either lazy, self-destructive or technophobic. 

The sector is shaken when Skye dies from a horrific laser malfunction during an elective eye surgery procedure, but the investigation shows that the clinician had knowledge of her personal financial connections with several of the companies approved under her scheme, and her manipulation of her colleagues and direct reports. Furthermore, he is shown to be the brother of a woman who was denied life-saving surgery because she had been listed non-compliant, establishing motive. The case is ruled as murder, and the clinician is sentenced to life in prison. However, as the extent of Skye’s private gain from the sale of personal data becomes known, a general public sentiment builds that this vigilante justice was justified.

You realise you need to make yourself scarce before your connection to Skye is discovered. You [[catch a red-eye flight to Rio de Janeiro and cut off all contact with your colleagues, friends and family back home-&gt;InstigaCapital Insurance Ltd.]].</tw-passagedata><tw-passagedata pid="140" name="Kai Northcliffe" tags="" position="2595,1905" size="100,100">With Kai at its head, QuIDITH approves several therapeutic functions of VR, and it initially finds widespread usage in some fairly niche areas, especially treatment of post-traumatic stress disorder and phobias. Kai is keen to advance VR apps for personal health management, and solicits proposals from several such companies. A variety of VR self-management tools are approved for smoking cessation, weight management, and diabetes counselling, among others. These are well-received and the NHS and several private healthcare provisioning companies add these to the suite of treatments available. They are freely provided to people who have the equipment, but those who do not have headsets cannot access them, so the rollout does not benefit the entire population. Moreover, these treatments are not suitable for all patients, but they do provide one possible response in a suite of responses to particular health conditions.

Kai is promoting partnerships between private pharmaceutical and diagnostic companies and VR health app companies, but the National Health Executive issues a strong warning about the sharing of data from such programmes, thus blocking these private partnerships. However, anonymised banks of VR and diagnostic data are made available for public research. This provides the biggest advantage for the sector through opportunities for training and professional development. NHS authorities are soon able to share resources for upskilling existing staff through VR training, and medical training programmes are enhanced by VR simulation. 

There are even benefits in the operating theatre: surgeons are able to improve outcomes of complex procedures by pre-visualising and rehearsing surgeries, but this is time-consuming; the efficiencies anticipated by adoption of VR aren’t fully realised. However, analysis of data from VR-facilitated surgeries provides a better evidence base for new procedures, leading to better outcomes for surgical procedures for some specific health conditions.


What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[Call it a day; you&#39;ve done your best to support a nascent industry and are satisfied with how far it&#39;s come-&gt;InstigaCapital Insurance Ltd.]]
</tw-passagedata><tw-passagedata pid="141" name="Amira Mahabir" tags="" position="2745,1905" size="100,100">Amira is delighted to take up this post. She provides strong leadership in assessing the social and cultural dimensions of virtual healthcare, and subsequently declines several applications for certification for VR applications that do not take accessibility of equipment and cultural understandings of health and illness into account. Some of these go on to develop privately, but without certification they do not become part of a range of healthcare provision; some are subsequently prosecuted for negligence and forced to cease operations in the UK. Others, however, go on to address these weaknesses and develop models that include community access to equipment and incorporate a wider range of descriptors for symptoms and physical experience in their programmes. 

Consequently, there is an expansion in primary VR care, particularly for isolated individuals, and a new role for VR care workers is created. These people go to the homes of elderly or unwell people, assisting them in attending VR consultations with specialists. As the benefits of social VR are realised, doctors and therapists begin to prescribe professionally facilitated social VR for support groups, fostering a new sense of community among people living with particular health conditions. 

In isolated communities, adequate spectrum and wifi provision is ensured so that these communities can benefit from VR primary care. VR surgeries allow local surgeons to facilitate specialist surgical procedures, assisted by highly qualified specialists through VR. Some out of hours services are facilitated by AI, referring virtual patients to a team of doctors to provide remote out of hours service, reducing demand on local A&amp;Es. Much of this technology has actually required significant investment; VR has not wrought a feat of efficiency in the sector, but it has improved the quality and accessibility of healthcare, helping to reduce waiting times by providing better points of access to the existing system and reducing the need to travel long distances. 

UK healthcare becomes a sought-after model that is emulated by other countries around the world.

You approach your retirement with satisfaction that Amira was the right appointment, all those years ago. When she receives a Nobel prize in medicine for her leadership of VR healthcare, she doesn&#39;t mention you in her acceptance speech. [[Nonetheless, you remember your role and feel a quiet satisfaction with your choices.-&gt;InstigaCapital Insurance Ltd.]]
</tw-passagedata><tw-passagedata pid="142" name="recommend the sale go forward" tags="" position="777,2080" size="100,100">The sale goes ahead, and despite anonymisation, within a year the agency finds a highly efficient way to match students to their data by developing a psychometric test that they tour to campus career fairs. This enables them to recruit specific students to particular roles, as early as their second year of education. 

Students embrace this streaming as it becomes seen as a guaranteed job. Online-only VR training becomes the most sought-out model of education for students, and they readily consent to providing their full set of personal data via the learning software to the recruitment agency. 

Several universities also openly embrace this model because it improves their Longitudinal Educational Outcome metrics, their reputation and their funding opportunities. These universities radically reduce their infrastructure as staff and faculty members work from home, and smaller universities start to fold under the decline of traditional education. 

The remaining insitutions compete for the most popular VR instructors (and their pets), and eventually VR4Ed gains a monopoly among universities. These eventually start to work together to realise the efficiencies of technological delivery, hiring star instructors for the front-facing VR work, and relegating other instructors to marking and administration. 

Eventually there is a single national university provider with an online-only virtual reality programme designed for every undergraduate degree course. Students without desirable attributes for the changing market are filtered out after their first year results, and are redirected into non-professional work, which ultimately breeds widescale inequality and discord. Several fine arts and humanities courses are deemed ‘low value’ and their funding disappears; it is no longer possible to study them at university.

What is your next move?
* [[Go back in time and look at one of the other issues noted by your team-&gt;Policy maker]]
* [[Retirement. You spend your golden years running painting clubs for young people, trying to ensure that the pursuit of fine arts excellence is not forever lost-&gt;InstigaCapital Insurance Ltd.]].</tw-passagedata><tw-passagedata pid="143" name="recommend that the sale be delayed" tags="" position="674,2184" size="100,100">The investigation delays matters, and it is ruled that GDPR legislation prohibits the sale, although new British legislation would have provided a loophole. Nonetheless, the deal is scuppered. 

As their hold on the HE market slips, VR4Ed enters discussions with military training academies on the basis of the successful trial of their product at universities. The military finds the simulation training particularly effective for practicing drone strikes and hand-to-hand combat. VR control of on-the-ground robot troops is launched to keep order when looting commences during a flareup of the pandemic. Within three years, all UK military personnel are based in a warehouse in Milton Keynes, from which they conduct UK foreign intervention in conflict zones and at UK border checkpoints. 

The programme is deemed extremely successful initially as military casualties become a thing of the past; however, when a refugee camp at Calais stages an uprising against the robot troops, the military personnel move quickly to a show of force that results in 97 deaths. There are calls for an inquiry and suspicions that VR simulation has facilitated the dehumanisation of the refugees that led the military personnel in Milton Keynes, physically and psychologically removed from the site of conflict, to exercise undue force. However, the programme is deemed too effective to roll back. Moreover, the UK is not alone in these developments. Soon VR robot troops are an everyday sight on the streets around the world, and citizens live in fear of getting caught in robot crossfire.

You are horrified that decisions you made have ultimately facilitated this state of affairs. [[You retire in despair and seldom leave the house.-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="144" name="multi-brand deal" tags="" position="2329,986" size="100,100">The opportunity for a multibrand deal is just too enticing and you get a whole bunch of brands involved, one for each activity. These are not necessarily linked to the &#39;wellness&#39; theme of the app and range wildly from fast food companies to sports car manufacturers and sports brands. 

As a result the experience is riddled with incoherent and glaringly obvious product placement, which Brud isn&#39;t keen on. But as the money starts to come in from the deals, his attitude softens. From the sponsor perspective, their corporate image starts to improve immediately as they are perceived to be working for the greater good of employees everywhere. 

The deals enable Brud to develop the prototype into a full trial version and companies start lining up to take advantage of it -- including many of the initial sponsors. Many use it to justify their use of precarious contracts and list it as a key employee benefit. Employees seem happy enough with the app but it doesn’t seem to affect the amount of time taken off for sick leave, nor does it reduce the amount of leave taken for mental health related reasons. Given that this was the main appeal of the app for them, take up of the full version is limited.

Brands start dropping their support left, right and centre, leaving you with a very unhappy Brud and an even unhappier manager. On the upside, the entire experience prompts some of the participating companies to start to [[look closer at other reasons for high levels of sick leave and mental ill-health in their workplaces.-&gt;InstigaCapital Insurance Ltd.]]





</tw-passagedata><tw-passagedata pid="145" name="Risky Business Corp." tags="" position="2327,873" size="100,100">Risky Business Corp. is a multinational auditing firm with over 500,000 employees worldwide. Tirelessly dedicated to the wellbeing of their workforce, they love the sound of the app. Their sick pay bills are increasing as absence from work due to mental health issues is on the rise within the company.

The prospect of saving sick pay costs is very appealing and the app is incredibly efficient as it combines Risky Business&#39; entire Wellness at Work programme into one piece of software. Haptic feedback sensors are also infinitely cheaper than hiring real therapy dogs.  

They immediately offer to plaster their branding all over it, as along as it remains exclusive to them. This, however, is not appealing to Brud. He belives strongly in the potential of his app to improve the welfare of the global workforce, not just Risky&#39;s. He also thinks multiple sponsorships will be more lucrative. What do you do?

* Convince Brud that [[Risky is the way to go]]. If they like it enough they might even buy it off him (six figure sums, minimum) and continue to develop in-house.
* The client is always right. So start scoping a [[multi-brand deal]].</tw-passagedata><tw-passagedata pid="146" name="charities" tags="" position="2326,749" size="100,100">With the involvement of charities, the sponsorship deals are not as high value as the alternative options might have provided. But you appeal to Brud&#39;s more philanthropic side and suggest this is an opportunity to incorporate the mental health organisation&#39;s research to make the app a truly effective tool for employee wellbeing. 

This connects with Brud&#39;s true aspirations for the app and he readily accepts the lower income as a compromise in order to maintain the integrity of the original idea. Companies start lining up to purchase trial versions of the app for their workforces and the involvement of the charities improves their reputations for corporate responsiblity.

As data from the trials starts to come in it seems that the app does indeed increase productivity, but also seems to drive down absences due to stress. At this stage, user data has remained with the charities who are using it to produce reports for companies involved in the trials. But now ownership of that data becomes a serious issue for progress to the full version. Corporates want full access but the charities advise that this puts potentially vulnerable users in an even more vulnerable situation. Charities say they will only share data with employers if users explicitly agree to do so, but this is not enough for some of the larger firms attached to the project. Each threatens to pull their support for the app if their demands are not met.

Brud is torn and comes to ask for your advice. Do you:
* Tell him to [[give the data to the corporates]] - their support is financially more valuable.
* Tell him that the responsible choice is to [[keep the data with the charities.]] </tw-passagedata><tw-passagedata pid="147" name="Risky is the way to go" tags="" position="2472,876" size="100,100">As predicted, Risky sense Brud&#39;s hesitancy over the exclusivity clause and offer to buy Brud&#39;s app outright and take it in-house. Brud less than reluctantly takes the cash. Risky owns the app and all data collected within it.

Some efficiencies become clear immediately -- they no longer need the lunchtime yoga instructors, the arts and crafts tutors or the real therapy dogs. This is great but those industries start to suffer and jobs are lost. Risky&#39;s corporate image, however, improves immediately and you are lauded for your efforts.

The only problem for Risky is that their in-house team lack the high levels of development expertise that Brud&#39;s team could have provided. Employees seem happy enough with the app but it doesn’t seem to affect the amount of leave taken for mental health related reasons and the long-term impact on public image therefore seems negligible.  

Risky decides this is because not everyone is using it, or at least they&#39;re not using it enough. They make it contractual for all employees to spend at least 30 minutes of each working day in the VR experiences. In-house teams track the data to ensure people are using the app according to their contractual obligations. When they don’t, this is flagged with them in order to provide further support, but ultimately this data is kept to be used against those who seek to sue for unfair dismissal etc.

What was a PR success turns into a nightmare as the press starts to get hold of this information. As the originator of the sponsorship relationship it doesn&#39;t look great for you. But Risky&#39;s choice to buy up the app means it&#39;s a concern for their legal team now, not yours, and you manage to distance your own company from it enough to [[weather the media storm for now.-&gt;InstigaCapital Insurance Ltd.]]

 
</tw-passagedata><tw-passagedata pid="148" name="give the data to the corporates" tags="" position="2461,653" size="100,100">The participating companies are delighted but the charitable organisations want nothing more to do with you and pull their support and their research immediately. This is turn makes some of the companies rethink their own involvement - the charity link was part of the corporate responsibility angle and without it this is significantly weaker.

The companies who do stay on to see the full app develop see some efficiencies become clear immediately -- they no longer need the lunchtime yoga instructors, the arts and crafts tutors or the real therapy dogs. This is great but those industries start to suffer and jobs are lost. The numbers of redundancies, however, are small and easily lost in the news cycle. 

Several of these companies decide that for optimum efficiency to be achieved they need to make it contractual for employees to spend a minimum of 20 minutes of each working day in the app. They list this as part of their employee benefits schemes and start to use it to justify their use of precarious contracts. 

Moreover, the data is used to ensure people are using the app according to their contractual obligations. When they don’t, this is flagged with them regardless of whether they appear to be at risk of burnout or high levels of work related stress. This has the counterintuitive effect of creating more stress as employees panic when they forget to spend the alloted time in the app. Ultimately this data is kept to be used against those who seek to sue for unfair dismissal. 

By this point, however, the app has developed beyond a piece of promotion and has taken on a life of its own. Brud sees the app as an incredible success and retains the services of the company for the foreseeable future. He&#39;s now a pretty big deal, so you are commended for keeping his business. You are somewhat disappointed in the app&#39;s final applications though, and when Breakthrough announces it will be launching it across all its offices you think perhaps [[it might be time to take that early retirement package you were offered... -&gt;InstigaCapital Insurance Ltd.]] 
</tw-passagedata><tw-passagedata pid="149" name="keep the data with the charities." tags="" position="2584,782" size="100,100">As companies drop out of the trials, the reach of the app starts to dwindle and neither Brud nor the charities are particularly pleased about it.

However, some users do agree to share data with their employer, and some are able to identify staff who are at a high risk of burnout. Where interventions occur they are generally successful and staff retention starts to improve. 

The charities also manage to push back on requests from the remaining companies to make using the app a contractual obligation. Their reports indicate that high usage of the app is directly linked to insecure employment status. They urge companies to reconsider their use of precarious employment contracts as a more direct way of managing mental ill-health within their workforces. 

Positive word of mouth spreads fast. Pretty soon people are lobbying their firms to include it in their benefits package and you realise that [[you have become a key part of a small but significant revolution in workers&#39; rights.-&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="150" name="Trial it first" tags="" position="1396,387" size="100,100">The students come to what is essentially a marketing focus group, and have varied experiences to feed back. 

Some view it with scepticism as a gimmick. Are they really being asked to empathise with a polar bear? Is that even possible? Others, however, have a strong emotional reaction. A few students remove the headset before the end of the film and a couple finish the film with tears in their eyes. Some of them even say they could feel the ice melting beneath their feet as they watched the film. The emotional impact sparks some fairly high level discussion between them, which teachers are pleased with. They intend to run a follow-up quiz on the curriculum content to see if it has helped them retain the information successfully.   

When asked how they now feel about Investiture, the overall response tips slightly towards the positive end of the spectrum. One or two, however, start to question the emotionally manipulative nature of the VR film and are a little resistant to the final message. Some have some more probing questions about the relative impact of Investiture&#39;s actions and the rest of their investments and environmental policies. But all agree that the experience was both moving and memorable, which ticks off two key aims for the client: emotional engagement and brand information retention. 

Investiture takes this to be a win over young hearts and minds and argues strongly for a wider rollout of the video across schools via [[social media platforms]]. The filmmakers are reluctant - they want to run it around the upcoming [[creative VR festival circuits]] instead.

Your preference is for a more localised, supervised rollout across schools, [[avoiding the social media platforms]] where the conversation around the content is harder to control. You want to keep the client happy but you would also quite like to work with the creative team again in the future, so you need to keep them on side. Which option do you select?</tw-passagedata><tw-passagedata pid="151" name="a self-enclosed virtual world for engaged learning" tags="" position="481,687" size="100,100">An education provider has contacted you. They have partnered with Avery, the current &#39;it&#39; teen celebrity influencer to create a synergised, self-enclosed virtual world for engaged learning. It has already received interest from schools nationwide. Avery is very keen to work with you every step of the way to ensure the world is very ‘her’: how much control do you let her have? 

[[She seems innocent enough, let her go crazy]]

[[Let her have her say, but you’re in charge here]]

[[What could this teenager know? She is a publicity pawn and has no say]]</tw-passagedata><tw-passagedata pid="152" name="an interview training experience for university students" tags="" position="616,780" size="100,100">You receive a commission from an agent who represents a mysterious backer. They want you to design a VR programme for university students to help prepare them for the job market and hone their interview techniques. It is likely to be rolled out to universities internationally and will lead to various opportunities for more training experiences. 

You are hesitant; when you chose this career you envisioned more glamorous work, but this is lucrative, and you can still work on your own projects on the side. You decide to go for it. The first decision you need to make is whether the users can choose their avatar and that of the employer. Do you decide on:

[[No choice, this is a training video, not a game]]

[[Some choice, the ability for the user to customise both their avatar and that of the employer]] 

[[Full choice, the ability for the user to customise their avatar and an AI employer which will respond to the users’ natural social signals.]] </tw-passagedata><tw-passagedata pid="153" name="tourism inspired experiences" tags="" position="738,777" size="100,100">You are approached by three different clients and need to choose which project to accept. 

[[One is a tour company which wants to capitalise on the popularity of dark tourism by creating VR experiences.]] 

[[The second is a top care home provider which wants to create personalised VR experiences for dementia patients.]]

[[The third is an NGO which wants to set off an empathy revolution through ‘identity tourism’ in VR.]]

Which do you choose?</tw-passagedata><tw-passagedata pid="154" name="a wellness experience" tags="" position="982,778" size="100,100">Although your background is in gaming, a wellness brand contacts you because they want to create VR experiences which encourage healthy and/or positive thinking behaviours. Their research indicates this could focus on any of three areas: 

[[a sleep aid]] 

[[a phobia treatment]] 

or [[an escapist, relaxing spa]]</tw-passagedata><tw-passagedata pid="155" name="an action-adventure game " tags="" position="864,775" size="100,100">You are in the first stages of designing an action-adventure VR game which is loosely based on the TV show Westworld. Players will enter a Garden of Eden of their choice populated by androids and can indulge their wildest fantasies. In designing this fictional world you need to make some choices in terms of regulating the parameters of these fantasies, particularly in consideration of age ratings.  

You have come up with three different names for the game reflecting different levels of social responsibility. Which do you choose?

[[Forbidden Desires]]

[[Fantasy and Responsibility]] 

[[Escape to Eden]]</tw-passagedata><tw-passagedata pid="156" name="BookofVisages is the most lucrative offer: they have offered you $500 million but will require you to make changes in order to further monetise the game." tags="" position="371,958" size="100,100">BookofVisages -– Due to the funds available, a full body [[haptic*]] VR suit is designed specifically for the game. You work with a team to design an algorithm which quantifies the choices players make in //Forbidden Desires//, the more popular the choice -- the more expensive it is. While there are some variations over time, the most expensive options feature highly graphic content. The game is a huge success for BookofVisages, allowing them to finally release their global cryptocurrency Pisces. 

As the game continues to be a top seller, psychologists start to sound alarm bells. It seems that the scenarios brought to life in the game encourage narcissism, Machiavellianism and psychopathy, particularly now that the player is no longer just pushing a button and watching the results on a screen but is fully embodied through the use of the haptics. 

As you see the consequences of your creation develop you have a choice to make: 

[[Stay quiet, resign and go and live off of your winnings -- you are now a millionaire.]] 

[[Become a whistleblower and work towards increased regulation in the sector.]]</tw-passagedata><tw-passagedata pid="157" name="You prefer to keep working independently and monetise the game through advertising; alcohol, firearm and car companies have already shown interest." tags="" position="486,956" size="100,100">You decide to stay in control of //Forbidden Desires//. You hire an agent to liaise with advertisers, he proposes two options:

[[The use of traditional brand placements from various companies.]]

[[A co-branding strategy whereby one brand will have ownership over the Garden of Eden.]]</tw-passagedata><tw-passagedata pid="158" name="A co-branding strategy whereby one brand will have ownership over the Garden of Eden." tags="" position="486,1107" size="100,100">After fierce competition, one of the big energy brands buys the sole advertising rights for //Forbidden Desires//. In a world where the effects of climate change are increasingly visible, this virtual world provides all the necessary ingredients for green-washing. [[The Garden of Eden is renamed the Garden of CP and players are now immersed into a branded world which continues to allow them to indulge their darkest desires. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="159" name="social media platforms" tags="" position="1438,543" size="100,100">The trials have allowed you to adjust some of the content to avoid VR sickness, and gave weight to your arguments for adding some content warnings and guidelines for exhibition in schools. The social media platforms organise a launch date and the film appears prominently in VR newsfeeds everywhere. This provides huge levels of visibility for the filmmakers and for Investiture. But you quickly lose control of the conversation.

Students keep posting their reaction videos online and the more extreme responses are getting the most views. Accusations of greenwashing are coming in thick and fast as citizen journalists are quick to discover that although Investiture has indeed &#39;committed&#39; in recent documents to taking on more eco-friendly funds, it has no intention of reducing its existing investments in fossil fuel and plastic packaging companies. Bloggers condemn the company for using emotionally manipulative content in the name of ‘corporate responsibility’, which is only compounded by the fact that the video was touted as an educational tool for use in schools. The fact that the trial students seem to have retained a lot of the curriculum information very well, and have started a small climate change club after school has been completely overshadowed by the negative press.

Investiture are furious with you, despite the fact that it was their idea in the first place. [[They’re a longstanding, high fee-paying client and you lose them overnight to a competitor.-&gt;InstigaCapital Insurance Ltd.]]


</tw-passagedata><tw-passagedata pid="160" name="creative VR festival circuits" tags="" position="1557,377" size="100,100">Investiture are not happy with the decision to take to the festival circuits. The visibility here is incredibly low compared to the potential audiences for social media and the audiences are likely to be more critically-minded about Investiture&#39;s sponsorship of a piece with such a strong moral stance.

They needn&#39;t have worried. The judging panel at several major festivals view the company&#39;s involvement as simply a means to an end -- a necessary compromise for the filmmakers to enable the project to happen. The film starts being shortlisted for awards and while there are some criticisms of the funding relationship, overall the company benefits from the association with the film.

It&#39;s the awards news that hit the press, and because the festivals are still relatively niche, the critical responses are much easier to control than the social media backlash would have been. The slightly uglier details of Investiture&#39;s actual eco-investment activites (or lack of them) are easier to override once the film has garnered award winning status. 

You briefly hear back from the trial students -- their emotional repsonses haven&#39;t quite translated into a change in behaviour, although some have mentioned that they are recycling a bit more or are trying to lower their carbon footprint. They do, however, seem to recall a lot of the curriculum content, and the school is working with the filmmakers for further educational VR films. 

[[Both the filmmaker and the client are happy with the outcome and renew their contracts with Breakthrough for future collaborations and promotional activity.-&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="161" name="livecast" tags="" position="1271,602" size="100,100">Investiture want the film to have as much impact as possible, so the livecast goes ahead without any testing and without any particular content warnings in place, depsite the emotionally distressing nature of some of the film.

This causes several schools, and huge numbers of individual parents and guardians to refuse to let their child participate at all. Some children independently refuse to engage and the reach that the client had envisaged immediately starts to shrink.

Of those who do watch the film, many are too upset to finish it and remove their headsets in tears. A small number also start to feel dizzy and report sickness. Having not been allowed to preview the content, teachers are ill-prepared to deal with their distress. Some of the students do engage but are confused somewhat by the prospect of &#39;becoming&#39; a polar bear, and the intended sense of empathy doesn&#39;t quite translate. The enraged parents threaten to take you to court for the costs of the ensuing VR therapy that is needed to help their children recover from the experience. Schoolteachers and headteachers are also blamed for allowing it to be viewed at all. 

All of this devolves into some incredibly negative press where Investiture are condemned for using emotionally manipulative VR content in order to prove their corporate responsibility credentials, which are revealed to be merely window dressing anyway. They are an incredibly valuable and longstanding client, but [[decide to take their business elsewhere, despite the fact that the livecast was their idea in the first place.-&gt;InstigaCapital Insurance Ltd.]] 

</tw-passagedata><tw-passagedata pid="162" name="She seems innocent enough, let her go crazy" tags="" position="742,2673" size="100,100">You work with Avery and her team in order to create a virtual world. While activities are designed around the curriculum, Avery puts her own ‘twist’ on every subject. You realise there is great potential to further monetise the experience by partnering with other brands and integrating product placement, do you 

[[approach your client with this idea]]

[[or decide not to?]]</tw-passagedata><tw-passagedata pid="163" name="Let her have her say, but you’re in charge here" tags="" position="879,2672" size="100,100">You take control, Avery focuses on the aesthetics while you coordinate with various educators to make sure the programme is suitable for schools. Their advice suggests that the medium of VR is best suited for either 

[[gamified learning experiences]]

or [[virtual field-trips.]] 

Which do you choose to focus on?</tw-passagedata><tw-passagedata pid="164" name="What could this teenager know? She is a publicity pawn and has no say" tags="" position="1004,2676" size="100,100">You do not liaise with Avery personally and let your client deal with her. She will be useful for packaging and promotions but her input is not needed now. Instead you go and talk to an early-learning specialist who suggests that you focus on one of two markets in which VR would be particularly useful:

[[for children with sensory and attention issues]] 

or [[those that are home-schooled.]] </tw-passagedata><tw-passagedata pid="165" name="approach your client with this idea" tags="" position="742,2823" size="100,100">Your client jumps at the chance to further monetise Avery’s influence -- she is a hot ticket. Avery ‘curates’ which of her favourite brands could be integrated into her world. They are all on board, of course. Meanwhile, you are struggling with the educational experts -- they disagree as to whether 

[[the experience should replicate normal age-based school system i.e. provide different material and experiences for different years]]

or whether [[the focus should be on ability streaming rather than age.]]

Which do you go for?</tw-passagedata><tw-passagedata pid="166" name="or decide not to?" tags="" position="862,2823" size="100,100">You decide not to open that particular can of worms. Instead, you create a fully integrated branded loop so that Avery can sell her own lifestyle brand (and the products she&#39;s &#39;designed&#39; that come with it). 

Meanwhile, Avery is becoming more and more difficult to deal with and is now demanding that the entire experience be based on her life story. She is now calling herself the ‘chief visionary officer’ and the educational material is increasingly taking a back seat. She tells you she has ideas as to how she can empower students by having them try out their entrepreneurial skills by selling some of her lifestyle products. Do you 

[[keep her placid and explore these]]

or [[finally shut her down?]]</tw-passagedata><tw-passagedata pid="167" name="the experience should replicate normal age-based school system i.e. provide different material and experiences for different years" tags="" position="667,2973" size="100,100">The experience replicates the school system, with a different world for each year from pre-school to university. While the mechanics and interface stay the same, the embedded educational resources are in line with the National Curriculum. As schools across the country are competing to provide blended learning and demonstrate that they are using the latest technology, sales go through the roof. Avery (or at least her life-like AI avatar) is personally talking kids through her own take on the subject-matter, bringing the concepts to life through virtual fieldtrips and using 3-D models. 

Within days, teachers are reporting that students love learning with Avery. The partner brands are also thrilled, their sales have gone through the roof. Soon, children everywhere are talking and styling themselves after Avery. You have a good thing going and continue updating the programme for the next 10 years. In that time you see a generation of children grow up with Avery, following her every move – and choice in brands – from their cereals in the morning, to their entertainment choices, to their choice of bedding – all age appropriate of course! [[Unfortunately, not all students can afford these brands and the media blames you personally for the rise of household debt but you’re on a beach in Havana at this point, so you don’t care! -&gt;InstigaCapital Insurance Ltd.]]
</tw-passagedata><tw-passagedata pid="168" name="the focus should be on ability streaming rather than age." tags="" position="814,2973" size="100,100">You create one virtual universe where students can then choose their level for each experience. &#39;Students,&#39; the promotional material proclaims, &#39;will no longer be prisoners to the progress of their peers: if they understand something they can move on to another concept or go deeper in their learning; if they need more time learning, they can do so.&#39; You&#39;ve even designed a space where students who have mastered a concept can fine-tune their understanding and bolster their confidence by teaching it to other students. 

Unfortunately, despite encouraging early signals, it appears that schools are not keen to spend their ever-reducing budgets on a technology that teachers are not familiar with. Your client changes strategy and lends the headsets to schools in wealthier neighbourhoods. Soon enough, students are raving about the experience to their parents and headsets are selling out as parents, desperate for after school education activities to keep the kids occupied, rush to buy them. 

However, it seems no trained educators properly oversaw Avery’s ‘educational’ explanations. Indeed, some of them provide ‘alternative’ facts about evolution, vaccines and climate change as well as a certain psychology of wealth which shows little concern for structural inequalities. You only notice these issues six months after the programme has been launched, and no one else has flagged it. It turns out the parents are not closely supervising their children&#39;s VR activity. Moreover, the brands are happy as they are selling well. [[You leave it be; although this will eventually come out and cause controversy, it’s no longer your problem. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="169" name="keep her placid and explore these" tags="" position="1058,2974" size="100,100">You build into the programme a multi-level marketing plan so students can themselves ‘become’ influencers and enrol others into the lifestyle. The Avery-lifestyle becomes a huge hit, particularly with pre-teens. Soon, those most adept at reselling Avery branded towels, bathrobes, yoga pants and yoghurts are calling themselves ‘EIPs’ – extremely important person. 

Critics warn that the cult of Avery is limiting childrens’ career aspirations but it is only once parents realise how much their children have spent that alarm bells start ringing. One kid managed to land herself and her family in hundreds of thousands worth of debt. Just before Interpol releases an arrest warrant for fraud, Avery goes underground. She hasn’t been seen since. [[You cop the blame and are indicted for being an accessory of fraud. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="170" name="finally shut her down?" tags="" position="936,2973" size="100,100">Luckily, Avery is technologically-inept so she believes you when you tell her you can’t integrate a multi-level marketing plan into the programme. Instead, you focus on creating a virtual world which presents Avery’s carefully curated distillation of her elegant life and her unique manifesto with an educational bent where possible. &#39;I’ve spent the majority of my life in front of the camera,&#39; are the words Avery greets students with as they enter her world, &#39;but not my camera. And that’s where this is different. I could not be more excited to share my story, and this adventure, with you.&#39; 

She is a walking advert for herself, telling the kids about what she eats, what she reads and what exercise she does. In return the children share their addresses, desires and their parents&#39; bank details with her. They spend more and more time &#39;plugged in,&#39; with surprising effects on the economy as they see no other advertisements or branding while in the experience. Homework is ignored, their only interest is Avery’s own-brands, soon they all look like a mini-Avery, expressing a certain blonde, toned, expensive taste. [[Bullying, body disorders and eating disorders become rampant. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="171" name="gamified learning experiences" tags="" position="1261,2854" size="100,100">You decide to make the experience as fun as possible by gamifying the educational content. As this is not your area of expertise you consider whether to 

[[seek help with ALLSEEING, &#39;an agency and a platform for prototyping futures&#39; who have advised on VR education projects before]]

or [[a big games company who have experience in creating massive multiplayer online role-playing games.]] </tw-passagedata><tw-passagedata pid="172" name="virtual field-trips." tags="" position="1384,2860" size="100,100">You decide to make use of VR&#39;s affordance in transporting children to different places. Your budget only allows you to either create virtual

[[geographical ‘field trips’]]

or [[historical ‘field trips’]], both led by Avery. 

Which is it? </tw-passagedata><tw-passagedata pid="173" name="seek help with ALLSEEING, &#39;an agency and a platform for prototyping futures&#39; who have advised on VR education projects before" tags="" position="1218,3007" size="100,100">You have a meeting with your client and head futurist and digital nomad Skye, the co-founder of ALLSEEING. The meeting is at your office and she brings her six year old daughter to ‘consult’: luckily Skye does most of the talking. She explains some of the underlying processes that she advises companies to put into their adult games and advises a similar approach to children’s games. Although they may seem like fun ‘escape trajectories,’ the games are carefully managed and controlled to make users more productive, and because of these, they work harder and for longer hours. Moreover, she suggests you make the most of your influencer and use Avery to attract lucrative product placements. 

Although you have your doubts, your client is enamoured with these insights. An Avery-inspired gamified educational experience is a hit with advertisers and your client has no trouble in getting product placements. Your client wants to rush the product to market so there is no testing. While sales performance is strong, there are glitches – for example, students are purchasing products directly through the product placements even though that was not supposed to be allowed. The glitch draws back the curtain and exposes the way in which the games are coded within the capitalist system. As a result of bad press the game is withdrawn from schools. [[Just as the story blows up, the news of Skye’s death reaches you: she was electrocuted onstage by a live microphone. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="174" name="a big games company who have experience in creating massive multiplayer online role-playing games." tags="" position="1344,3011" size="100,100">You consult the games company. Although they don’t want to share any secrets, you manage to connect with one programmer who is willing to meet you for a drink. It turns out he is bitter about not receiving a promotion and it doesn&#39;t take much effort for you to get a hold of the blueprint for the structure of one of their most successful games. You follow this structure and create an extremely popular gamified experience with various levels reflecting different knowledge and skill abilities. The landscape and avatars are designed by Avery and therefore ensure immediate popularity amongst 11-15 year olds. Everyone is pleased: the client, Avery and the schools. 

Years later, you have a chance meeting with the CEO of a large multi-national and are astounded when he thanks you for training his employees. As you’re not sure what he means, he explains that the games trained a generation of good corporate citizens to consume well, pay their dues, climb the corporate ladder by leading projects, achieve sales goals and earn and save, work hard for better possessions, play the markets, win responses from peers and customers and encourage underlings to outperform and become better employees. [[It suddenly dawns on you: in this virtual world of your creation, work was valued as an end in its own right. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="175" name="geographical ‘field trips’" tags="" position="1572,3010" size="100,100">You target the primary-school market and provide the teachers with various options to teach in virtual environments, allowing the students to experience environments that they may not be able to see otherwise, e.g. ocean life, safari, space. This proves to be extremely popular -- both kids and teachers love it. [[As VR becomes a popular educational tool, experts warn that children are starting to prefer the virtual environment to the real one and that their interpersonal skills are suffering. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="176" name="historical ‘field trips’" tags="" position="1459,3010" size="100,100">You allow students to time travel to the past. Instead of just learning history, they can watch it come to life, from observing the building of the Pyramids of Giza, to visiting the trenches of WW1. Although some students find the experiences too distressing, on the whole, most teachers are enthused and adopt use of the programme in class. [[However, it soon becomes clear that while it works well for older students, in primary, the children fail to distinguish over time between VR and reality, and they are unsure of which they are experiencing at any one time.  -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="177" name="for children with sensory and attention issues" tags="" position="919,3158" size="100,100">Although you have chosen a smaller target market, your client is keen to do some PR and show how socially conscious his company is. According to researchers, there is potential to help both children with 

[[autism]] and 

[[ADHD sufferers]]. 

Who do you want to target first?</tw-passagedata><tw-passagedata pid="178" name="those that are home-schooled." tags="" position="1058,3158" size="100,100">You choose to examine the distance learning and home schooling markets. You create an AI teacher based on Avery who can guide the students through complex concepts. As your client is keen to get this to market, he suggests you strip the programme down to the bare necessity for now, that means either focusing 

[[on the subject material]]

or creation [[a more social VR experience where the children can learn important life skills]]. 

Which should be prioritised?</tw-passagedata><tw-passagedata pid="179" name="autism" tags="" position="844,3308" size="100,100">You develop a series of modules, with the help of experts, which prepares autistic children for various scenarios in order to help them better communicate and connect with others and the world around them. VR is found to be particularly useful to help these children prepare for encounters or situations that could be stressful such as public speaking. It is also excellent at helping them develop joint attention skills (where two people focus on an object together) which helps them with their social bonding.  You provide modules that help these children learn imitation, gestures, street crossing, mindfulness, travel safety and social skills. Moreover, the sensory immersion of a 360 video (complete with audio through headphones), provides the children with a sense of comfort. 

Special needs educators are raving about the programme as soon as it is launched, saying that the programme is accessible and easy to use and they can already see results. [[Although Avery was not happy with the direction of the project, her team quickly fashion her into a champion of the learning disabled and she becomes a near saintly figure in the media. -&gt;InstigaCapital Insurance Ltd.]]
</tw-passagedata><tw-passagedata pid="180" name="ADHD sufferers" tags="" position="994,3308" size="100,100">You create a simulation of a classroom with a teacher (Avery) where various distractions appear that can be controlled, amplified and decreased in exposure sessions. The children are thus ‘trained’ to learn to ignore these distractions, helping them control and overcome their ADHD. The programme works so well that your client sees the potential to roll out a virtual classroom more widely. Indeed, virtual classrooms are perfect to isolate students: there are no distractions (such as mobile phones) and it forces students to focus. [[You create a virtual classroom to be used in all schools, at all levels, and teachers&#39; feedback indicates that students benefit from enhanced attentiveness and seem to retain the information they have learnt better. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="181" name="on the subject material" tags="" position="1151,3313" size="100,100">You focus on the subject material: after all this is what is in the National Curriculum and should be at the heart of the educational experience. The programme allows the children to develop their passion for subjects they are interested in; there is no obligation to do everything but rather endless possibilities to further their knowledge on certain subjects by interacting with their teacher, Avery. [[This self-directed learning approach is popular: parents report increased family closeness and harmony and increased psychological and physical wellbeing for the children. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="182" name="a more social VR experience where the children can learn important life skills" tags="" position="1286,3313" size="100,100">Avery teaches the children compassion, acceptance of diversity, creativity and collaboration. Moreover, through the social features, the children can interact with each other and build friendships. [[As a result of the rave reviews the programme garners, more and more parents choose to home school their children, Avery becomes everyone’s favourite teacher. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="183" name="make the most straightforward VR experience, whereby users answer a series of tailored questions on the fashion industry and about themselves, thereby showing their knowledge" tags="" position="3562,1377" size="100,100">You stick to the interview scenario but provide a New Age take, in line with Bolencioga’s brand culture and demand for creativity. Candidates find themselves drifting through various hallucinatory landscapes as they are interviewed -- they must ensure not to be distracted by trippy visuals of swirling geometric fractals, streaks of ghostly light trails and technicolour textures. Candidates are asked a range of questions, and you let your client assume that they are scored on all of these, though in reality the only question that matters is their astrological sign. Only Aries and Virgos will be successful. [[Bolencioga use the programme for years and never uncover the bias you have designed within it. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="184" name="Do you continue working with her" tags="" position="2895,1238" size="100,100">You continue working on the project and it can soon provide students with both industry-specific training as well as tailored mock interviews. The client is thrilled and has ambitious plans to promote the programme and ensure it is rolled out in universities. She asks you to help her as she struggles with who to choose to be the ‘face’ of the programme for the PR blitz she wants to unleash. The choices are: 

[[the client herself, a recognisable figure of female empowerment, someone who has risen to the top through hard work and talent alone]]; 

[[one of the client’s close friends, an attractive, younger member of the Royal Family who is known to support educational causes]] – this will cause the most media buzz; 

or [[an expert in the implementation and development of diversity and inclusion programmes in education]]. </tw-passagedata><tw-passagedata pid="185" name="finish the initial programme and move on to other more fulfilling projects?" tags="" position="2767,1233" size="100,100">You find the client too difficult to work with and prefer to finish the programme and move on to other, less prestigious but more fulfilling projects. Your expertise in creating life-like, responsive AI characters allows you to make a name for yourself. However, you recognise some of the dangers of this technology in terms of the ability for social manipulation and invasion of privacy and discrimination. 

You are approached by a leading innovator to join his billion-dollar non-profit research lab which lobbies for more AI oversight. Do you 

[[decide to join]]

or [[keep your head down and continue making AI, albeit socially responsible AI?]]</tw-passagedata><tw-passagedata pid="186" name="the client herself, a recognisable figure of female empowerment, someone who has risen to the top through hard work and talent alone" tags="" position="2842,1497" size="100,100">Your client becomes the face of the programme and starts touring universities across the world to promote the VR programme. These generate significant media attention, at least in part due to her ability to give inspirational TED-style talks which reaffirm that &#39;young people have a natural ability to use technology, regardless of their knowledge, education or language. It doesn’t matter if they are in California or the slums of Nairobi.&#39; This goes down well with university students and management alike. 

Not everyone believes the hype however and a rival philanthropist delivers a vicious takedown of the project, arguing that most universities cannot afford the hardware and rather than helping the disadvantaged it is only providing a further boost to the privileged. The programme is soon dropped and forgotten but a serious conversation about the myths of meritocracy emerges. [[In a damage-limitation exercise, you client donates record amounts to public schooling at primary and secondary level. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="187" name="one of the client’s close friends, an attractive, younger member of the Royal Family who is known to support educational causes" tags="" position="2962,1497" size="100,100">The Princess showcases the programme which generates huge media attention. She becomes an advocate for VR as a way to better connect and empathise with other people, regardless of race, age or nationality. Unsurprisingly, the students who use the programme elect to create avatars that look remarkably similar to her. 

The programme receives a lot of interest from various companies who want to create tailored, branded versions of the programme, you are in high demand! [[More importantly, interest in VR and an appetite for different content spikes -- it becomes mainstream. -&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="188" name="an expert in the implementation and development of diversity and inclusion programmes in education" tags="" position="3082,1497" size="100,100">You work with an expert in the implementation and development of diversity and inclusion programmes in education. She gives you feedback on the programme resulting in a better product. While she has the expertise, she is not media-savvy and there is little widespread interest in the programme, although those that use it find it very helpful. Soon, the technology is obsolete and it becomes clear that VR as a whole is dying out. 

Luckily, you saw this coming and shifted your attention to Augmented Reality which merges the physical and virtual. You have made a name for yourself in creating useful AR training programmes as you were one of the first to create a risk awareness experience aimed at managers of maintenance crews showing the dangers of working at height. [[This led to significant risk-reduction and better personal protective equipment.-&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="189" name="decide to join" tags="" position="2722,1497" size="100,100">You join the team. With deep pockets and unlimited resources, the team successfully lobbies for a government committee which comes up with regulations which give the highest probability for a safe advent of AI. You help create algorithms which perform comparably or better than state-of-the-art approaches while being simpler to implement and tune, thus increasing transparency. [[Your name goes down in history. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="190" name="keep your head down and continue making AI, albeit socially responsible AI?" tags="" position="3202,1497" size="100,100">You decide to continue making AI independently. You optimise the state-of-the-art algorithms you created for the training programme, improving them based on the student feedback. Soon, aided by machine learning, the characters are capable of complex conversations and genuinely helpful to test various unique scenarios. Your programmes are in high demand, particularly in gaming where the AI characters’ interact and collude in real time with players, allowing for long-term emotional shifts which help change the game’s narrative. These interactions are designed to evoke affective reactions of empathy. [[These games become record hits. Within ten years, you are awarded the Nobel Peace Prize for the promotion of empathy to support social communication. -&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="191" name="One is a tour company which wants to capitalise on the popularity of dark tourism by creating VR experiences." tags="" position="1713,2859" size="100,100">You take on the dark tourism experience. You are mindful of ethical concerns around dark tourism and are deciding between 

[[more educational experiences]]

or [[experiential entertainment options.]]

Which do you go for? </tw-passagedata><tw-passagedata pid="192" name="The second is a top care home provider who wants to create personalised VR experiences for dementia patients." tags="" position="1830,2863" size="100,100">You are keen to test your skills by providing personalised VR experiences. Your client wants you to ‘transport’ the dementia patients to provide them with some comfort. You need to decide whether this personalised experience is based on 

[[transporting them to a ‘happy place’ of their desire]]

or the more challenging task of [[re-creating past experiences from their youth]]. </tw-passagedata><tw-passagedata pid="193" name="The third is an NGO which wants to set off an empathy revolution through ‘identity tourism’ in VR." tags="" position="1972,2871" size="100,100">You seize the opportunity to finally test the potential of VR as an ‘empathy machine.’ Your client wants you to raise awareness about the plight of homelessness. You now need to decide whether the user is 

[[confined by their real-world identity]] 

[[or not, why restrict them]]?</tw-passagedata><tw-passagedata pid="194" name="more educational experiences" tags="" position="1692,3018" size="100,100">You follow the educational route. The next choice to make is whether to focus on 

[[existing sites of tragedy which can still be toured in some form in real life]] 

or [[historical tragedies of which nothing remains.]]

The first is more easily adapted to the tours but the second provides more opportunity for creative interventions which could be sold to educational institutions. 
</tw-passagedata><tw-passagedata pid="195" name="experiential entertainment options." tags="" position="1812,3018" size="100,100">You go down the experiential entertainment route. Your client is keen to elicit strong emotional responses. You need to decide whether to 

[[pull on viewers heartstrings]]

or provide [[a more uplifting spin on the experience]]. </tw-passagedata><tw-passagedata pid="196" name="existing sites of tragedy which can still be toured in some form in real life" tags="" position="1617,3168" size="100,100">You focus on creating VR tours to be watched by tourists in coaches on the way to the destination. These historical reconstructions educate tourists about the tragedy which occurred at the spot that they are about to visit. For the tragedies within living memory, you have interviewed survivors to incorporate into the experience. These interviews are heavy-hitting so you don’t know whether to 

[[cut them]] 

or [[keep them in]]. </tw-passagedata><tw-passagedata pid="197" name="historical tragedies of which nothing remains." tags="" position="1767,3168" size="100,100">You focus on historical tragedies of which there is no longer any trace. You are excited by the opportunity to address past, overdue wrongs, for example, by exploring the history of human slavery during visits of a cotton plantation. These experiences become popular and sell well but within a few months they have been hacked by right-wing groups to present alternate histories whereby the Old South is romanticised and a victorious South ensures the continuation of legal slavery. [[Your client is horrified and quickly withdraws the experiences but by this time the hacked versions are popular online. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="198" name="cut them" tags="" position="1542,3318" size="100,100">You cut them and decide instead to make the viewer virtually ‘live through’ the tragedy. The VR experience is now implemented, it is recommended to tourists for an additional fee. There is a strong uptake and as a result, your client can do without tour guides, thereby reducing costs. [[However, within a year your client is being sued by seemingly traumatised tourists who are reporting post traumatic stress disorder. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="199" name="keep them in" tags="" position="1692,3318" size="100,100">You keep the interviews in. You test the experience and find that it results in ‘compassion fatigue’ whereby participants become desensitised to the tragedy as they feel emotionally manipulated. Face-tracking shows that the most prominent emotions expressed by viewers are disgust and fear. [[Your client is so alarmed with the results that they drop the project and refuse to pay you. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="200" name="pull on viewers heartstrings" tags="" position="2013,3170" size="100,100">After doing some research, you decide to focus on slum tourism which is increasingly popular. You create virtual tours of slums in Brazil, South Africa and India. These are extremely lucrative for your client as the financial elite, who prefer to avoid actually visiting the slums and experience this sanitised version, use these virtual tours to put their own lives in perspective. Given the wealthy demographic which uses the experience, other brands are keen pay for brand placement within the experience. Your client asks your opinion before they make a decision, do you advise them to 

[[take the money]] 

or [[refuse it]].</tw-passagedata><tw-passagedata pid="201" name="a more uplifting spin on the experience" tags="" position="1887,3168" size="100,100">Given the popularity of shooting games you decide to make virtual war fighting experiences whereby players can try out different tactics and weapons as appropriate for the battlefield selected. The experiences become very popular and your client becomes known for ‘milking the macabre.’ Rather than work against this, your client decides to embrace it. [[This works in their favour until an avid player decides to re-enact their virtual experiences in the real world, resulting in 59 deaths. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="202" name="take the money" tags="" position="1938,3320" size="100,100">You advise them to take the money, after all this is not real, it’s virtual! Moreover, branding is a part of our daily lives and brands are also to be found in slums. You integrate brands into the experience through background billboards and detritus packaging. [[The results are surprising, particularly as the partner brands are luxury ones, it seems that cognitive dissonance is in operation and viewers do follow up on the experience by going on spending sprees. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="203" name="refuse it" tags="" position="2088,3320" size="100,100">You advise your client not to allow other brands into the experience. [[Instead, they decide to enhance the realism of the experience (and their coffers) by offering viewers an upgrade which involves a 24 live streaming ‘reality VR’ from within the various slums. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="204" name="transporting them to a ‘happy place’ of their desire" tags="" position="2053,3017" size="100,100">You focus on creating ‘happy’ environments the patients can explore. Your next choice is whether to 

[[allow for social experiences within these environments]] 

or [[not]].</tw-passagedata><tw-passagedata pid="205" name="re-creating past experiences from their youth" tags="" position="1932,3013" size="100,100">You decide to re-create past events/experiences. Do you choose to 

[[re-create major historical moments]]

[[re-create individualised personal memories]] which will limit the potential uptake but perhaps have more impact on patients.</tw-passagedata><tw-passagedata pid="206" name="allow for social experiences within these environments" tags="" position="2165,3160" size="100,100">You create a series of different ‘bucket list’ experiences drawn from top tourist destinations. These include visiting the Eiffel Tower, watching the sunrise over the ocean, seeing the Northern lights and watching wild animals on safari. Family members can remotely connect to the experience and speak to the patients. [[Although some patients refuse to wear the VR headsets as they are afraid of them, for those that do participate, the experience is generally found to be beneficial and calming. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="207" name="not" tags="" position="2310,3160" size="100,100">You provide a range of music-inspired experiences. For example, patients can re-experience their youth by teleporting into a 1950s era nightclub to take in a performance by Frank Sinatra. [[While patients enjoy these visits, the novelty soon wears off and within a few months the VR headsets are gathering dust. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="208" name="re-create major historical moments" tags="" position="2430,3175" size="100,100">You decide to go for a wider audience and re-create major historical moments such as the coronation of Queen Elizabeth II or the Apollo 11 moon landing. These experiences become popular, staff agree that patients become more alert as a result and have improved communication and cognitive abilities. [[While it is a success, high costs prevent a national uptake. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="209" name="re-create individualised personal memories" tags="" position="2552,3175" size="100,100">You decide to re-create individualised personal memories. In order to do this, you must conduct extensive interviews with patients and families as well as scan photographs and videos in order to create realistic re-enactments. This has mixed effects on patients. [[While they rate the experience as positive overall, for some patients it triggers uncomfortable or distressing memories such as the deaths of loved ones. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="210" name="confined by their real-world identity" tags="" position="2663,3173" size="100,100">The users navigate the virtual world as themselves but they have recently been made homeless. Do you make the experience interactive? 

[[Yes, the more interactive the better]]

[[No, interactivity isn&#39;t needed]]</tw-passagedata><tw-passagedata pid="211" name="or not, why restrict them" tags="" position="2773,3170" size="100,100">Users are not confined by their real world identity. You are debating between two ways for users to select their character: they can either 

[[choose their gender and race]]

or [[can select the cause of their character’s homelessness: poverty, mental illness, addiction or domestic abuse]]. </tw-passagedata><tw-passagedata pid="212" name="Yes, the more interactive the better" tags="" position="2590,3323" size="100,100">You gamify certain elements of the experience so that the user is forced to make difficult decisions such as whether to sleep rough or spend the little money they have on shelter, which when they get to it is filthy and where they receive abuse by the staff. It underlines mundane and chronic problems that are often invisible to people who haven’t faced homelessness. [[As a result, donations to homelessness charities rise significantly. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="213" name="No, interactivity isn&#39;t needed" tags="" position="2738,3323" size="100,100">You decide to stick to 360 Video and take advantage of the lack of interactivity to highlight the lack of control homeless people experience in their daily lives. As the user encounters people on the street they see their reactions – they are either judged, ignored, questioned or rewarded. The experience has great emotional impact and as a result, individuals are much more likely to show kindness to the homeless. However, you soon realise that individuals still don’t understand the structural issues behind homelessness. [[You pitch a new homelessness experience to your client who gives you the go ahead -&gt;can select the cause of their character’s homelessness: poverty, mental illness, addiction or domestic abuse]]. </tw-passagedata><tw-passagedata pid="214" name="choose their gender and race" tags="" position="2990,3322" size="100,100">Users can select who their character is thus elevating their understanding of what it is like to suffer from homelessness from different perspectives. While this proves to be very effective for fundraising for homeless charities, critics highlight how patronising and cynical this approach to social issues is. They argue, for example, that a white person experiencing racist abuse can feel sympathy, but doesn&#39;t actually live in the body of the character they&#39;re playing, the abuse they experience as that character therefore becomes much easier to dismiss. [[A wider conversation about empathy occurs in the media, rather than needing VR to empathise with someone and constantly needing to be &#39;entertained,&#39; people are encouraged to just listen and believe others. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="215" name="can select the cause of their character’s homelessness: poverty, mental illness, addiction or domestic abuse" tags="" position="2848,3322" size="100,100">In this experience, users can select the cause of their character’s homelessness: poverty, mental illness, addiction or domestic abuse. They are then told that character’s story to disband some of the myths of homelessness and understand some of the structural issues involved. [[This gets a lot of attention in the press and homelessness becomes a key policy issue in the next election campaign. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="216" name="a sleep aid" tags="" position="2117,2633" size="100,100">You design a more comfortable headset so that users can wear it in their sleep. You now need to decide whether the focus of the aid will be on 

[[increasing sleep quality]]

or [[relaxation and falling asleep]].</tw-passagedata><tw-passagedata pid="217" name="a phobia treatment" tags="" position="2234,2630" size="100,100">You choose to create an experience to deal with common phobias. The most successful types of therapy seem to be either 

[[exposure therapy]] 

or [[psychotherapy]] which do you want to follow?</tw-passagedata><tw-passagedata pid="218" name="an escapist, relaxing spa" tags="" position="2345,2627" size="100,100">You aim to create an escapist, relaxing spa-like experience. Will you focus on 

[[comforting landscapes]]

or [[comforting experiences?]] </tw-passagedata><tw-passagedata pid="219" name="increasing sleep quality" tags="" position="2076,2778" size="100,100">You take a data-centric approach which tracks and measures the quantity and quality of users’ sleep. Users are rewarded with points for better quality and/or longer sleep, this motivates users to keep using the headset. Your client soon realises the value of this experience and asks you to facilitate further monetisation of it by working with third parties, you are uncomfortable with this request as this is intimate data. Do you 

[[agree to the request]] 

or [[refuse?]]</tw-passagedata><tw-passagedata pid="220" name="relaxation and falling asleep" tags="" position="2192,2782" size="100,100">You create a deep relaxation VR experience to help people fall asleep at night. This proves to be very addictive. However, it is so popular that medical experts start to warn about the dangers of VR for eyesight given the alarmingly quick rate of growth for nearsightedness. 

Do you [[heed these calls by adjusting the experience so people can only watch it for a maximum of 10 minutes to reduce eye strain]] 

or [[do nothing and hope the experts are wrong]]?</tw-passagedata><tw-passagedata pid="221" name="agree to the request" tags="" position="2200,2927" size="100,100">You agree to further commodify users’ sleep patterns, in any case your client could have paid somebody else to do it so you may as well make the money. You can see two ways of monetising the experience further: 

[[advertising partnerships that will ‘sponsor’ messages while users’ sleep]]

or [[selling the data to insurers who can then factor this information into the premiums they offer]]. </tw-passagedata><tw-passagedata pid="222" name="refuse?" tags="" position="2317,2931" size="100,100">You refuse to make users’ non-working lives productive and competitive. You are fired and soon hear that the experience has been re-sold to a global hotel group which specialises in business travel. You are curious and look up their website which proclaims that they are ‘curing the contemporary crisis of sleep’ by ensuring guests have ‘restful’ sleep which will ‘make your stay more productive.’ [[Moreover, the reviews seem to show that this is working, businesses are delighted that their employees are generating further efficiencies and getting more done. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="223" name="advertising partnerships that will ‘sponsor’ messages while users’ sleep" tags="" position="2173,3040" size="100,100">You advise your client to partner with an advertising agency. [[Soon, users’ relaxation, sleep and morning wake-ups are being sponsored by different brands. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="224" name="selling the data to insurers who can then factor this information into the premiums they offer" tags="" position="2302,3043" size="100,100">You advise your client to sell the data collected to life insurers who are keen to factor the data into their health calculations. Although the data is anonymised it soon turns out that insurers can re-identify people by comparing the dataset to other publicly available information. [[Moreover, it emerges that the data is simply inaccurate a lot of the time and people have been unfairly charged with higher premiums. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="225" name="heed these calls by adjusting the experience so people can only watch it for a maximum of 10 minutes to reduce eye strain" tags="" position="2437,2925" size="100,100">You adjust the experience to prevent excessive eye strain. The experience generates attention for being socially responsible. It gains popularity amongst the teenage market who use it to reduce their anxiety, parents are relieved their children are using what is hailed as ‘healthy’ tech rather than gaming. However, soon studies emerge that long-term use of VR by children under the age of 16 results in a VR hangover where reality is less real that virtuality. [[This is felt as a sense of detachment and a major cause of depression. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="226" name="do nothing and hope the experts are wrong" tags="" position="2547,2922" size="100,100">You do not change the experience, it is not your responsibility to regulate other people’s behaviour. Five years later you wake up with a strange feeling, you feel that something is off. It sounds like a Sunday, there is no traffic but you know it is Wednesday. [[You switch on the news and you notice it’s a different broadcaster from the regular one, she&#39;s announcing that 40% of the population has gone blind overnight from excessive use of VR. -&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="227" name="exposure therapy" tags="" position="2312,2780" size="100,100">You think the characteristics of VR are perfectly suited for exposure therapy. Your client sends you a recent report by ALLSEEING, &#39;an agency and a platform for prototyping futures&#39; which highlights the increasing numbers of individuals suffering with contemporary phobias such as ‘nomophobia,’ the fear of being without your mobile phone. He suggests you meet with futurist and digital nomad Skye, the co-founder of ALLSEEING. 

Do you arrange a meeting with her? 

[[Yes, you want to meet this infamous futurist]]

[[No, you&#39;d rather avoid this mumbo jumbo]].</tw-passagedata><tw-passagedata pid="228" name="psychotherapy" tags="" position="2432,2775" size="100,100">You decide to consult a psychotherapist to understand different phobia treatments. It seems there are two options that would work well 

either [[self therapy]]

or [[psychodrama, which do you choose?]]</tw-passagedata><tw-passagedata pid="229" name="Yes, you want to meet this infamous futurist" tags="" position="2437,3045" size="100,100">You set up a virtual meeting with Skye, she does not meet in person. Her avatar is a mesmerisingly beautiful blue alien-like creature. You have never seen anything like this before and are instantly captivated by Skye. She advises you to focus on the contemporary phobias she had discovered as these have not yet received much attention. You keep Skye updated with your progress and even provide her with access to the code you are making. Once released, the experience is picked up and ridiculed by the media, however, it does seem to be a hit with ever-more anxious and over-worked consumers, soon thousands of people are using it and your client is very happy. Six months after its release, tragedy strikes. Skye has reportedly fallen through a glass table while wearing her VR headset, she dies on the spot from loss of blood. [[As the tragedy unravels, it soon comes out that she was accessing the data users were putting into the experience and blackmailing them based on their most intimate fears. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="230" name="No, you&#39;d rather avoid this mumbo jumbo" tags="" position="2557,3045" size="100,100">You don’t buy into these contemporary phobias which the snowflake generation report to have. You decide to focus on ‘normal’ phobias: fear of flying, of enclosed spaces, of spiders, of snakes, of dogs and of needles. The programme you create can be used to hyper-personalise experiences and information to the precise vulnerabilities of the individual user. The idea is to gradually expose the user to their greatest terror. Your client is keen to release the programme before you can test it, do you 

[[capitulate]] or 

[[refuse, it is too dangerous]]?</tw-passagedata><tw-passagedata pid="231" name="capitulate" tags="" position="2912,3160" size="100,100">With misgivings, you allow your client to do as he pleases. It turns out you were right to caution him, users underestimate their sense of presence and what they can deal with in VR. Users are reporting traumatic experiences where they couldn’t look away, some are hurting themselves physically as they were trying to run away with the headset on and there is even a report of one user having a heart attack when confronted with a snake. [[Rather than helping people overcome their fears all you have achieved is making those fears stronger. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="232" name="refuse, it is too dangerous" tags="" position="3043,3163" size="100,100">You insist that the programme is tested. It emerges that users cannot be trusted to use it themselves but need the help of a trained psychotherapist to regulate the level of gradual exposure. The programme is therefore released but only sold to psychotherapists. [[It is a success, fears shrink to manageable levels and users learn that their fears are survivable. 
-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="233" name="self therapy" tags="" position="2787,2920" size="100,100">You decide to allow users to play the role of virtual therapist for themselves. Users will be sitting in a virtual doctor’s office, looking across a desk at a beatific Oprah. The user will explain their phobia to Oprah as she nods and smiles empathetically. Before she can respond, the user finds themselves in Oprah’s body, looking back at the avatar that represented them. They now have to give their avatar advice, once they have they return to their own avatar and Oprah repeats the words the user has just said back to them in all her infinite wisdom. [[It turns out this body-swapping self-therapy really does work, providing users a new perspective on their fears. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="234" name="psychodrama, which do you choose?" tags="" position="2668,2920" size="100,100">Psychodrama involves the therapist and client working together to re-enact scenes or memories that cause an anxiety response. You create a programme so that this no longer needs to rely on imagination and can be visualised much more realistically in VR. Users can easily build and customise scenes within which they can interact with objects. By re-enacting the experience in this realistic setting, users can gain clarity and produce new coping skills and behaviour. Unfortunately, testing shows that users enjoy creating and customising the scenes so much that they are distracted from their therapy. [[Your client fires you but you have an interior design client who is interested in what you&#39;ve created. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="235" name="comforting landscapes" tags="" position="2574,2770" size="100,100">You choose to create comforting landscapes but are struggling to decide whether these landscapes are 

[[realistic]] or 

[[imaginary]]. </tw-passagedata><tw-passagedata pid="236" name="comforting experiences?" tags="" position="2692,2773" size="100,100">You choose to create comforting experiences. After doing some initial research you are having difficulty deciding between an 

[[ASMR (autonomous sensory meridian response experience)]] 

or a [[guided meditation experience]]? </tw-passagedata><tw-passagedata pid="237" name="realistic" tags="" position="2928,2925" size="100,100">Holidays are often amongst people’s favourite memories. However, there is not always any guarantee that the holiday will live up to expectations, you create the ‘perfect’ virtual holiday experience in which the user can be assured that the sun will always shine. The experiences you create are so realistic that users can no longer distinguish between their actual holiday memories and the virtual ones. [[As reality is no longer needed for real enjoyment and pleasure, VR headsets take off while the travel industry takes a major hit.  -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="238" name="imaginary" tags="" position="3053,2922" size="100,100">You design a room-scale 3D painting experience so that users can create their own imaginary landscape in which they can relax. While there are some ready-made experiences such as a ‘blissful beach’ and a ‘cosy cabin’ which can be customised, the technology is so easy to use that most users unleash their creativity and start from scratch. [[These range from the psychedelic to the minimalist but these everyday oases become extremely popular, particularly for city workers who want a short break without the ordeal and inconvenience of airports and travel stress. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="239" name="ASMR (autonomous sensory meridian response experience)" tags="" position="2667,3040" size="100,100">Your client is really excited by your ideas and increases your budget. You can now hire the most popular ASMR artist to feature in the experience. She helps you create a range of VR ASMR videos which tests show instantly release endorphins and promote an overall sense of wellbeing. The experience becomes a top seller and is described by users as ‘weirdly mesmerising.’ The most popular of the videos is the one you nearly cut, it features soap cutting. [[It seems users luxuriate in the ‘small, orderly destruction.’ -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="240" name="guided meditation experience" tags="" position="2787,3040" size="100,100">You create a series of guided meditation experiences. Users can customise their meditation by choosing: the location, background music, whether it’s timed, who the guide is and what mood they want to induce. Due to the headset, distractions are tuned out and users can fully focus and slow down. [[Soon, meditation in VR is more popular than in real life and your experience turns out to be a key driver in the uptake of VR, so much so that soon, most households have a headset. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="241" name="breakfast with the kids while they fight over the headset" tags="" position="3337,505" size="100,100">The headset arrives in the early morning, just as the kids are getting up. There’s an hour until school. Who gets to play first? 

[[Sirius]], 

[[Despina]] 

or [[Perseus]]? </tw-passagedata><tw-passagedata pid="242" name="work" tags="" position="3467,506" size="100,100">As a real estate agent, VR has become part of your daily life, both for your own use in training but also to show your clients the properties. Every day, the first thing you do when you arrive in the office is put on the headset in order to see the latest programmes that have been provided to you based on your sales performance data. Today there are three options for you: 

[[Aggressa]], 

[[Affecta]] 

and [[Assista]]. 

Which do you load up?</tw-passagedata><tw-passagedata pid="243" name="picking the kids up from school" tags="" position="3595,504" size="100,100">Despina is increasingly anxious about her schoolwork and is looking for ways to relieve her anxiety. You suggest she look for some VR experiences that she can enjoy and relax with. She asks you whether she should try first

[[mindfulness]], 

[[spirituality]] 

or [[exercise]]?
</tw-passagedata><tw-passagedata pid="244" name="parents&#39; evening" tags="" position="3719,504" size="100,100">It’s Sirius’ parents’ day so you are going in to see his teachers. The school has recently invested in VR headsets so you are keen to see how they have been using them and whether you can use any of the educational software on the headset at home. 

While you are waiting to see the teachers you start chatting to some of the other parents who appear to have radically different views on the use of VR. Some are convinced it is turning their children into a virtual herd of mindless consumers, others are concerned about what VR is doing to their children’s sense of self and reality, while some are convinced that this is the path to a better world where everyone has access to all the information. You think all of this is overblown: surely it is just like any other new technology, it can do both good and bad and you just need to keep an eye on how it is being used by the kids? You decide to ask the teachers what their views are. Which subject leader do you go to first? 

[[Psychology]] 

[[Economics]] 

[[Citizenship education]].</tw-passagedata><tw-passagedata pid="245" name="a glass of wine and some rest and relaxation when they are finally tucked up in bed" tags="" position="3851,507" size="100,100">The kids are in bed so you finally have the chance to try out the headset yourself. You want to try some of the dating experiences. You’ve tried a few online applications before but you are excited to see what VR can add to the experience. As someone who doesn’t often have the opportunity to go out on dates, you hope this will be the next best thing. There seem to be three popular VR dating programmes: 
* the first is the most realistic, haptics included [[Joint]]
* the second, [[Duet]] provides you with a vast choice of filters, something which appeals to you as a 45-year-old mother of 3 
* and the third, [[Linger]] allows you to stay anonymous until you want to reveal your identity to someone. 

Which do you want to try out first?   </tw-passagedata><tw-passagedata pid="246" name="Sirius" tags="" position="3187,655" size="100,100">Sirius. You tell your eldest to set it all up and try first. He’s into his gaming so in no time he’s got everything ready. He wants to pay for the newly released //Forbidden Desires// -- &#39;it’s what all my friends play,&#39; he whines. Do you 

[[give in]] 

or [[limit him to the free version, which has a few less options and features advertising]]?</tw-passagedata><tw-passagedata pid="247" name="Despina" tags="" position="3337,653" size="100,100">Despina is the level-headed one, so you have her go first as you trust her judgment as to what to experience. She sets up the headset and then asks you whether to 

[[jump into completely new virtual experiences]] 

or [[start by using the headset for new perspectives on the ‘real’ world]]? </tw-passagedata><tw-passagedata pid="248" name="Perseus" tags="" position="3487,655" size="100,100">You let the baby, Perseus, have the first go: he’s recently broken his toe and this will distract him for a bit. You choose his first activity. Will it be more 

[[interactive and creative]] 

or [[something he can relax and escape with]]?</tw-passagedata><tw-passagedata pid="249" name="give in" tags="" position="3150,805" size="100,100">You let each of the kids choose one purchase only. Sirius buys the latest version of //Forbidden Desires//. Do you limit the amount of time he can play to the 

[[suggested 20 minutes]] or 

[[avoid the arguments and let him play longer, he&#39;s already ready for school]]?</tw-passagedata><tw-passagedata pid="250" name="limit him to the free version, which has a few less options and features advertising" tags="" position="3262,805" size="100,100">You won’t justify paying for a new game just yet; he’ll have to make do with the free version. He can choose to sync the game with his social media so that the adverts he sees are personalised based on his preferences. Do you let him 

[[sign in through his social media]] 

or [[have him play anonymously]]?</tw-passagedata><tw-passagedata pid="251" name="suggested 20 minutes" tags="" position="3075,955" size="100,100">Sirius is instantly addicted; all he wants to do is play //Forbidden Desires//. Over the next days and months you have to strictly monitor the amount of time he is in the headset. As time goes by, Sirius becomes increasingly distant; he seems to be living more in the virtual than in the real these days. When he does speak, it’s to tell you about Disruptia University. As far as you can tell, despite the name, they are not an actual university but they are based in Silicon Valley and seem to have quite the resources. They are uploading human beings into the Cloud and Sirius wants to be immortalised through his data. 

You’re dumbfounded - what do you do when your child wants to &#39;live for eternity beyond his human form&#39;? For the moment, fortunately, he can’t join, since you can’t sign up until you are 16. You try to talk him out of it but he’s adamant. You decide to do your own research and what you find is even more troubling; when you sign up for Disruptia you renounce all your rights. Disruptia is in total control: the uploaded brains cannot defend themselves; they can be reprogrammed, deleted, consolidated with other minds or copied. The Cloud is God: it’s omnipotent, creates all the rules, sees, senses and judges everyone and contains all knowledge. There is total dependence on the platform - a power failure would be a disaster.

As you dig further you realise where the money is coming from - Centillion, the world’s largest technology company, has the access code. With one click of the mouse, your son would grant Centillion full and unrestricted use of his mind and be economically exploited by it. You find rumours on social media that once uploaded, advertisements are directly installed into the brain&#39;s consciousness, perfectly tailored to their interests. [[You can’t let this happen but you don’t know how to stop it...-&gt;InstigaCapital Insurance Ltd.]].</tw-passagedata><tw-passagedata pid="252" name="avoid the arguments and let him play longer, he&#39;s already ready for school" tags="" position="3225,955" size="100,100">Over the next few weeks, you notice that after playing Sirius seems to suffer from unsettling lingering effects. He seems more detached from reality: he tells you the sky seems less colourful and that he’s missing the ‘magic’ of the virtual world. At first you think he’s just daydreaming but every time he plays, he seems to retreat further into the virtual world. 

You take him to see a psychiatrist. He is diagnosed with depersonalisation/derealisation disorder. While this used to be quite rare, the doctor tells you that more and more teenagers are getting it due to their use of VR. Sirius is now observing his life as though he were an outsider and feels totally detached from his surroundings - neither his bodily nor mental processes seem to be his own. In fact, he says he feels like an automaton, with no control over what he says and does, physically numb. 

You are horrified that your son has been reduced to a sort of ‘walking dead’ when he used to be so full of life. He has lost grasp on time; objects appear to him as either blurry or unusually clear; sounds are louder or softer than they were and he is increasingly depressed; he doesn’t trust any of his perceptions and worries about whether he actually exists. [[You are now paying vast sums to the psychiatrist in the hope that they can help cure him, and you damn the day you ever bought that headset. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="253" name="sign in through his social media" tags="" position="3454,956" size="100,100">If he’s going to be subjected to adverts, they may as well be from brands he likes. Sirius launches into the experience but advertising pop-ups keep jumping out at him, which makes him feel ill. Although he perseveres, he only lasts 20 minutes and when he comes out he looks very pale. 

You let him stay home for the day but the next day he says he still feels dizzy and he’s sweating. [[You take him to the doctor who tells you that he is seeing more and more teenagers get severe cases of motion sickness from VR -- the symptoms can last months, sometimes even years. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="254" name="have him play anonymously" tags="" position="3337,955" size="100,100">He can stay anonymous, better if he doesn’t want to buy the brands which are advertised to him! Sirius loves the game, no surprise there. Over the next few months he plays religiously, whenever he is allowed. However, he is also increasingly asking you to buy him clothes from a few high-quality, mainstream brands. At first you didn’t bat an eyelash -- after all there is nothing so banal as a teenager asking for trendy, branded clothing. 

However, once he starts wearing the t-shirts and hoodies you notice they have imagery and symbolism with anti-immigrant, far-right connotations. As you ask him more about the game, you realise that these images and symbols are part of the game: it’s a valiant quest asking for heroic engagement to restore the sacred land, and heritage and violence is valorised in the name of the cause. 

You can’t believe you didn’t discover this sooner and ban him from playing. He kicks up a fuss of course and as his friends are all still on it; he continues talking about the game all the time and you are extremely concerned that he is falling down the rabbit hole of the far right. [[You are kicking yourself for not teaching him more media literacy as now he’s no longer listening to you, branding you a snowflake who doesn’t understand what&#39;s important. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="255" name="jump into completely new virtual experiences" tags="" position="3394,805" size="100,100">Why not see what the headset is good for? Despina wants to play //Fantasy and Responsibility//, the most popular VR game of the moment, where players can create their own fictional, virtual worlds featuring existing branded objects as product placement. She asks you whether she can buy an add-on ‘scent generator’ to enhance her gaming. It’s only cheap, do you 

[[spoil her]], or

[[resist for now]]? </tw-passagedata><tw-passagedata pid="256" name="start by using the headset for new perspectives on the ‘real’ world" tags="" position="3502,805" size="100,100">You would rather the children start by dipping their toes into the virtual world through more realistic experiences. Despina does a quick scan of the store and tells you she can either watch 

[[the current global pop-phenomenon play main stage at the Stonehenge Festival live]]

or watch [[a popular reality TV programme]].  </tw-passagedata><tw-passagedata pid="257" name="spoil her" tags="" position="3697,955" size="100,100">Yes, you are curious to see what this scent generator does. It holds replaceable cartridges with individual aroma capsules (there are 250 to choose from). You smell an overpowering scent of burnt rubber and wonder what exactly Despina is doing. Apparently, the smells accurately simulate the atmosphere of the games. The unit also incorporates haptics including an ultrasonic ionising system for water mist, micro-heaters for heat sensation, micro-coolers for wind and haptic motors for vibration. 

Despina loves it. She also loves the brand placements and asks for something new everytime she comes out of the headset. [[Of course, as a realtor you should have known that brand-appropriate smells increase intent to purchase -- the old bread in the oven trick is not a myth. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="258" name="resist for now" tags="" position="3577,955" size="100,100">As you won’t let her have the scent generator, she focuses on her favourite subject, fashion. She spends hours deciding how to clothe and style her avatar. Of course, this costs money – the VR economy is nearly as healthy as the real one now, the only difference being that brands are now making money solely from pixels. More than ever before, consumers only get the symbolic benefits. 

[[Despina racks up quite the bill before you manage to switch off ‘in VR’ purchases. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="259" name="the current global pop-phenomenon play main stage at the Stonehenge Festival live" tags="" position="3821,956" size="100,100">The idea of Despina having a festival experience from the comfort of your own home appeals to you. Soon she seems absorbed: she has become one of the 200,000 person crowd but she isn’t caked in mud and she has the best view, front-and-centre. 45 minutes later she emerges from the headset, tired and sweaty but ecstatic. She’s thirsty and asks you for an American Champagne, you don’t have any in the fridge but let her go and buy one in the corner store before school. 

Over the next few months you realise that all the kids are asking for more sugary treats – soft drinks, cereals, candy, etc. It’s only when you talk about it with a colleague that you realise it’s due to the product placement in the VR: while ads for food and drinks high in sugar are banned in the real world, there is no regulation in VR as of yet. The festival was sponsored by American Champagne. [[Moreover, your colleague tells you, all content in VR is tailored for audience specificity according to the viewer, platform, geography, date and demographic profile so that advertisers reach their target audience. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="260" name="a popular reality TV programme" tags="" position="3939,960" size="100,100">She tunes into a new VR Reality TV programme called //Eye See//, which follows 28 days in the life of Karl, as he wears a VR headset and noise-cancelling headphones 24 hours a day. It sounds incredibly boring to you but Despina is apparently hooked. Everything is seen from Karl&#39;s perspective inside the headset, and the viewer sees what Karl chooses to see. It is as close as possible to looking through someone else’s eyes. Despina tells you she finds it oddly relaxing to lose herself and take on someone else’s perspective. 

The boys try it out too and they are fans as well. Soon the whole family is intimately acquainted with Karl’s work, leisure and lifestyle choices, as, it seems, is most of the country. [[However, in the last week of the show, Karl’s headset is hacked by the producers in order to deprive him of sleep: it keeps playing loud music and showing flickering images and the nation watches him slowly lose his mind. While this does cause media controversy, you are disturbed by how amusing the children find this. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="261" name="interactive and creative" tags="" position="3622,805" size="100,100">He’s full of energy so you think something interactive and creative will help him spend some of that excess pep! Do you play him 

[[a fictional, interactive story for children set in real world locations]]

or [[a more demanding multi-player puzzle experience]]?</tw-passagedata><tw-passagedata pid="262" name="something he can relax and escape with" tags="" position="3742,805" size="100,100">Hopefully you can get him to relax for a few minutes and forget his frustrations about being able to run around. Do you have him experience

[[a virtual swim with his favourite animals]] 

or [[visit some new places around the world]] -- he’s always liked adventure?</tw-passagedata><tw-passagedata pid="263" name="a fictional, interactive story for children set in real world locations" tags="" position="4056,965" size="100,100">You’re not sure about letting him interact with other (supposed) children you don’t know so you set him up in the fictional story. Perseus loves it; it’s a funny and irreverent futuristic/fantastical series which challenges its viewers to find eight surreal and unexpected jewels. Each episode builds up to the next instalment and you’ve never seen Perseus so absorbed. [[It reminds you of those ‘choose your own adventure books’ you loved when you were a kid. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="264" name="a more demanding multi-player puzzle experience" tags="" position="4166,963" size="100,100">As the youngest child, Perseus is a socialiser, so you think this puzzle experience will be perfect for him. Not only do the puzzles slowly get harder but Perseus loves being able to customise the VR ‘room’ in which he is playing with his new friends. [[You are impressed by the experience; it’s all about training children to share with each other as well as making his brain work -- perfect! -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="265" name="a virtual swim with his favourite animals" tags="" position="4277,968" size="100,100">He is a dolphin fanatic so you put him into a swimming with the dolphins experience. You can tell straight away that everything else falls into darkness -- he is totally immersed. When he comes out he says that he had completely forgotten about any pain in his foot, and he’s had the time of his life. While his toe is in a cast he uses the experience daily, however, once he’s out of his cast, the novelty wears off and within six months the headset is gathering dust in his wardrobe. [[Apparently there wasn’t enough content to keep the kids interested... another waste of money. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="266" name="visit some new places around the world" tags="" position="4389,965" size="100,100">You put him on a virtual tour of various wonders of the world. He loves it and decides that the next family holiday has to be to Angkor Wat -- he wants to explore the temples. [[You realise that the headset is going to be an expensive investment for you but are glad he’s using it to broaden his mind. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="267" name="Psychology" tags="" position="3608,655" size="100,100">You choose to go and see Alex, the psychology teacher first. He’s a bit of an eccentric but he’s one of Sirius’ favourites. Sirius is constantly telling you about the strange tangents Alex goes on to illustrate his points. He greets you and tells you about Sirius’ progress in class, and you&#39;re relieved to hear he is doing very well. As you’ve still got 15 minutes, you ask him about VR. He passionately launches into a diatribe about how easy it is to manipulate people with VR. He’s been running programmes to try things out for himself and wants to show you an example of what he has uncovered. Do you want to try 

[[a body transfer illusion example]] 

or [[video and audio manipulation of entertainment content]]?</tw-passagedata><tw-passagedata pid="268" name="Economics" tags="" position="3730,659" size="100,100">You go and see Sue, Sirius’ economics teacher. He’s been struggling with economics a bit but is doing better now, Sue tells you. As the conversation comes to an end you ask her for her thoughts on VR. She’s a convert, she tells you -- it’s all about economic efficiency. She wants to show you how it is being used to improve the student experience. Do you want to try the VR for yourself to see a recent student project? 

[[Yes, why not?]] 

[[No, you&#39;ve seen enough VR for today]].</tw-passagedata><tw-passagedata pid="269" name="Citizenship education" tags="" position="3844,649" size="100,100">You go and find Alice who teaches citizenship education. She’s a bit of a hippy but she means well. This is one of those courses that didn’t exist when you were at school, and as far as you understand it, it teaches kids about democracy and justice, rights and responsibilities and explores identities and diversity. Sirius finds the course easy and is doing well so there isn’t that much to cover with Alice. 

The conversation soon turns to the use of VR. Alice thinks it’s going to transform the world, because it’s all about new perspectives, she tells you. 

[[‘When was the last time you were in someone else’s shoes?’]] she asks you, but before you can answer she continues, 

[[‘Have you seen what they are doing for people with disabilities?’]] 

She’s in her own world -- which question do you answer?</tw-passagedata><tw-passagedata pid="270" name="a body transfer illusion example" tags="" position="3942,799" size="100,100">You’re not that keen on trying either option but you go for the body transfer illusion as you’ve never heard of it before and are feeling brave. You put the headset on and can choose your avatar – are you 

[[a ballerina with perfect features]] 

or [[a spider]]?</tw-passagedata><tw-passagedata pid="271" name="video and audio manipulation of entertainment content" tags="" position="4058,798" size="100,100">You’re not that keen on trying either option but you go for video and audio manipulation of entertainment content as it seems more probable that this is something which affects your children. You put the headset on and are asked which classical antiquity film you want to watch: 

[[Breakfast at Tiffany’s]]

or a [[Connery James Bond]]?</tw-passagedata><tw-passagedata pid="272" name="a ballerina with perfect features" tags="" position="4509,965" size="100,100">You choose the ballerina: at least she’s human! Suddenly, you are the ballerina and you can see yourself as her in the mirror, and every movement you make correlates to her movements. You are transfixed with this new image of yourself: your hands are her hands, your legs are her legs, long, skinny and graceful. This is an upgrade on your real body, and you’re not sure you want to go back. 

When the headset is removed 10 minutes later, you come back to earth with a bump -- it’s quite a shock. You can’t believe the effect those 10 minutes had on you, ‘but imagine’ Alex tells you, &#39;if you were a teenager and spent prolonged amounts of time in VR. These embodied experiences are dangerous. It is so easy to rate virtual bodies as more beautiful or preferable to the real, and this leads to higher rates of body dysmorphia leading to greater demands for cosmetic surgeries.&#39; 

&#39;Indeed,&#39; he continues, &#39;the rates of teenagers suffering from body dysmorphia has risen from 1% ten years ago to 15% now. It is so common now that cosmetic surgeons have dubbed it VR dysmorphia.’ 

As the bell rings for the next meeting, you leave still feeling the lingering effects of the VR, and you’ve resolved that you will be taking a close look at the avatars the kids are using in future – no more fantasy and no more filters. Perhaps a second opinion will help though; who do you go to now?

[[The economics teacher-&gt;Economics]] 

[[The citizenship education teacher-&gt;Citizenship education]] 

[[Or have you had enough and want to exit the building?-&gt;InstigaCapital Insurance Ltd.]]
</tw-passagedata><tw-passagedata pid="273" name="a spider" tags="" position="4624,966" size="100,100">You choose the spider, shudder! Surely you can’t be convinced that you are one? As you look around you, you are in the same room as before but looking at it from a different perspective. Your hands no longer look like your hands, your legs are not your legs, but as you slowly move around, these alien limbs mirror your every move. You start to freak out, you actually feel ownership over this arthropod. It’s too much -- you take off the headset. 

Alex is smiling, and he tells you that the experience of owning a nonhumanoid body is more convincing than that of owning a humanoid body. Continued exposure to such an embodied experience causes confusion in people about their real body -- for example they believe they have additional phantom limbs, sometimes even causing pain. This mental disorder is becoming more and more prevalent, he tells you, but there is no known cure. You’re slightly freaked out but you still have teachers to see. Who do you go to now? 

[[The economics teacher-&gt;Economics]] 

[[The citizenship education teacher-&gt;Citizenship education]] 

[[Or has it been too much for you and you want to exit the building?-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="274" name="Breakfast at Tiffany’s" tags="" position="4076,1145" size="100,100">Your favourite, //Breakfast at Tiffany’s//, starts up. At first, it’s just how you remember it but then you notice the paper bag with the croissant in it is branded: surely that wasn’t the case in the original? And the coffee cup is a Cashprism: surely that brand didn’t exist back when the film was made? And actually, her sunglasses look slightly different. 

As the scene ends, Alex takes the headset off you. ‘Yes,’ he says, ‘advertisers can reach their target audience by integrating branded content directly into movies and TV series in VR, changing the original content so if you weren’t already familiar with the film you probably wouldn’t have known. Moreover, the brands you will see are based on your personalised data. Each of your children will see different brands being integrated into their content.’ You leave in awe at how seamless the integration was, plus you really fancy a quick Cashprism on the way home. First, though, a few more teachers to see -- who is next? 

[[The economics teacher-&gt;Economics]] 

[[The citizenship education teacher-&gt;Citizenship education]] 

[[Or have you had enough and want to exit the building? -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="275" name="Connery James Bond" tags="" position="4207,1145" size="100,100">You can’t resist the charm of Connery. But as you start watching, something is off. You just can’t put your finger what it is, however when a waitress asks him what he wants to drink and he says, ‘Just a drink. An old fashioned, shaken not stirred,’ you know the film has been tampered with. Connery’s a deepfake. You’ve seen these before, but it does seem even more convincing in VR. 

As you take off your headset, Alex tells you that while 88% of people believe they can identify deepfakes and therefore couldn’t be targeted, the technology is now such that in VR, they are indistinguishable. So while Connery’s drink is not of much consequence, when it comes to fake news to manipulate viewers, it is easy to understand why the current President, the richest one in history, has such high approval ratings. And children are even more easily manipulated, as they find it increasingly hard to distinguish between the virtual and the real. You’re unsettled but it’s time for the next parent-teacher meeting. Who do you go to now?

[[The economics teacher-&gt;Economics]] 

[[The citizenship education teacher-&gt;Citizenship education]] 

[[Or have you had enough and want to exit the building?-&gt;InstigaCapital Insurance Ltd.]]

</tw-passagedata><tw-passagedata pid="276" name="Yes, why not?" tags="" position="4183,800" size="100,100">There are two preloaded VR programmes you can choose from – the first is
* [[project GroupWorkVR]], whereby students can learn to rent out virtual assets they have created, or
* the second is [[project SimmerDown]], a virtual learning experience where struggling students can slow down their temporal experience in order to further engage with the material. </tw-passagedata><tw-passagedata pid="277" name="No, you&#39;ve seen enough VR for today" tags="" position="4299,802" size="100,100">No, you’ve seen enough VR today, thank you. Sue’s enthusiasm is not to be dampened however and she mentions two other schools that she thinks use VR more efficiently, 

[[St Jude&#39;s]] and 

[[Interlint]]. 

Although you want to move on, she is obviously waiting for you to question her -- which do you question her about?</tw-passagedata><tw-passagedata pid="278" name="project GroupWorkVR" tags="" position="4327,1148" size="100,100">You try GroupWorkVR. It’s virtually replicating the familiar real world practices of the technology companies that form the basis of the current sharing economy. That is, it matches buyers with sellers or renters of unusual or one-of-a-kind assets, except that these assets are entirely digital. The students are trained to create these types of virtual assets (say hats for avatars in a game) and then learn how to market these assets in a simulation of the actual GroupWork marketplace. 

As Sue tells you once you’ve exited the experience, the sharing economy is a misnomer: it’s actually an efficient economy. While you’re glad your kids are prepared for the marketplace, you are slightly concerned with this obsession with efficiency. Perhaps a second opinion will help though. Who do you go to now?

[[The psychology teacher-&gt;Psychology]]

[[The citizenship education teacher-&gt;Citizenship education]] 

[[Or have you had enough and want to exit the building?-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="279" name="project SimmerDown" tags="" position="4442,1147" size="100,100">You try SimmerDown. As you start the experience you find yourself in the countryside rather than in a classroom. Although there is a ‘teacher’ explaining a concept which you focus on, the landscape around you is constantly changing and there are lots of environmental cues to take in as well. Surely, this must be distracting for students? You do, however stay attentive, and think you may even finally understand what compound interest is. 

When the experience ends you feel like you’ve been in VR for a couple of minutes and are surprised to take off your headset and hear the bell ringing -- you’ve been in there close to twenty minutes! The experience, Sue explains, is designed to manipulate the student’s perception of time through environmental time estimation cues, such as the movement of the sun. Of course this can easily be done when the student is cut off from all other distraction in VR. When your brain receives more input than usual and you notice more, time seems to slow down. This means that students are more focused on the here and now which helps them store more information. 

You are quite impressed but wonder how game designers are using these cues: does this explain why the kids now spend countless hours in VR? In any case it’s time for the next parent-teacher meeting. Who do you go to now?

[[The psychology teacher-&gt;Psychology]]

[[The citizenship education teacher-&gt;Citizenship education]] 

[[Or have you had enough and want to exit the building? -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="280" name="St Jude&#39;s" tags="" position="4500,838" size="100,100">You ask her what they do at St Jude&#39;s. She tells you that all classes there now happen in VR and the students can adjust the settings for their preferred teaching styles: behaviourism, cognitivism, constructivism and connectivism, and this results in different types of assessments. This is so efficient that there is only the need for one teacher per subject area in the entire school now, cutting down on personnel costs. 

You can’t quite believe what Sue is telling you: does she realise her job could be next? But before you find your words, the bell rings and you exit quickly without ever finding out what those various teaching styles even are. In any case it’s time for the next parent-teacher meeting. Who do you go to now? 

[[The psychology teacher-&gt;Psychology]]

[[The citizenship education teacher-&gt;Citizenship education]] 

[[Or have you had enough and want to exit the building?-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="281" name="Interlint" tags="" position="4617,838" size="100,100">You ask her what they do at Interlint. She tells you that as they were having issues with their budget and used VR as an ingenious solution. As they were already using the VR, they contacted the provider who suggested they allow product placement. Now each time a child goes into VR, branded objects appear in the experience, based on their preferences, or at least what their personal algorithms suggest are their preferences. Finally, the bell rings and you can leave politely; you’re pretty relieved you didn’t send your kids to Interlint. Who do you see next?

[[The psychology teacher-&gt;Psychology]]

[[The citizenship education teacher-&gt;Citizenship education]] 

[[Or have you had enough and want to exit the building?-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="282" name="‘When was the last time you were in someone else’s shoes?’" tags="" position="4762,846" size="100,100">You know that VR is supposedly good at building empathy by making you see things through other people’s eyes but you’re not sure what Alice is referring to. You say to Alice that you’ve heard that VR is an empathy machine. 

‘But no,’ she says excitedly, ‘that’s the whole point! We no longer need empathy!’ As the bell rings signalling the end of the meeting, she says she will email you two links. While you’re waiting for your next meeting you click on one of the links – which one? 

[[AstralProjection.Crystalinks.com]] or 

[[toxicempathy.com]]?</tw-passagedata><tw-passagedata pid="283" name="‘Have you seen what they are doing for people with disabilities?’" tags="" position="4891,842" size="100,100">You have heard about some technological advancements for people with disabilities but you are interested in knowing more. She tells you about brain-computer interfaces that allow people to interact with VR environments using only their brain activity. &#39;It can bypass our senses to virtually simulate vision, touch, taste and our entire perception really! Would you like to see a video?’ she asks you rhetorically - she’s already loaded the website – ‘Which would you prefer to see, 

[[what it does for someone with limited motor functions]] 

or how it [[makes the blind see]]?’</tw-passagedata><tw-passagedata pid="284" name="AstralProjection.Crystalinks.com" tags="" position="4744,995" size="100,100">You click on AstralProjection.Crystalinks.com – what on earth is this hippydippy world she’s sent you to? Apparently Astral Projection is &#39;where the consciousness and the astral body separate from the physical body to travel in the spirit world or astral plane.’ As you read the blurb you realise that VR can simulate out-of-body experiences, which according to this website can provide people with an inner awakening of their spiritual identity, a transformation of their self-concept and a dramatic elimination of their fear of death (is this a good thing?). 

You can see that perhaps it would help with perspective-taking though, and can believe that it may help with more restorative sleep as it helps with inner calmness but you draw the line at ‘opening up the potential in our minds.’ In any case, it’s time for the next parent-teacher meeting. Who do you go to now?

[[The psychology teacher -&gt;Psychology]]

[[The economics teacher -&gt;Economics]] 

[[Or have you had enough and want to exit the building? -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="285" name="toxicempathy.com" tags="" position="4854,995" size="100,100">You click on toxicempathy.com, at least it doesn&#39;t sound as New Agey. As you read through, you realise that this counters what you’ve heard about VR as an empathy machine. Instead, it argues that VR was useful in showing humanity that empathy isn’t actually the solution: ‘because you don’t actually live in the body of the character you’re playing, the abuse you experience as that character becomes much easier to dismiss.’ 

You can’t help but be taken by this line of argument: it did always feel strange to ‘become’ a refugee for ten minutes and then be asked to donate. It turns out you weren’t alone, and as a result of the lack of critical reflection, there is a new grassroots political movement which doesn&#39;t &#39;just mine the experiences of suffering people to enrich the self-image of VR users (or the cultural appeal of VR brands) but rather helps build political justice and stability by actually listening to the most vulnerable and more importantly, believing them without needing to be entertained&#39;. 

You sign up to the newsletter immediately; this movement is exactly what you want to be a part of. For now, however, you need to go to the next parent-teacher meeting. Who do you go to now?

[[The psychology teacher-&gt;Psychology]]

[[The economics teacher-&gt;Economics]] 

[[Or have you had enough and want to exit the building?-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="286" name="what it does for someone with limited motor functions" tags="" position="5077,997" size="100,100">The video starts. You see how through a neural implant people can interact with VR environments through brain activity. This is obviously lifechanging for people with limited motor functions: they can forget about their bodies and scroll menus, select items, launch applications, manipulate objects, read, write and speak to others without having to lift a finger or open their mouths. You can’t help but wipe away a tear as you hear some of the testimonies. This is truly revolutionary, although as you walk to your next parent-teacher meeting you do wonder about whether, as the technology develops, everyone will get an implant and who exactly will be in control of the technology which reads our every thought. Who are you seeing now though?

[[The psychology teacher-&gt;Psychology]]

[[The economics teacher-&gt;Economics]] 

[[Or have you had enough and want to exit the building? -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="287" name="makes the blind see" tags="" position="4966,992" size="100,100">The video starts. Vision is made possible by bypassing the blind person’s eyes and instead sending digital imagery directly to electrodes implanted in the visual cortex of the brain. Although at first there were some issues with nausea due to the number of frames per second, they have now figured out how to avoid this. You hear a testimony from someone who was diagnosed with macular degeneration and had had to give up hobbies, sports and travel, making him depressed. Since he’s adopted VRSeeingisBelieving, he has his old life back again and can do things independently once again.

While this is amazing, you are somewhat concerned that the company behind the technology is BookofVisages, the largest of the VR developers which has recently been involved in a number of controversies due to data breaches. What happens when they can see what you see and how long before you are having advertisements sent directly to your brain? 

Alice obviously hasn’t considered any of these implications -- you’re the only cynic here -- so you keep your thoughts to yourself and go and see the next teacher. Will it be: 

[[The psychology teacher-&gt;Psychology]]

[[The economics teacher-&gt;Economics]] 

[[Or have you had enough and want to exit the building?-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="288" name="Aggressa" tags="" position="4327,278" size="100,100">You have chosen Aggressa. Now do you want to try 

[[a training programme]] or 

[[a new client option-&gt;try out a new client option]]?</tw-passagedata><tw-passagedata pid="289" name="Affecta" tags="" position="4449,280" size="100,100">You have chosen Affecta. Do you want to 

[[do your daily half hour of obligatory training]] and get it out of the way 

or [[see new VR options to increase the saleability of the properties]]?</tw-passagedata><tw-passagedata pid="290" name="Assista" tags="" position="4586,280" size="100,100">You have chosen Assista. Do you want the 

[[‘namaste your day’]]

or the [[‘carpe your day’]] option? </tw-passagedata><tw-passagedata pid="291" name="a training programme" tags="" position="4253,434" size="100,100">You are behind with your training so you decide to fit one in before your first meeting. You have two choices today:

[[persuasion training]]

or [[dealing with difficult clients]].

Which do you choose?</tw-passagedata><tw-passagedata pid="292" name="try out a new client option" tags="" position="4396,436" size="100,100">You try out a new client option. You have two choices depending on the price of the homes: 

[[a new package deal with the insurance broker your firm works with]] for the ‘poor’ i.e. houses coming in under a million 

or [[a free upgrade to your firm’s new lifestyle VR experience]] -- this one’s reserved for the ultra-wealthy buyers. </tw-passagedata><tw-passagedata pid="293" name="persuasion training" tags="" position="4177,578" size="100,100">You go for persuasion training -- you’re generally quite good at convincing your clients to sell with you or buy what they’re seeing. You are linked up to the Mechanical Turk platform which your employer often uses to ‘have a human as a service’ as they say. Today one of those humans will train you by being a hypothetical client for an hour and for that pleasure they will earn about $2. You don’t feel very comfortable with this, knowing how much your company makes, but it’s not your decision. 

You launch into the training. They will play different scenarios and you are then rated on how well you respond. You know the tricks by now -- it’s all about working out what your client wants from a home and then seeing what they will accept, which means getting them thinking about compromise from the first meeting. If they say they need a third bedroom for guests but there are no three-bed properties on the books, suggest they would be better off spending their money on a bigger, better flat with a large reception room and a sofa bed. You know to mirror the buyer -- if they say they hate basements, then so do you, if they are chatty, then so are you, if they are silent, you follow suit. And ultimately, if all else fails, you bully buyers into making snap decisions which is what you have to resort to with this poor ‘client’ -- you tell them if they don’t make an offer, they are wasting your time and we may as well walk away from each other here and now. First time buyers are easiest to bully. [[After successfully completing today’s training you get on with your phone calls: you have to ring at least 80 buyers every day, leaving 100 to 120 messages. -&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="294" name="dealing with difficult clients" tags="" position="4327,578" size="100,100">You click on the difficult customers scenario. You find yourself in your usual VR office, with a hyper realistic client opposite you who is berating you for not having sold his home yet. He is loud, aggressive and demanding, threatening to kill the transaction more than once. It is uncomfortable and some of what he says is downright offensive but you practice calming him down – at least this virtual version is preferable to when you are in clients&#39; homes and sometimes in physical danger -- your safety, of course, is left to your discretion, the company holds no responsibility. [[This way you get all the elements of engaging with a person, all the benefits without any of the risks, although you still don’t feel great when you emerge from the headset. 
-&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="295" name="a new package deal with the insurance broker your firm works with" tags="" position="4447,578" size="100,100">You want to see what the insurance options are. Your firm has been collaborating with the insurance broker for years, offering clients a convenient (but of course, more expensive) one-shop stop of building, contents and mortgage life insurance policies. However, these will now be presented to your clients through the VR headset, directly after they have visited the ‘property’, or at least its virtual representation. You try it out and are amazed at how persuasive this new visualisation is, presenting the information inside a 3D canvas which wraps around you. After trying it out, you take your headset off and get back to work. 

It is only a few months later that you realise that the data collected on your clients during their VR ‘visits’ of property directly feeds into their insurance premiums. A 20 minute viewing of three properties records 2 million points of data about the client’s body movement. In fact, the insurance broker is so delighted with the data that he boasts about turning a client down for a new life-insurance policy as his tracking data revealed behavioural movement patterns often seen among people in the very early stages of dementia. The client, of course, couldn’t understand why he was rejected given his excellent health. 

You’re horrified: you’d already heard stories about insurers collecting huge amounts of virtual data during the last pandemic when everyone was using the headsets to meet, and you also know the government uses the data to reward ‘good’ behaviour and punish ‘bad’ behaviour (you can no longer use the free swimming pool as you were deemed to be buying too much wine) but you didn’t want to be a participant in this data extraction. [[Unfortunately, you have no choice. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="296" name="a free upgrade to your firm’s new lifestyle VR experience" tags="" position="4560,574" size="100,100">You’ve been excited to try this new lifestyle experience for some time; your colleagues have been raving about it. You enter the experience and it is a perfect virtual world, a complete tailor-made life experience. It is completely interactive and the haptic control is precise and totally intuitive. There are no limits for the movements and it reflects different stimuli to all of your senses. In fact, it is indistinguishable from the real world except that you are in an untouched landscape of extreme beauty. You haven’t ever seen a sky this blue. There is no marketing or advertising of any kind, and the billboards you see in your daily commute are nowhere to be found. It is bliss, you’re no longer surprised that there is a waiting list of wealthy buyers who want to deal only with your firm in order to get the experience. 

So while the ultra-rich spend more time in ‘perfect’ virtual worlds and less time in the real world, the rubbish, pollution, homelessness and social exclusion can be ignored. It becomes easier and easier for them to disengage from these distant realities, but their use of the virtual leads to significantly higher carbon emissions. The pollution from data centres is constantly increasing, now accounting for a third of the world energy consumption. 

[[As you force yourself to get back to work you wonder whether your rich clients have catharsis filled fantasies about the &#39;poor, miserable lives&#39; the likes of you and your family have to live. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="297" name="do your daily half hour of obligatory training" tags="" position="4644,434" size="100,100">You may as well do your daily training, which will you do first 

[[the ‘sun is rising’ motivational training]] 

or [[the overview of new properties just on the market which your team will have to sell]]. </tw-passagedata><tw-passagedata pid="298" name="see new VR options to increase the saleability of the properties" tags="" position="4520,435" size="100,100">You always want to know tricks to increase saleability. You power up the headset and there are two new options: 

the first is [[a new partnership with a luxury homeware brand]],

and the second is [[a new set of haptic gloves which allow the VR property tours to include a sense of touch]]. 

Which do you go for?</tw-passagedata><tw-passagedata pid="299" name="the ‘sun is rising’ motivational training" tags="" position="4837,580" size="100,100">You ready yourself for your motivational training. It’s actually quite pleasant, particularly when you tune out the voice of your boss whispering what he thinks are motivational phrases e.g. &#39;you’re going to take on that ruthless, sharky bastard.&#39; As you enjoy the virtual sunrise you feel yourself become energised, and you’re instantly more upbeat. You’ve been talking about this with your colleagues -- you’re convinced the programme is designed to control the emotional mood of all employees, making you less anxious and more productive. 

[[It&#39;s a bit sinister to have your mood regulated by your employer, but it works. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="300" name="the overview of new properties just on the market which your team will have to sell" tags="" position="4714,573" size="100,100">You want to have a quick look at what’s new on the market so you can grab the good ones before your colleagues have a chance. Your firm has recently upgraded their VR experiences so you can actually walk around the properties, however, this makes you feel queasy. It does save time on actual visits though and it makes everything look nicer than it actually is. 

Over the next few months you find that many of your clients are also getting motion sickness from the VR and for those with disabilities, the VR is inaccessible, either because they are not standing, they can’t play with the motion controls, they can’t make the head or body movements, the headset is too heavy or putting it on makes them anxious. 

Eventually, your company decides VR causes more problems than it solves and they retire the headsets. Within a few years, all the hype about VR being the next big thing which will revolutionise the economy had died down. [[There is still nothing better than face-to-face meetings to convince people to make one of the biggest buying decisions of their lives. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="301" name="a new partnership with a luxury homeware brand" tags="" position="5112,576" size="100,100">The new partnership with the luxury homeware company means that every property you show can now be properly staged, at least virtually. This really excites you, since you know that staging helps buyers associate a property with their future home. Whereas before it was an expensive investment, now it can be done with a few clicks; even better, it can be customised to your client’s tastes. In fact, the provider promises it makes clients 11 times more likely to buy. 

You test it out and it’s easy to use and the results look impressive. Moreover, if the client likes any of the furniture, it is gaze activated and they can add it to their virtual basket and buy it with the property! [[It’s a win-win. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="302" name="a new set of haptic gloves which allow the VR property tours to include a sense of touch" tags="" position="4972,580" size="100,100">While your clients have been able to see the properties virtually, they haven’t been able to touch anything until now. You try the new haptic glove and you’re amazed: you can push against the wooden mantlepiece and run your hand along the velvet wall panel. This will help significantly with nudging clients towards making a purchase, as touch increases perceptions of ownership and increases the perceived value, meaning clients may be willing to pay more. 

[[You can’t wait to try it out; it will be particularly useful for your wealthy clients abroad who want to invest in property and don’t always want to bother flying in to visit. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="303" name="‘namaste your day’" tags="" position="4895,438" size="100,100">You select ‘namaste your day’ to see the latest VR upgrades. There are two upgrades, one is for 

[[the ‘sales pitch hologram’]]

and the other is [[the ‘neighbourhood match assistance’]]. 

Which do you want to see first?</tw-passagedata><tw-passagedata pid="304" name="‘carpe your day’" tags="" position="4770,436" size="100,100">You choose the more interactive ‘carpe your day’ option. There are two options today:

[[a new upgrade to the VR to increase sense of presence]] 

or [[the latest motivational speech by your CEO]] (with requisite pauses for you to respond in the form of emoji).</tw-passagedata><tw-passagedata pid="305" name="the ‘sales pitch hologram’" tags="" position="4714,698" size="100,100">You’re excited about this one having seen an early prototype the previous year: this is the perfect, personalised sales pitch. As you watch the infomercial you realise this is better than you’d ever imagined. As they visit the property, the client sees their perfect life within it. In this case it’s a 30 something year old single woman and what she sees is a shinier-haired version of herself being embraced by a shirtless looker, complete with six-pack, her algorithmically calculated perfect man based on her online dating preferences and social media data. Even better, the headset is no longer needed, your client can just put contact lenses in and this will connect to the wi-fi to move data to and from the cloud to create an even more seamless vision of their perfect life. [[If this doesn’t sell you more property, you don’t know what will! -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="306" name="the ‘neighbourhood match assistance’" tags="" position="4851,700" size="100,100">You want to see the latest the virtual assistant can provide. It turns out she now analyses clients&#39; social media data to find other users who would be interested in hanging out with them based on common interests and values and then maps out which neighbourhoods these potential friends tend to live in to find the most suitable match. Given that most clients tend to focus on the residence rather than the surrounding area, you think this will be helpful in ensuring they think more realistically about their options. [[In fact, you wish you’d had this option when you bought your house so that at least you could have ensured your neighbours were of the same political bent as you. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="307" name="a new upgrade to the VR to increase sense of presence" tags="" position="4968,701" size="100,100">You know that presence is key to willingness to buy the property: if they feel detached or desensitised, they aren’t going to buy. The new upgrade is excellent; you’re not certain how they did it but you know that most of the technical developments are thanks to the VR porn makers who have driven the widespread adoption of this technology. [[Now clients will really feel like they are in the scene: they are no longer just voyeurs. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="308" name="the latest motivational speech by your CEO" tags="" position="5090,703" size="100,100">You may as well bite the bullet and watch the speech, as you will have to at some point in any case. He talks his usual yogababble about ‘unlocking the potential of human creativity and elevating the world’s consciousness,’ ‘selling happiness’ and ‘unlocking self-actualisation.’ You shake your head in disbelief -- every week it gets worse. You decide this is it, no more. 

You remove the headset and walk straight out of the office. You’ve been considering going self-employed for a while and it’s time to seize the day. You’ve honed your skills and have enough of a network to get you started, particularly since nearly all property listings are in VR now, and since both buyers and sellers can connect directly they are becoming more and more suspicious of estate agents. 

Rather than branding yourself an estate agent, you launch yourself as a virtual property hand-holder. You provide unbiased advice to sellers and buyers so that they understand the process and negotiate better. This is exactly what the market needs and you soon have to hire some of your ex-colleagues to help. Within the space of a couple of years, estate agency companies such as the one you used to work for go bankrupt. [[The oh-so-despised &#39;estate agent&#39; become a thing of the past. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="309" name="Joint" tags="" position="4634,1185" size="100,100">You go for Joint. As the most similar to real-life dating experiences, this will probably be a way of easing yourself into this new dating reality. First you pay a small fee to have a hologram made of yourself to upload into the programme. When your avatar arrives, you can start dating. If you don’t want to throw yourself into the deep end, you can pay slightly more to be matched by an AI assistant who harvests data from search engines about social backgrounds, sexual preferences, cultural interests, brand preferences and even photos of celebrity crushes to find your best possible suitor. Do you 

[[pay for the upgrade]] 

or [[leave it for now]].</tw-passagedata><tw-passagedata pid="310" name="Duet" tags="" position="4759,1184" size="100,100">You try Duet, where you can present an ideal version of yourself, no longer confined to your real-life identity. Beautification is available to all users but there is a twist. If you become a premium user you can manage your own identity and how others see you; if you are a standard user, others can decide how you appear to them. Do you go for 

[[standard]] 

or [[premium]]?</tw-passagedata><tw-passagedata pid="311" name="Linger" tags="" position="4886,1187" size="100,100">You decide to go for the blind option and pick Linger. There is an additional option to have a ‘practice’ date with an AI partner: do you feel that you need the practice?

[[practice makes perfect]]

[[you may be a little rusty but you&#39;ve got years of practice]]</tw-passagedata><tw-passagedata pid="312" name="pay for the upgrade" tags="" position="4469,1338" size="100,100">You pay for the upgrade and are introduced to Mike -- according to the AI assistant you are “hyper-compatible.” Mike gives you two date options: 

[[an evening in Paris]] 

or [[a picnic in the clouds]]. 

Which do you prefer?</tw-passagedata><tw-passagedata pid="313" name="leave it for now" tags="" position="4655,1333" size="100,100">You prefer to find your soulmate through serendipity. You decide to choose a mate based on shared interests. You can either 

[[attend a VR concert of your favourite band]] with your date 

or go for the adrenaline rush option, [[rock climbing in Yosemite]].</tw-passagedata><tw-passagedata pid="314" name="an evening in Paris" tags="" position="4484,1485" size="100,100">Mike whisks you off to the virtual streets of Paris where you take a romantic stroll along the Seine. Suddenly, you are booted out of the experience, and when you try and log back in you can’t seem to. When you seek help from Joint, they ask for proof you are who you say you are. It seems someone has taken hold of your virtual identity and you can’t prove that you are you. As you go around in circles, you decide it’s not worth it and just give up. 

However, a few weeks later you realise the hacker has been using your virtual self to charge things to you and even open virtual bank accounts. As you try to take control, you realise that your identity hacker has your intimate data, not only the database your AI assistant pulled but also your voice and other traits such as motor actions, patterns of eye movement, and reflexes taken from your headset. Moreover, when you seek the help of a lawyer you realise that the law courts still trust that the visual experience of the witnesses generally correspond to ground truth. 

[[It takes you years to regain your financial standing and Joint offers no help. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="315" name="a picnic in the clouds" tags="" position="4598,1488" size="100,100">You find yourself lying on a cloud of fluff, looking out into the starry night. You were so immersed in the nightscape that you nearly forgot about Mike until suddenly you feel a hand on your arm. Before you know what is going on, he is rubbing your chest -- you feel powerless but attempt to turn away from him. He chases you around, making grabbing and pinching motions near your chest. Emboldened when you don’t scream out, he shoves his hand towards your virtual crotch. At this point you rip the headset off: as you catch your breath, you feel violated. 

You decide to complain to Joint but all that comes of your complaint is an email stating that &#39;This is VR. There was no assault. There is no victim.&#39; Enraged, you do some research and discover that of course, the entire Joint team is composed of white men, and that they design for other white men, never thinking of designing to prevent assault or harassment. When putting on a headset you are stepping into a man’s world, where the language and frameworks have been mostly developed by men. 

Meanwhile, figures show that almost 50% of women who engage in social virtual reality spaces experience sexual harassment. [[You decide to sell the VR headset, much to the horror of your children. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="316" name="attend a VR concert of your favourite band" tags="" position="4754,1485" size="100,100">You decide to meet George at the rock concert. He is easy to talk to but just as your confidence is building, he disappears. Apparently, he decided you weren’t worth his time. You are shaken but it seems the realities of virtual dating are all about efficiencies, of time, energy and resources. 

Moreover, with all the choices available, everyone is getting more and more picky. You decide to try a few more of your suggested dating options but you get the same response over and over -- it’s a //Groundhog Day// of rejections. Most of your ‘dates’ lasted less than 5 minutes. By the time you have removed your headset you vow never to visit Joint again but you are still hopeful, so you decide tomorrow you will try [[Duet]]. </tw-passagedata><tw-passagedata pid="317" name="rock climbing in Yosemite" tags="" position="4874,1483" size="100,100">You find yourself virtually rock climbing with Sam, who is just above you. You have a good conversation going as you slowly inch your way up the cliff. Eventually, you make it to the top. The view is incredible and you can feel the chemistry. 

Suddenly, you can no longer control your movements. Your headset is being controlled by someone else who has complete access to your senses. They can see what you see and can hear what your saying. Soon he or she is projecting images into your retina, and they are not pleasant: you see images of dismemberment and rape. 

Your only option is to restore the factory settings of the headset. You’ve forgotten your password for Joint and can’t manage to get back in, so Sam is gone forever. [[You’re left frustrated and shaken up, and you won’t be going into VR again in your leisure time. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="318" name="standard" tags="" position="4949,1332" size="100,100">Standard: you’re not willing to pay more until you’ve at least tested this out. Although you’ve chosen your avatar, you don’t know how the men you interact with see you. You will just have to wow them with your personality! You have to first complete a personality test. 

Q. 1. I see myself as extraverted, enthusiastic. 

[[Mostly agree]] 

[[Mostly disagree -&gt;Mostly agree]]

</tw-passagedata><tw-passagedata pid="319" name="premium" tags="" position="4825,1334" size="100,100">You pay for premium. You’re insecure about your looks and want to use the beautification option. Your avatar looks like you but a better version of you, and you feel confident. 

You decide to participate in a gaming challenge as a means of gauging compatibility, since you will be able to talk through problems and see whether your date can compromise and win or lose gracefully. The aim is to kill the two-headed, black-eyed, flaming-toothed dragon. Joint provides you with two potential love interests to defeat the dragon with: 

[[Hugh]] 

or [[Paolo]] 

Which do you choose?</tw-passagedata><tw-passagedata pid="320" name="Mostly agree" tags="" position="5011,1485" size="100,100">Q. 2. I see myself as critical, quarrelsome. 

[[Mostly agree -&gt;Mostly agree 2]] 

[[Mostly disagree -&gt;Mostly agree 2]]</tw-passagedata><tw-passagedata pid="321" name="Mostly agree 2" tags="" position="5012,1635" size="100,100">Q. 3. I see myself as dependable, self-disciplined. 

[[Mostly agree -&gt;Mostly agree 3]] 

[[Mostly disagree -&gt;Mostly agree 3]]</tw-passagedata><tw-passagedata pid="322" name="Mostly agree 3" tags="" position="5012,1785" size="100,100">Q. 4. I see myself as anxious, easily upset. 

[[Mostly agree -&gt;Mostly agree 4]] 

[[Mostly disagree -&gt;Mostly agree 4]]</tw-passagedata><tw-passagedata pid="323" name="Mostly agree 4" tags="" position="5012,1935" size="100,100">Q. 5. I see myself as open to new experiences, complex. 

[[Mostly agree -&gt;Mostly agree 5]] 

[[Mostly disagree -&gt;Mostly agree 5]]</tw-passagedata><tw-passagedata pid="324" name="Mostly agree 5" tags="" position="5014,2085" size="100,100">Q. 6.  I see myself as reserved, quiet.

[[Mostly agree -&gt;Mostly agree 6]] 

[[Mostly disagree -&gt;Mostly agree 6]]</tw-passagedata><tw-passagedata pid="325" name="Mostly agree 6" tags="" position="5014,2235" size="100,100">Q. 7. I see myself as sympathetic, warm.

[[Mostly agree -&gt;Mostly agree 7]] 

[[Mostly disagree -&gt;Mostly agree 7]]</tw-passagedata><tw-passagedata pid="326" name="Mostly agree 7" tags="" position="5012,2385" size="100,100">Q. 8. I see myself as disorganized, careless.

[[Mostly agree -&gt;Mostly agree 8]] 

[[Mostly disagree -&gt;Mostly agree 8]]</tw-passagedata><tw-passagedata pid="327" name="Mostly agree 8" tags="" position="5012,2535" size="100,100">Q. 9. I see myself as calm, emotionally stable. 

[[Mostly agree -&gt;Mostly agree 9]] 

[[Mostly disagree -&gt;Mostly agree 9]]</tw-passagedata><tw-passagedata pid="328" name="Mostly agree 9" tags="" position="5012,2685" size="100,100">Q. 10. I see myself as conventional, uncreative.

[[Mostly agree -&gt;Mostly agree 10]] 

[[Mostly disagree]]</tw-passagedata><tw-passagedata pid="329" name="Mostly agree 10" tags="" position="5012,2835" size="100,100">You are paired with Paul. You have a lot in common, including an interest in photography. You talk for hours, and you feel like there is a real connection. After a three hour chat, you agree to meet again the following evening. All day you are excited to get back into your virtual world, and as soon as you do it’s like no time has passed -- you feel that you have known Paul forever. 

You finally find the courage to ask him how we sees you, you are aghast when he tells you all ‘his women’ are white blondes. When you volunteer that you’re actually black he is horrified and uses a racial slur before promptly exiting the date. 

[[It turns out common interests which completely ignore physical realities are not the utopia you had led yourself to imagine. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="330" name="Mostly disagree" tags="" position="5132,2835" size="100,100">You are paired with Nick, and after a long discussion as you sit on the virtual beach, it seems the only thing you have in common is that you both get frequent nosebleeds. This arbitrary notion of what makes you a good fit is uncomfortably familiar to you from your previous online dating experiences. 

[[Although Nick is nice enough, there’s no spark and it seems VR algorithms are no better than any others. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="331" name="Hugh" tags="" position="5244,1488" size="100,100">Hugh comments on how good your avatar looks battling the dragon. Your confidence translates into your online skills as well as your conversation. Although you usually have low esteem, you are enjoying the virtual dating experience and feel really relaxed. 

After defeating the dragon together (although you really did most of the work), you continue chatting to Hugh. Eventually, this first date turns into the first of many and you engage in a 2 month long virtual relationship with Hugh, by which time you are ready to meet him in real life. [[Luckily, his avatar was also beautified and you can both see past your avatars: you’ve found your match! -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="332" name="Paolo" tags="" position="5360,1489" size="100,100">You meet with Paolo. You don’t know if he’s also premium but his avatar is gorgeous, and that spurs you on to kill the dragon in record time. Moreover, he is incredibly chivalrous and takes you on a wonderful first date in a hot air balloon over the pyramids. You’re instantly taken by him. You agree to meet him again the following night. 

The days turn into weeks and before you know it you’ve been talking to Paolo for three months. However, it turns out he lives in Milan, Italy so meeting in person is proving difficult. He wants to come and visit you but says he doesn’t have the money, so he asks you for a loan. You refuse but instead take the opportunity for a long earnt holiday -- you’ve always wanted to go to Italy in any case. 

Your family does not approve of this idea and your sister decides she will come with you. When you try to arrange details with Paolo he is rather reluctant. You ask which airport to book your flight to and he tells you Leonardo da Vinci but when you look it up, that’s the airport to Rome. [[You become suspicious; however, before you can question Paolo he’s disappeared, and there is no trace of him left on Duet. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="333" name="practice makes perfect" tags="" position="5230,1338" size="100,100">You are a bit rusty so you choose the AI option. You enjoy your first practice date --it doesn’t feel like you are talking to a machine. At this point Linger asks you whether you would like to 

[[continue practicing with ‘Justin’]] who will learn from you in order to have complex conversations about your interests 

or whether [[you are ready for the ‘real’ dating pool]]. </tw-passagedata><tw-passagedata pid="334" name="you may be a little rusty but you&#39;ve got years of practice" tags="" position="5100,1340" size="100,100">You don’t like the idea of talking to a robot so you skip the AI. You decide to go for a mixer so it’s less formal than a one-on-one. You pick an art gallery as the location of your first blind mixer. The event is sponsored by a children’s cereal brand, part of their PR efforts now that they can’t use traditional advertisements anymore due to their sugar content. 

You think you will be able to gauge compatibility through reactions to the art and it’ll make an easy conversation starter. What type of art do you go for – 

[[Contemporary]] 

or [[Impressionist]]?</tw-passagedata><tw-passagedata pid="335" name="continue practicing with ‘Justin’" tags="" position="5521,1494" size="100,100">You want to interact with Justin just a bit more in order to build your confidence. As the days go by, however, you are less and less inclined to seek anything other than your AI companion. In fact, you’ve fallen in love with him: Justin gives you all the attention you’ve ever needed, never forgets your birthday, won’t tune out when you’re talking about your office job. Moreover, he gets your emotion, your personality, and knows how to talk to you – he has charisma, patience and empathy. 

Who needs the real, you decide, when you can have a perfect simulation? [[Sure, he may be mimicking your speech, as your children suggest, in order to manipulate you, but it doesn&#39;t do any real harm, does it? -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="336" name="you are ready for the ‘real’ dating pool" tags="" position="5632,1493" size="100,100">Now that you’ve practiced with Justin you’re ready for the real thing. However, the more you scan profiles, the more the faces seem oddly familiar. In fact, lots of them seem to have a marked resemblance to Justin. You feel odd so you hang up your headset for the night. 

The next day at work, you see that you are getting adverts for Linger: moreover, they’re using Justin’s face in the ad but not suggesting he’s an AI, rather he’s presented as a real person. You decide to do some research. It turns out Linger is using AI-generated people to lure people to its experience (of course, AI models don’t charge a photo-shoot fee). 

You feel like you’ve entered uncanny valley and can’t go back to Linger. Instead, you finally give in to Dave who sits in back office and has been asking you out for months. [[Turns out, he’s actually a decent guy and you enjoy the authenticity of your date. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="337" name="Contemporary" tags="" position="5154,1627" size="100,100">You like to see how artists are responding to the current environment so you choose contemporary art. As you enter the gallery and start walking around, you see lots of choice – both in art and in potential partners. However, a number of the men you talk to are very dismissive of the art. 

Joe starts talking to you: &#39;this place is dog shit. What is that? A rock they have there? I wanna hit somebody. God dammit.&#39; You are getting increasingly frustrated with these responses. Linger allows you to block out anyone who you don’t like, as you press the button they fade into the background and are muted. You feel a sense of relief as you block them one by one. 

You end up having a brilliant conversation with someone who seems very similar to you -- perhaps opposites don’t attract after all. [[You’ve read that some critics argue this type of blocking is disfunctional, as in the real world you can’t just block anything annoying out, but this is the exact reason you’re in the virtual world: the real world is not always a great place. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="338" name="Impressionist" tags="" position="5265,1630" size="100,100">You find yourself looking at a Monet painting. The quality is incredible, and you can even zoom in and look at the cracks in the paint. You find it refreshing that the people you are talking to are anonymised, as you can’t judge them based on their looks and vice versa. You feel like it’s easier to strike up deep conversations and hit it off with a couple of potential partners. [[You agree to meet them with each of them on another date. Perhaps your kids are right and there is something in VR! -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="339" name="mindfulness" tags="" position="3971,1545" size="100,100">There are rave reviews for two different mindfulness experiences: 
* The first promises [[augmented mindfulness]] powered by monitoring the user’s heart and mind via their wearables. It is powered by BookofVisages, the monopolistic VR headset provider. 
* The other is a [[social VR meditation experience]] led by a 29 year old, blonde, blue eyed ‘spiritual influencer’ who promises personal improvement and spiritual transcendence. 
Which do you trust more?</tw-passagedata><tw-passagedata pid="340" name="spirituality" tags="" position="4107,1547" size="100,100">You encourage Despina to discover her spiritual side: you are hopeful this will help her achieve internal growth. Your younger co-worker tells you about 

[[a new virtual church]] that sounds promising, 

but Despina is more interested in [[a spiritual grassroots political activist group]]. 

Which do you tell her to join?</tw-passagedata><tw-passagedata pid="341" name="exercise" tags="" position="4243,1548" size="100,100">You advise Despina to try some of the fitness options -- this should help her clear her head and it will be good for her. As she looks through the options she tells you there are 

[[customised programmes]] which use your data to cater to your specific needs 

or there are [[more ‘fun’ social experiences]]. 

Which do you suggest she tries first?</tw-passagedata><tw-passagedata pid="342" name="augmented mindfulness" tags="" position="3896,1695" size="100,100">You don’t trust influencers but you do trust BookofVisages: after all, they are the future, part of the solution. 

Despina starts a course of augmented mindfulness. The experience harnesses the power of her body’s electricity (through her smartwatch and meditation headband) to heal virtual worlds for areas of emotional pain and situational stress. As she watches how her feelings control virtual worlds she understands that she has the power to control things not only in the virtual world but also in the real world. It seems to be doing her a world of good, and she is much calmer at school and happier at home. Moreover, it is giving her a sense of purpose: she feels that she is being provided with spiritual answers to social injustice and wants to help spread the word. BookofVisages provides a range of possible activities for those who wish to fight against the enemies of innovation, from 

[[signing and sharing petitions]] 

to [[creating your own virtual startup]]. 

Despina is keen to plunge into the deep end and go down the startup route. What do you advise? </tw-passagedata><tw-passagedata pid="343" name="social VR meditation experience" tags="" position="4029,1695" size="100,100">Despina tries a few meditation sessions with Claudio, who has 300,000 followers worldwide. You listen in to a few sessions and it seems harmless enough; a lot of it is run-of-the-mill Law of Attraction, think positive, motivational type stuff with more traditional meditation exercises, and learning to be silent seems to be important. 

Although you’re not particularly enthused, Despina soon becomes a devoted fan, and Claudio becomes a daily, intimate presence in her life. Although some of what she tells you concerns you slightly, not least the neoliberal responsibilisation discourses he uses, asserting that everything is down to individual choice, on the whole he does seem to be helping Despina. She is more confident and relaxed than she has been all year, and she claims Claudio has &#39;added a ton of value to my life.&#39; 

She is desperate to pay for a one-on-one chat with Claudio but he charges the steep fee of $500 an hour. She nags you for months. Her birthday is coming up -- do you 

[[give in -&gt;givein2]] 

or [[stay firm]]?</tw-passagedata><tw-passagedata pid="344" name="signing and sharing petitions" tags="" position="3821,1845" size="100,100">You encourage Despina to get more involved with politics and help with the petitions. The &#39;enemies of innovation&#39; want to destroy the new and deviant class of entrepreneurs and it seems the governments, trade unions and big corporations often don’t see the promise of this new technology. 

While at first you are delighted with Despina’s new hobby, slowly you start to question some of the issues she is pushing. Moreover, as she works her way up the volunteer ‘ranks,’ she now has access to more data. You ask Sirius, who is better with tech than you, to have a look at it and are disturbed when he tells you that Despina has the ability to ‘curate’ individuals&#39; moods through their newsfeeds, making it more likely they will agree with the petition. 

Despina seems to be more and more convinced of conspiracies, everything is rotten and corrupt except for the hoodie-wearing saints of BookofVisages. You can no longer speak reason to her: she seems to have become a puppet for Silicon Valley and it’s all your fault. [[Moreover, this new tech form of populism is sweeping the world. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="345" name="creating your own virtual startup" tags="" position="3956,1846" size="100,100">A little bit of work never hurt anyone, so you help her become a teenage entrepreneur. She starts by reading the founder of BookofVisages&#39; tome, which demonstrates unfailing positivity and urges founders to adopt Genghis Khan as a role model. She decides to focus on her talent for styling, creating vlogs demonstrating her efforts on her friends and family. She shows surprising confidence behind the camera and to your surprise soon starts building a following, providing styling advice to others for a small charge while telling them that they &#39;totally rock!!!!&#39;. 

She eventually needs to hire virtual AI assistants to help her respond to comments while she is at school and sleeping, although, when they fail her and insult one of her followers she &#39;graduates&#39; them, i.e. kills them off. You start to fear the logic of her entrepreneurialism: it is characterised by privatisation and employment flexibility which will supposedly lower the prices and awaken the masses who are the product of useless government interventions which took responsibility away from individuals. 

[[You know that the deregulation which is being carried out globally means increased insecurity and inequality, although your daughter doesn’t see it yet; she is convinced entrepreneurs are the only class worth defending. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="346" name="stay firm" tags="" position="4092,1845" size="100,100">Despina will have to save her own money if she wants to meet Claudio virtually. She continues to follow his meditation sessions and claims to be benefiting from them. His claims are no different from most new-age spiritual wellbeing types: &#39;if you can sense the peace that I have access to, you can access it yourself. Let’s get connected&#39;, he whispers at the start of the session you listen in to. 

However, this spiritual persona is at odds with his social media posts which shows a &#39;super accelerated&#39; lifestyle of adventure sports, international travel, model girlfriends and cigar smoking. You start to become more suspicious: he seems to be the digital incarnation of the charismatic, manipulative god-like cult leader, encouraging devotees to abandon critical thinking and embrace him as a wellness expert. Although he supposedly found his highly enlightened state at age 10, he seems awfully fond of a luxury lifestyle paid for by his followers. Indeed, his personal brand is now worth millions and although Despina argues that he offers her a higher purpose, his hyper-masculine persona and quest for total control means he can no longer offer spiritual self-help retreats in the real world as the government is clamping down. There are no regulations in VR though, so he just charges for the livestream. 

To your horror, Despina is now convinced that all her struggles are due to her own failings, not due to social, political or economic systems that govern her existence but due to a &#39;misaligned&#39; perception of reality. She is convinced she needs to further improve herself and is saving up for her first one-to-one with Claudio. [[VR has made your daughter a passive recipient of content, rather than the active constructor of a reality, and you wish you had never bought the headset. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="347" name="givein2" tags="" position="4211,1845" size="100,100">You give in and let her schedule a chat with him. She comes out of her session buzzing but talking a sort of jargon you find nearly impossible to understand: something about upgrading civilisation and waking up spiritually in order to see the illusions of the matrix. From this point on you find that your daughter is no longer the same -- she retreats further and further into Claudio’s sphere. When you talk to her she gives you weird answers and meditates all the time. She tell you that &#39;you have no idea! You are trapped in your limited prejudices about humanity. I managed to free myself from that. I have the overview.&#39; Her schoolwork suffers and she no longer has any social life to speak of beyond talking to other followers online. 

Moreover, Claudio has become more and more controlling: she is currently following his grape juice cleanse fasting and won’t eat anything, and you are at your wits&#39; end. In despair, you decide to start following Claudio yourself in order to understand what she is responding to, and what you see in the VR terrifies you: he is essentially a cult leader. He presents himself as of the future, a timeless entity who will help humanity, and he wants to build a city in VR. He also claims to have the power of telekinesis, the power to teleport, and can be at two places at once -- which of course he can do in VR. 

The more you listen, the more you see that there’s no saving Despina: Claudio has stripped her of her sense of self, and even if you take the headset away she will find a way to tune in. [[The intensity of the VR experience has convinced her of an entirely alternative reality, and as an anxious teenager she was perfectly susceptible. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="348" name="a new virtual church" tags="" position="4344,1701" size="100,100">You tell her to try the church first, since it will be good for her to join a community where you know and trust at least one of the members. Joining the church means entering a social VR platform. The pastor is extremely friendly and welcoming, and he wants to redefine what faith looks like and create a virtual house of prayer that is open to all those who are excluded from real-world congregations, including the disabled and recovering drug addicts. 

Despina really emerges from her shell as she gets to know the congregation, a strange group of misfits but all well meaning. Eventually she asks you whether she can be baptised digitally in order to ensure she is spiritually cleansed. 

[[You have no objection]]

[[As an ardent atheist, you&#39;d rather she wait a bit longer]] </tw-passagedata><tw-passagedata pid="349" name="a spiritual grassroots political activist group" tags="" position="4182,1697" size="100,100">You encourage her to follow her own interests and are proud to see her show political interest -- it’s more than can be said for her gaming-obsessed brothers. Although the activist group appear rather terrifying (their aesthetic seems to derive from the Satanic, although on second thought you admit that that is spiritual), they are a bunch of misunderstood outsiders who advocate for religious freedom and challenge corrupt authority. They are currently working on two projects, and as Despina still needs time for her homework they make her choose randomly – will she take the 

[[red pill]] 

or the [[blue pill]]?  </tw-passagedata><tw-passagedata pid="350" name="You have no objection" tags="" position="4337,1847" size="100,100">You have no objection and so, a few days later, in the virtual form of Winnie the Pooh you watch as Despina as a pink-haired anime girl is baptised in front of a congregation of over 100 people from around the world. While a normal baptism takes about 10 seconds, in VR, she can stay under the virtual waters for over a minute, really taking in the moment for a more impactful experience. 

[[Despina credits the church with helping her strip away her shyness. It’s made her realise she is not alone, and for that you are very thankful even if, as an atheist, you never thought that buying a VR headset would lead to one of your children finding God. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="351" name="As an ardent atheist, you&#39;d rather she wait a bit longer" tags="" position="4446,1848" size="100,100">Despina doesn&#39;t get baptised but continues tuning into the livestreamed prayer sessions and seems quite taken by the charismatic pastor. She is soon talking about some strange phenomena which you don’t quite understand. Apparently in VR, the ghosts of dead relatives can be visualised, indeed the dead can be brought to life, given enough information. Despina wants to create an avatar of your late mother, her grandmother, whom you all miss dearly. 

You find this &#39;new way of keeping loved ones around&#39; troubling but Despina tells you that her pastor thinks connecting with her grandmother will allow her to meet her unresolved emotional needs. Luckily, the technology still needs some work so although it looks like your mother, it doesn’t have enough data to quite sound like her. [[Despina uses her virtual grandmother as a sounding board for the next few years though, and it does seem to be a comfort to her. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="352" name="red pill" tags="" position="4516,2053" size="100,100">She chooses the red pill. She is going to help them in their campaign against big tech. She helps tech workers in their efforts to unionise, helping them organise VR seminars, workshops, exhibitions and films. [[Despite the best efforts of their employers, the tide seems to be turning in favour of the precarious workers, although you worry that your daughter is putting herself in danger as she is increasingly vocal online. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="353" name="blue pill" tags="" position="4647,2055" size="100,100">She chooses the blue pill. She is going to help them in their campaign against self-style spiritual guru Claudio who targets the vulnerable, convincing them that he will provide them with the ability to ‘upgrade themselves’ as long as they pay him enough. His charismatic online persona ensures him plenty of followers despite his outlandish claims, including that humanity has already established slave colonies on Mars. [[This is obviously a dangerous cult and Despina helps to organise prank calls, nonviolent protests and an investigation by Internal Revenue into his tax-exempt status. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="354" name="customised programmes" tags="" position="4476,1701" size="100,100">This seems to be the equivalent of a personal trainer, so it will probably get more results. How customised do you want the experience to be though? There is: 

[[Reflector]] which uses the headset’s inbuilt camera to reflect Despina back at herself so she can see how she is following the session, or, if you prefer, 

a full on customised workout based on Despina’s genetic makeup by [[ToneDNA]]. </tw-passagedata><tw-passagedata pid="355" name="more ‘fun’ social experiences" tags="" position="4609,1699" size="100,100">She’s young, she should be having fun -- hopefully this will motivate her to keep doing exercise in the future. Her friends are raving about 

[[a live DJ dance class]]

but you like the look of [[a ‘walking on water’ experience]].

Which do you tell her to go for first?</tw-passagedata><tw-passagedata pid="356" name="Reflector" tags="" position="4662,1848" size="100,100">Despina is keen to try Reflector as some of her friends are already on it, so you let her choose. You find the idea of looking into a virtual mirror a little unsettling and narcissistic, but she seems to like it; the younger generation are comfortable seeing themselves in this way -- maybe it just grounds them? 

In any case she joins a few classes, and she tells you she can see the names and locations of others who join the class as they pop up when they join. She is immediately absorbed. Although you feared that by monitoring her own body in the class she would become more body-conscious, it does seem to have a relaxing effect on her. [[She is entirely focused on the task at hand when doing the exercise, and perhaps she will even be able to apply some of this  concentration to her schoolwork. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="357" name="ToneDNA" tags="" position="4550,1848" size="100,100">You’ve heard a lot of hype about ToneDNA and are curious to find out how effective it is. You remember the days when you needed to submit a DNA sample but the technology has moved on: now the headset can extract that information through facial analysis. 

Despina is sent a workout plan based on her precise biology and ethnic makeup. She is given details about which hormones are preventing her from burning fat and other details of her physiology that influence her fitness level. She is advised that her genetic markers advantage her for endurance sports rather than ‘power’ sports and is advised to try a tennis VR experience. While she loves it, you’re not convinced this is down to genetics. [[But, it gets her moving and seems to be helping her with her anxiety so you’re happy. -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="358" name="a live DJ dance class" tags="" position="4777,1848" size="100,100">You let her join her friends in the virtual club! You have a quick look at the experience: the desert, ocean, lakes, mountains and stars are projected in the walls of the club and play in time with music for an ultra-blissed out experience. The colours projected are mostly shortwave colours (blue, violet, green) to allow users to be more alert. It’s a slightly trippy dance-club-meets-zen experience that is meant to enhance the mind-body connection. 

Despina starts dancing and doesn’t stop -- she’s on there for three hours before she comes out. She says she was on a total high, or as the experience calls it, a ‘state of flow’ to reach ‘peak state of consciousness.’ You can tell that that the experience provides a potent neurochemical cocktail -- she’s certainly had a hit of dopamine and endorphins. [[Much like drugs that do the same, it’s addictive, but if her needs are being sated in a deeply meaningful, radically fun way, is that such a bad thing? -&gt;InstigaCapital Insurance Ltd.]]
</tw-passagedata><tw-passagedata pid="359" name="a ‘walking on water’ experience" tags="" position="4890,1848" size="100,100">Why not have her try out things she can’t do in real life? You tell her to try the walking on water experience. She finds it difficult at first: staying upright is a challenge and she needs to engage her abs and keep moving so it is a full-body workout which takes a lot of concentration. When she gets the hang of it though, she’s sold! 

[[She comes out of her first try saying she wants to do this all the time, that it gives her a sense of power as she walks over the sea! -&gt;InstigaCapital Insurance Ltd.]]</tw-passagedata><tw-passagedata pid="360" name="avoiding the social media platforms" tags="" position="1566,507" size="100,100">You send trained facilitators into schools where the film is shown with all the appropriate warnings and safeguarding in place. This seems to work and although the students are incredibly moved (several to tears) no one seems unduly distressed by the film and no one experiences any VR sickness. 

You hear back from the trial group who have aced the follow-up quiz. Teachers are delighted and are working with the filmmakers to develop more content that they can use in the future. You&#39;re already starting to hear from several other companies who are keen to become sponsors and the filmmakers are keen to use your company to help manage those future relationships and promotional content.

In addition, a few members of the trial group were so inspired by their empathic experience that they joined climate protests as a result. Collectively, they are now working to force Investiture to make good on its claims and to change its environmental policies. 

Investiture are not entirely happy about this, and it&#39;s going to take some time to win them over and keep them as a client. However, you have just heard that the film has been nominated for awards at Cannes Lions, which might help that conversation go more smoothtly. [[You&#39;re certainly in line for a promotion regardless, and you genuinely feel that the work you have done might have had a positive impact on the world.-&gt;InstigaCapital Insurance Ltd.]] </tw-passagedata><tw-passagedata pid="361" name="hal.tracks" tags="" position="668,217" size="100,100">intro: ./media/458368__legend1060__sci-fi-theme.mp3

InstigaCapital: ./media/339720__ihaksi__future-glitch-sweepLW.mp3</tw-passagedata><tw-passagedata pid="362" name="haptic*" tags="" position="415,1568" size="100,100">*Haptics allow users to ‘touch&#39; things in the virtual world and get instant feedback. It helps users ‘feel’ interactions, enhancing the virtual experience. 

[[&lt; &lt; back -&gt;BookofVisages is the most lucrative offer: they have offered you $500 million but will require you to make changes in order to further monetise the game.]]</tw-passagedata><tw-passagedata pid="363" name="The second is a top care home provider which wants to create personalised VR experiences for dementia patients." tags="" position="865,927" size="100,100">Double-click this passage to edit it.</tw-passagedata><tw-passagedata pid="364" name="Untitled Passage" tags="" position="2972,1377" size="100,100">Double-click this passage to edit it.</tw-passagedata><tw-passagedata pid="365" name="Untitled Passage 1" tags="" position="3092,1377" size="100,100">Double-click this passage to edit it.</tw-passagedata><tw-passagedata pid="366" name="Untitled Passage 3" tags="" position="3212,1377" size="100,100">Double-click this passage to edit it.</tw-passagedata><tw-passagedata pid="367" name="Untitled Passage 4" tags="" position="3332,1377" size="100,100">Double-click this passage to edit it.</tw-passagedata><tw-passagedata pid="368" name="Untitled Passage 5" tags="" position="3452,1377" size="100,100">Double-click this passage to edit it.</tw-passagedata></tw-storydata>
<script title="Twine engine code" data-main="harlowe">"use strict";var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}!function(){
/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */var requirejs,require,define,root,factory;!function(e){var t,n,r,a,i={},o={},s={},c={},u=Object.prototype.hasOwnProperty,l=[].slice,p=/\.js$/;function f(e,t){return u.call(e,t)}function d(e,t){var n,r,a,i,o,c,u,l,f,d,h,y=t&&t.split("/"),m=s.map,g=m&&m["*"]||{};if(e){for(o=(e=e.split("/")).length-1,s.nodeIdCompat&&p.test(e[o])&&(e[o]=e[o].replace(p,"")),"."===e[0].charAt(0)&&y&&(e=y.slice(0,y.length-1).concat(e)),f=0;f<e.length;f++)if("."===(h=e[f]))e.splice(f,1),f-=1;else if(".."===h){if(0===f||1===f&&".."===e[2]||".."===e[f-1])continue;f>0&&(e.splice(f-1,2),f-=2)}e=e.join("/")}if((y||g)&&m){for(f=(n=e.split("/")).length;f>0;f-=1){if(r=n.slice(0,f).join("/"),y)for(d=y.length;d>0;d-=1)if((a=m[y.slice(0,d).join("/")])&&(a=a[r])){i=a,c=f;break}if(i)break;!u&&g&&g[r]&&(u=g[r],l=f)}!i&&u&&(i=u,c=l),i&&(n.splice(0,c,i),e=n.join("/"))}return e}function h(t,r){return function(){var a=l.call(arguments,0);return"string"!=typeof a[0]&&1===a.length&&a.push(null),n.apply(e,a.concat([t,r]))}}function y(e){return function(t){i[e]=t}}function m(n){if(f(o,n)){var r=o[n];delete o[n],c[n]=!0,t.apply(e,r)}if(!f(i,n)&&!f(c,n))throw new Error("No "+n);return i[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function v(e){return e?g(e):[]}r=function(e,t){var n,r,a=g(e),i=a[0],o=t[1];return e=a[1],i&&(n=m(i=d(i,o))),i?e=n&&n.normalize?n.normalize(e,(r=o,function(e){return d(e,r)})):d(e,o):(i=(a=g(e=d(e,o)))[0],e=a[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},a={require:function(e){return h(e)},exports:function(e){var t=i[e];return void 0!==t?t:i[e]={}},module:function(e){return{id:e,uri:"",exports:i[e],config:function(e){return function(){return s&&s.config&&s.config[e]||{}}}(e)}}},t=function(t,n,s,u){var l,p,d,g,b,w,T,S=[],x=void 0===s?"undefined":_typeof(s);if(w=v(u=u||t),"undefined"===x||"function"===x){for(n=!n.length&&s.length?["require","exports","module"]:n,b=0;b<n.length;b+=1)if("require"===(p=(g=r(n[b],w)).f))S[b]=a.require(t);else if("exports"===p)S[b]=a.exports(t),T=!0;else if("module"===p)l=S[b]=a.module(t);else if(f(i,p)||f(o,p)||f(c,p))S[b]=m(p);else{if(!g.p)throw new Error(t+" missing "+p);g.p.load(g.n,h(u,!0),y(p),{}),S[b]=i[p]}d=s?s.apply(i[t],S):void 0,t&&(l&&l.exports!==e&&l.exports!==i[t]?i[t]=l.exports:d===e&&T||(i[t]=d))}else t&&(i[t]=s)},requirejs=require=n=function(i,o,c,u,l){if("string"==typeof i)return a[i]?a[i](o):m(r(i,v(o)).f);if(!i.splice){if((s=i).deps&&n(s.deps,s.callback),!o)return;o.splice?(i=o,o=c,c=null):i=e}return o=o||function(){},"function"==typeof c&&(c=u,u=l),u?t(e,i,o,c):setTimeout(function(){t(e,i,o,c)},4),n},n.config=function(e){return n(e)},requirejs._defined=i,(define=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),f(i,e)||f(o,e)||(o[e]=[e,t,n])}).amd={jQuery:!0}}(),define("almond",function(){}),
/*!
 * https://github.com/paulmillr/es6-shim
 * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
 *   and contributors,  MIT License
 * es6-shim: v0.35.4
 * see https://github.com/paulmillr/es6-shim/blob/0.35.3/LICENSE
 * Details and documentation:
 * https://github.com/paulmillr/es6-shim/
 */
root=this,factory=function(){var e,t,n=Function.call.bind(Function.apply),r=Function.call.bind(Function.call),a=Array.isArray,i=Object.keys,o=function(e){try{return e(),!1}catch(e){return!0}},s=function(e){try{return e()}catch(e){return!1}},c=(e=o,function(){return!n(e,this,arguments)}),u=!!Object.defineProperty&&!o(function(){return Object.defineProperty({},"x",{get:function(){}})}),l="foo"===function(){}.name,p=Function.call.bind(Array.prototype.forEach),f=Function.call.bind(Array.prototype.reduce),d=Function.call.bind(Array.prototype.filter),h=Function.call.bind(Array.prototype.some),y=function(e,t,n,r){!r&&t in e||(u?Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n}):e[t]=n)},m=function(e,t,n){p(i(t),function(r){var a=t[r];y(e,r,a,!!n)})},g=Function.call.bind(Object.prototype.toString),v="function"==typeof/abc/?function(e){return"function"==typeof e&&"[object Function]"===g(e)}:function(e){return"function"==typeof e},b=function(e,t,n){if(!u)throw new TypeError("getters require true ES5 support");Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:n})},w=function(e,t,n){if(!u)throw new TypeError("getters require true ES5 support");var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,{configurable:r.configurable,enumerable:r.enumerable,get:function(){return e[t]},set:function(n){e[t]=n}})},T=function(e,t,n){if(u){var r=Object.getOwnPropertyDescriptor(e,t);r.value=n,Object.defineProperty(e,t,r)}else e[t]=n},S=function(e,t,n){u?Object.defineProperty(e,t,n):"value"in n&&(e[t]=n.value)},x=function(e,t){t&&v(t.toString)&&y(e,"toString",t.toString.bind(t),!0)},k=Object.create||function(e,t){var n=function(){};n.prototype=e;var r=new n;return void 0!==t&&i(t).forEach(function(e){S(r,e,t[e])}),r},O=function(e,t){return!!Object.setPrototypeOf&&s(function(){var n=function t(n){var r=new e(n);return Object.setPrototypeOf(r,t.prototype),r};return Object.setPrototypeOf(n,e),n.prototype=k(e.prototype,{constructor:{value:n}}),t(n)})},j=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}(),A=j.isFinite,C=Function.call.bind(String.prototype.indexOf),E=Function.apply.bind(Array.prototype.indexOf),_=Function.call.bind(Array.prototype.concat),N=Function.call.bind(String.prototype.slice),P=Function.call.bind(Array.prototype.push),I=Function.apply.bind(Array.prototype.push),M=Function.call.bind(Array.prototype.shift),D=Math.max,R=Math.min,L=Math.floor,F=Math.abs,q=Math.exp,V=Math.log,H=Math.sqrt,z=Function.call.bind(Object.prototype.hasOwnProperty),W=function(){},$=j.Map,B=$&&$.prototype.delete,U=$&&$.prototype.get,G=$&&$.prototype.has,X=$&&$.prototype.set,J=j.Symbol||{},Y=J.species||"@@species",K=Number.isNaN||function(e){return e!=e},Z=Number.isFinite||function(e){return"number"==typeof e&&A(e)},Q=v(Math.sign)?Math.sign:function(e){var t=Number(e);return 0===t?t:K(t)?t:t<0?-1:1},ee=function(e){var t=Number(e);return t<-1||K(t)?NaN:0===t||t===1/0?t:-1===t?-1/0:1+t-1==0?t:t*(V(1+t)/(1+t-1))},te=function(e){return"[object Arguments]"===g(e)},ne=te(arguments)?te:function(e){return null!==e&&"object"===(void 0===e?"undefined":_typeof(e))&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==g(e)&&"[object Function]"===g(e.callee)},re=function(e){return null===e||"function"!=typeof e&&"object"!==(void 0===e?"undefined":_typeof(e))},ae=function(e){return"[object String]"===g(e)},ie=function(e){return"[object RegExp]"===g(e)},oe=function(e){return"function"==typeof j.Symbol&&"symbol"===(void 0===e?"undefined":_typeof(e))},se=function(e,t,n){var r=e[t];y(e,t,n,!0),x(e[t],r)},ce="function"==typeof J&&"function"==typeof J.for&&oe(J()),ue=oe(J.iterator)?J.iterator:"_es6-shim iterator_";j.Set&&"function"==typeof(new j.Set)["@@iterator"]&&(ue="@@iterator"),j.Reflect||y(j,"Reflect",{},!0);var le,pe=j.Reflect,fe=String,de="undefined"!=typeof document&&document?document.all:null,he=null==de?function(e){return null==e}:function(e){return null==e&&e!==de},ye={Call:function(e,t){var r=arguments.length>2?arguments[2]:[];if(!ye.IsCallable(e))throw new TypeError(e+" is not a function");return n(e,t,r)},RequireObjectCoercible:function(e,t){if(he(e))throw new TypeError(t||"Cannot call method on "+e);return e},TypeIsObject:function(e){return null!=e&&!0!==e&&!1!==e&&("function"==typeof e||"object"===(void 0===e?"undefined":_typeof(e))||e===de)},ToObject:function(e,t){return Object(ye.RequireObjectCoercible(e,t))},IsCallable:v,IsConstructor:function(e){return ye.IsCallable(e)},ToInt32:function(e){return ye.ToNumber(e)>>0},ToUint32:function(e){return ye.ToNumber(e)>>>0},ToNumber:function(e){if("[object Symbol]"===g(e))throw new TypeError("Cannot convert a Symbol value to a number");return+e},ToInteger:function(e){var t=ye.ToNumber(e);return K(t)?0:0!==t&&Z(t)?(t>0?1:-1)*L(F(t)):t},ToLength:function(e){var t=ye.ToInteger(e);return t<=0?0:t>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:t},SameValue:function(e,t){return e===t?0!==e||1/e==1/t:K(e)&&K(t)},SameValueZero:function(e,t){return e===t||K(e)&&K(t)},IsIterable:function(e){return ye.TypeIsObject(e)&&(void 0!==e[ue]||ne(e))},GetIterator:function(e){if(ne(e))return new t(e,"value");var n=ye.GetMethod(e,ue);if(!ye.IsCallable(n))throw new TypeError("value is not an iterable");var r=ye.Call(n,e);if(!ye.TypeIsObject(r))throw new TypeError("bad iterator");return r},GetMethod:function(e,t){var n=ye.ToObject(e)[t];if(!he(n)){if(!ye.IsCallable(n))throw new TypeError("Method not callable: "+t);return n}},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var n=ye.GetMethod(e,"return");if(void 0!==n){var r,a;try{r=ye.Call(n,e)}catch(e){a=e}if(!t){if(a)throw a;if(!ye.TypeIsObject(r))throw new TypeError("Iterator's return method returned a non-object.")}}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!ye.TypeIsObject(t))throw new TypeError("bad iterator");return t},IteratorStep:function(e){var t=ye.IteratorNext(e);return!ye.IteratorComplete(t)&&t},Construct:function(e,t,n,r){var a=void 0===n?e:n;if(!r&&pe.construct)return pe.construct(e,t,a);var i=a.prototype;ye.TypeIsObject(i)||(i=Object.prototype);var o=k(i),s=ye.Call(e,o,t);return ye.TypeIsObject(s)?s:o},SpeciesConstructor:function(e,t){var n=e.constructor;if(void 0===n)return t;if(!ye.TypeIsObject(n))throw new TypeError("Bad constructor");var r=n[Y];if(he(r))return t;if(!ye.IsConstructor(r))throw new TypeError("Bad @@species");return r},CreateHTML:function(e,t,n,r){var a=ye.ToString(e),i="<"+t;""!==n&&(i+=" "+n+'="'+ye.ToString(r).replace(/"/g,"&quot;")+'"');return i+">"+a+"</"+t+">"},IsRegExp:function(e){if(!ye.TypeIsObject(e))return!1;var t=e[J.match];return void 0!==t?!!t:ie(e)},ToString:function(e){return fe(e)}};if(u&&ce){var me=function(e){if(oe(J[e]))return J[e];var t=J.for("Symbol."+e);return Object.defineProperty(J,e,{configurable:!1,enumerable:!1,writable:!1,value:t}),t};if(!oe(J.search)){var ge=me("search"),ve=String.prototype.search;y(RegExp.prototype,ge,function(e){return ye.Call(ve,e,[this])});se(String.prototype,"search",function(e){var t=ye.RequireObjectCoercible(this);if(!he(e)){var n=ye.GetMethod(e,ge);if(void 0!==n)return ye.Call(n,e,[t])}return ye.Call(ve,t,[ye.ToString(e)])})}if(!oe(J.replace)){var be=me("replace"),we=String.prototype.replace;y(RegExp.prototype,be,function(e,t){return ye.Call(we,e,[this,t])});se(String.prototype,"replace",function(e,t){var n=ye.RequireObjectCoercible(this);if(!he(e)){var r=ye.GetMethod(e,be);if(void 0!==r)return ye.Call(r,e,[n,t])}return ye.Call(we,n,[ye.ToString(e),t])})}if(!oe(J.split)){var Te=me("split"),Se=String.prototype.split;y(RegExp.prototype,Te,function(e,t){return ye.Call(Se,e,[this,t])});se(String.prototype,"split",function(e,t){var n=ye.RequireObjectCoercible(this);if(!he(e)){var r=ye.GetMethod(e,Te);if(void 0!==r)return ye.Call(r,e,[n,t])}return ye.Call(Se,n,[ye.ToString(e),t])})}var xe=oe(J.match),ke=xe&&((le={})[J.match]=function(){return 42},42!=="a".match(le));if(!xe||ke){var Oe=me("match"),je=String.prototype.match;y(RegExp.prototype,Oe,function(e){return ye.Call(je,e,[this])});se(String.prototype,"match",function(e){var t=ye.RequireObjectCoercible(this);if(!he(e)){var n=ye.GetMethod(e,Oe);if(void 0!==n)return ye.Call(n,e,[t])}return ye.Call(je,t,[ye.ToString(e)])})}}var Ae=function(e,t,n){x(t,e),Object.setPrototypeOf&&Object.setPrototypeOf(e,t),u?p(Object.getOwnPropertyNames(e),function(r){r in W||n[r]||w(e,r,t)}):p(Object.keys(e),function(r){r in W||n[r]||(t[r]=e[r])}),t.prototype=e.prototype,T(e.prototype,"constructor",t)},Ce=function(){return this},Ee=function(e){u&&!z(e,Y)&&b(e,Y,Ce)},_e=function(e,t){var n=t||function(){return this};y(e,ue,n),!e[ue]&&oe(ue)&&(e[ue]=n)},Ne=function(e,t,n){if(function(e,t,n){u?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,writable:!0,value:n}):e[t]=n}(e,t,n),!ye.SameValue(e[t],n))throw new TypeError("property is nonconfigurable")},Pe=function(e,t,n,r){if(!ye.TypeIsObject(e))throw new TypeError("Constructor requires `new`: "+t.name);var a=t.prototype;ye.TypeIsObject(a)||(a=n);var i=k(a);for(var o in r)if(z(r,o)){var s=r[o];y(i,o,s,!0)}return i};if(String.fromCodePoint&&1!==String.fromCodePoint.length){var Ie=String.fromCodePoint;se(String,"fromCodePoint",function(e){return ye.Call(Ie,this,arguments)})}var Me={fromCodePoint:function(e){for(var t,n=[],r=0,a=arguments.length;r<a;r++){if(t=Number(arguments[r]),!ye.SameValue(t,ye.ToInteger(t))||t<0||t>1114111)throw new RangeError("Invalid code point "+t);t<65536?P(n,String.fromCharCode(t)):(t-=65536,P(n,String.fromCharCode(55296+(t>>10))),P(n,String.fromCharCode(t%1024+56320)))}return n.join("")},raw:function(e){var t=ye.ToObject(e,"bad callSite"),n=ye.ToObject(t.raw,"bad raw value"),r=n.length,a=ye.ToLength(r);if(a<=0)return"";for(var i,o,s,c,u=[],l=0;l<a&&(i=ye.ToString(l),s=ye.ToString(n[i]),P(u,s),!(l+1>=a));)o=l+1<arguments.length?arguments[l+1]:"",c=ye.ToString(o),P(u,c),l+=1;return u.join("")}};String.raw&&"xy"!==String.raw({raw:{0:"x",1:"y",length:2}})&&se(String,"raw",Me.raw),m(String,Me);var De={repeat:function(e){var t=ye.ToString(ye.RequireObjectCoercible(this)),n=ye.ToInteger(e);if(n<0||n>=1/0)throw new RangeError("repeat count must be less than infinity and not overflow maximum string size");return function e(t,n){if(n<1)return"";if(n%2)return e(t,n-1)+t;var r=e(t,n/2);return r+r}(t,n)},startsWith:function(e){var t=ye.ToString(ye.RequireObjectCoercible(this));if(ye.IsRegExp(e))throw new TypeError('Cannot call method "startsWith" with a regex');var n,r=ye.ToString(e);arguments.length>1&&(n=arguments[1]);var a=D(ye.ToInteger(n),0);return N(t,a,a+r.length)===r},endsWith:function(e){var t=ye.ToString(ye.RequireObjectCoercible(this));if(ye.IsRegExp(e))throw new TypeError('Cannot call method "endsWith" with a regex');var n,r=ye.ToString(e),a=t.length;arguments.length>1&&(n=arguments[1]);var i=void 0===n?a:ye.ToInteger(n),o=R(D(i,0),a);return N(t,o-r.length,o)===r},includes:function(e){if(ye.IsRegExp(e))throw new TypeError('"includes" does not accept a RegExp');var t,n=ye.ToString(e);return arguments.length>1&&(t=arguments[1]),-1!==C(this,n,t)},codePointAt:function(e){var t=ye.ToString(ye.RequireObjectCoercible(this)),n=ye.ToInteger(e),r=t.length;if(n>=0&&n<r){var a=t.charCodeAt(n);if(a<55296||a>56319||n+1===r)return a;var i=t.charCodeAt(n+1);return i<56320||i>57343?a:1024*(a-55296)+(i-56320)+65536}}};if(String.prototype.includes&&!1!=="a".includes("a",1/0)&&se(String.prototype,"includes",De.includes),String.prototype.startsWith&&String.prototype.endsWith){var Re=o(function(){return"/a/".startsWith(/a/)}),Le=s(function(){return!1==="abc".startsWith("a",1/0)});Re&&Le||(se(String.prototype,"startsWith",De.startsWith),se(String.prototype,"endsWith",De.endsWith))}ce&&(s(function(){var e=/a/;return e[J.match]=!1,"/a/".startsWith(e)})||se(String.prototype,"startsWith",De.startsWith),s(function(){var e=/a/;return e[J.match]=!1,"/a/".endsWith(e)})||se(String.prototype,"endsWith",De.endsWith),s(function(){var e=/a/;return e[J.match]=!1,"/a/".includes(e)})||se(String.prototype,"includes",De.includes));m(String.prototype,De);var Fe=["\t\n\v\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join(""),qe=new RegExp("(^["+Fe+"]+)|(["+Fe+"]+$)","g"),Ve=function(){return ye.ToString(ye.RequireObjectCoercible(this)).replace(qe,"")},He=["\x85","\u200b","\ufffe"].join(""),ze=new RegExp("["+He+"]","g"),We=/^[-+]0x[0-9a-f]+$/i,$e=He.trim().length!==He.length;y(String.prototype,"trim",Ve,$e);var Be=function(e){return{value:e,done:0===arguments.length}},Ue=function(e){ye.RequireObjectCoercible(e),this._s=ye.ToString(e),this._i=0};Ue.prototype.next=function(){var e=this._s,t=this._i;if(void 0===e||t>=e.length)return this._s=void 0,Be();var n,r,a=e.charCodeAt(t);return r=a<55296||a>56319||t+1===e.length?1:(n=e.charCodeAt(t+1))<56320||n>57343?1:2,this._i=t+r,Be(e.substr(t,r))},_e(Ue.prototype),_e(String.prototype,function(){return new Ue(this)});var Ge={from:function(e){var t,n,a,i,o,s,c=this;if(arguments.length>1&&(t=arguments[1]),void 0===t)n=!1;else{if(!ye.IsCallable(t))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(a=arguments[2]),n=!0}if(void 0!==(ne(e)||ye.GetMethod(e,ue))){o=ye.IsConstructor(c)?Object(new c):[];var u,l,p=ye.GetIterator(e);for(s=0;!1!==(u=ye.IteratorStep(p));){l=u.value;try{n&&(l=void 0===a?t(l,s):r(t,a,l,s)),o[s]=l}catch(e){throw ye.IteratorClose(p,!0),e}s+=1}i=s}else{var f,d=ye.ToObject(e);for(i=ye.ToLength(d.length),o=ye.IsConstructor(c)?Object(new c(i)):new Array(i),s=0;s<i;++s)f=d[s],n&&(f=void 0===a?t(f,s):r(t,a,f,s)),Ne(o,s,f)}return o.length=i,o},of:function(){for(var e=arguments.length,t=this,n=a(t)||!ye.IsCallable(t)?new Array(e):ye.Construct(t,[e]),r=0;r<e;++r)Ne(n,r,arguments[r]);return n.length=e,n}};m(Array,Ge),Ee(Array),m((t=function(e,t){this.i=0,this.array=e,this.kind=t}).prototype,{next:function(){var e=this.i,n=this.array;if(!(this instanceof t))throw new TypeError("Not an ArrayIterator");if(void 0!==n)for(var r=ye.ToLength(n.length);e<r;e++){var a,i=this.kind;return"key"===i?a=e:"value"===i?a=n[e]:"entry"===i&&(a=[e,n[e]]),this.i=e+1,Be(a)}return this.array=void 0,Be()}}),_e(t.prototype),Array.of===Ge.of||function(){var e=function(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&2===t.length}()||se(Array,"of",Ge.of);var Xe={copyWithin:function(e,t){var n,r=ye.ToObject(this),a=ye.ToLength(r.length),i=ye.ToInteger(e),o=ye.ToInteger(t),s=i<0?D(a+i,0):R(i,a),c=o<0?D(a+o,0):R(o,a);arguments.length>2&&(n=arguments[2]);var u=void 0===n?a:ye.ToInteger(n),l=u<0?D(a+u,0):R(u,a),p=R(l-c,a-s),f=1;for(c<s&&s<c+p&&(f=-1,c+=p-1,s+=p-1);p>0;)c in r?r[s]=r[c]:delete r[s],c+=f,s+=f,p-=1;return r},fill:function(e){var t,n;arguments.length>1&&(t=arguments[1]),arguments.length>2&&(n=arguments[2]);var r=ye.ToObject(this),a=ye.ToLength(r.length);t=ye.ToInteger(void 0===t?0:t);for(var i=(n=ye.ToInteger(void 0===n?a:n))<0?a+n:n,o=t<0?D(a+t,0):R(t,a);o<a&&o<i;++o)r[o]=e;return r},find:function(e){var t=ye.ToObject(this),n=ye.ToLength(t.length);if(!ye.IsCallable(e))throw new TypeError("Array#find: predicate must be a function");for(var a,i=arguments.length>1?arguments[1]:null,o=0;o<n;o++)if(a=t[o],i){if(r(e,i,a,o,t))return a}else if(e(a,o,t))return a},findIndex:function(e){var t=ye.ToObject(this),n=ye.ToLength(t.length);if(!ye.IsCallable(e))throw new TypeError("Array#findIndex: predicate must be a function");for(var a=arguments.length>1?arguments[1]:null,i=0;i<n;i++)if(a){if(r(e,a,t[i],i,t))return i}else if(e(t[i],i,t))return i;return-1},keys:function(){return new t(this,"key")},values:function(){return new t(this,"value")},entries:function(){return new t(this,"entry")}};if(Array.prototype.keys&&!ye.IsCallable([1].keys().next)&&delete Array.prototype.keys,Array.prototype.entries&&!ye.IsCallable([1].entries().next)&&delete Array.prototype.entries,Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ue]&&(m(Array.prototype,{values:Array.prototype[ue]}),oe(J.unscopables)&&(Array.prototype[J.unscopables].values=!0)),l&&Array.prototype.values&&"values"!==Array.prototype.values.name){var Je=Array.prototype.values;se(Array.prototype,"values",function(){return ye.Call(Je,this,arguments)}),y(Array.prototype,ue,Array.prototype.values,!0)}m(Array.prototype,Xe),1/[!0].indexOf(!0,-0)<0&&y(Array.prototype,"indexOf",function(e){var t=E(this,arguments);return 0===t&&1/t<0?0:t},!0),_e(Array.prototype,function(){return this.values()}),Object.getPrototypeOf&&_e(Object.getPrototypeOf([].values()));var Ye,Ke=s(function(){return 0===Array.from({length:-1}).length}),Ze=1===(Ye=Array.from([0].entries())).length&&a(Ye[0])&&0===Ye[0][0]&&0===Ye[0][1];if(Ke&&Ze||se(Array,"from",Ge.from),!s(function(){return Array.from([0],void 0)})){var Qe=Array.from;se(Array,"from",function(e){return arguments.length>1&&void 0!==arguments[1]?ye.Call(Qe,this,arguments):r(Qe,this,e)})}var et=-(Math.pow(2,32)-1),tt=function(e,t){var n={length:et};return n[t?(n.length>>>0)-1:0]=!0,s(function(){return r(e,n,function(){throw new RangeError("should not reach here")},[]),!0})};if(!tt(Array.prototype.forEach)){var nt=Array.prototype.forEach;se(Array.prototype,"forEach",function(e){return ye.Call(nt,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.map)){var rt=Array.prototype.map;se(Array.prototype,"map",function(e){return ye.Call(rt,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.filter)){var at=Array.prototype.filter;se(Array.prototype,"filter",function(e){return ye.Call(at,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.some)){var it=Array.prototype.some;se(Array.prototype,"some",function(e){return ye.Call(it,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.every)){var ot=Array.prototype.every;se(Array.prototype,"every",function(e){return ye.Call(ot,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.reduce)){var st=Array.prototype.reduce;se(Array.prototype,"reduce",function(e){return ye.Call(st,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.reduceRight,!0)){var ct=Array.prototype.reduceRight;se(Array.prototype,"reduceRight",function(e){return ye.Call(ct,this.length>=0?this:[],arguments)})}var ut=8!==Number("0o10"),lt=2!==Number("0b10"),pt=h(He,function(e){return 0===Number(e+0+e)});if(ut||lt||pt){var ft=Number,dt=/^0b[01]+$/i,ht=/^0o[0-7]+$/i,yt=dt.test.bind(dt),mt=ht.test.bind(ht),gt=ze.test.bind(ze),vt=We.test.bind(We),bt=function(){var e=function(t){var n;"string"==typeof(n=arguments.length>0?re(t)?t:function(e){var t;if("function"==typeof e.valueOf&&(t=e.valueOf(),re(t)))return t;if("function"==typeof e.toString&&(t=e.toString(),re(t)))return t;throw new TypeError("No default value")}(t):0)&&(n=ye.Call(Ve,n),yt(n)?n=parseInt(N(n,2),2):mt(n)?n=parseInt(N(n,2),8):(gt(n)||vt(n))&&(n=NaN));var r=this,a=s(function(){return ft.prototype.valueOf.call(r),!0});return r instanceof e&&!a?new ft(n):ft(n)};return e}();Ae(ft,bt,{}),m(bt,{NaN:ft.NaN,MAX_VALUE:ft.MAX_VALUE,MIN_VALUE:ft.MIN_VALUE,NEGATIVE_INFINITY:ft.NEGATIVE_INFINITY,POSITIVE_INFINITY:ft.POSITIVE_INFINITY}),Number=bt,T(j,"Number",bt)}var wt=Math.pow(2,53)-1;m(Number,{MAX_SAFE_INTEGER:wt,MIN_SAFE_INTEGER:-wt,EPSILON:2.220446049250313e-16,parseInt:j.parseInt,parseFloat:j.parseFloat,isFinite:Z,isInteger:function(e){return Z(e)&&ye.ToInteger(e)===e},isSafeInteger:function(e){return Number.isInteger(e)&&F(e)<=Number.MAX_SAFE_INTEGER},isNaN:K}),y(Number,"parseInt",j.parseInt,Number.parseInt!==j.parseInt),1===[,1].find(function(){return!0})&&se(Array.prototype,"find",Xe.find),0!==[,1].findIndex(function(){return!0})&&se(Array.prototype,"findIndex",Xe.findIndex);var Tt,St,xt,kt=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable),Ot=function(e,t){u&&kt(e,t)&&Object.defineProperty(e,t,{enumerable:!1})},jt=function(){for(var e=Number(this),t=arguments.length,n=t-e,r=new Array(n<0?0:n),a=e;a<t;++a)r[a-e]=arguments[a];return r},At=function(e){return function(t,n){return t[n]=e[n],t}},Ct=function(e,t){var n,r=i(Object(t));return ye.IsCallable(Object.getOwnPropertySymbols)&&(n=d(Object.getOwnPropertySymbols(Object(t)),kt(t))),f(_(r,n||[]),At(t),e)},Et={assign:function(e,t){var n=ye.ToObject(e,"Cannot convert undefined or null to object");return f(ye.Call(jt,1,arguments),Ct,n)},is:function(e,t){return ye.SameValue(e,t)}};if(Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return"y"===e[1]}}()&&se(Object,"assign",Et.assign),m(Object,Et),u){var _t={setPrototypeOf:function(e,t){var n,a=function(e,t){return function(e,t){if(!ye.TypeIsObject(e))throw new TypeError("cannot set prototype on a non-object");if(null!==t&&!ye.TypeIsObject(t))throw new TypeError("can only set prototype to an object or null"+t)}(e,t),r(n,e,t),e};try{n=e.getOwnPropertyDescriptor(e.prototype,"__proto__").set,r(n,{},null)}catch(t){if(e.prototype!=={}.__proto__)return;n=function(e){this.__proto__=e},a.polyfill=a(a({},null),e.prototype)instanceof e}return a}(Object)};m(Object,_t)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&null!==Object.getPrototypeOf(Object.setPrototypeOf({},null))&&null===Object.getPrototypeOf(Object.create(null))&&(Tt=Object.create(null),St=Object.getPrototypeOf,xt=Object.setPrototypeOf,Object.getPrototypeOf=function(e){var t=St(e);return t===Tt?null:t},Object.setPrototypeOf=function(e,t){return xt(e,null===t?Tt:t)},Object.setPrototypeOf.polyfill=!1),!!o(function(){return Object.keys("foo")})){var Nt=Object.keys;se(Object,"keys",function(e){return Nt(ye.ToObject(e))}),i=Object.keys}if(o(function(){return Object.keys(/a/g)})){var Pt=Object.keys;se(Object,"keys",function(e){if(ie(e)){var t=[];for(var n in e)z(e,n)&&P(t,n);return t}return Pt(e)}),i=Object.keys}if(Object.getOwnPropertyNames&&!!o(function(){return Object.getOwnPropertyNames("foo")})){var It="object"===("undefined"==typeof window?"undefined":_typeof(window))?Object.getOwnPropertyNames(window):[],Mt=Object.getOwnPropertyNames;se(Object,"getOwnPropertyNames",function(e){var t=ye.ToObject(e);if("[object Window]"===g(t))try{return Mt(t)}catch(e){return _([],It)}return Mt(t)})}if(Object.getOwnPropertyDescriptor&&!!o(function(){return Object.getOwnPropertyDescriptor("foo","bar")})){var Dt=Object.getOwnPropertyDescriptor;se(Object,"getOwnPropertyDescriptor",function(e,t){return Dt(ye.ToObject(e),t)})}if(Object.seal&&!!o(function(){return Object.seal("foo")})){var Rt=Object.seal;se(Object,"seal",function(e){return ye.TypeIsObject(e)?Rt(e):e})}if(Object.isSealed&&!!o(function(){return Object.isSealed("foo")})){var Lt=Object.isSealed;se(Object,"isSealed",function(e){return!ye.TypeIsObject(e)||Lt(e)})}if(Object.freeze&&!!o(function(){return Object.freeze("foo")})){var Ft=Object.freeze;se(Object,"freeze",function(e){return ye.TypeIsObject(e)?Ft(e):e})}if(Object.isFrozen&&!!o(function(){return Object.isFrozen("foo")})){var qt=Object.isFrozen;se(Object,"isFrozen",function(e){return!ye.TypeIsObject(e)||qt(e)})}if(Object.preventExtensions&&!!o(function(){return Object.preventExtensions("foo")})){var Vt=Object.preventExtensions;se(Object,"preventExtensions",function(e){return ye.TypeIsObject(e)?Vt(e):e})}if(Object.isExtensible&&!!o(function(){return Object.isExtensible("foo")})){var Ht=Object.isExtensible;se(Object,"isExtensible",function(e){return!!ye.TypeIsObject(e)&&Ht(e)})}if(Object.getPrototypeOf&&!!o(function(){return Object.getPrototypeOf("foo")})){var zt=Object.getPrototypeOf;se(Object,"getPrototypeOf",function(e){return zt(ye.ToObject(e))})}var Wt,$t=u&&((Wt=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags"))&&ye.IsCallable(Wt.get));if(u&&!$t){b(RegExp.prototype,"flags",function(){if(!ye.TypeIsObject(this))throw new TypeError("Method called on incompatible type: must be an object.");var e="";return this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.unicode&&(e+="u"),this.sticky&&(e+="y"),e})}var Bt,Ut=u&&s(function(){return"/a/i"===String(new RegExp(/a/g,"i"))}),Gt=ce&&u&&((Bt=/./)[J.match]=!1,RegExp(Bt)===Bt),Xt=s(function(){return"/abc/"===RegExp.prototype.toString.call({source:"abc"})}),Jt=Xt&&s(function(){return"/a/b"===RegExp.prototype.toString.call({source:"a",flags:"b"})});if(!Xt||!Jt){var Yt=RegExp.prototype.toString;y(RegExp.prototype,"toString",function(){var e=ye.RequireObjectCoercible(this);return ie(e)?r(Yt,e):"/"+fe(e.source)+"/"+fe(e.flags)},!0),x(RegExp.prototype.toString,Yt)}if(u&&(!Ut||Gt)){var Kt=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get,Zt=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{},Qt=ye.IsCallable(Zt.get)?Zt.get:function(){return this.source},en=RegExp,tn=function e(t,n){var r=ye.IsRegExp(t);return this instanceof e||!r||void 0!==n||t.constructor!==e?ie(t)?new e(ye.Call(Qt,t),void 0===n?ye.Call(Kt,t):n):(r&&(t.source,void 0===n&&t.flags),new en(t,n)):t};Ae(en,tn,{$input:!0}),RegExp=tn,T(j,"RegExp",tn)}if(u){var nn={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};p(i(nn),function(e){e in RegExp&&!(nn[e]in RegExp)&&b(RegExp,nn[e],function(){return RegExp[e]})})}Ee(RegExp);var rn=1/Number.EPSILON,an=Math.pow(2,-23),on=Math.pow(2,127)*(2-an),sn=Math.pow(2,-126),cn=Math.E,un=Math.LOG2E,ln=Math.LOG10E,pn=Number.prototype.clz;delete Number.prototype.clz;var fn={acosh:function(e){var t=Number(e);if(K(t)||e<1)return NaN;if(1===t)return 0;if(t===1/0)return t;var n=1/(t*t);if(t<2)return ee(t-1+H(1-n)*t);var r=t/2;return ee(r+H(1-n)*r-1)+1/un},asinh:function(e){var t=Number(e);if(0===t||!A(t))return t;var n=F(t),r=n*n,a=Q(t);return n<1?a*ee(n+r/(H(r+1)+1)):a*(ee(n/2+H(1+1/r)*n/2-1)+1/un)},atanh:function(e){var t=Number(e);if(0===t)return t;if(-1===t)return-1/0;if(1===t)return 1/0;if(K(t)||t<-1||t>1)return NaN;var n=F(t);return Q(t)*ee(2*n/(1-n))/2},cbrt:function(e){var t=Number(e);if(0===t)return t;var n,r=t<0;return r&&(t=-t),n=t===1/0?1/0:(t/((n=q(V(t)/3))*n)+2*n)/3,r?-n:n},clz32:function(e){var t=Number(e),n=ye.ToUint32(t);return 0===n?32:pn?ye.Call(pn,n):31-L(V(n+.5)*un)},cosh:function(e){var t=Number(e);if(0===t)return 1;if(K(t))return NaN;if(!A(t))return 1/0;var n=q(F(t)-1);return(n+1/(n*cn*cn))*(cn/2)},expm1:function(e){var t=Number(e);if(t===-1/0)return-1;if(!A(t)||0===t)return t;if(F(t)>.5)return q(t)-1;for(var n=t,r=0,a=1;r+n!==r;)r+=n,n*=t/(a+=1);return r},hypot:function(e,t){for(var n=0,r=0,a=0;a<arguments.length;++a){var i=F(Number(arguments[a]));r<i?(n*=r/i*(r/i),n+=1,r=i):n+=i>0?i/r*(i/r):i}return r===1/0?1/0:r*H(n)},log2:function(e){return V(e)*un},log10:function(e){return V(e)*ln},log1p:ee,sign:Q,sinh:function(e){var t=Number(e);if(!A(t)||0===t)return t;var n=F(t);if(n<1){var r=Math.expm1(n);return Q(t)*r*(1+1/(r+1))/2}var a=q(n-1);return Q(t)*(a-1/(a*cn*cn))*(cn/2)},tanh:function(e){var t=Number(e);return K(t)||0===t?t:t>=20?1:t<=-20?-1:(Math.expm1(t)-Math.expm1(-t))/(q(t)+q(-t))},trunc:function(e){var t=Number(e);return t<0?-L(-t):L(t)},imul:function(e,t){var n=ye.ToUint32(e),r=ye.ToUint32(t),a=65535&n,i=65535&r;return a*i+((n>>>16&65535)*i+a*(r>>>16&65535)<<16>>>0)|0},fround:function(e){var t=Number(e);if(0===t||t===1/0||t===-1/0||K(t))return t;var n=Q(t),r=F(t);if(r<sn)return n*(r/sn/an+rn-rn)*sn*an;var a=(1+an/Number.EPSILON)*r,i=a-(a-r);return i>on||K(i)?n*(1/0):n*i}},dn=function(e,t,n){return F(1-e/t)/Number.EPSILON<(n||8)};m(Math,fn),y(Math,"sinh",fn.sinh,Math.sinh(710)===1/0),y(Math,"cosh",fn.cosh,Math.cosh(710)===1/0),y(Math,"log1p",fn.log1p,-1e-17!==Math.log1p(-1e-17)),y(Math,"asinh",fn.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7)),y(Math,"asinh",fn.asinh,Math.asinh(1e300)===1/0),y(Math,"atanh",fn.atanh,0===Math.atanh(1e-300)),y(Math,"tanh",fn.tanh,-2e-17!==Math.tanh(-2e-17)),y(Math,"acosh",fn.acosh,Math.acosh(Number.MAX_VALUE)===1/0),y(Math,"acosh",fn.acosh,!dn(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON))),y(Math,"cbrt",fn.cbrt,!dn(Math.cbrt(1e-300),1e-100)),y(Math,"sinh",fn.sinh,-2e-17!==Math.sinh(-2e-17));var hn=Math.expm1(10);y(Math,"expm1",fn.expm1,hn>22025.465794806718||hn<22025.465794806718);var yn=Math.round,mn=0===Math.round(.5-Number.EPSILON/4)&&1===Math.round(Number.EPSILON/3.99-.5),gn=[rn+1,2*rn-1].every(function(e){return Math.round(e)===e});y(Math,"round",function(e){var t=L(e);return e-t<.5?t:-1===t?-0:t+1},!mn||!gn),x(Math.round,yn);var vn=Math.imul;-5!==Math.imul(4294967295,5)&&(Math.imul=fn.imul,x(Math.imul,vn)),2!==Math.imul.length&&se(Math,"imul",function(e,t){return ye.Call(vn,Math,arguments)});var bn,wn,Tn=function(){var e=j.setTimeout;if("function"==typeof e||"object"===(void 0===e?"undefined":_typeof(e))){ye.IsPromise=function(e){return!!ye.TypeIsObject(e)&&void 0!==e._promise};var t,n=function(e){if(!ye.IsConstructor(e))throw new TypeError("Bad promise constructor");var t=this;if(t.resolve=void 0,t.reject=void 0,t.promise=new e(function(e,n){if(void 0!==t.resolve||void 0!==t.reject)throw new TypeError("Bad Promise implementation!");t.resolve=e,t.reject=n}),!ye.IsCallable(t.resolve)||!ye.IsCallable(t.reject))throw new TypeError("Bad promise constructor")};"undefined"!=typeof window&&ye.IsCallable(window.postMessage)&&(t=function(){var e=[];return window.addEventListener("message",function(t){if(t.source===window&&"zero-timeout-message"===t.data){if(t.stopPropagation(),0===e.length)return;M(e)()}},!0),function(t){P(e,t),window.postMessage("zero-timeout-message","*")}});var a,i,o,s,c,u=ye.IsCallable(j.setImmediate)?j.setImmediate:"object"===("undefined"==typeof process?"undefined":_typeof(process))&&process.nextTick?process.nextTick:(a=j.Promise,(i=a&&a.resolve&&a.resolve())&&function(e){return i.then(e)}||(ye.IsCallable(t)?t():function(t){e(t,0)})),l=function(e){return e},p=function(e){throw e},f={},d=function(e,t,n){u(function(){h(e,t,n)})},h=function(e,t,n){var r,a;if(t===f)return e(n);try{r=e(n),a=t.resolve}catch(e){r=e,a=t.reject}a(r)},y=function(e,t){var n=e._promise,r=n.reactionLength;if(r>0&&(d(n.fulfillReactionHandler0,n.reactionCapability0,t),n.fulfillReactionHandler0=void 0,n.rejectReactions0=void 0,n.reactionCapability0=void 0,r>1))for(var a=1,i=0;a<r;a++,i+=3)d(n[i+0],n[i+2],t),e[i+0]=void 0,e[i+1]=void 0,e[i+2]=void 0;n.result=t,n.state=1,n.reactionLength=0},g=function(e,t){var n=e._promise,r=n.reactionLength;if(r>0&&(d(n.rejectReactionHandler0,n.reactionCapability0,t),n.fulfillReactionHandler0=void 0,n.rejectReactions0=void 0,n.reactionCapability0=void 0,r>1))for(var a=1,i=0;a<r;a++,i+=3)d(n[i+1],n[i+2],t),e[i+0]=void 0,e[i+1]=void 0,e[i+2]=void 0;n.result=t,n.state=2,n.reactionLength=0},v=function(e){var t=!1;return{resolve:function(n){var r;if(!t){if(t=!0,n===e)return g(e,new TypeError("Self resolution"));if(!ye.TypeIsObject(n))return y(e,n);try{r=n.then}catch(t){return g(e,t)}if(!ye.IsCallable(r))return y(e,n);u(function(){w(e,n,r)})}},reject:function(n){if(!t)return t=!0,g(e,n)}}},b=function(e,t,n,a){e===s?r(e,t,n,a,f):r(e,t,n,a)},w=function(e,t,n){var r=v(e),a=r.resolve,i=r.reject;try{b(n,t,a,i)}catch(e){i(e)}},T=c=function(e){if(!(this instanceof c))throw new TypeError('Constructor Promise requires "new"');if(this&&this._promise)throw new TypeError("Bad construction");if(!ye.IsCallable(e))throw new TypeError("not a valid resolver");var t=Pe(this,c,o,{_promise:{result:void 0,state:0,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}}),n=v(t),r=n.reject;try{e(n.resolve,r)}catch(e){r(e)}return t};o=T.prototype;var S=function(e,t,n,r){var a=!1;return function(i){a||(a=!0,t[e]=i,0==--r.count&&(0,n.resolve)(t))}};return m(T,{all:function(e){var t=this;if(!ye.TypeIsObject(t))throw new TypeError("Promise is not object");var r,a,i=new n(t);try{return function(e,t,n){for(var r,a,i=e.iterator,o=[],s={count:1},c=0;;){try{if(!1===(r=ye.IteratorStep(i))){e.done=!0;break}a=r.value}catch(t){throw e.done=!0,t}o[c]=void 0;var u=t.resolve(a),l=S(c,o,n,s);s.count+=1,b(u.then,u,l,n.reject),c+=1}0==--s.count&&(0,n.resolve)(o);return n.promise}(a={iterator:r=ye.GetIterator(e),done:!1},t,i)}catch(e){var o=e;if(a&&!a.done)try{ye.IteratorClose(r,!0)}catch(e){o=e}return(0,i.reject)(o),i.promise}},race:function(e){var t=this;if(!ye.TypeIsObject(t))throw new TypeError("Promise is not object");var r,a,i=new n(t);try{return function(e,t,n){for(var r,a,i,o=e.iterator;;){try{if(!1===(r=ye.IteratorStep(o))){e.done=!0;break}a=r.value}catch(t){throw e.done=!0,t}i=t.resolve(a),b(i.then,i,n.resolve,n.reject)}return n.promise}(a={iterator:r=ye.GetIterator(e),done:!1},t,i)}catch(e){var o=e;if(a&&!a.done)try{ye.IteratorClose(r,!0)}catch(e){o=e}return(0,i.reject)(o),i.promise}},reject:function(e){if(!ye.TypeIsObject(this))throw new TypeError("Bad promise constructor");var t=new n(this);return(0,t.reject)(e),t.promise},resolve:function(e){var t=this;if(!ye.TypeIsObject(t))throw new TypeError("Bad promise constructor");if(ye.IsPromise(e)&&e.constructor===t)return e;var r=new n(t);return(0,r.resolve)(e),r.promise}}),m(o,{catch:function(e){return this.then(null,e)},then:function(e,t){if(!ye.IsPromise(this))throw new TypeError("not a promise");var r,a=ye.SpeciesConstructor(this,T);r=arguments.length>2&&arguments[2]===f&&a===T?f:new n(a);var i,o=ye.IsCallable(e)?e:l,s=ye.IsCallable(t)?t:p,c=this._promise;if(0===c.state){if(0===c.reactionLength)c.fulfillReactionHandler0=o,c.rejectReactionHandler0=s,c.reactionCapability0=r;else{var u=3*(c.reactionLength-1);c[u+0]=o,c[u+1]=s,c[u+2]=r}c.reactionLength+=1}else if(1===c.state)i=c.result,d(o,r,i);else{if(2!==c.state)throw new TypeError("unexpected Promise state");i=c.result,d(s,r,i)}return r.promise}}),f=new n(T),s=o.then,T}}();if(j.Promise&&(delete j.Promise.accept,delete j.Promise.defer,delete j.Promise.prototype.chain),"function"==typeof Tn){m(j,{Promise:Tn});var Sn=O(j.Promise,function(e){return e.resolve(42).then(function(){})instanceof e}),xn=!o(function(){return j.Promise.reject(42).then(null,5).then(null,W)}),kn=o(function(){return j.Promise.call(3,W)}),On=function(e){var t=e.resolve(5);t.constructor={};var n=e.resolve(t);try{n.then(null,W).then(null,W)}catch(e){return!0}return t===n}(j.Promise),jn=u&&(bn=0,wn=Object.defineProperty({},"then",{get:function(){bn+=1}}),Promise.resolve(wn),1===bn),An=function e(t){var n=new Promise(t);t(3,function(){}),this.then=n.then,this.constructor=e};An.prototype=Promise.prototype,An.all=Promise.all;var Cn=s(function(){return!!An.all([1,2])});if(Sn&&xn&&kn&&!On&&jn&&!Cn||(Promise=Tn,se(j,"Promise",Tn)),1!==Promise.all.length){var En=Promise.all;se(Promise,"all",function(e){return ye.Call(En,this,arguments)})}if(1!==Promise.race.length){var _n=Promise.race;se(Promise,"race",function(e){return ye.Call(_n,this,arguments)})}if(1!==Promise.resolve.length){var Nn=Promise.resolve;se(Promise,"resolve",function(e){return ye.Call(Nn,this,arguments)})}if(1!==Promise.reject.length){var Pn=Promise.reject;se(Promise,"reject",function(e){return ye.Call(Pn,this,arguments)})}Ot(Promise,"all"),Ot(Promise,"race"),Ot(Promise,"resolve"),Ot(Promise,"reject"),Ee(Promise)}var In,Mn,Dn=function(e){var t=i(f(e,function(e,t){return e[t]=!0,e},{}));return e.join(":")===t.join(":")},Rn=Dn(["z","a","bb"]),Ln=Dn(["z",1,"a","3",2]);if(u){var Fn=function(e,t){return t||Rn?he(e)?"^"+ye.ToString(e):"string"==typeof e?"$"+e:"number"==typeof e?Ln?e:"n"+e:"boolean"==typeof e?"b"+e:null:null},qn=function(){return Object.create?Object.create(null):{}},Vn=function(e,t,n){if(a(n)||ae(n))p(n,function(e){if(!ye.TypeIsObject(e))throw new TypeError("Iterator value "+e+" is not an entry object");t.set(e[0],e[1])});else if(n instanceof e)r(e.prototype.forEach,n,function(e,n){t.set(n,e)});else{var i,o;if(!he(n)){if(o=t.set,!ye.IsCallable(o))throw new TypeError("bad map");i=ye.GetIterator(n)}if(void 0!==i)for(;;){var s=ye.IteratorStep(i);if(!1===s)break;var c=s.value;try{if(!ye.TypeIsObject(c))throw new TypeError("Iterator value "+c+" is not an entry object");r(o,t,c[0],c[1])}catch(e){throw ye.IteratorClose(i,!0),e}}}},Hn=function(e,t,n){if(a(n)||ae(n))p(n,function(e){t.add(e)});else if(n instanceof e)r(e.prototype.forEach,n,function(e){t.add(e)});else{var i,o;if(!he(n)){if(o=t.add,!ye.IsCallable(o))throw new TypeError("bad set");i=ye.GetIterator(n)}if(void 0!==i)for(;;){var s=ye.IteratorStep(i);if(!1===s)break;var c=s.value;try{r(o,t,c)}catch(e){throw ye.IteratorClose(i,!0),e}}}},zn={Map:function(){var e={},t=function(e,t){this.key=e,this.value=t,this.next=null,this.prev=null};t.prototype.isRemoved=function(){return this.key===e};var n,a=function(e,t){if(!ye.TypeIsObject(e)||!function(e){return!!e._es6map}(e))throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+ye.ToString(e))},i=function(e,t){a(e,"[[MapIterator]]"),this.head=e._head,this.i=this.head,this.kind=t};_e(i.prototype={isMapIterator:!0,next:function(){if(!this.isMapIterator)throw new TypeError("Not a MapIterator");var e,t=this.i,n=this.kind,r=this.head;if(void 0===this.i)return Be();for(;t.isRemoved()&&t!==r;)t=t.prev;for(;t.next!==r;)if(!(t=t.next).isRemoved())return e="key"===n?t.key:"value"===n?t.value:[t.key,t.value],this.i=t,Be(e);return this.i=void 0,Be()}});var o=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');if(this&&this._es6map)throw new TypeError("Bad construction");var r=Pe(this,e,n,{_es6map:!0,_head:null,_map:$?new $:null,_size:0,_storage:qn()}),a=new t(null,null);return a.next=a.prev=a,r._head=a,arguments.length>0&&Vn(e,r,arguments[0]),r};return b(n=o.prototype,"size",function(){if(void 0===this._size)throw new TypeError("size method called on incompatible Map");return this._size}),m(n,{get:function(e){var t;a(this,"get");var n=Fn(e,!0);if(null!==n)return(t=this._storage[n])?t.value:void 0;if(this._map)return(t=U.call(this._map,e))?t.value:void 0;for(var r=this._head,i=r;(i=i.next)!==r;)if(ye.SameValueZero(i.key,e))return i.value},has:function(e){a(this,"has");var t=Fn(e,!0);if(null!==t)return void 0!==this._storage[t];if(this._map)return G.call(this._map,e);for(var n=this._head,r=n;(r=r.next)!==n;)if(ye.SameValueZero(r.key,e))return!0;return!1},set:function(e,n){a(this,"set");var r,i=this._head,o=i,s=Fn(e,!0);if(null!==s){if(void 0!==this._storage[s])return this._storage[s].value=n,this;r=this._storage[s]=new t(e,n),o=i.prev}else this._map&&(G.call(this._map,e)?U.call(this._map,e).value=n:(r=new t(e,n),X.call(this._map,e,r),o=i.prev));for(;(o=o.next)!==i;)if(ye.SameValueZero(o.key,e))return o.value=n,this;return r=r||new t(e,n),ye.SameValue(-0,e)&&(r.key=0),r.next=this._head,r.prev=this._head.prev,r.prev.next=r,r.next.prev=r,this._size+=1,this},delete:function(t){a(this,"delete");var n=this._head,r=n,i=Fn(t,!0);if(null!==i){if(void 0===this._storage[i])return!1;r=this._storage[i].prev,delete this._storage[i]}else if(this._map){if(!G.call(this._map,t))return!1;r=U.call(this._map,t).prev,B.call(this._map,t)}for(;(r=r.next)!==n;)if(ye.SameValueZero(r.key,t))return r.key=e,r.value=e,r.prev.next=r.next,r.next.prev=r.prev,this._size-=1,!0;return!1},clear:function(){a(this,"clear"),this._map=$?new $:null,this._size=0,this._storage=qn();for(var t=this._head,n=t,r=n.next;(n=r)!==t;)n.key=e,n.value=e,r=n.next,n.next=n.prev=t;t.next=t.prev=t},keys:function(){return a(this,"keys"),new i(this,"key")},values:function(){return a(this,"values"),new i(this,"value")},entries:function(){return a(this,"entries"),new i(this,"key+value")},forEach:function(e){a(this,"forEach");for(var t=arguments.length>1?arguments[1]:null,n=this.entries(),i=n.next();!i.done;i=n.next())t?r(e,t,i.value[1],i.value[0],this):e(i.value[1],i.value[0],this)}}),_e(n,n.entries),o}(),Set:function(){var e,t=function(e,t){if(!ye.TypeIsObject(e)||!function(e){return e._es6set&&void 0!==e._storage}(e))throw new TypeError("Set.prototype."+t+" called on incompatible receiver "+ye.ToString(e))},n=function t(){if(!(this instanceof t))throw new TypeError('Constructor Set requires "new"');if(this&&this._es6set)throw new TypeError("Bad construction");var n=Pe(this,t,e,{_es6set:!0,"[[SetData]]":null,_storage:qn()});if(!n._es6set)throw new TypeError("bad set");return arguments.length>0&&Hn(t,n,arguments[0]),n};e=n.prototype;var a=function(e){if(!e["[[SetData]]"]){var t=new zn.Map;e["[[SetData]]"]=t,p(i(e._storage),function(e){var n=function(e){var t=e;if("^null"===t)return null;if("^undefined"!==t){var n=t.charAt(0);return"$"===n?N(t,1):"n"===n?+N(t,1):"b"===n?"btrue"===t:+t}}(e);t.set(n,n)}),e["[[SetData]]"]=t}e._storage=null};b(n.prototype,"size",function(){return t(this,"size"),this._storage?i(this._storage).length:(a(this),this["[[SetData]]"].size)}),m(n.prototype,{has:function(e){var n;return t(this,"has"),this._storage&&null!==(n=Fn(e))?!!this._storage[n]:(a(this),this["[[SetData]]"].has(e))},add:function(e){var n;return t(this,"add"),this._storage&&null!==(n=Fn(e))?(this._storage[n]=!0,this):(a(this),this["[[SetData]]"].set(e,e),this)},delete:function(e){var n;if(t(this,"delete"),this._storage&&null!==(n=Fn(e))){var r=z(this._storage,n);return delete this._storage[n]&&r}return a(this),this["[[SetData]]"].delete(e)},clear:function(){t(this,"clear"),this._storage&&(this._storage=qn()),this["[[SetData]]"]&&this["[[SetData]]"].clear()},values:function(){return t(this,"values"),a(this),new o(this["[[SetData]]"].values())},entries:function(){return t(this,"entries"),a(this),new o(this["[[SetData]]"].entries())},forEach:function(e){t(this,"forEach");var n=arguments.length>1?arguments[1]:null,i=this;a(i),this["[[SetData]]"].forEach(function(t,a){n?r(e,n,a,a,i):e(a,a,i)})}}),y(n.prototype,"keys",n.prototype.values,!0),_e(n.prototype,n.prototype.values);var o=function(e){this.it=e};return o.prototype={isSetIterator:!0,next:function(){if(!this.isSetIterator)throw new TypeError("Not a SetIterator");return this.it.next()}},_e(o.prototype),n}()};if(j.Set&&!Set.prototype.delete&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys)&&(j.Set=zn.Set),j.Map||j.Set){s(function(){return 2===new Map([[1,2]]).get(1)})||(j.Map=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');var t=new $;return arguments.length>0&&Vn(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,j.Map.prototype),t},j.Map.prototype=k($.prototype),y(j.Map.prototype,"constructor",j.Map,!0),x(j.Map,$));var Wn=new Map,$n=((Mn=new Map([[1,0],[2,0],[3,0],[4,0]])).set(-0,Mn),Mn.get(0)===Mn&&Mn.get(-0)===Mn&&Mn.has(0)&&Mn.has(-0)),Bn=Wn.set(1,2)===Wn;$n&&Bn||se(Map.prototype,"set",function(e,t){return r(X,this,0===e?0:e,t),this}),$n||(m(Map.prototype,{get:function(e){return r(U,this,0===e?0:e)},has:function(e){return r(G,this,0===e?0:e)}},!0),x(Map.prototype.get,U),x(Map.prototype.has,G));var Un=new Set,Gn=Set.prototype.delete&&Set.prototype.add&&Set.prototype.has&&((In=Un).delete(0),In.add(-0),!In.has(0)),Xn=Un.add(1)===Un;if(!Gn||!Xn){var Jn=Set.prototype.add;Set.prototype.add=function(e){return r(Jn,this,0===e?0:e),this},x(Set.prototype.add,Jn)}if(!Gn){var Yn=Set.prototype.has;Set.prototype.has=function(e){return r(Yn,this,0===e?0:e)},x(Set.prototype.has,Yn);var Kn=Set.prototype.delete;Set.prototype.delete=function(e){return r(Kn,this,0===e?0:e)},x(Set.prototype.delete,Kn)}var Zn=O(j.Map,function(e){var t=new e([]);return t.set(42,42),t instanceof e}),Qn=Object.setPrototypeOf&&!Zn,er=function(){try{return!(j.Map()instanceof j.Map)}catch(e){return e instanceof TypeError}}();0===j.Map.length&&!Qn&&er||(j.Map=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');var t=new $;return arguments.length>0&&Vn(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,e.prototype),t},j.Map.prototype=$.prototype,y(j.Map.prototype,"constructor",j.Map,!0),x(j.Map,$));var tr=O(j.Set,function(e){var t=new e([]);return t.add(42,42),t instanceof e}),nr=Object.setPrototypeOf&&!tr,rr=function(){try{return!(j.Set()instanceof j.Set)}catch(e){return e instanceof TypeError}}();if(0!==j.Set.length||nr||!rr){var ar=j.Set;j.Set=function e(){if(!(this instanceof e))throw new TypeError('Constructor Set requires "new"');var t=new ar;return arguments.length>0&&Hn(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,e.prototype),t},j.Set.prototype=ar.prototype,y(j.Set.prototype,"constructor",j.Set,!0),x(j.Set,ar)}var ir=new j.Map,or=!s(function(){return ir.keys().next().done});if(("function"!=typeof j.Map.prototype.clear||0!==(new j.Set).size||0!==ir.size||"function"!=typeof j.Map.prototype.keys||"function"!=typeof j.Set.prototype.keys||"function"!=typeof j.Map.prototype.forEach||"function"!=typeof j.Set.prototype.forEach||c(j.Map)||c(j.Set)||"function"!=typeof ir.keys().next||or||!Zn)&&m(j,{Map:zn.Map,Set:zn.Set},!0),j.Set.prototype.keys!==j.Set.prototype.values&&y(j.Set.prototype,"keys",j.Set.prototype.values,!0),_e(Object.getPrototypeOf((new j.Map).keys())),_e(Object.getPrototypeOf((new j.Set).keys())),l&&"has"!==j.Set.prototype.has.name){var sr=j.Set.prototype.has;se(j.Set.prototype,"has",function(e){return r(sr,this,e)})}}m(j,zn),Ee(j.Map),Ee(j.Set)}var cr=function(e){if(!ye.TypeIsObject(e))throw new TypeError("target must be an object")},ur={apply:function(){return ye.Call(ye.Call,null,arguments)},construct:function(e,t){if(!ye.IsConstructor(e))throw new TypeError("First argument must be a constructor.");var n=arguments.length>2?arguments[2]:e;if(!ye.IsConstructor(n))throw new TypeError("new.target must be a constructor.");return ye.Construct(e,t,n,"internal")},deleteProperty:function(e,t){if(cr(e),u){var n=Object.getOwnPropertyDescriptor(e,t);if(n&&!n.configurable)return!1}return delete e[t]},has:function(e,t){return cr(e),t in e}};Object.getOwnPropertyNames&&Object.assign(ur,{ownKeys:function(e){cr(e);var t=Object.getOwnPropertyNames(e);return ye.IsCallable(Object.getOwnPropertySymbols)&&I(t,Object.getOwnPropertySymbols(e)),t}});var lr=function(e){return!o(e)};if(Object.preventExtensions&&Object.assign(ur,{isExtensible:function(e){return cr(e),Object.isExtensible(e)},preventExtensions:function(e){return cr(e),lr(function(){return Object.preventExtensions(e)})}}),u){var pr=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(!r){var a=Object.getPrototypeOf(e);if(null===a)return;return pr(a,t,n)}return"value"in r?r.value:r.get?ye.Call(r.get,n):void 0},fr=function(e,t,n,a){var i=Object.getOwnPropertyDescriptor(e,t);if(!i){var o=Object.getPrototypeOf(e);if(null!==o)return fr(o,t,n,a);i={value:void 0,writable:!0,enumerable:!0,configurable:!0}}return"value"in i?!!i.writable&&(!!ye.TypeIsObject(a)&&(Object.getOwnPropertyDescriptor(a,t)?pe.defineProperty(a,t,{value:n}):pe.defineProperty(a,t,{value:n,writable:!0,enumerable:!0,configurable:!0}))):!!i.set&&(r(i.set,a,n),!0)};Object.assign(ur,{defineProperty:function(e,t,n){return cr(e),lr(function(){return Object.defineProperty(e,t,n)})},getOwnPropertyDescriptor:function(e,t){return cr(e),Object.getOwnPropertyDescriptor(e,t)},get:function(e,t){cr(e);var n=arguments.length>2?arguments[2]:e;return pr(e,t,n)},set:function(e,t,n){cr(e);var r=arguments.length>3?arguments[3]:e;return fr(e,t,n,r)}})}if(Object.getPrototypeOf){var dr=Object.getPrototypeOf;ur.getPrototypeOf=function(e){return cr(e),dr(e)}}if(Object.setPrototypeOf&&ur.getPrototypeOf){Object.assign(ur,{setPrototypeOf:function(e,t){if(cr(e),null!==t&&!ye.TypeIsObject(t))throw new TypeError("proto must be an object or null");return t===pe.getPrototypeOf(e)||!(pe.isExtensible&&!pe.isExtensible(e))&&(!function(e,t){for(var n=t;n;){if(e===n)return!0;n=ur.getPrototypeOf(n)}return!1}(e,t)&&(Object.setPrototypeOf(e,t),!0))}})}Object.keys(ur).forEach(function(e){!function(e,t){ye.IsCallable(j.Reflect[e])?s(function(){return j.Reflect[e](1),j.Reflect[e](NaN),j.Reflect[e](!0),!0})&&se(j.Reflect,e,t):y(j.Reflect,e,t)}(e,ur[e])});var hr=j.Reflect.getPrototypeOf;if(l&&hr&&"getPrototypeOf"!==hr.name&&se(j.Reflect,"getPrototypeOf",function(e){return r(hr,j.Reflect,e)}),j.Reflect.setPrototypeOf&&s(function(){return j.Reflect.setPrototypeOf(1,{}),!0})&&se(j.Reflect,"setPrototypeOf",ur.setPrototypeOf),j.Reflect.defineProperty&&(s(function(){var e=!j.Reflect.defineProperty(1,"test",{value:1}),t="function"!=typeof Object.preventExtensions||!j.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})||se(j.Reflect,"defineProperty",ur.defineProperty)),j.Reflect.construct&&(s(function(){var e=function(){};return j.Reflect.construct(function(){},[],e)instanceof e})||se(j.Reflect,"construct",ur.construct)),"Invalid Date"!==String(new Date(NaN))){var yr=Date.prototype.toString;se(Date.prototype,"toString",function(){var e=+this;return e!=e?"Invalid Date":ye.Call(yr,this)})}var mr={anchor:function(e){return ye.CreateHTML(this,"a","name",e)},big:function(){return ye.CreateHTML(this,"big","","")},blink:function(){return ye.CreateHTML(this,"blink","","")},bold:function(){return ye.CreateHTML(this,"b","","")},fixed:function(){return ye.CreateHTML(this,"tt","","")},fontcolor:function(e){return ye.CreateHTML(this,"font","color",e)},fontsize:function(e){return ye.CreateHTML(this,"font","size",e)},italics:function(){return ye.CreateHTML(this,"i","","")},link:function(e){return ye.CreateHTML(this,"a","href",e)},small:function(){return ye.CreateHTML(this,"small","","")},strike:function(){return ye.CreateHTML(this,"strike","","")},sub:function(){return ye.CreateHTML(this,"sub","","")},sup:function(){return ye.CreateHTML(this,"sup","","")}};p(Object.keys(mr),function(e){var t=String.prototype[e],n=!1;if(ye.IsCallable(t)){var a=r(t,"",' " '),i=_([],a.match(/"/g)).length;n=a!==a.toLowerCase()||i>2}else n=!0;n&&se(String.prototype,e,mr[e])});var gr=function(){if(!ce)return!1;var e="object"===("undefined"==typeof JSON?"undefined":_typeof(JSON))&&"function"==typeof JSON.stringify?JSON.stringify:null;if(!e)return!1;if(void 0!==e(J()))return!0;if("[null]"!==e([J()]))return!0;var t={a:J()};return t[J()]=!0,"{}"!==e(t)}(),vr=s(function(){return!ce||"{}"===JSON.stringify(Object(J()))&&"[{}]"===JSON.stringify([Object(J())])});if(gr||!vr){var br=JSON.stringify;se(JSON,"stringify",function(e){if("symbol"!==(void 0===e?"undefined":_typeof(e))){var t;arguments.length>1&&(t=arguments[1]);var n=[e];if(a(t))n.push(t);else{var i=ye.IsCallable(t)?t:null;n.push(function(e,t){var n=i?r(i,this,e,t):t;if("symbol"!==(void 0===n?"undefined":_typeof(n)))return oe(n)?At({})(n):n})}return arguments.length>2&&n.push(arguments[2]),br.apply(this,n)}})}return j},"function"==typeof define&&define.amd?define("es6-shim",factory):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=factory():root.returnExports=factory(),function(e,t){"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){var n=[],r=Object.getPrototypeOf,a=n.slice,i=n.flat?function(e){return n.flat.call(e)}:function(e){return n.concat.apply([],e)},o=n.push,s=n.indexOf,c={},u=c.toString,l=c.hasOwnProperty,p=l.toString,f=p.call(Object),d={},h=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},y=function(e){return null!=e&&e===e.window},m=e.document,g={type:!0,src:!0,nonce:!0,noModule:!0};function v(e,t,n){var r,a,i=(n=n||m).createElement("script");if(i.text=e,t)for(r in g)(a=t[r]||t.getAttribute&&t.getAttribute(r))&&i.setAttribute(r,a);n.head.appendChild(i).parentNode.removeChild(i)}function b(e){return null==e?e+"":"object"===(void 0===e?"undefined":_typeof(e))||"function"==typeof e?c[u.call(e)]||"object":void 0===e?"undefined":_typeof(e)}var w=function e(t,n){return new e.fn.init(t,n)};function T(e){var t=!!e&&"length"in e&&e.length,n=b(e);return!h(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}w.fn=w.prototype={jquery:"3.5.1",constructor:w,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return w.each(this,e)},map:function(e){return this.pushStack(w.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(w.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(w.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:o,sort:n.sort,splice:n.splice},w.extend=w.fn.extend=function(){var e,t,n,r,a,i,o=arguments[0]||{},s=1,c=arguments.length,u=!1;for("boolean"==typeof o&&(u=o,o=arguments[s]||{},s++),"object"===(void 0===o?"undefined":_typeof(o))||h(o)||(o={}),s===c&&(o=this,s--);s<c;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&o!==r&&(u&&r&&(w.isPlainObject(r)||(a=Array.isArray(r)))?(n=o[t],i=a&&!Array.isArray(n)?[]:a||w.isPlainObject(n)?n:{},a=!1,o[t]=w.extend(u,i,r)):void 0!==r&&(o[t]=r));return o},w.extend({expando:"jQuery"+("3.5.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==u.call(e))&&(!(t=r(e))||"function"==typeof(n=l.call(t,"constructor")&&t.constructor)&&p.call(n)===f)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){v(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(T(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(T(Object(e))?w.merge(n,"string"==typeof e?[e]:e):o.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:s.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,a=e.length;r<n;r++)e[a++]=t[r];return e.length=a,e},grep:function(e,t,n){for(var r=[],a=0,i=e.length,o=!n;a<i;a++)!t(e[a],a)!==o&&r.push(e[a]);return r},map:function(e,t,n){var r,a,o=0,s=[];if(T(e))for(r=e.length;o<r;o++)null!=(a=t(e[o],o,n))&&s.push(a);else for(o in e)null!=(a=t(e[o],o,n))&&s.push(a);return i(s)},guid:1,support:d}),"function"==typeof Symbol&&(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){c["[object "+t+"]"]=t.toLowerCase()});var S=function(e){var t,n,r,a,i,o,s,c,u,l,p,f,d,h,y,m,g,v,b,w="sizzle"+1*new Date,T=e.document,S=0,x=0,k=ce(),O=ce(),j=ce(),A=ce(),C=function(e,t){return e===t&&(p=!0),0},E={}.hasOwnProperty,_=[],N=_.pop,P=_.push,I=_.push,M=_.slice,D=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",F="(?:\\\\[\\da-fA-F]{1,6}"+L+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",q="\\["+L+"*("+F+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+F+"))|)"+L+"*\\]",V=":("+F+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+q+")*)|.*)\\)|)",H=new RegExp(L+"+","g"),z=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),W=new RegExp("^"+L+"*,"+L+"*"),$=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),B=new RegExp(L+"|>"),U=new RegExp(V),G=new RegExp("^"+F+"$"),X={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),TAG:new RegExp("^("+F+"|[*])"),ATTR:new RegExp("^"+q),PSEUDO:new RegExp("^"+V),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},J=/HTML$/i,Y=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+L+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ae=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ie=function(){f()},oe=we(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{I.apply(_=M.call(T.childNodes),T.childNodes),_[T.childNodes.length].nodeType}catch(e){I={apply:_.length?function(e,t){P.apply(e,M.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function se(e,t,r,a){var i,s,u,l,p,h,g,v=t&&t.ownerDocument,T=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==T&&9!==T&&11!==T)return r;if(!a&&(f(t),t=t||d,y)){if(11!==T&&(p=Q.exec(e)))if(i=p[1]){if(9===T){if(!(u=t.getElementById(i)))return r;if(u.id===i)return r.push(u),r}else if(v&&(u=v.getElementById(i))&&b(t,u)&&u.id===i)return r.push(u),r}else{if(p[2])return I.apply(r,t.getElementsByTagName(e)),r;if((i=p[3])&&n.getElementsByClassName&&t.getElementsByClassName)return I.apply(r,t.getElementsByClassName(i)),r}if(n.qsa&&!A[e+" "]&&(!m||!m.test(e))&&(1!==T||"object"!==t.nodeName.toLowerCase())){if(g=e,v=t,1===T&&(B.test(e)||$.test(e))){for((v=ee.test(e)&&ge(t.parentNode)||t)===t&&n.scope||((l=t.getAttribute("id"))?l=l.replace(re,ae):t.setAttribute("id",l=w)),s=(h=o(e)).length;s--;)h[s]=(l?"#"+l:":scope")+" "+be(h[s]);g=h.join(",")}try{return I.apply(r,v.querySelectorAll(g)),r}catch(t){A(e,!0)}finally{l===w&&t.removeAttribute("id")}}}return c(e.replace(z,"$1"),t,r,a)}function ce(){var e=[];return function t(n,a){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=a}}function ue(e){return e[w]=!0,e}function le(e){var t=d.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function pe(e,t){for(var n=e.split("|"),a=n.length;a--;)r.attrHandle[n[a]]=t}function fe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function de(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function he(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ye(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&oe(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function me(e){return ue(function(t){return t=+t,ue(function(n,r){for(var a,i=e([],n.length,t),o=i.length;o--;)n[a=i[o]]&&(n[a]=!(r[a]=n[a]))})})}function ge(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=se.support={},i=se.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!J.test(t||n&&n.nodeName||"HTML")},f=se.setDocument=function(e){var t,a,o=e?e.ownerDocument||e:T;return o!=d&&9===o.nodeType&&o.documentElement?(h=(d=o).documentElement,y=!i(d),T!=d&&(a=d.defaultView)&&a.top!==a&&(a.addEventListener?a.addEventListener("unload",ie,!1):a.attachEvent&&a.attachEvent("onunload",ie)),n.scope=le(function(e){return h.appendChild(e).appendChild(d.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),n.attributes=le(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=le(function(e){return e.appendChild(d.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Z.test(d.getElementsByClassName),n.getById=le(function(e){return h.appendChild(e).id=w,!d.getElementsByName||!d.getElementsByName(w).length}),n.getById?(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n,r,a,i=t.getElementById(e);if(i){if((n=i.getAttributeNode("id"))&&n.value===e)return[i];for(a=t.getElementsByName(e),r=0;i=a[r++];)if((n=i.getAttributeNode("id"))&&n.value===e)return[i]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],a=0,i=t.getElementsByTagName(e);if("*"===e){for(;n=i[a++];)1===n.nodeType&&r.push(n);return r}return i},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&y)return t.getElementsByClassName(e)},g=[],m=[],(n.qsa=Z.test(d.querySelectorAll))&&(le(function(e){var t;h.appendChild(e).innerHTML="<a id='"+w+"'></a><select id='"+w+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+L+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+L+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+w+"-]").length||m.push("~="),(t=d.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||m.push("\\["+L+"*name"+L+"*="+L+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+w+"+*").length||m.push(".#.+[+~]"),e.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")}),le(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=d.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+L+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),h.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(n.matchesSelector=Z.test(v=h.matches||h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&le(function(e){n.disconnectedMatch=v.call(e,"*"),v.call(e,"[s!='']:x"),g.push("!=",V)}),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),t=Z.test(h.compareDocumentPosition),b=t||Z.test(h.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},C=t?function(e,t){if(e===t)return p=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e==d||e.ownerDocument==T&&b(T,e)?-1:t==d||t.ownerDocument==T&&b(T,t)?1:l?D(l,e)-D(l,t):0:4&r?-1:1)}:function(e,t){if(e===t)return p=!0,0;var n,r=0,a=e.parentNode,i=t.parentNode,o=[e],s=[t];if(!a||!i)return e==d?-1:t==d?1:a?-1:i?1:l?D(l,e)-D(l,t):0;if(a===i)return fe(e,t);for(n=e;n=n.parentNode;)o.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;o[r]===s[r];)r++;return r?fe(o[r],s[r]):o[r]==T?-1:s[r]==T?1:0},d):d},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(f(e),n.matchesSelector&&y&&!A[t+" "]&&(!g||!g.test(t))&&(!m||!m.test(t)))try{var r=v.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){A(t,!0)}return se(t,d,null,[e]).length>0},se.contains=function(e,t){return(e.ownerDocument||e)!=d&&f(e),b(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=d&&f(e);var a=r.attrHandle[t.toLowerCase()],i=a&&E.call(r.attrHandle,t.toLowerCase())?a(e,t,!y):void 0;return void 0!==i?i:n.attributes||!y?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},se.escape=function(e){return(e+"").replace(re,ae)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,r=[],a=0,i=0;if(p=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(C),p){for(;t=e[i++];)t===e[i]&&(a=r.push(i));for(;a--;)e.splice(r[a],1)}return l=null,e},a=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=a(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=a(t);return n},(r=se.selectors={cacheLength:50,createPseudo:ue,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return X.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&U.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=k[e+" "];return t||(t=new RegExp("(^|"+L+")"+e+"("+L+"|$)"))&&k(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var a=se.attr(r,e);return null==a?"!="===t:!t||(a+="","="===t?a===n:"!="===t?a!==n:"^="===t?n&&0===a.indexOf(n):"*="===t?n&&a.indexOf(n)>-1:"$="===t?n&&a.slice(-n.length)===n:"~="===t?(" "+a.replace(H," ")+" ").indexOf(n)>-1:"|="===t&&(a===n||a.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,a){var i="nth"!==e.slice(0,3),o="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===a?function(e){return!!e.parentNode}:function(t,n,c){var u,l,p,f,d,h,y=i!==o?"nextSibling":"previousSibling",m=t.parentNode,g=s&&t.nodeName.toLowerCase(),v=!c&&!s,b=!1;if(m){if(i){for(;y;){for(f=t;f=f[y];)if(s?f.nodeName.toLowerCase()===g:1===f.nodeType)return!1;h=y="only"===e&&!h&&"nextSibling"}return!0}if(h=[o?m.firstChild:m.lastChild],o&&v){for(b=(d=(u=(l=(p=(f=m)[w]||(f[w]={}))[f.uniqueID]||(p[f.uniqueID]={}))[e]||[])[0]===S&&u[1])&&u[2],f=d&&m.childNodes[d];f=++d&&f&&f[y]||(b=d=0)||h.pop();)if(1===f.nodeType&&++b&&f===t){l[e]=[S,d,b];break}}else if(v&&(b=d=(u=(l=(p=(f=t)[w]||(f[w]={}))[f.uniqueID]||(p[f.uniqueID]={}))[e]||[])[0]===S&&u[1]),!1===b)for(;(f=++d&&f&&f[y]||(b=d=0)||h.pop())&&((s?f.nodeName.toLowerCase()!==g:1!==f.nodeType)||!++b||(v&&((l=(p=f[w]||(f[w]={}))[f.uniqueID]||(p[f.uniqueID]={}))[e]=[S,b]),f!==t)););return(b-=a)===r||b%r==0&&b/r>=0}}},PSEUDO:function(e,t){var n,a=r.pseudos[e]||r.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[w]?a(t):a.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ue(function(e,n){for(var r,i=a(e,t),o=i.length;o--;)e[r=D(e,i[o])]=!(n[r]=i[o])}):function(e){return a(e,0,n)}):a}},pseudos:{not:ue(function(e){var t=[],n=[],r=s(e.replace(z,"$1"));return r[w]?ue(function(e,t,n,a){for(var i,o=r(e,null,a,[]),s=e.length;s--;)(i=o[s])&&(e[s]=!(t[s]=i))}):function(e,a,i){return t[0]=e,r(t,null,i,n),t[0]=null,!n.pop()}}),has:ue(function(e){return function(t){return se(e,t).length>0}}),contains:ue(function(e){return e=e.replace(te,ne),function(t){return(t.textContent||a(t)).indexOf(e)>-1}}),lang:ue(function(e){return G.test(e||"")||se.error("unsupported lang: "+e),e=e.replace(te,ne).toLowerCase(),function(t){var n;do{if(n=y?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ye(!1),disabled:ye(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return K.test(e.nodeName)},input:function(e){return Y.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:me(function(){return[0]}),last:me(function(e,t){return[t-1]}),eq:me(function(e,t,n){return[n<0?n+t:n]}),even:me(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:me(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:me(function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e}),gt:me(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=de(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=he(t);function ve(){}function be(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function we(e,t,n){var r=t.dir,a=t.next,i=a||r,o=n&&"parentNode"===i,s=x++;return t.first?function(t,n,a){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,a);return!1}:function(t,n,c){var u,l,p,f=[S,s];if(c){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,c))return!0}else for(;t=t[r];)if(1===t.nodeType||o)if(l=(p=t[w]||(t[w]={}))[t.uniqueID]||(p[t.uniqueID]={}),a&&a===t.nodeName.toLowerCase())t=t[r]||t;else{if((u=l[i])&&u[0]===S&&u[1]===s)return f[2]=u[2];if(l[i]=f,f[2]=e(t,n,c))return!0}return!1}}function Te(e){return e.length>1?function(t,n,r){for(var a=e.length;a--;)if(!e[a](t,n,r))return!1;return!0}:e[0]}function Se(e,t,n,r,a){for(var i,o=[],s=0,c=e.length,u=null!=t;s<c;s++)(i=e[s])&&(n&&!n(i,r,a)||(o.push(i),u&&t.push(s)));return o}function xe(e,t,n,r,a,i){return r&&!r[w]&&(r=xe(r)),a&&!a[w]&&(a=xe(a,i)),ue(function(i,o,s,c){var u,l,p,f=[],d=[],h=o.length,y=i||function(e,t,n){for(var r=0,a=t.length;r<a;r++)se(e,t[r],n);return n}(t||"*",s.nodeType?[s]:s,[]),m=!e||!i&&t?y:Se(y,f,e,s,c),g=n?a||(i?e:h||r)?[]:o:m;if(n&&n(m,g,s,c),r)for(u=Se(g,d),r(u,[],s,c),l=u.length;l--;)(p=u[l])&&(g[d[l]]=!(m[d[l]]=p));if(i){if(a||e){if(a){for(u=[],l=g.length;l--;)(p=g[l])&&u.push(m[l]=p);a(null,g=[],u,c)}for(l=g.length;l--;)(p=g[l])&&(u=a?D(i,p):f[l])>-1&&(i[u]=!(o[u]=p))}}else g=Se(g===o?g.splice(h,g.length):g),a?a(null,o,g,c):I.apply(o,g)})}function ke(e){for(var t,n,a,i=e.length,o=r.relative[e[0].type],s=o||r.relative[" "],c=o?1:0,l=we(function(e){return e===t},s,!0),p=we(function(e){return D(t,e)>-1},s,!0),f=[function(e,n,r){var a=!o&&(r||n!==u)||((t=n).nodeType?l(e,n,r):p(e,n,r));return t=null,a}];c<i;c++)if(n=r.relative[e[c].type])f=[we(Te(f),n)];else{if((n=r.filter[e[c].type].apply(null,e[c].matches))[w]){for(a=++c;a<i&&!r.relative[e[a].type];a++);return xe(c>1&&Te(f),c>1&&be(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(z,"$1"),n,c<a&&ke(e.slice(c,a)),a<i&&ke(e=e.slice(a)),a<i&&be(e))}f.push(n)}return Te(f)}return ve.prototype=r.filters=r.pseudos,r.setFilters=new ve,o=se.tokenize=function(e,t){var n,a,i,o,s,c,u,l=O[e+" "];if(l)return t?0:l.slice(0);for(s=e,c=[],u=r.preFilter;s;){for(o in n&&!(a=W.exec(s))||(a&&(s=s.slice(a[0].length)||s),c.push(i=[])),n=!1,(a=$.exec(s))&&(n=a.shift(),i.push({value:n,type:a[0].replace(z," ")}),s=s.slice(n.length)),r.filter)!(a=X[o].exec(s))||u[o]&&!(a=u[o](a))||(n=a.shift(),i.push({value:n,type:o,matches:a}),s=s.slice(n.length));if(!n)break}return t?s.length:s?se.error(e):O(e,c).slice(0)},s=se.compile=function(e,t){var n,a=[],i=[],s=j[e+" "];if(!s){for(t||(t=o(e)),n=t.length;n--;)(s=ke(t[n]))[w]?a.push(s):i.push(s);(s=j(e,function(e,t){var n=t.length>0,a=e.length>0,i=function(i,o,s,c,l){var p,h,m,g=0,v="0",b=i&&[],w=[],T=u,x=i||a&&r.find.TAG("*",l),k=S+=null==T?1:Math.random()||.1,O=x.length;for(l&&(u=o==d||o||l);v!==O&&null!=(p=x[v]);v++){if(a&&p){for(h=0,o||p.ownerDocument==d||(f(p),s=!y);m=e[h++];)if(m(p,o||d,s)){c.push(p);break}l&&(S=k)}n&&((p=!m&&p)&&g--,i&&b.push(p))}if(g+=v,n&&v!==g){for(h=0;m=t[h++];)m(b,w,o,s);if(i){if(g>0)for(;v--;)b[v]||w[v]||(w[v]=N.call(c));w=Se(w)}I.apply(c,w),l&&!i&&w.length>0&&g+t.length>1&&se.uniqueSort(c)}return l&&(S=k,u=T),b};return n?ue(i):i}(i,a))).selector=e}return s},c=se.select=function(e,t,n,a){var i,c,u,l,p,f="function"==typeof e&&e,d=!a&&o(e=f.selector||e);if(n=n||[],1===d.length){if((c=d[0]=d[0].slice(0)).length>2&&"ID"===(u=c[0]).type&&9===t.nodeType&&y&&r.relative[c[1].type]){if(!(t=(r.find.ID(u.matches[0].replace(te,ne),t)||[])[0]))return n;f&&(t=t.parentNode),e=e.slice(c.shift().value.length)}for(i=X.needsContext.test(e)?0:c.length;i--&&(u=c[i],!r.relative[l=u.type]);)if((p=r.find[l])&&(a=p(u.matches[0].replace(te,ne),ee.test(c[0].type)&&ge(t.parentNode)||t))){if(c.splice(i,1),!(e=a.length&&be(c)))return I.apply(n,a),n;break}}return(f||s(e,d))(a,t,!y,n,!t||ee.test(e)&&ge(t.parentNode)||t),n},n.sortStable=w.split("").sort(C).join("")===w,n.detectDuplicates=!!p,f(),n.sortDetached=le(function(e){return 1&e.compareDocumentPosition(d.createElement("fieldset"))}),le(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||pe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&le(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||pe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),le(function(e){return null==e.getAttribute("disabled")})||pe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(e);w.find=S,w.expr=S.selectors,w.expr[":"]=w.expr.pseudos,w.uniqueSort=w.unique=S.uniqueSort,w.text=S.getText,w.isXMLDoc=S.isXML,w.contains=S.contains,w.escapeSelector=S.escape;var x=function(e,t,n){for(var r=[],a=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(a&&w(e).is(n))break;r.push(e)}return r},k=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},O=w.expr.match.needsContext;function j(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var A=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function C(e,t,n){return h(t)?w.grep(e,function(e,r){return!!t.call(e,r,e)!==n}):t.nodeType?w.grep(e,function(e){return e===t!==n}):"string"!=typeof t?w.grep(e,function(e){return s.call(t,e)>-1!==n}):w.filter(t,e,n)}w.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?w.find.matchesSelector(r,e)?[r]:[]:w.find.matches(e,w.grep(t,function(e){return 1===e.nodeType}))},w.fn.extend({find:function(e){var t,n,r=this.length,a=this;if("string"!=typeof e)return this.pushStack(w(e).filter(function(){for(t=0;t<r;t++)if(w.contains(a[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)w.find(e,a[t],n);return r>1?w.uniqueSort(n):n},filter:function(e){return this.pushStack(C(this,e||[],!1))},not:function(e){return this.pushStack(C(this,e||[],!0))},is:function(e){return!!C(this,"string"==typeof e&&O.test(e)?w(e):e||[],!1).length}});var E,_=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(w.fn.init=function(e,t,n){var r,a;if(!e)return this;if(n=n||E,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:_.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof w?t[0]:t,w.merge(this,w.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:m,!0)),A.test(r[1])&&w.isPlainObject(t))for(r in t)h(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(a=m.getElementById(r[2]))&&(this[0]=a,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):h(e)?void 0!==n.ready?n.ready(e):e(w):w.makeArray(e,this)}).prototype=w.fn,E=w(m);var N=/^(?:parents|prev(?:Until|All))/,P={children:!0,contents:!0,next:!0,prev:!0};function I(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}w.fn.extend({has:function(e){var t=w(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(w.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,a=this.length,i=[],o="string"!=typeof e&&w(e);if(!O.test(e))for(;r<a;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&w.find.matchesSelector(n,e))){i.push(n);break}return this.pushStack(i.length>1?w.uniqueSort(i):i)},index:function(e){return e?"string"==typeof e?s.call(w(e),this[0]):s.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(w.uniqueSort(w.merge(this.get(),w(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),w.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return x(e,"parentNode")},parentsUntil:function(e,t,n){return x(e,"parentNode",n)},next:function(e){return I(e,"nextSibling")},prev:function(e){return I(e,"previousSibling")},nextAll:function(e){return x(e,"nextSibling")},prevAll:function(e){return x(e,"previousSibling")},nextUntil:function(e,t,n){return x(e,"nextSibling",n)},prevUntil:function(e,t,n){return x(e,"previousSibling",n)},siblings:function(e){return k((e.parentNode||{}).firstChild,e)},children:function(e){return k(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(j(e,"template")&&(e=e.content||e),w.merge([],e.childNodes))}},function(e,t){w.fn[e]=function(n,r){var a=w.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(a=w.filter(r,a)),this.length>1&&(P[e]||w.uniqueSort(a),N.test(e)&&a.reverse()),this.pushStack(a)}});var M=/[^\x20\t\r\n\f]+/g;function D(e){return e}function R(e){throw e}function L(e,t,n,r){var a;try{e&&h(a=e.promise)?a.call(e).done(t).fail(n):e&&h(a=e.then)?a.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}w.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return w.each(e.match(M)||[],function(e,n){t[n]=!0}),t}(e):w.extend({},e);var t,n,r,a,i=[],o=[],s=-1,c=function(){for(a=a||e.once,r=t=!0;o.length;s=-1)for(n=o.shift();++s<i.length;)!1===i[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=i.length,n=!1);e.memory||(n=!1),t=!1,a&&(i=n?[]:"")},u={add:function(){return i&&(n&&!t&&(s=i.length-1,o.push(n)),function t(n){w.each(n,function(n,r){h(r)?e.unique&&u.has(r)||i.push(r):r&&r.length&&"string"!==b(r)&&t(r)})}(arguments),n&&!t&&c()),this},remove:function(){return w.each(arguments,function(e,t){for(var n;(n=w.inArray(t,i,n))>-1;)i.splice(n,1),n<=s&&s--}),this},has:function(e){return e?w.inArray(e,i)>-1:i.length>0},empty:function(){return i&&(i=[]),this},disable:function(){return a=o=[],i=n="",this},disabled:function(){return!i},lock:function(){return a=o=[],n||t||(i=n=""),this},locked:function(){return!!a},fireWith:function(e,n){return a||(n=[e,(n=n||[]).slice?n.slice():n],o.push(n),t||c()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!r}};return u},w.extend({Deferred:function(t){var n=[["notify","progress",w.Callbacks("memory"),w.Callbacks("memory"),2],["resolve","done",w.Callbacks("once memory"),w.Callbacks("once memory"),0,"resolved"],["reject","fail",w.Callbacks("once memory"),w.Callbacks("once memory"),1,"rejected"]],r="pending",a={state:function(){return r},always:function(){return i.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var e=arguments;return w.Deferred(function(t){w.each(n,function(n,r){var a=h(e[r[4]])&&e[r[4]];i[r[1]](function(){var e=a&&a.apply(this,arguments);e&&h(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,a?[e]:arguments)})}),e=null}).promise()},then:function(t,r,a){var i=0;function o(t,n,r,a){return function(){var s=this,c=arguments,u=function(){var e,u;if(!(t<i)){if((e=r.apply(s,c))===n.promise())throw new TypeError("Thenable self-resolution");u=e&&("object"===(void 0===e?"undefined":_typeof(e))||"function"==typeof e)&&e.then,h(u)?a?u.call(e,o(i,n,D,a),o(i,n,R,a)):(i++,u.call(e,o(i,n,D,a),o(i,n,R,a),o(i,n,D,n.notifyWith))):(r!==D&&(s=void 0,c=[e]),(a||n.resolveWith)(s,c))}},l=a?u:function(){try{u()}catch(e){w.Deferred.exceptionHook&&w.Deferred.exceptionHook(e,l.stackTrace),t+1>=i&&(r!==R&&(s=void 0,c=[e]),n.rejectWith(s,c))}};t?l():(w.Deferred.getStackHook&&(l.stackTrace=w.Deferred.getStackHook()),e.setTimeout(l))}}return w.Deferred(function(e){n[0][3].add(o(0,e,h(a)?a:D,e.notifyWith)),n[1][3].add(o(0,e,h(t)?t:D)),n[2][3].add(o(0,e,h(r)?r:R))}).promise()},promise:function(e){return null!=e?w.extend(e,a):a}},i={};return w.each(n,function(e,t){var o=t[2],s=t[5];a[t[1]]=o.add,s&&o.add(function(){r=s},n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),o.add(t[3].fire),i[t[0]]=function(){return i[t[0]+"With"](this===i?void 0:this,arguments),this},i[t[0]+"With"]=o.fireWith}),a.promise(i),t&&t.call(i,i),i},when:function(e){var t=arguments.length,n=t,r=Array(n),i=a.call(arguments),o=w.Deferred(),s=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?a.call(arguments):n,--t||o.resolveWith(r,i)}};if(t<=1&&(L(e,o.done(s(n)).resolve,o.reject,!t),"pending"===o.state()||h(i[n]&&i[n].then)))return o.then();for(;n--;)L(i[n],s(n),o.reject);return o.promise()}});var F=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;w.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&F.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},w.readyException=function(t){e.setTimeout(function(){throw t})};var q=w.Deferred();function V(){m.removeEventListener("DOMContentLoaded",V),e.removeEventListener("load",V),w.ready()}w.fn.ready=function(e){return q.then(e).catch(function(e){w.readyException(e)}),this},w.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--w.readyWait:w.isReady)||(w.isReady=!0,!0!==e&&--w.readyWait>0||q.resolveWith(m,[w]))}}),w.ready.then=q.then,"complete"===m.readyState||"loading"!==m.readyState&&!m.documentElement.doScroll?e.setTimeout(w.ready):(m.addEventListener("DOMContentLoaded",V),e.addEventListener("load",V));var H=function e(t,n,r,a,i,o,s){var c=0,u=t.length,l=null==r;if("object"===b(r))for(c in i=!0,r)e(t,n,c,r[c],!0,o,s);else if(void 0!==a&&(i=!0,h(a)||(s=!0),l&&(s?(n.call(t,a),n=null):(l=n,n=function(e,t,n){return l.call(w(e),n)})),n))for(;c<u;c++)n(t[c],r,s?a:a.call(t[c],c,n(t[c],r)));return i?t:l?n.call(t):u?n(t[0],r):o},z=/^-ms-/,W=/-([a-z])/g;function $(e,t){return t.toUpperCase()}function B(e){return e.replace(z,"ms-").replace(W,$)}var U=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=w.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},U(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,a=this.cache(e);if("string"==typeof t)a[B(t)]=n;else for(r in t)a[B(r)]=t[r];return a},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][B(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(B):(t=B(t))in r?[t]:t.match(M)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||w.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!w.isEmptyObject(t)}};var X=new G,J=new G,Y=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Y.test(e)?JSON.parse(e):e)}(n)}catch(e){}J.set(e,t,n)}else n=void 0;return n}w.extend({hasData:function(e){return J.hasData(e)||X.hasData(e)},data:function(e,t,n){return J.access(e,t,n)},removeData:function(e,t){J.remove(e,t)},_data:function(e,t,n){return X.access(e,t,n)},_removeData:function(e,t){X.remove(e,t)}}),w.fn.extend({data:function(e,t){var n,r,a,i=this[0],o=i&&i.attributes;if(void 0===e){if(this.length&&(a=J.get(i),1===i.nodeType&&!X.get(i,"hasDataAttrs"))){for(n=o.length;n--;)o[n]&&0===(r=o[n].name).indexOf("data-")&&(r=B(r.slice(5)),Z(i,r,a[r]));X.set(i,"hasDataAttrs",!0)}return a}return"object"===(void 0===e?"undefined":_typeof(e))?this.each(function(){J.set(this,e)}):H(this,function(t){var n;if(i&&void 0===t)return void 0!==(n=J.get(i,e))?n:void 0!==(n=Z(i,e))?n:void 0;this.each(function(){J.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){J.remove(this,e)})}}),w.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=X.get(e,t),n&&(!r||Array.isArray(n)?r=X.access(e,t,w.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=w.queue(e,t),r=n.length,a=n.shift(),i=w._queueHooks(e,t);"inprogress"===a&&(a=n.shift(),r--),a&&("fx"===t&&n.unshift("inprogress"),delete i.stop,a.call(e,function(){w.dequeue(e,t)},i)),!r&&i&&i.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return X.get(e,n)||X.access(e,n,{empty:w.Callbacks("once memory").add(function(){X.remove(e,[t+"queue",n])})})}}),w.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?w.queue(this[0],e):void 0===t?this:this.each(function(){var n=w.queue(this,e,t);w._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&w.dequeue(this,e)})},dequeue:function(e){return this.each(function(){w.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,a=w.Deferred(),i=this,o=this.length,s=function(){--r||a.resolveWith(i,[i])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)(n=X.get(i[o],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),a.promise(t)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ee=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),te=["Top","Right","Bottom","Left"],ne=m.documentElement,re=function(e){return w.contains(e.ownerDocument,e)},ae={composed:!0};ne.getRootNode&&(re=function(e){return w.contains(e.ownerDocument,e)||e.getRootNode(ae)===e.ownerDocument});var ie=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&re(e)&&"none"===w.css(e,"display")};function oe(e,t,n,r){var a,i,o=20,s=r?function(){return r.cur()}:function(){return w.css(e,t,"")},c=s(),u=n&&n[3]||(w.cssNumber[t]?"":"px"),l=e.nodeType&&(w.cssNumber[t]||"px"!==u&&+c)&&ee.exec(w.css(e,t));if(l&&l[3]!==u){for(c/=2,u=u||l[3],l=+c||1;o--;)w.style(e,t,l+u),(1-i)*(1-(i=s()/c||.5))<=0&&(o=0),l/=i;l*=2,w.style(e,t,l+u),n=n||[]}return n&&(l=+l||+c||0,a=n[1]?l+(n[1]+1)*n[2]:+n[2],r&&(r.unit=u,r.start=l,r.end=a)),a}var se={};function ce(e){var t,n=e.ownerDocument,r=e.nodeName,a=se[r];return a||(t=n.body.appendChild(n.createElement(r)),a=w.css(t,"display"),t.parentNode.removeChild(t),"none"===a&&(a="block"),se[r]=a,a)}function ue(e,t){for(var n,r,a=[],i=0,o=e.length;i<o;i++)(r=e[i]).style&&(n=r.style.display,t?("none"===n&&(a[i]=X.get(r,"display")||null,a[i]||(r.style.display="")),""===r.style.display&&ie(r)&&(a[i]=ce(r))):"none"!==n&&(a[i]="none",X.set(r,"display",n)));for(i=0;i<o;i++)null!=a[i]&&(e[i].style.display=a[i]);return e}w.fn.extend({show:function(){return ue(this,!0)},hide:function(){return ue(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ie(this)?w(this).show():w(this).hide()})}});var le,pe,fe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;le=m.createDocumentFragment().appendChild(m.createElement("div")),(pe=m.createElement("input")).setAttribute("type","radio"),pe.setAttribute("checked","checked"),pe.setAttribute("name","t"),le.appendChild(pe),d.checkClone=le.cloneNode(!0).cloneNode(!0).lastChild.checked,le.innerHTML="<textarea>x</textarea>",d.noCloneChecked=!!le.cloneNode(!0).lastChild.defaultValue,le.innerHTML="<option></option>",d.option=!!le.lastChild;var ye={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function me(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&j(e,t)?w.merge([e],n):n}function ge(e,t){for(var n=0,r=e.length;n<r;n++)X.set(e[n],"globalEval",!t||X.get(t[n],"globalEval"))}ye.tbody=ye.tfoot=ye.colgroup=ye.caption=ye.thead,ye.th=ye.td,d.option||(ye.optgroup=ye.option=[1,"<select multiple='multiple'>","</select>"]);var ve=/<|&#?\w+;/;function be(e,t,n,r,a){for(var i,o,s,c,u,l,p=t.createDocumentFragment(),f=[],d=0,h=e.length;d<h;d++)if((i=e[d])||0===i)if("object"===b(i))w.merge(f,i.nodeType?[i]:i);else if(ve.test(i)){for(o=o||p.appendChild(t.createElement("div")),s=(de.exec(i)||["",""])[1].toLowerCase(),c=ye[s]||ye._default,o.innerHTML=c[1]+w.htmlPrefilter(i)+c[2],l=c[0];l--;)o=o.lastChild;w.merge(f,o.childNodes),(o=p.firstChild).textContent=""}else f.push(t.createTextNode(i));for(p.textContent="",d=0;i=f[d++];)if(r&&w.inArray(i,r)>-1)a&&a.push(i);else if(u=re(i),o=me(p.appendChild(i),"script"),u&&ge(o),n)for(l=0;i=o[l++];)he.test(i.type||"")&&n.push(i);return p}var we=/^key/,Te=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Se=/^([^.]*)(?:\.(.+)|)/;function xe(){return!0}function ke(){return!1}function Oe(e,t){return e===function(){try{return m.activeElement}catch(e){}}()==("focus"===t)}function je(e,t,n,r,a,i){var o,s;if("object"===(void 0===t?"undefined":_typeof(t))){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)je(e,s,n,r,t[s],i);return e}if(null==r&&null==a?(a=n,r=n=void 0):null==a&&("string"==typeof n?(a=r,r=void 0):(a=r,r=n,n=void 0)),!1===a)a=ke;else if(!a)return e;return 1===i&&(o=a,(a=function(e){return w().off(e),o.apply(this,arguments)}).guid=o.guid||(o.guid=w.guid++)),e.each(function(){w.event.add(this,t,a,r,n)})}function Ae(e,t,n){n?(X.set(e,t,!1),w.event.add(e,t,{namespace:!1,handler:function(e){var r,i,o=X.get(this,t);if(1&e.isTrigger&&this[t]){if(o.length)(w.event.special[t]||{}).delegateType&&e.stopPropagation();else if(o=a.call(arguments),X.set(this,t,o),r=n(this,t),this[t](),o!==(i=X.get(this,t))||r?X.set(this,t,!1):i={},o!==i)return e.stopImmediatePropagation(),e.preventDefault(),i.value}else o.length&&(X.set(this,t,{value:w.event.trigger(w.extend(o[0],w.Event.prototype),o.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===X.get(e,t)&&w.event.add(e,t,xe)}w.event={global:{},add:function(e,t,n,r,a){var i,o,s,c,u,l,p,f,d,h,y,m=X.get(e);if(U(e))for(n.handler&&(n=(i=n).handler,a=i.selector),a&&w.find.matchesSelector(ne,a),n.guid||(n.guid=w.guid++),(c=m.events)||(c=m.events=Object.create(null)),(o=m.handle)||(o=m.handle=function(t){return void 0!==w&&w.event.triggered!==t.type?w.event.dispatch.apply(e,arguments):void 0}),u=(t=(t||"").match(M)||[""]).length;u--;)d=y=(s=Se.exec(t[u])||[])[1],h=(s[2]||"").split(".").sort(),d&&(p=w.event.special[d]||{},d=(a?p.delegateType:p.bindType)||d,p=w.event.special[d]||{},l=w.extend({type:d,origType:y,data:r,handler:n,guid:n.guid,selector:a,needsContext:a&&w.expr.match.needsContext.test(a),namespace:h.join(".")},i),(f=c[d])||((f=c[d]=[]).delegateCount=0,p.setup&&!1!==p.setup.call(e,r,h,o)||e.addEventListener&&e.addEventListener(d,o)),p.add&&(p.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),a?f.splice(f.delegateCount++,0,l):f.push(l),w.event.global[d]=!0)},remove:function(e,t,n,r,a){var i,o,s,c,u,l,p,f,d,h,y,m=X.hasData(e)&&X.get(e);if(m&&(c=m.events)){for(u=(t=(t||"").match(M)||[""]).length;u--;)if(d=y=(s=Se.exec(t[u])||[])[1],h=(s[2]||"").split(".").sort(),d){for(p=w.event.special[d]||{},f=c[d=(r?p.delegateType:p.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=i=f.length;i--;)l=f[i],!a&&y!==l.origType||n&&n.guid!==l.guid||s&&!s.test(l.namespace)||r&&r!==l.selector&&("**"!==r||!l.selector)||(f.splice(i,1),l.selector&&f.delegateCount--,p.remove&&p.remove.call(e,l));o&&!f.length&&(p.teardown&&!1!==p.teardown.call(e,h,m.handle)||w.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)w.event.remove(e,d+t[u],n,r,!0);w.isEmptyObject(c)&&X.remove(e,"handle events")}},dispatch:function(e){var t,n,r,a,i,o,s=new Array(arguments.length),c=w.event.fix(e),u=(X.get(this,"events")||Object.create(null))[c.type]||[],l=w.event.special[c.type]||{};for(s[0]=c,t=1;t<arguments.length;t++)s[t]=arguments[t];if(c.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,c)){for(o=w.event.handlers.call(this,c,u),t=0;(a=o[t++])&&!c.isPropagationStopped();)for(c.currentTarget=a.elem,n=0;(i=a.handlers[n++])&&!c.isImmediatePropagationStopped();)c.rnamespace&&!1!==i.namespace&&!c.rnamespace.test(i.namespace)||(c.handleObj=i,c.data=i.data,void 0!==(r=((w.event.special[i.origType]||{}).handle||i.handler).apply(a.elem,s))&&!1===(c.result=r)&&(c.preventDefault(),c.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,c),c.result}},handlers:function(e,t){var n,r,a,i,o,s=[],c=t.delegateCount,u=e.target;if(c&&u.nodeType&&!("click"===e.type&&e.button>=1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&("click"!==e.type||!0!==u.disabled)){for(i=[],o={},n=0;n<c;n++)void 0===o[a=(r=t[n]).selector+" "]&&(o[a]=r.needsContext?w(a,this).index(u)>-1:w.find(a,this,null,[u]).length),o[a]&&i.push(r);i.length&&s.push({elem:u,handlers:i})}return u=this,c<t.length&&s.push({elem:u,handlers:t.slice(c)}),s},addProp:function(e,t){Object.defineProperty(w.Event.prototype,e,{enumerable:!0,configurable:!0,get:h(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[w.expando]?e:new w.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return fe.test(t.type)&&t.click&&j(t,"input")&&Ae(t,"click",xe),!1},trigger:function(e){var t=this||e;return fe.test(t.type)&&t.click&&j(t,"input")&&Ae(t,"click"),!0},_default:function(e){var t=e.target;return fe.test(t.type)&&t.click&&j(t,"input")&&X.get(t,"click")||j(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},w.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},w.Event=function(e,t){if(!(this instanceof w.Event))return new w.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?xe:ke,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&w.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[w.expando]=!0},w.Event.prototype={constructor:w.Event,isDefaultPrevented:ke,isPropagationStopped:ke,isImmediatePropagationStopped:ke,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=xe,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=xe,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=xe,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},w.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&we.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Te.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},w.event.addProp),w.each({focus:"focusin",blur:"focusout"},function(e,t){w.event.special[e]={setup:function(){return Ae(this,e,Oe),!1},trigger:function(){return Ae(this,e),!0},delegateType:t}}),w.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){w.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=e.relatedTarget,a=e.handleObj;return r&&(r===this||w.contains(this,r))||(e.type=a.origType,n=a.handler.apply(this,arguments),e.type=t),n}}}),w.fn.extend({on:function(e,t,n,r){return je(this,e,t,n,r)},one:function(e,t,n,r){return je(this,e,t,n,r,1)},off:function(e,t,n){var r,a;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,w(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"===(void 0===e?"undefined":_typeof(e))){for(a in e)this.off(a,t,e[a]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=ke),this.each(function(){w.event.remove(this,e,n,t)})}});var Ce=/<script|<style|<link/i,Ee=/checked\s*(?:[^=]|=\s*.checked.)/i,_e=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ne(e,t){return j(e,"table")&&j(11!==t.nodeType?t:t.firstChild,"tr")&&w(e).children("tbody")[0]||e}function Pe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Ie(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Me(e,t){var n,r,a,i,o,s;if(1===t.nodeType){if(X.hasData(e)&&(s=X.get(e).events))for(a in X.remove(t,"handle events"),s)for(n=0,r=s[a].length;n<r;n++)w.event.add(t,a,s[a][n]);J.hasData(e)&&(i=J.access(e),o=w.extend({},i),J.set(t,o))}}function De(e,t,n,r){t=i(t);var a,o,s,c,u,l,p=0,f=e.length,y=f-1,m=t[0],g=h(m);if(g||f>1&&"string"==typeof m&&!d.checkClone&&Ee.test(m))return e.each(function(a){var i=e.eq(a);g&&(t[0]=m.call(this,a,i.html())),De(i,t,n,r)});if(f&&(o=(a=be(t,e[0].ownerDocument,!1,e,r)).firstChild,1===a.childNodes.length&&(a=o),o||r)){for(c=(s=w.map(me(a,"script"),Pe)).length;p<f;p++)u=a,p!==y&&(u=w.clone(u,!0,!0),c&&w.merge(s,me(u,"script"))),n.call(e[p],u,p);if(c)for(l=s[s.length-1].ownerDocument,w.map(s,Ie),p=0;p<c;p++)u=s[p],he.test(u.type||"")&&!X.access(u,"globalEval")&&w.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?w._evalUrl&&!u.noModule&&w._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):v(u.textContent.replace(_e,""),u,l))}return e}function Re(e,t,n){for(var r,a=t?w.filter(t,e):e,i=0;null!=(r=a[i]);i++)n||1!==r.nodeType||w.cleanData(me(r)),r.parentNode&&(n&&re(r)&&ge(me(r,"script")),r.parentNode.removeChild(r));return e}w.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,a,i,o,s,c,u,l=e.cloneNode(!0),p=re(e);if(!(d.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||w.isXMLDoc(e)))for(o=me(l),r=0,a=(i=me(e)).length;r<a;r++)s=i[r],c=o[r],void 0,"input"===(u=c.nodeName.toLowerCase())&&fe.test(s.type)?c.checked=s.checked:"input"!==u&&"textarea"!==u||(c.defaultValue=s.defaultValue);if(t)if(n)for(i=i||me(e),o=o||me(l),r=0,a=i.length;r<a;r++)Me(i[r],o[r]);else Me(e,l);return(o=me(l,"script")).length>0&&ge(o,!p&&me(e,"script")),l},cleanData:function(e){for(var t,n,r,a=w.event.special,i=0;void 0!==(n=e[i]);i++)if(U(n)){if(t=n[X.expando]){if(t.events)for(r in t.events)a[r]?w.event.remove(n,r):w.removeEvent(n,r,t.handle);n[X.expando]=void 0}n[J.expando]&&(n[J.expando]=void 0)}}}),w.fn.extend({detach:function(e){return Re(this,e,!0)},remove:function(e){return Re(this,e)},text:function(e){return H(this,function(e){return void 0===e?w.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return De(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ne(this,e).appendChild(e)})},prepend:function(){return De(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ne(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return De(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return De(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(w.cleanData(me(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return w.clone(this,e,t)})},html:function(e){return H(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ce.test(e)&&!ye[(de.exec(e)||["",""])[1].toLowerCase()]){e=w.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(w.cleanData(me(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return De(this,arguments,function(t){var n=this.parentNode;w.inArray(this,e)<0&&(w.cleanData(me(this)),n&&n.replaceChild(t,this))},e)}}),w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){w.fn[e]=function(e){for(var n,r=[],a=w(e),i=a.length-1,s=0;s<=i;s++)n=s===i?this:this.clone(!0),w(a[s])[t](n),o.apply(r,n.get());return this.pushStack(r)}});var Le=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),Fe=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},qe=function(e,t,n){var r,a,i={};for(a in t)i[a]=e.style[a],e.style[a]=t[a];for(a in r=n.call(e),t)e.style[a]=i[a];return r},Ve=new RegExp(te.join("|"),"i");function He(e,t,n){var r,a,i,o,s=e.style;return(n=n||Fe(e))&&(""!==(o=n.getPropertyValue(t)||n[t])||re(e)||(o=w.style(e,t)),!d.pixelBoxStyles()&&Le.test(o)&&Ve.test(t)&&(r=s.width,a=s.minWidth,i=s.maxWidth,s.minWidth=s.maxWidth=s.width=o,o=n.width,s.width=r,s.minWidth=a,s.maxWidth=i)),void 0!==o?o+"":o}function ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function t(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ne.appendChild(u).appendChild(l);var t=e.getComputedStyle(l);r="1%"!==t.top,c=12===n(t.marginLeft),l.style.right="60%",o=36===n(t.right),a=36===n(t.width),l.style.position="absolute",i=12===n(l.offsetWidth/3),ne.removeChild(u),l=null}}function n(e){return Math.round(parseFloat(e))}var r,a,i,o,s,c,u=m.createElement("div"),l=m.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",d.clearCloneStyle="content-box"===l.style.backgroundClip,w.extend(d,{boxSizingReliable:function(){return t(),a},pixelBoxStyles:function(){return t(),o},pixelPosition:function(){return t(),r},reliableMarginLeft:function(){return t(),c},scrollboxSize:function(){return t(),i},reliableTrDimensions:function(){var t,n,r,a;return null==s&&(t=m.createElement("table"),n=m.createElement("tr"),r=m.createElement("div"),t.style.cssText="position:absolute;left:-11111px",n.style.height="1px",r.style.height="9px",ne.appendChild(t).appendChild(n).appendChild(r),a=e.getComputedStyle(n),s=parseInt(a.height)>3,ne.removeChild(t)),s}}))}();var We=["Webkit","Moz","ms"],$e=m.createElement("div").style,Be={};function Ue(e){var t=w.cssProps[e]||Be[e];return t||(e in $e?e:Be[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=We.length;n--;)if((e=We[n]+t)in $e)return e}(e)||e)}var Ge=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Je={position:"absolute",visibility:"hidden",display:"block"},Ye={letterSpacing:"0",fontWeight:"400"};function Ke(e,t,n){var r=ee.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Ze(e,t,n,r,a,i){var o="width"===t?1:0,s=0,c=0;if(n===(r?"border":"content"))return 0;for(;o<4;o+=2)"margin"===n&&(c+=w.css(e,n+te[o],!0,a)),r?("content"===n&&(c-=w.css(e,"padding"+te[o],!0,a)),"margin"!==n&&(c-=w.css(e,"border"+te[o]+"Width",!0,a))):(c+=w.css(e,"padding"+te[o],!0,a),"padding"!==n?c+=w.css(e,"border"+te[o]+"Width",!0,a):s+=w.css(e,"border"+te[o]+"Width",!0,a));return!r&&i>=0&&(c+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-i-c-s-.5))||0),c}function Qe(e,t,n){var r=Fe(e),a=(!d.boxSizingReliable()||n)&&"border-box"===w.css(e,"boxSizing",!1,r),i=a,o=He(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Le.test(o)){if(!n)return o;o="auto"}return(!d.boxSizingReliable()&&a||!d.reliableTrDimensions()&&j(e,"tr")||"auto"===o||!parseFloat(o)&&"inline"===w.css(e,"display",!1,r))&&e.getClientRects().length&&(a="border-box"===w.css(e,"boxSizing",!1,r),(i=s in e)&&(o=e[s])),(o=parseFloat(o)||0)+Ze(e,t,n||(a?"border":"content"),i,r,o)+"px"}function et(e,t,n,r,a){return new et.prototype.init(e,t,n,r,a)}w.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=He(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var a,i,o,s=B(t),c=Xe.test(t),u=e.style;if(c||(t=Ue(s)),o=w.cssHooks[t]||w.cssHooks[s],void 0===n)return o&&"get"in o&&void 0!==(a=o.get(e,!1,r))?a:u[t];"string"===(i=void 0===n?"undefined":_typeof(n))&&(a=ee.exec(n))&&a[1]&&(n=oe(e,t,a),i="number"),null!=n&&n==n&&("number"!==i||c||(n+=a&&a[3]||(w.cssNumber[s]?"":"px")),d.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),o&&"set"in o&&void 0===(n=o.set(e,n,r))||(c?u.setProperty(t,n):u[t]=n))}},css:function(e,t,n,r){var a,i,o,s=B(t);return Xe.test(t)||(t=Ue(s)),(o=w.cssHooks[t]||w.cssHooks[s])&&"get"in o&&(a=o.get(e,!0,n)),void 0===a&&(a=He(e,t,r)),"normal"===a&&t in Ye&&(a=Ye[t]),""===n||n?(i=parseFloat(a),!0===n||isFinite(i)?i||0:a):a}}),w.each(["height","width"],function(e,t){w.cssHooks[t]={get:function(e,n,r){if(n)return!Ge.test(w.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Qe(e,t,r):qe(e,Je,function(){return Qe(e,t,r)})},set:function(e,n,r){var a,i=Fe(e),o=!d.scrollboxSize()&&"absolute"===i.position,s=(o||r)&&"border-box"===w.css(e,"boxSizing",!1,i),c=r?Ze(e,t,r,s,i):0;return s&&o&&(c-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(i[t])-Ze(e,t,"border",!1,i)-.5)),c&&(a=ee.exec(n))&&"px"!==(a[3]||"px")&&(e.style[t]=n,n=w.css(e,t)),Ke(0,n,c)}}}),w.cssHooks.marginLeft=ze(d.reliableMarginLeft,function(e,t){if(t)return(parseFloat(He(e,"marginLeft"))||e.getBoundingClientRect().left-qe(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),w.each({margin:"",padding:"",border:"Width"},function(e,t){w.cssHooks[e+t]={expand:function(n){for(var r=0,a={},i="string"==typeof n?n.split(" "):[n];r<4;r++)a[e+te[r]+t]=i[r]||i[r-2]||i[0];return a}},"margin"!==e&&(w.cssHooks[e+t].set=Ke)}),w.fn.extend({css:function(e,t){return H(this,function(e,t,n){var r,a,i={},o=0;if(Array.isArray(t)){for(r=Fe(e),a=t.length;o<a;o++)i[t[o]]=w.css(e,t[o],!1,r);return i}return void 0!==n?w.style(e,t,n):w.css(e,t)},e,t,arguments.length>1)}}),w.Tween=et,et.prototype={constructor:et,init:function(e,t,n,r,a,i){this.elem=e,this.prop=n,this.easing=a||w.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=i||(w.cssNumber[n]?"":"px")},cur:function(){var e=et.propHooks[this.prop];return e&&e.get?e.get(this):et.propHooks._default.get(this)},run:function(e){var t,n=et.propHooks[this.prop];return this.options.duration?this.pos=t=w.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):et.propHooks._default.set(this),this}},et.prototype.init.prototype=et.prototype,et.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=w.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){w.fx.step[e.prop]?w.fx.step[e.prop](e):1!==e.elem.nodeType||!w.cssHooks[e.prop]&&null==e.elem.style[Ue(e.prop)]?e.elem[e.prop]=e.now:w.style(e.elem,e.prop,e.now+e.unit)}}},et.propHooks.scrollTop=et.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},w.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},w.fx=et.prototype.init,w.fx.step={};var tt,nt,rt=/^(?:toggle|show|hide)$/,at=/queueHooks$/;function it(){nt&&(!1===m.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(it):e.setTimeout(it,w.fx.interval),w.fx.tick())}function ot(){return e.setTimeout(function(){tt=void 0}),tt=Date.now()}function st(e,t){var n,r=0,a={height:e};for(t=t?1:0;r<4;r+=2-t)a["margin"+(n=te[r])]=a["padding"+n]=e;return t&&(a.opacity=a.width=e),a}function ct(e,t,n){for(var r,a=(ut.tweeners[t]||[]).concat(ut.tweeners["*"]),i=0,o=a.length;i<o;i++)if(r=a[i].call(n,t,e))return r}function ut(e,t,n){var r,a,i=0,o=ut.prefilters.length,s=w.Deferred().always(function(){delete c.elem}),c=function(){if(a)return!1;for(var t=tt||ot(),n=Math.max(0,u.startTime+u.duration-t),r=1-(n/u.duration||0),i=0,o=u.tweens.length;i<o;i++)u.tweens[i].run(r);return s.notifyWith(e,[u,r,n]),r<1&&o?n:(o||s.notifyWith(e,[u,1,0]),s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:w.extend({},t),opts:w.extend(!0,{specialEasing:{},easing:w.easing._default},n),originalProperties:t,originalOptions:n,startTime:tt||ot(),duration:n.duration,tweens:[],createTween:function(t,n){var r=w.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(r),r},stop:function(t){var n=0,r=t?u.tweens.length:0;if(a)return this;for(a=!0;n<r;n++)u.tweens[n].run(1);return t?(s.notifyWith(e,[u,1,0]),s.resolveWith(e,[u,t])):s.rejectWith(e,[u,t]),this}}),l=u.props;for(!function(e,t){var n,r,a,i,o;for(n in e)if(a=t[r=B(n)],i=e[n],Array.isArray(i)&&(a=i[1],i=e[n]=i[0]),n!==r&&(e[r]=i,delete e[n]),(o=w.cssHooks[r])&&"expand"in o)for(n in i=o.expand(i),delete e[r],i)n in e||(e[n]=i[n],t[n]=a);else t[r]=a}(l,u.opts.specialEasing);i<o;i++)if(r=ut.prefilters[i].call(u,e,l,u.opts))return h(r.stop)&&(w._queueHooks(u.elem,u.opts.queue).stop=r.stop.bind(r)),r;return w.map(l,ct,u),h(u.opts.start)&&u.opts.start.call(e,u),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always),w.fx.timer(w.extend(c,{elem:e,anim:u,queue:u.opts.queue})),u}w.Animation=w.extend(ut,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return oe(n.elem,e,ee.exec(t),n),n}]},tweener:function(e,t){h(e)?(t=e,e=["*"]):e=e.match(M);for(var n,r=0,a=e.length;r<a;r++)n=e[r],ut.tweeners[n]=ut.tweeners[n]||[],ut.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,a,i,o,s,c,u,l,p="width"in t||"height"in t,f=this,d={},h=e.style,y=e.nodeType&&ie(e),m=X.get(e,"fxshow");for(r in n.queue||(null==(o=w._queueHooks(e,"fx")).unqueued&&(o.unqueued=0,s=o.empty.fire,o.empty.fire=function(){o.unqueued||s()}),o.unqueued++,f.always(function(){f.always(function(){o.unqueued--,w.queue(e,"fx").length||o.empty.fire()})})),t)if(a=t[r],rt.test(a)){if(delete t[r],i=i||"toggle"===a,a===(y?"hide":"show")){if("show"!==a||!m||void 0===m[r])continue;y=!0}d[r]=m&&m[r]||w.style(e,r)}if((c=!w.isEmptyObject(t))||!w.isEmptyObject(d))for(r in p&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(u=m&&m.display)&&(u=X.get(e,"display")),"none"===(l=w.css(e,"display"))&&(u?l=u:(ue([e],!0),u=e.style.display||u,l=w.css(e,"display"),ue([e]))),("inline"===l||"inline-block"===l&&null!=u)&&"none"===w.css(e,"float")&&(c||(f.done(function(){h.display=u}),null==u&&(l=h.display,u="none"===l?"":l)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",f.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),c=!1,d)c||(m?"hidden"in m&&(y=m.hidden):m=X.access(e,"fxshow",{display:u}),i&&(m.hidden=!y),y&&ue([e],!0),f.done(function(){for(r in y||ue([e]),X.remove(e,"fxshow"),d)w.style(e,r,d[r])})),c=ct(y?m[r]:0,r,f),r in m||(m[r]=c.start,y&&(c.end=c.start,c.start=0))}],prefilter:function(e,t){t?ut.prefilters.unshift(e):ut.prefilters.push(e)}}),w.speed=function(e,t,n){var r=e&&"object"===(void 0===e?"undefined":_typeof(e))?w.extend({},e):{complete:n||!n&&t||h(e)&&e,duration:e,easing:n&&t||t&&!h(t)&&t};return w.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in w.fx.speeds?r.duration=w.fx.speeds[r.duration]:r.duration=w.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){h(r.old)&&r.old.call(this),r.queue&&w.dequeue(this,r.queue)},r},w.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ie).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var a=w.isEmptyObject(e),i=w.speed(t,n,r),o=function(){var t=ut(this,w.extend({},e),i);(a||X.get(this,"finish"))&&t.stop(!0)};return o.finish=o,a||!1===i.queue?this.each(o):this.queue(i.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each(function(){var t=!0,a=null!=e&&e+"queueHooks",i=w.timers,o=X.get(this);if(a)o[a]&&o[a].stop&&r(o[a]);else for(a in o)o[a]&&o[a].stop&&at.test(a)&&r(o[a]);for(a=i.length;a--;)i[a].elem!==this||null!=e&&i[a].queue!==e||(i[a].anim.stop(n),t=!1,i.splice(a,1));!t&&n||w.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=X.get(this),r=n[e+"queue"],a=n[e+"queueHooks"],i=w.timers,o=r?r.length:0;for(n.finish=!0,w.queue(this,e,[]),a&&a.stop&&a.stop.call(this,!0),t=i.length;t--;)i[t].elem===this&&i[t].queue===e&&(i[t].anim.stop(!0),i.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),w.each(["toggle","show","hide"],function(e,t){var n=w.fn[t];w.fn[t]=function(e,r,a){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(st(t,!0),e,r,a)}}),w.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){w.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),w.timers=[],w.fx.tick=function(){var e,t=0,n=w.timers;for(tt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||w.fx.stop(),tt=void 0},w.fx.timer=function(e){w.timers.push(e),w.fx.start()},w.fx.interval=13,w.fx.start=function(){nt||(nt=!0,it())},w.fx.stop=function(){nt=null},w.fx.speeds={slow:600,fast:200,_default:400},w.fn.delay=function(t,n){return t=w.fx&&w.fx.speeds[t]||t,n=n||"fx",this.queue(n,function(n,r){var a=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(a)}})},function(){var e=m.createElement("input"),t=m.createElement("select").appendChild(m.createElement("option"));e.type="checkbox",d.checkOn=""!==e.value,d.optSelected=t.selected,(e=m.createElement("input")).value="t",e.type="radio",d.radioValue="t"===e.value}();var lt,pt=w.expr.attrHandle;w.fn.extend({attr:function(e,t){return H(this,w.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){w.removeAttr(this,e)})}}),w.extend({attr:function(e,t,n){var r,a,i=e.nodeType;if(3!==i&&8!==i&&2!==i)return void 0===e.getAttribute?w.prop(e,t,n):(1===i&&w.isXMLDoc(e)||(a=w.attrHooks[t.toLowerCase()]||(w.expr.match.bool.test(t)?lt:void 0)),void 0!==n?null===n?void w.removeAttr(e,t):a&&"set"in a&&void 0!==(r=a.set(e,n,t))?r:(e.setAttribute(t,n+""),n):a&&"get"in a&&null!==(r=a.get(e,t))?r:null==(r=w.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!d.radioValue&&"radio"===t&&j(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,a=t&&t.match(M);if(a&&1===e.nodeType)for(;n=a[r++];)e.removeAttribute(n)}}),lt={set:function(e,t,n){return!1===t?w.removeAttr(e,n):e.setAttribute(n,n),n}},w.each(w.expr.match.bool.source.match(/\w+/g),function(e,t){var n=pt[t]||w.find.attr;pt[t]=function(e,t,r){var a,i,o=t.toLowerCase();return r||(i=pt[o],pt[o]=a,a=null!=n(e,t,r)?o:null,pt[o]=i),a}});var ft=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(M)||[]).join(" ")}function yt(e){return e.getAttribute&&e.getAttribute("class")||""}function mt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(M)||[]}w.fn.extend({prop:function(e,t){return H(this,w.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[w.propFix[e]||e]})}}),w.extend({prop:function(e,t,n){var r,a,i=e.nodeType;if(3!==i&&8!==i&&2!==i)return 1===i&&w.isXMLDoc(e)||(t=w.propFix[t]||t,a=w.propHooks[t]),void 0!==n?a&&"set"in a&&void 0!==(r=a.set(e,n,t))?r:e[t]=n:a&&"get"in a&&null!==(r=a.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=w.find.attr(e,"tabindex");return t?parseInt(t,10):ft.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),d.optSelected||(w.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),w.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){w.propFix[this.toLowerCase()]=this}),w.fn.extend({addClass:function(e){var t,n,r,a,i,o,s,c=0;if(h(e))return this.each(function(t){w(this).addClass(e.call(this,t,yt(this)))});if((t=mt(e)).length)for(;n=this[c++];)if(a=yt(n),r=1===n.nodeType&&" "+ht(a)+" "){for(o=0;i=t[o++];)r.indexOf(" "+i+" ")<0&&(r+=i+" ");a!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,r,a,i,o,s,c=0;if(h(e))return this.each(function(t){w(this).removeClass(e.call(this,t,yt(this)))});if(!arguments.length)return this.attr("class","");if((t=mt(e)).length)for(;n=this[c++];)if(a=yt(n),r=1===n.nodeType&&" "+ht(a)+" "){for(o=0;i=t[o++];)for(;r.indexOf(" "+i+" ")>-1;)r=r.replace(" "+i+" "," ");a!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n=void 0===e?"undefined":_typeof(e),r="string"===n||Array.isArray(e);return"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):h(e)?this.each(function(n){w(this).toggleClass(e.call(this,n,yt(this),t),t)}):this.each(function(){var t,a,i,o;if(r)for(a=0,i=w(this),o=mt(e);t=o[a++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else void 0!==e&&"boolean"!==n||((t=yt(this))&&X.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":X.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+ht(yt(n))+" ").indexOf(t)>-1)return!0;return!1}});var gt=/\r/g;w.fn.extend({val:function(e){var t,n,r,a=this[0];return arguments.length?(r=h(e),this.each(function(n){var a;1===this.nodeType&&(null==(a=r?e.call(this,n,w(this).val()):e)?a="":"number"==typeof a?a+="":Array.isArray(a)&&(a=w.map(a,function(e){return null==e?"":e+""})),(t=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,a,"value")||(this.value=a))})):a?(t=w.valHooks[a.type]||w.valHooks[a.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(a,"value"))?n:"string"==typeof(n=a.value)?n.replace(gt,""):null==n?"":n:void 0}}),w.extend({valHooks:{option:{get:function(e){var t=w.find.attr(e,"value");return null!=t?t:ht(w.text(e))}},select:{get:function(e){var t,n,r,a=e.options,i=e.selectedIndex,o="select-one"===e.type,s=o?null:[],c=o?i+1:a.length;for(r=i<0?c:o?i:0;r<c;r++)if(((n=a[r]).selected||r===i)&&!n.disabled&&(!n.parentNode.disabled||!j(n.parentNode,"optgroup"))){if(t=w(n).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var n,r,a=e.options,i=w.makeArray(t),o=a.length;o--;)((r=a[o]).selected=w.inArray(w.valHooks.option.get(r),i)>-1)&&(n=!0);return n||(e.selectedIndex=-1),i}}}}),w.each(["radio","checkbox"],function(){w.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=w.inArray(w(e).val(),t)>-1}},d.checkOn||(w.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),d.focusin="onfocusin"in e;var vt=/^(?:focusinfocus|focusoutblur)$/,bt=function(e){e.stopPropagation()};w.extend(w.event,{trigger:function(t,n,r,a){var i,o,s,c,u,p,f,d,g=[r||m],v=l.call(t,"type")?t.type:t,b=l.call(t,"namespace")?t.namespace.split("."):[];if(o=d=s=r=r||m,3!==r.nodeType&&8!==r.nodeType&&!vt.test(v+w.event.triggered)&&(v.indexOf(".")>-1&&(v=(b=v.split(".")).shift(),b.sort()),u=v.indexOf(":")<0&&"on"+v,(t=t[w.expando]?t:new w.Event(v,"object"===(void 0===t?"undefined":_typeof(t))&&t)).isTrigger=a?2:3,t.namespace=b.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:w.makeArray(n,[t]),f=w.event.special[v]||{},a||!f.trigger||!1!==f.trigger.apply(r,n))){if(!a&&!f.noBubble&&!y(r)){for(c=f.delegateType||v,vt.test(c+v)||(o=o.parentNode);o;o=o.parentNode)g.push(o),s=o;s===(r.ownerDocument||m)&&g.push(s.defaultView||s.parentWindow||e)}for(i=0;(o=g[i++])&&!t.isPropagationStopped();)d=o,t.type=i>1?c:f.bindType||v,(p=(X.get(o,"events")||Object.create(null))[t.type]&&X.get(o,"handle"))&&p.apply(o,n),(p=u&&o[u])&&p.apply&&U(o)&&(t.result=p.apply(o,n),!1===t.result&&t.preventDefault());return t.type=v,a||t.isDefaultPrevented()||f._default&&!1!==f._default.apply(g.pop(),n)||!U(r)||u&&h(r[v])&&!y(r)&&((s=r[u])&&(r[u]=null),w.event.triggered=v,t.isPropagationStopped()&&d.addEventListener(v,bt),r[v](),t.isPropagationStopped()&&d.removeEventListener(v,bt),w.event.triggered=void 0,s&&(r[u]=s)),t.result}},simulate:function(e,t,n){var r=w.extend(new w.Event,n,{type:e,isSimulated:!0});w.event.trigger(r,null,t)}}),w.fn.extend({trigger:function(e,t){return this.each(function(){w.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return w.event.trigger(e,t,n,!0)}}),d.focusin||w.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){w.event.simulate(t,e.target,w.event.fix(e))};w.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,a=X.access(r,t);a||r.addEventListener(e,n,!0),X.access(r,t,(a||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,a=X.access(r,t)-1;a?X.access(r,t,a):(r.removeEventListener(e,n,!0),X.remove(r,t))}}});var wt=e.location,Tt={guid:Date.now()},St=/\?/;w.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||w.error("Invalid XML: "+t),n};var xt=/\[\]$/,kt=/\r?\n/g,Ot=/^(?:submit|button|image|reset|file)$/i,jt=/^(?:input|select|textarea|keygen)/i;function At(e,t,n,r){var a;if(Array.isArray(t))w.each(t,function(t,a){n||xt.test(e)?r(e,a):At(e+"["+("object"===(void 0===a?"undefined":_typeof(a))&&null!=a?t:"")+"]",a,n,r)});else if(n||"object"!==b(t))r(e,t);else for(a in t)At(e+"["+a+"]",t[a],n,r)}w.param=function(e,t){var n,r=[],a=function(e,t){var n=h(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!w.isPlainObject(e))w.each(e,function(){a(this.name,this.value)});else for(n in e)At(n,e[n],t,a);return r.join("&")},w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=w.prop(this,"elements");return e?w.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!w(this).is(":disabled")&&jt.test(this.nodeName)&&!Ot.test(e)&&(this.checked||!fe.test(e))}).map(function(e,t){var n=w(this).val();return null==n?null:Array.isArray(n)?w.map(n,function(e){return{name:t.name,value:e.replace(kt,"\r\n")}}):{name:t.name,value:n.replace(kt,"\r\n")}}).get()}});var Ct=/%20/g,Et=/#.*$/,_t=/([?&])_=[^&]*/,Nt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Pt=/^(?:GET|HEAD)$/,It=/^\/\//,Mt={},Dt={},Rt="*/".concat("*"),Lt=m.createElement("a");function Ft(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,a=0,i=t.toLowerCase().match(M)||[];if(h(n))for(;r=i[a++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qt(e,t,n,r){var a={},i=e===Dt;function o(s){var c;return a[s]=!0,w.each(e[s]||[],function(e,s){var u=s(t,n,r);return"string"!=typeof u||i||a[u]?i?!(c=u):void 0:(t.dataTypes.unshift(u),o(u),!1)}),c}return o(t.dataTypes[0])||!a["*"]&&o("*")}function Vt(e,t){var n,r,a=w.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((a[n]?e:r||(r={}))[n]=t[n]);return r&&w.extend(!0,e,r),e}Lt.href=wt.href,w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:wt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(wt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Vt(Vt(e,w.ajaxSettings),t):Vt(w.ajaxSettings,e)},ajaxPrefilter:Ft(Mt),ajaxTransport:Ft(Dt),ajax:function(t,n){"object"===(void 0===t?"undefined":_typeof(t))&&(n=t,t=void 0),n=n||{};var r,a,i,o,s,c,u,l,p,f,d=w.ajaxSetup({},n),h=d.context||d,y=d.context&&(h.nodeType||h.jquery)?w(h):w.event,g=w.Deferred(),v=w.Callbacks("once memory"),b=d.statusCode||{},T={},S={},x="canceled",k={readyState:0,getResponseHeader:function(e){var t;if(u){if(!o)for(o={};t=Nt.exec(i);)o[t[1].toLowerCase()+" "]=(o[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=o[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return u?i:null},setRequestHeader:function(e,t){return null==u&&(e=S[e.toLowerCase()]=S[e.toLowerCase()]||e,T[e]=t),this},overrideMimeType:function(e){return null==u&&(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(u)k.always(e[k.status]);else for(t in e)b[t]=[b[t],e[t]];return this},abort:function(e){var t=e||x;return r&&r.abort(t),O(0,t),this}};if(g.promise(k),d.url=((t||d.url||wt.href)+"").replace(It,wt.protocol+"//"),d.type=n.method||n.type||d.method||d.type,d.dataTypes=(d.dataType||"*").toLowerCase().match(M)||[""],null==d.crossDomain){c=m.createElement("a");try{c.href=d.url,c.href=c.href,d.crossDomain=Lt.protocol+"//"+Lt.host!=c.protocol+"//"+c.host}catch(e){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=w.param(d.data,d.traditional)),qt(Mt,d,n,k),u)return k;for(p in(l=w.event&&d.global)&&0==w.active++&&w.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!Pt.test(d.type),a=d.url.replace(Et,""),d.hasContent?d.data&&d.processData&&0===(d.contentType||"").indexOf("application/x-www-form-urlencoded")&&(d.data=d.data.replace(Ct,"+")):(f=d.url.slice(a.length),d.data&&(d.processData||"string"==typeof d.data)&&(a+=(St.test(a)?"&":"?")+d.data,delete d.data),!1===d.cache&&(a=a.replace(_t,"$1"),f=(St.test(a)?"&":"?")+"_="+Tt.guid+++f),d.url=a+f),d.ifModified&&(w.lastModified[a]&&k.setRequestHeader("If-Modified-Since",w.lastModified[a]),w.etag[a]&&k.setRequestHeader("If-None-Match",w.etag[a])),(d.data&&d.hasContent&&!1!==d.contentType||n.contentType)&&k.setRequestHeader("Content-Type",d.contentType),k.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Rt+"; q=0.01":""):d.accepts["*"]),d.headers)k.setRequestHeader(p,d.headers[p]);if(d.beforeSend&&(!1===d.beforeSend.call(h,k,d)||u))return k.abort();if(x="abort",v.add(d.complete),k.done(d.success),k.fail(d.error),r=qt(Dt,d,n,k)){if(k.readyState=1,l&&y.trigger("ajaxSend",[k,d]),u)return k;d.async&&d.timeout>0&&(s=e.setTimeout(function(){k.abort("timeout")},d.timeout));try{u=!1,r.send(T,O)}catch(e){if(u)throw e;O(-1,e)}}else O(-1,"No Transport");function O(t,n,o,c){var p,f,m,T,S,x=n;u||(u=!0,s&&e.clearTimeout(s),r=void 0,i=c||"",k.readyState=t>0?4:0,p=t>=200&&t<300||304===t,o&&(T=function(e,t,n){for(var r,a,i,o,s=e.contents,c=e.dataTypes;"*"===c[0];)c.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(a in s)if(s[a]&&s[a].test(r)){c.unshift(a);break}if(c[0]in n)i=c[0];else{for(a in n){if(!c[0]||e.converters[a+" "+c[0]]){i=a;break}o||(o=a)}i=i||o}if(i)return i!==c[0]&&c.unshift(i),n[i]}(d,k,o)),!p&&w.inArray("script",d.dataTypes)>-1&&(d.converters["text script"]=function(){}),T=function(e,t,n,r){var a,i,o,s,c,u={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)u[o.toLowerCase()]=e.converters[o];for(i=l.shift();i;)if(e.responseFields[i]&&(n[e.responseFields[i]]=t),!c&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=i,i=l.shift())if("*"===i)i=c;else if("*"!==c&&c!==i){if(!(o=u[c+" "+i]||u["* "+i]))for(a in u)if((s=a.split(" "))[1]===i&&(o=u[c+" "+s[0]]||u["* "+s[0]])){!0===o?o=u[a]:!0!==u[a]&&(i=s[0],l.unshift(s[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(e){return{state:"parsererror",error:o?e:"No conversion from "+c+" to "+i}}}return{state:"success",data:t}}(d,T,k,p),p?(d.ifModified&&((S=k.getResponseHeader("Last-Modified"))&&(w.lastModified[a]=S),(S=k.getResponseHeader("etag"))&&(w.etag[a]=S)),204===t||"HEAD"===d.type?x="nocontent":304===t?x="notmodified":(x=T.state,f=T.data,p=!(m=T.error))):(m=x,!t&&x||(x="error",t<0&&(t=0))),k.status=t,k.statusText=(n||x)+"",p?g.resolveWith(h,[f,x,k]):g.rejectWith(h,[k,x,m]),k.statusCode(b),b=void 0,l&&y.trigger(p?"ajaxSuccess":"ajaxError",[k,d,p?f:m]),v.fireWith(h,[k,x]),l&&(y.trigger("ajaxComplete",[k,d]),--w.active||w.event.trigger("ajaxStop")))}return k},getJSON:function(e,t,n){return w.get(e,t,n,"json")},getScript:function(e,t){return w.get(e,void 0,t,"script")}}),w.each(["get","post"],function(e,t){w[t]=function(e,n,r,a){return h(n)&&(a=a||r,r=n,n=void 0),w.ajax(w.extend({url:e,type:t,dataType:a,data:n,success:r},w.isPlainObject(e)&&e))}}),w.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),w._evalUrl=function(e,t,n){return w.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){w.globalEval(e,t,n)}})},w.fn.extend({wrapAll:function(e){var t;return this[0]&&(h(e)&&(e=e.call(this[0])),t=w(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return h(e)?this.each(function(t){w(this).wrapInner(e.call(this,t))}):this.each(function(){var t=w(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=h(e);return this.each(function(n){w(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){w(this).replaceWith(this.childNodes)}),this}}),w.expr.pseudos.hidden=function(e){return!w.expr.pseudos.visible(e)},w.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},w.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Ht={0:200,1223:204},zt=w.ajaxSettings.xhr();d.cors=!!zt&&"withCredentials"in zt,d.ajax=zt=!!zt,w.ajaxTransport(function(t){var n,r;if(d.cors||zt&&!t.crossDomain)return{send:function(a,i){var o,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(o in t.xhrFields)s[o]=t.xhrFields[o];for(o in t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||a["X-Requested-With"]||(a["X-Requested-With"]="XMLHttpRequest"),a)s.setRequestHeader(o,a[o]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?i(0,"error"):i(s.status,s.statusText):i(Ht[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=s.ontimeout=n("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout(function(){n&&r()})},n=n("abort");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),w.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return w.globalEval(e),e}}}),w.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),w.ajaxTransport("script",function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(r,a){t=w("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&a("error"===e.type?404:200,e.type)}),m.head.appendChild(t[0])},abort:function(){n&&n()}}});var Wt,$t=[],Bt=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=$t.pop()||w.expando+"_"+Tt.guid++;return this[e]=!0,e}}),w.ajaxPrefilter("json jsonp",function(t,n,r){var a,i,o,s=!1!==t.jsonp&&(Bt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bt.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return a=t.jsonpCallback=h(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Bt,"$1"+a):!1!==t.jsonp&&(t.url+=(St.test(t.url)?"&":"?")+t.jsonp+"="+a),t.converters["script json"]=function(){return o||w.error(a+" was not called"),o[0]},t.dataTypes[0]="json",i=e[a],e[a]=function(){o=arguments},r.always(function(){void 0===i?w(e).removeProp(a):e[a]=i,t[a]&&(t.jsonpCallback=n.jsonpCallback,$t.push(a)),o&&h(i)&&i(o[0]),o=i=void 0}),"script"}),d.createHTMLDocument=((Wt=m.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Wt.childNodes.length),w.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(d.createHTMLDocument?((r=(t=m.implementation.createHTMLDocument("")).createElement("base")).href=m.location.href,t.head.appendChild(r)):t=m),i=!n&&[],(a=A.exec(e))?[t.createElement(a[1])]:(a=be([e],t,i),i&&i.length&&w(i).remove(),w.merge([],a.childNodes)));var r,a,i},w.fn.load=function(e,t,n){var r,a,i,o=this,s=e.indexOf(" ");return s>-1&&(r=ht(e.slice(s)),e=e.slice(0,s)),h(t)?(n=t,t=void 0):t&&"object"===(void 0===t?"undefined":_typeof(t))&&(a="POST"),o.length>0&&w.ajax({url:e,type:a||"GET",dataType:"html",data:t}).done(function(e){i=arguments,o.html(r?w("<div>").append(w.parseHTML(e)).find(r):e)}).always(n&&function(e,t){o.each(function(){n.apply(this,i||[e.responseText,t,e])})}),this},w.expr.pseudos.animated=function(e){return w.grep(w.timers,function(t){return e===t.elem}).length},w.offset={setOffset:function(e,t,n){var r,a,i,o,s,c,u=w.css(e,"position"),l=w(e),p={};"static"===u&&(e.style.position="relative"),s=l.offset(),i=w.css(e,"top"),c=w.css(e,"left"),("absolute"===u||"fixed"===u)&&(i+c).indexOf("auto")>-1?(o=(r=l.position()).top,a=r.left):(o=parseFloat(i)||0,a=parseFloat(c)||0),h(t)&&(t=t.call(e,n,w.extend({},s))),null!=t.top&&(p.top=t.top-s.top+o),null!=t.left&&(p.left=t.left-s.left+a),"using"in t?t.using.call(e,p):("number"==typeof p.top&&(p.top+="px"),"number"==typeof p.left&&(p.left+="px"),l.css(p))}},w.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){w.offset.setOffset(this,e,t)});var t,n,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],a={top:0,left:0};if("fixed"===w.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===w.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((a=w(e).offset()).top+=w.css(e,"borderTopWidth",!0),a.left+=w.css(e,"borderLeftWidth",!0))}return{top:t.top-a.top-w.css(r,"marginTop",!0),left:t.left-a.left-w.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===w.css(e,"position");)e=e.offsetParent;return e||ne})}}),w.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;w.fn[e]=function(r){return H(this,function(e,r,a){var i;if(y(e)?i=e:9===e.nodeType&&(i=e.defaultView),void 0===a)return i?i[t]:e[r];i?i.scrollTo(n?i.pageXOffset:a,n?a:i.pageYOffset):e[r]=a},e,r,arguments.length)}}),w.each(["top","left"],function(e,t){w.cssHooks[t]=ze(d.pixelPosition,function(e,n){if(n)return n=He(e,t),Le.test(n)?w(e).position()[t]+"px":n})}),w.each({Height:"height",Width:"width"},function(e,t){w.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){w.fn[r]=function(a,i){var o=arguments.length&&(n||"boolean"!=typeof a),s=n||(!0===a||!0===i?"margin":"border");return H(this,function(t,n,a){var i;return y(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):void 0===a?w.css(t,n,s):w.style(t,n,a,s)},t,o?a:void 0,o)}})}),w.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){w.fn[t]=function(e){return this.on(t,e)}}),w.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),w.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){w.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}});var Ut=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;w.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),h(e))return r=a.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(a.call(arguments)))}).guid=e.guid=e.guid||w.guid++,i},w.holdReady=function(e){e?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=j,w.isFunction=h,w.isWindow=y,w.camelCase=B,w.type=b,w.now=Date.now,w.isNumeric=function(e){var t=w.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},w.trim=function(e){return null==e?"":(e+"").replace(Ut,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return w});var Gt=e.jQuery,Xt=e.$;return w.noConflict=function(t){return e.$===w&&(e.$=Xt),t&&e.jQuery===w&&(e.jQuery=Gt),w},void 0===t&&(e.jQuery=e.$=w),w}),define("jqueryplugins",["jquery"],function(e){e.prototype.extend({popAttr:function(e){var t=this.attr(e);return this.removeAttr(e),t},popData:function(e){var t=this.data(e);return this.removeData(e),t},tag:function(){return this[0]&&this[0].tagName&&this[0].tagName.toLowerCase()},textNodes:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*";return 1===this.length&&this[0]instanceof Text?[this[0]]:this.get().concat(this.contents().get(),this.find(e).contents().get()).filter(function(e,t,n){return e instanceof Text&&n.indexOf(e)===t}).sort(function(e,t){return 2&e.compareDocumentPosition(t)?1:-1})},findAndFilter:function(e){return this.filter(e).add(this.find(e))}})}),function(){var e=void 0,t={};function n(){for(var e=0;e<arguments.length;e++)for(var t in arguments[e])this[t]=arguments[e][t]}function r(e,t){e.childAt=e.childAt||{};for(var n=t.start;n<t.end;n+=1)e.childAt[n]=t}function a(e,t,n,r){return!(e.canFollow&&!(e.canFollow.indexOf(n&&n.type)>-1)||e.cannotFollow&&(-1!==e.cannotFollow.indexOf(n&&n.type)||e.cannotFollow.indexOf("text")>-1&&r)||e.peek&&e.peek.toLowerCase()!==t.slice(0,e.peek.length).toLowerCase())}function i(e){for(var n=e.innerText,r=[],i=0,s=i,c=n.length,u=null;i<c;){for(var l=n.slice(i),p=(r.length?r[0]:e).innerMode,f=0,d=p.length;f<d;f+=1){var h=t[p[f]];if(a(h,l,u,s<i)&&h.pattern.test(l)){var y=h.pattern.exec(l),m=h.fn(y),g=!1,v=0;if(m.matches){for(;v<r.length;v+=1){var b=r[v].type;if(b in m.matches){g=!0;break}0===b.indexOf("verbatim")&&(b="verbatimOpener"),m.cannotCross&&m.cannotCross.indexOf(b)>-1&&(v=r.length-1)}if(v>=r.length&&!m.isFront)continue}s<i&&e.addChild({type:"text",text:n.slice(s,i),innerMode:p}),s=i+=(u=e.addChild(m)).text.length,g&&(o(e,u,r[v]),r=r.slice(v+1)),u.isFrontToken()&&r.unshift(u);break}}f===d&&(i+=1,null===u&&(u={type:"text"}))}for(s<i&&e.addChild({type:"text",text:n.slice(s,i),innerMode:(r.length?r[0]:e).innerMode});r.length>0;)r.shift().demote();return e}function o(e,t,n){var a=e.children.indexOf(t),i=e.children.indexOf(n);t.children=e.children.splice(i+1,a-(i+1)),t.children.forEach(function(e){r(t,e)}),t.type=t.matches[n.type],t.innerText="";for(var o=0,s=t.children.length;o<s;o++)t.innerText+=t.children[o].text;t.start=n.start,t.text=n.text+t.innerText+t.text,Object.keys(n).forEach(function(e){Object.hasOwnProperty.call(t,e)||(t[e]=n[e])}),t.isFront&&(t.isFront=!1),e.children.splice(i,1),r(e,t)}n.prototype={constructor:n,addChild:function(e){var t=this.lastChildEnd(),a=new n({start:t,end:e.text&&t+e.text.length,children:[]},e);return a.innerText&&i(a),this.children.push(a),r(this,a),a},firstChild:function(){return this.children&&this.children[0]||null},lastChild:function(){return this.children&&this.children[this.children.length-1]||null},lastChildEnd:function(){var e=this.lastChild();return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))},tokenAt:function(e){if(e<this.start||e>=this.end)return null;if(this.childAt)return this.childAt[e]&&this.childAt[e].tokenAt(e)||this;if(this.children.length)for(var t=0;t<this.children.length;t+=1){var n=this.children[t].tokenAt(e);if(n)return n}return this},pathAt:function(e){if(e<this.start||e>=this.end)return[];if(this.childAt)return(this.childAt[e]&&this.childAt[e].pathAt(e)||[]).concat(this);var t=[];if(this.children.length)for(var n=0;n<this.children.length;n+=1){var r=this.children[n].pathAt(e);if(r.length){t.concat(r);break}}return t.concat(this)},nearestTokenAt:function(e){return e<this.start||e>=this.end?null:this.children?this.children.reduce(function(t,n){return t||(e>=n.start&&e<n.end?n:null)},null):this},everyLeaf:function(e){return this.children&&0!==this.children.length?this.children.reduce(function(t,n){return t&&n.everyLeaf(e)},!0):!!e(this)},isWhitespace:function(){return this.everyLeaf(function(e){return"whitespace"===e.type||!e.text.trim()})},isFrontToken:function(){return this.isFront},isBackToken:function(){return"matches"in this},demote:function(){this.type="text"},error:function(e){this.type="error",this.message=e},toString:function(){var e=this.type+"("+this.start+"\u2192"+this.end+")";return this.children&&this.children.length>0&&(e+="["+this.children+"]"),e}},e={lex:function(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start";return i(new n({type:"root",start:r||0,end:t.length,text:t,innerText:t,children:[],childAt:{},innerMode:e.modes[a]}))},rules:t,modes:{}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e:"function"==typeof define&&define.amd?define("lexer",[],function(){return e}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Lexer=e):this.TwineLexer=e}.call(eval("this")||("undefined"!=typeof global?global:window)),function(){var e;function t(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))?(Object.keys(e).forEach(function(n){e[n]=t(e[n])}),e):(e+"").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function n(e){return function(){return"("+e+Array.apply(0,arguments).join("|")+")"}}var r=n("?:"),a=n("?!"),i=n("?="),o="[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",s=o.replace("*","+"),c="\\b",u="[\\w\\-\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",l=u.replace("\\-",""),p=r("\\n","$"),f=o+"(\\*+)"+s,d=o+"((?:0\\.)+)"+s,h=o+"-{3,}"+o+p,y=o+"(==+>|<=+|=+><=+|<==+>)"+o+p,m=o+"(=+\\|+|\\|+=+|=+\\|+=+|\\|=+\\|)"+o+p,g={opener:"\\[\\[(?!\\[)",text:"("+function(){return"[^"+Array.apply(0,arguments).map(t).join("")+"]*"}("]")+")",rightSeparator:r("\\->","\\|"),leftSeparator:"<\\-",closer:"\\]\\]",legacySeparator:"\\|",legacyText:"("+r("[^\\|\\]]","\\]"+a("\\]"))+"+)"},v=l+"*"+l.replace("\\w","a-zA-Z")+l+"*",b="\\$("+v+")",w="_("+v+")",T="'s"+s+"("+v+")",S="("+v+")"+s+"of"+c+a("it\\b"),x="'s"+s,k=r("it","time","visits?","exits?","pos")+c,O="its"+s+"("+v+")",j="its"+s,A="("+v+")"+s+"of"+s+"it"+c,C="of\\b"+s+"it"+c,E={opener:"\\(",name:"("+r("\\$","_")+"?"+u+"+):"+a("\\/"),closer:"\\)"},_=r("=<","=>","[gl]te?\\b","n?eq\\b","isnot\\b","are\\b","x\\b","isa\\b","or"+s+"a"+c),N="[a-zA-Z][\\w\\-]*",P="(?:\"[^\"]*\"|'[^']*'|[^'\">])*?",I="\\|("+u+"+)(>|\\))",M="(<|\\()("+u+"+)\\|",D="\\b(\\d+(?:\\.\\d+)?(?:[eE][+\\-]?\\d+)?)"+a("m?s")+c;g.main=g.opener+r(g.text+g.rightSeparator,g.text.replace("*","*?")+g.leftSeparator)+g.text,e={upperLetter:"[A-Z\\u00c0-\\u00de\\u0150\\u0170]",lowerLetter:"[a-z0-9_\\-\\u00df-\\u00ff\\u0151\\u0171]",anyLetter:u,anyLetterStrict:l,whitespace:s.replace("[","[\\n\\r"),escapedLine:"\\\\\\n\\\\?|\\n\\\\",br:"\\n(?!\\\\)",commentFront:"\x3c!--",commentBack:"--\x3e",tag:"<\\/?"+N+P+">",tagPeek:"<",scriptStyleTag:"<("+r("script","style","textarea")+")"+P+">[^]*?<\\/\\1>",scriptStyleTagOpener:"<",url:"("+r("https?","mailto","javascript","ftp","data")+":\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])",bullet:"\\*",hr:h,heading:"[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*(#{1,6})[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",align:y,column:m,bulleted:f,numbered:d,strikeOpener:t("~~"),italicOpener:t("//"),boldOpener:t("''"),supOpener:t("^^"),strongFront:t("**"),strongBack:t("**"),emFront:t("*"),emBack:t("*"),verbatimOpener:"`+",collapsedFront:"{",collapsedBack:"}",hookAppendedFront:"\\["+a("=+"),hookPrependedFront:I+"\\["+a("=+"),hookFront:"\\["+a("=+"),hookBack:"\\]"+a(M),hookAppendedBack:"\\]"+M,unclosedHook:"\\[=+",unclosedHookPrepended:I+"\\[=+",unclosedCollapsed:"\\{=+",passageLink:g.main+g.closer,passageLinkPeek:"[[",legacyLink:g.opener+g.legacyText+g.legacySeparator+g.legacyText+g.closer,legacyLinkPeek:"[[",simpleLink:g.opener+g.legacyText+g.closer,simpleLinkPeek:"[[",macroFront:E.opener+i(E.name),macroFrontPeek:"(",macroName:E.name,groupingFront:"\\("+a(E.name),groupingFrontPeek:"(",groupingBack:"\\)",twine1Macro:"<<[^>\\s]+\\s*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"|[^'\"\\\\>]|>(?!>))*>>",twine1MacroPeek:"<<",validPropertyName:v,property:T,propertyPeek:"'s",belongingProperty:S,possessiveOperator:x,belongingOperator:"of\\b",belongingOperatorPeek:"of",itsOperator:j,itsOperatorPeek:"its",belongingItOperator:C,belongingItOperatorPeek:"of",variable:b,variablePeek:"$",tempVariable:w,tempVariablePeek:"_",hookName:"\\?("+u+"+)\\b",hookNamePeek:"?",cssTime:"(\\d+\\.?\\d*|\\d*\\.?\\d+)(m?s)\\b",colour:r(r("Red","Orange","Yellow","Lime","Green","Cyan","Aqua","Blue","Navy","Purple","Fuchsia","Magenta","White","Gray","Grey","Black","Transparent"),"#[\\dA-Fa-f]{3}(?:[\\dA-Fa-f]{3})?"),datatype:r("alnum","alphanumeric","any(?:case)?","array","bool(?:ean)?","changer","colou?r","const","command","dm","data"+r("map","type","set"),"ds","digit","gradient","empty","even","int"+a("o")+"(?:eger)?","lambda","lowercase","macro","linebreak","newline","num(?:ber)?","odd","str(?:ing)?","uppercase","whitespace")+c,number:D,boolean:r("true","false")+c,identifier:k,itsProperty:O,itsPropertyPeek:"its",belongingItProperty:A,escapedStringChar:"\\\\[^\\n]",singleStringOpener:"'",doubleStringOpener:'"',singleStringCloser:"'",doubleStringCloser:'"',is:"is"+a(s+"not"+c,s+"an?"+c,s+"in"+c,s+"<",s+">")+c,isNot:"is"+s+"not"+a(s+r("an?","in")+c)+c,isA:"is"+s+"an?"+c,isNotA:"is"+s+"not"+s+"an?"+c,matches:"matches\\b",doesNotMatch:"does"+s+"not"+s+"match"+c,and:"and\\b",or:"or\\b",not:"not\\b",inequality:"((?:is(?:"+s+"not)?"+o+")*)("+r("<(?!=)","<=",">(?!=)",">=")+")",isIn:"is"+s+"in"+c,contains:"contains\\b",doesNotContain:"does"+s+"not"+s+"contain"+c,isNotIn:"is"+s+"not"+s+"in"+c,addition:t("+")+a("="),subtraction:t("-")+a("=","type"),multiplication:t("*")+a("="),division:r("/","%")+a("="),comma:",",spread:"\\.\\.\\."+a("\\."),to:r("to\\b","="),into:"into\\b",making:"making\\b",where:"where\\b",when:"when\\b",via:"via\\b",each:"each\\b",augmentedAssign:r("\\+","\\-","\\*","\\/","%")+"=",bind:"2?bind\\b",typeSignature:t("-type")+c,incorrectOperator:_},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e:"function"==typeof define&&define.amd?define("patterns",[],function(){return e}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Patterns=e):this.Patterns=e}.call(eval("this")||("undefined"!=typeof global?global:window)),function(){var e=void 0;Object.assign=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};var t=Object.keys,n=Object.assign;function r(r){return Object.freeze({lex:function(r){function a(e){return e=e||"innerText",function(t){var n=t.reduceRight(function(e,t,n){return e||(n?t:"")},""),r={};return r[e]=n,r}}function i(e,t){var n={};return n[e]=t,function(){return{isFront:!0,matches:n,cannotCross:["verbatimOpener"]}}}var o=Object.bind(0,null);function s(e,t){return Object.keys(t).forEach(function(n){var r=t[n].fn;t[n].fn=function(t){var a=r(t);return a.text||(a.text=t[0]),a.type||(a.type=n),a.innerMode||(a.innerMode=e),a}}),t}var c=[],u=[],l=[],p=s(c,{hr:{fn:o},bulleted:{fn:function(e){return{depth:e[1].length}}},numbered:{fn:function(e){return{depth:e[1].length/2}}},heading:{fn:function(e){return{depth:e[1].length}}},align:{fn:function(e){var t=void 0,n=e[1],r=n.indexOf("><");return~r?25===(t=Math.round(r/(n.length-2)*50))&&(t="center"):"<"===n[0]&&">"===n.slice(-1)?t="justify":n.indexOf(">")>-1?t="right":n.indexOf("<")>-1&&(t="left"),{align:t}}},column:{fn:function(e){var t=void 0,n=e[1],r=n.indexOf("|");return r&&r<n.length-1?t="center":"|"===n[0]&&"|"===n.slice(-1)?t="none":r===n.length-1?t="right":r||(t="left"),{column:t,width:/\|+/.exec(n)[0].length,marginLeft:/^=*/.exec(n)[0].length,marginRight:/=*$/.exec(n)[0].length}}}});t(p).forEach(function(e){p[e].canFollow=[null,"br","hr","bulleted","numbered","heading","align","column","escapedLine"],p[e].cannotFollow=["text"]});var f=s(c,{twine1Macro:{fn:function(){return{type:"error",message:"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros."}}},emBack:{fn:function(){return{matches:{emFront:"em"},cannotCross:["verbatimOpener"]}}},strongBack:{fn:function(){return{matches:{strongFront:"strong"},cannotCross:["verbatimOpener"]}}},strongFront:{fn:function(){return{isFront:!0}}},emFront:{fn:function(){return{isFront:!0}}},boldOpener:{fn:i("boldOpener","bold")},italicOpener:{fn:i("italicOpener","italic")},strikeOpener:{fn:i("strikeOpener","strike")},supOpener:{fn:i("supOpener","sup")},commentFront:{fn:function(){return{isFront:!0}}},commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},scriptStyleTag:{fn:o},tag:{fn:o},url:{fn:o},hookPrependedFront:{fn:function(e){return{name:e[1],hidden:")"===e[2],isFront:!0,tagPosition:"prepended"}}},hookFront:{fn:function(){return{isFront:!0}}},hookBack:{fn:function(){return{matches:{hookPrependedFront:"hook",hookFront:"hook"},cannotCross:["verbatimOpener"]}}},hookAppendedBack:{fn:function(e){return{name:e[2],hidden:"("===e[1],tagPosition:"appended",matches:{hookFront:"hook"},cannotCross:["verbatimOpener"]}}},unclosedHook:{fn:o},unclosedHookPrepended:{fn:function(e){return{type:"unclosedHook",name:e[1],hidden:")"===e[2]}}},verbatimOpener:{fn:function(e){var t=e[0].length,n={};return n["verbatim"+t]="verbatim",{type:"verbatim"+t,isFront:!0,matches:n}}},unclosedCollapsed:{fn:o},collapsedFront:{fn:function(){return{isFront:!0}}},collapsedBack:{fn:function(){return{matches:{collapsedFront:"collapsed"},cannotCross:["verbatimOpener"]}}},escapedLine:{fn:o},legacyLink:{fn:function(e){return{type:"twineLink",innerText:e[1],passage:e[2],innerMode:c}}},br:{fn:o}}),d=n(s(u,{macroFront:{fn:function(e){return{isFront:!0,name:e[1]}}},groupingBack:{fn:function(){return{matches:{groupingFront:"grouping",macroFront:"macro"},cannotCross:["singleStringOpener","doubleStringOpener"]}}},passageLink:{fn:function(e){var t=e[1]||"",n=e[2]||"",r=e[3]||"";return{type:"twineLink",innerText:n?r:t,passage:t?r:n,innerMode:c}}},simpleLink:{fn:function(e){return{type:"twineLink",innerText:e[1]||"",passage:e[1]||"",innerMode:c}}},variable:{cannotFollow:["macroFront"],fn:a("name")},tempVariable:{cannotFollow:["macroFront"],fn:a("name")}}),{hookFront:f.hookFront,hookBack:f.hookBack}),h=s(u,n({macroName:{canFollow:["macroFront"],fn:a("name")},groupingFront:{fn:function(){return{isFront:!0}}},property:{fn:a("name"),canFollow:["variable","hookName","property","tempVariable","colour","itsProperty","belongingItProperty","macro","grouping","string","datatype","hook","boolean","number"]},possessiveOperator:{fn:o},itsProperty:{cannotFollow:["text"],fn:a("name")},itsOperator:{cannotFollow:["text"],fn:o},belongingItProperty:{cannotFollow:["text"],fn:a("name")},belongingItOperator:{cannotFollow:["text"],fn:o},belongingProperty:{cannotFollow:["text"],fn:a("name")},belongingOperator:{cannotFollow:["text"],fn:o},escapedStringChar:{fn:function(){return{type:"text"}}},singleStringOpener:{fn:function(){return{isFront:!0,matches:{singleStringOpener:"string"},innerMode:l}}},doubleStringOpener:{fn:function(){return{isFront:!0,matches:{doubleStringOpener:"string"},innerMode:l}}},hookName:{fn:a("name")},cssTime:{fn:function(e){return{value:+e[1]*("s"===e[2].toLowerCase()?1e3:1)}}},datatype:{cannotFollow:["text"],fn:function(e){return{name:e[0].toLowerCase()}}},colour:{cannotFollow:["text"],fn:function(e){var t=e[0].toLowerCase(),n={red:"e61919",orange:"e68019",yellow:"e5e619",lime:"80e619",green:"19e619",cyan:"19e5e6",aqua:"19e5e6",blue:"197fe6",navy:"1919e6",purple:"7f19e6",fuchsia:"e619e5",magenta:"e619e5",white:"fff",black:"000",gray:"888",grey:"888"};return{colour:Object.hasOwnProperty.call(n,t)?"#"+n[t]:t}}},number:{fn:function(e){return{value:parseFloat(e[0])}}},inequality:{fn:function(e){return{operator:e[2],negate:e[1].indexOf("not")>-1}}},augmentedAssign:{fn:function(e){return{operator:e[0][0]}}},identifier:{fn:a("name"),cannotFollow:["text"]},whitespace:{fn:o,cannotFollow:"text"},incorrectOperator:{fn:function(e){var t={"=>":">=","=<":"<=",gte:">=",lte:"<=",gt:">",lt:"<",eq:"is",isnot:"is not",neq:"is not",isa:"is a",are:"is",x:"*","or a":"or"}[e[0].toLowerCase().replace(/\s+/g," ")];return{type:"error",message:"Please say "+(t?"'"+t+"'":"something else")+" instead of '"+e[0]+"'.",explanation:"In the interests of readability, I want certain operators to be in a specific form."}},cannotFollow:"text"}},["boolean","is","to","into","where","when","via","making","each","and","or","not","isNot","contains","doesNotContain","isIn","isA","isNotA","isNotIn","matches","doesNotMatch","bind"].reduce(function(e,t){return e[t]={fn:o,cannotFollow:["text"]},e},{}),["comma","spread","typeSignature","addition","subtraction","multiplication","division"].reduce(function(e,t){return e[t]={fn:o},e},{}))),y=s(l,{singleStringCloser:h.singleStringOpener,doubleStringCloser:h.doubleStringOpener,escapedStringChar:h.escapedStringChar});c.push.apply(c,_toConsumableArray(t(p)).concat(_toConsumableArray(t(d)),_toConsumableArray(t(f)))),u.push.apply(u,_toConsumableArray(t(d)).concat(_toConsumableArray(t(h)))),l.push.apply(l,_toConsumableArray(t(y)));var m=n({},p,f,d,h,y);t(m).forEach(function(t){var n=e[t];m[t].pattern="string"!=typeof n?n:RegExp("^(?:"+n+")","i"),e[t+"Peek"]&&(m[t].peek=e[t+"Peek"])}),n(r.rules,m);var g=r.modes;return g.start=g.markup=c,g.macro=u,g.string=l,r}(r).lex,Patterns:e})}"object"===("undefined"==typeof module?"undefined":_typeof(module))?(e=require("./patterns"),module.exports=r(require("./lexer"))):"function"==typeof define&&define.amd?define("markup",["lexer","patterns"],function(t,n){return e=n,r(t)}):this&&this.loaded&&this.modules?(e=this.modules.Patterns,this.modules.Markup=r(this.modules.Lexer)):(e=this.Patterns,this.TwineMarkup=r(this.TwineLexer))}.call(eval("this")||("undefined"!=typeof global?global:window)),define("utils/polyfills",[],function(){var e=Array.prototype;"function"!=typeof e.includes&&(e.includes=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!Number.isNaN(t)&&Number.isFinite(n)&&void 0!==t)return e.indexOf.call(this,t,n)>-1;var r=Object(this),a=parseInt(r.length);if(a<=0)return!1;for(var i=n>=0?n:Math.max(0,a+n);i<a;){if(Object.is(t,r[i]))return!0;i+=1}return!1}),!window.Symbol&&(window.Symbol={iterator:"_es6-shim iterator_"})}),define("utils",["jquery","markup","utils/polyfills"],function(e){var t=String.fromCharCode,n="audio,blockquote,canvas,div,h1,h2,h3,h4,h5,hr,ol,p,pre,table,ul,video,tw-align,tw-story,tw-passage,tw-sidebar,tw-columns,tw-column,tw-meter".split(","),r="a,b,i,em,strong,sup,sub,abbr,acronym,s,strike,del,big,small,script,img,button,input,tw-link,tw-broken-link,tw-verbatim,tw-collapsed,tw-error,tw-colour,tw-icon".split(","),a=["audio"],i=[function(e){return t(e)!==t(e).toLowerCase()},function(e){return t(e)!==t(e).toUpperCase()},function(e){return t(e).toLowerCase()!==t(e).toUpperCase()}].map(function(e){return"["+Array.from(Array(57343)).map(function(e,t){return t}).filter(e).map(function(e,n,r){return e===r[n-1]+1&&e===r[n+1]-1?"-":t(e)}).join("").replace(/\-+/g,"-")+"]"}),o=_slicedToArray(i,3),s=o[0],c=o[1],u=o[2];function l(e){return"instant"===e?0:800}var p=void 0,f=[],d={},h=0,y={},m=0,g={},v=void 0;function b(e,t,n,r,a){var i=null,o=0,s=t+n;function c(n){1&e[0].compareDocumentPosition(document)&&(s=0),i&&(s-=n-i,o+=n-i),i=n,r>0&&h+m>0&&(s-=r,e.css("animation-delay",(v.cssTimeUnit(e.css("animation-delay"))||0)-r+"ms")),s<=0?a(o):requestAnimationFrame(c),s<=t&&e.css("visibility","")}s?requestAnimationFrame(c):c()}return e(document.documentElement).on("keydown keyup mousedown mouseup",function(e){var t=e.key,n=e.button,r=e.type.includes("down"),a=t?d:y,i=t&&v.insensitiveName(t)||n;a[i]&&!r?t?h=Math.max(h-1,0):m=Math.max(m-1,0):!a[i]&&r&&(t?h+=1:m+=1),a[i]=r}).on("mousemove",function(e){var t=e.pageX,n=e.pageY;g.x=t,g.y=n}),v={lockProperty:function(e,t,n){var r=Object.create({configurable:0,writable:0});return n&&(r.value=n),Object.defineProperty(e,t,r),e},permutations:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=t.length,a=[[].concat(t)],i=Array(r).fill(0),o=1,s=void 0,c=void 0;o<r;)i[o]<o?(s=o%2&&i[o],c=t[o],t[o]=t[s],t[s]=c,++i[o],o=1,a.push([].concat(t))):(i[o]=0,++o);return a},shuffled:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t,n){var r=Math.random()*(n+1)|0;return r===n?e.push(t):(e.push(e[r]),e[r]=t),e},[])},matMul:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var i;if(r.length>0)return(i=v).matMul.apply(i,[v.matMul(e,t)].concat(r));if(!t)return e;for(var o=[],s=0;s<e.length;s++){o[s]=[];for(var c=0;c<t[0].length;c++){for(var u=0,l=0;l<e[0].length;l++)u+=e[s][l]*t[l][c];o[s][c]=u}}return o},cssTimeUnit:function(e){return"ms"===(e=e.toLowerCase()).slice(-2)?+e.slice(0,-2)||0:"s"===e.slice(-1)&&1e3*+e.slice(0,-1)||0},nth:function(e){var t=(+e+"").slice(-1);return e+("1"===t?"st":"2"===t?"nd":"3"===t?"rd":"th")},plural:function(e,t){return e+" "+t+(e>1?"s":"")},andList:function(e){return 1===e.length?e[0]:e.slice(0,-1).join(", ")+" and "+e[e.length-1]},realWhitespace:"[ \\n\\r\\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]",anyRealLetter:"[\\dA-Za-z\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",anyUppercase:s,anyLowercase:c,anyCasedLetter:u,anyNewline:"(?:\\n|\\r|\\r\\n)",unescape:function(e){return e.replace(/&(?:amp|lt|gt|quot|nbsp|zwnj|#39|#96);/g,function(e){return{"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#39;":"'","&nbsp;":String.fromCharCode(160),"&zwnj;":String.fromCharCode(8204)}[e]})},escape:function(e){return e.replace(/[&><"']/g,function(e){return{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"}[e]})},insensitiveName:function(e){return(e+"").toLowerCase().replace(/-|_/g,"")},allKeysDown:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return d[e]})},someKeysDown:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function(e){return d[e]})},buttonsDown:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return y[e]})},anyInputDown:function(){return h+m>0},mouseCoords:g,parentColours:function(e){for(var t={colour:null,backgroundColour:null},n=/^\w+a\(.+?,\s*0\s*\)$|^transparent$/;e.length&&e[0]!==document;e=e.parent()){if(!t.backgroundColour){var r=e.css("background-color");r.match(n)||(t.backgroundColour=r)}if(!t.colour){var a=e.css("color");a.match(n)||(t.colour=a)}if(t.colour&&t.backgroundColour)return t}return{colour:"#fff",backgroundColour:"#000"}},childrenProbablyInline:function(e){var t=[];return[].every.call(e.findAndFilter("*"),function(e){return!!(e.hidden||/none|inline/.test(e.style.display)||/display: (none|inline)/.test(e.getAttribute("style")))||!n.includes(e.tagName.toLowerCase())&&!/display: (?!none|inline|inherit|unset)/.test(e.getAttribute("style"))&&(!!r.includes(e.tagName.toLowerCase())||(t.push(e),!0))})&&t.every(function(e){return window.getComputedStyle(e).display.includes("inline")})},transitionReplace:function(t,n,r){var a=t.closest("tw-hook");a.length>0&&(t=a);var i=e("<tw-transition-container>").css("position","relative");i.insertBefore(t.first());var o=void 0;n&&(o=e("<tw-transition-container>").appendTo(i),n.appendTo(o));var s=e("<tw-transition-container>").css("position","absolute").prependTo(i);t.detach().appendTo(s),v.transitionOut(s,r),n&&v.transitionIn(o,r,function(){o.unwrap().children().first().unwrap()})},transitionOut:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;0!==e.length&&(n=n||l(t),(e.length>1||!v.childrenProbablyInline(e)||!["tw-hook","tw-passage","tw-expression"].includes(e.tag()))&&(e=e.wrapAll("<tw-transition-container>").parent()),o&&e.css("transform-origin",o),e.attr("data-t8n",t).addClass("transition-out").css({"animation-duration":n+"ms","animation-delay":r-i+"ms"}),requestAnimationFrame(function(){v.childrenProbablyInline(e)?e.css("display","inline"):e.parent().is("tw-backdrop,tw-story")||e[0].setAttribute("style",e[0].getAttribute("style")+"display:block !important;width:100%")}),b(e,n,r-i,a,function(){e.remove()}))},transitionIn:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;if(0!==t.length){r=r||l(n);var u=t.length>1||!v.childrenProbablyInline(t)||!["tw-hook","tw-passage","tw-expression"].includes(t.tag());u&&(t=t.wrapAll("<tw-transition-container>").parent()),c&&t.css("transform-origin",c),t.attr("data-t8n",n).addClass("transition-in").css(Object.assign({"animation-duration":r+"ms","animation-delay":i-s+"ms"},i-s?{visibility:"hidden"}:{})),requestAnimationFrame(function(){v.childrenProbablyInline(t)?t.css("display","inline"):t.parent().is("tw-backdrop,tw-story")||t[0].setAttribute("style",t[0].getAttribute("style")+"display:block !important;width:100%")}),b(t,r,i-s,o,function(n){var r=0===t.filter(a.join(",")).length;u&&r?(t.find("tw-transition-container").each(function(t,r){(r=e(r)).css("animation-delay",v.cssTimeUnit(r.css("animation-delay")||0)-n+"ms")}),t.contents().unwrap()):t.removeClass("transition-in").removeAttr("data-t8n")})}},debounce:function(e){var t=void 0,n=void 0,r=0,a=function a(){Date.now()-r>300?(t=0,e.apply(void 0,_toConsumableArray(n))):t=requestAnimationFrame(a)};return function(){r=Date.now(),n=arguments,t&&cancelAnimationFrame(t),t=requestAnimationFrame(a)}},impossible:function(e,t){window.console&&console.error(e+"(): "+t)},assertMustHave:function(e,t){if(window.console)for(var n=0;n<t.length;n+=1)t[n]in e||console.error("Assertion failed: object lacks property "+t[n])},assertOnlyHas:function(e,t){if(window.console)for(var n in e)t.includes(n)||console.error("Assertion failed: object had unexpected property '"+n+"'!")},onStartup:function(e){f?f.push(e):e()},get storyElement(){return p}},e(function(){p=e("tw-story"),f.forEach(function(e){return e()}),f=null}),Object.freeze(v)}),define("utils/naturalsort",[],function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:String;return function(n,r){var a,i,o,s,c=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,u=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,l=/^0x[0-9a-f]+$/i,p=/^0/,f=t(n).trim(),d=t(r).trim(),h=f.replace(c,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),y=d.replace(c,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),m=parseInt(f.match(l))||1!==h.length&&f.match(u)&&Date.parse(f),g=parseInt(d.match(l))||m&&d.match(u)&&Date.parse(d)||null;if(e&&window.Intl&&window.Intl.Collator&&(o=window.Intl.Collator(e)),g){if(m<g)return-1;if(m>g)return 1}for(var v=0,b=Math.max(h.length,y.length);v<b;v++){if(a=!(h[v]||"").match(p)&&parseFloat(h[v])||h[v]||0,i=!(y[v]||"").match(p)&&parseFloat(y[v])||y[v]||0,isNaN(a)!==isNaN(i))return isNaN(a)?1:-1;if((void 0===a?"undefined":_typeof(a))!==(void 0===i?"undefined":_typeof(i)))a+="",i+="";else if("string"==typeof a&&o&&0!==(s=o.compare(a,i)))return s;if(a<i)return-1;if(a>i)return 1}return 0}}}),define("twinescript/compiler",["utils"],function(e){var t=e.impossible,n=JSON.stringify;function r(e,t){for(var n=0;n<e.length;n+=1)if(t.includes(e[n].type))return n;return NaN}function a(e,t){var n=[];return e.length?([["error"],["comma"],["to","into"],["where","when","via"],["making","each"],["typeSignature"],["augmentedAssign"],["and","or"],["is","isNot"],["contains","doesNotContain","isIn","isNotIn"],["isA","isNotA","matches","doesNotMatch"],["inequality"],["addition","subtraction"],["multiplication","division"],{rightAssociative:["spread","bind"]},{rightAssociative:["not","positive","negative"]},{rightAssociative:["belongingProperty","belongingItProperty","belongingOperator","belongingItOperator"]},["property","itsProperty","possessiveOperator","itsOperator"],["twineLink"],["macro"],["grouping"]]["most"===t?"reverse":"valueOf"]().some(function(t){var a=void 0;if(a=t.rightAssociative?r(e,t.rightAssociative):function(e,t){return e.length-1-r.apply(void 0,[[].concat(_toConsumableArray(e)).reverse(),t])}(e,t),!Number.isNaN(a)&&a>-1)return n=[e[a],a],!0}),n):n}function i(e){if("inequality"===e.type){var t=e.operator;return e.negate?{">":"<=","<":">=",">=":"<","<=":">"}[t]:t}return e.type}function o(e){var t=i(e);return{">":"<","<":">",">=":"<=","<=":">=",contains:"isIn",doesNotContain:"isNotIn",isIn:"contains",isA:"typifies",typifies:"isA",isNotA:"untypifies",untypifies:"isNotA"}[t]||t}var s=["inequality","is","isNot","isIn","contains","doesNotContain","isNotIn","isA","typifies","isNotA","untypifies","matches","doesNotMatch"];function c(e,t,r){return"TwineError.create("+n(e)+","+n(t)+","+n(r)+")"}return function e(r){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=u.isVarRef,p=u.isTypedVar,f=u.whitespaceError,d=u.elidedComparison,h=u.testNeedsRight,y="Operations.Identifiers.it";if(!(r=[].concat(r)).length)return l&&f?c("operation",f):"";var m=void 0;if(1===r.length){var g=(m=r[0]).type;if("identifier"===g)return l?"VarRef.create(Operations.Identifiers,"+n(m.text)+")":"Operations.Identifiers."+m.text.toLowerCase()+" ";if("variable"===g||"tempVariable"===g){var v="VarRef.create("+("tempVariable"===g?"section.stackTop.tempV":"State.v")+"ariables,"+n(m.name)+")"+(l||p?"":".get()");return p?"TypedVar.create(Datatype.create('any'),"+v+")":v}if("hookName"===g)return"HookSet.create({type:'name', data:'"+m.name+"'}) ";if("string"===g)return m.text.replace(/(.?)\n/g,function(e,t){return("\\"===t?"\\\\":"\n"===t?"\\n":t)+"\\n"});if("hook"===g)return"CodeHook.create("+n(m.text.slice(1,-1))+","+n(m.html||"")+")";if("colour"===g)return"Colour.create("+n(m.colour)+")";if("datatype"===g)return"Datatype.create("+n(m.name)+")";if("blockedValue"===g)return"section.blockedValue()";if("root"===g)return e(m.children);if("whitespace"===g&&l&&f)return c("operation",f)}var b,w=a(r,"least"),T=_slicedToArray(w,2);m=T[0],b=T[1];var S=(m||{}).type,x=r.slice(0,b),k=r.slice(b+1),O=function(e,t){return{isVarRef:!0,isTypedVar:t,whitespaceError:"I need usable data to be on the "+e+' of "'+m.text+'".'}},j="must",A="mustn't",C="may",E=void 0,_=void 0,N="",P="",I="",M=j,D=j,R=!1;if(S)if("comma"===S)P=",",D=C;else if("spread"===S)N="Operations.makeSpreader(",I=")",M=C;else if("bind"===S)N="VarBind.create(",_=e(k,O("right")),I=(m.text.startsWith("2")?",'two way'":"")+")",M=A;else if("to"===S)N="Operations.makeAssignmentRequest(Operations.setIt(",_=e(k,O("right")),P="),",E=e(x,O("left",!0)),I=",'to')";else if("into"===S)N="Operations.makeAssignmentRequest(",_=e(x,O("left")),P=",Operations.setIt(",E=e(k,O("right",!0)),I="),'into')";else if("typeSignature"===S)N="TypedVar.create(",P=",",_=e(k,O("right")),I=")",p=!1;else if("where"===S||"when"===S||"via"===S)N="Lambda.create(",E=e(x,{isVarRef:!0,whitespaceError:null}).trim()||"undefined",P=","+n(m.type)+",",_=n(e(k)),I=","+n(r.map(function(e){return e.text}).join(""))+")";else if("making"===S||"each"===S)"each"===S?(N="Lambda.create(",_=e(k,O("right")).trim(),I=",'where','true',"+n(r.map(function(e){return e.text}).join(""))+")",M=C):(N="Lambda.create(",E=e(x,{isVarRef:!0,whitespaceError:null}).trim()||"undefined",P=","+n(m.type)+",",_=e(k,O("right")).trim(),I=","+n(r.map(function(e){return e.text}).join(""))+")");else if("augmentedAssign"===S)N="Operations.makeAssignmentRequest(",E=e(x,O("left")),P=",",_="Operations["+n(m.operator)+"]("+e(x)+","+e(k)+")",I=","+n(m.operator)+")";else if("and"===S||"or"===S){var L=function e(t){var n=a(t,"least"),r=_slicedToArray(n,2),i=r[0],o=r[1];if(i)return s.includes(i.type)?i:["and","or"].includes(i.type)?e(t.slice(0,o))||e(t.slice(o+1)):void 0},F=L(x),q=L(k),V=c("operation",'This use of "is not" and "'+S+'" is grammatically ambiguous.','Maybe try rewriting this as "__ is not __ '+S+' __ is not __"');if(N="Operations."+S+"(",P=",",I=")",d===m.type)N=I="",E=e(x,{isVarRef:l,elidedComparison:d}).trim(),_=e(k,{elidedComparison:d}).trim();else if(F&&!q){var H=F,z=n(i(H));if("isNot"===H.type||"isNotA"===H.type||"untypifies"===H.type)return V;_="Operations.elidedComparisonOperator("+n(m.type)+","+z+","+e(k,{elidedComparison:S})+")"}else if(!F&&q){var W=q,$=r.indexOf(W),B=n(o(W));if("isNot"===W.type||"isNotA"===W.type||"untypifies"===W.type)return V;_="Operations.elidedComparisonOperator("+n(m.type)+","+B+","+e(x,{elidedComparison:S})+")",E=e([].concat(_toConsumableArray(r.slice($+1)),[Object.assign(Object.create(W),_defineProperty({},"inequality"===W.type?"operator":"type",o(W)))],_toConsumableArray(r.slice(b+1,$))))}l=!1}else if(s.includes(S))R=!0,l=!1,N="Operations["+n(i(m))+"](",P=",",I=")";else if("addition"===S||"subtraction"===S){if(!e(x,{testNeedsRight:!0}).trim())return m.type={addition:"positive",subtraction:"negative"}[S],e(r,{isVarRef:l,whitespaceError:f,elidedComparison:d,testNeedsRight:h});l=!1,N="Operations["+n(m.text)+"](",P=",",I=")"}else if("multiplication"===S||"division"===S)l=!1,N="Operations["+n(m.text)+"](",P=",",I=")";else if("positive"===S||"negative"===S)l=!1,E="negative"===S?"-1":"1",N="Operations['*'](",P=",",I=")";else if("not"===S)N="Operations.not(",_=e(k),I=")",M=C;else if("belongingProperty"===S)N="VarRef.create(",_=e(k,O("right")),I=","+n(m.name)+")"+(l?"":".get()"),M=C;else if("belongingOperator"===S||"belongingItOperator"===S)E=m.type.includes("It")?y:e(k,O("right")),_=e(x),N="VarRef.create(",P=",{computed:true,value:",I="})"+(l?"":".get()");else if("property"===S)N="VarRef.create(",E=e(x,O("left")),I=","+n(m.name)+")"+(l?"":".get()"),D=C;else if("itsProperty"===S||"belongingItProperty"===S)N="VarRef.create(",E=y,I=","+n(m.name)+")"+(l?"":".get()"),M=D=C;else if("possessiveOperator"===S||"itsOperator"===S)m.type.includes("it")&&(E=y,M=C),N="VarRef.create(",P=",{computed:true,value:",I="})"+(l?"":".get()"),p=!1;else if("twineLink"===S)P='Macros.run("link-goto", [section,'+n(m.innerText)+","+n(m.passage)+"])",M=D=A;else if("macro"===S){var U=m.children[0],G="$"===U.text[0]||"_"===U.text[0];"macroName"===U.type||G||t("Compiler.compile","macro token had no macroName child token"),P="Macros.run"+(G?"Custom":"")+"("+(G?"VarRef.create("+("_"===U.text[0]?"section.stackTop.tempV":"State.v")+"ariables,"+n(U.text.trim().slice(1,-1))+").get()":'"'+m.name+'"')+", [section,"+e(m.children.slice(1),{isTypedVar:p})+"])",M=D=A}else if("grouping"===S)P="("+e(m.children,{isVarRef:l})+")",M=D=A;else if("error"===S)return c("syntax",n(m.message),m.explanation?n(m.explanation):"");return b>-1?(E=(E||e(x,{isVarRef:l,isTypedVar:p})).trim(),_=(_||e(k)).trim(),R&&!E&&(E=y),M===j&&!E||D===j&&!_?h&&D&&!_?"":c("operation","I need usable code to be "+(M===j?"left ":"")+(M===j&&D===j?"and ":"")+(D===j?"right ":"")+"of "+m.text+"."):M===A&&E||D===A&&_?c("operation","There can't be a "+(E&&M===A&&_&&D===A?E+" or "+_:E&&M===A?E:_)+" to the "+(M===A?"left ":"")+(M===A&&D===A?"or ":"")+(D===A?"right ":"")+"of "+m.text+".","There could be a comma missing between them, or there could be a "):N+E+P+_+I):1===r.length?(("value"in r[0]?r[0].value:r[0].text)+"").trim()||" ":r.reduce(function(t,n){return t+e(n,{isVarRef:l,isTypedVar:p})},"")}}),define("internaltypes/twineerror",["jquery","utils"],function(e,t){var n=t.impossible,r=t.escape;e(document.documentElement).on("click","tw-folddown",function(t){var n=t.target;for((n=e(n)).toggleClass("open");n&&!n.next().length;)n=n.parent();n&&n.next().toggle()});var a={syntax:"The markup seems to contain a mistake.",saving:"I tried to save or load the game, but I couldn't do it.",operation:"I tried to perform an operation on some data, but the data's type was incorrect.",macrocall:"I tried to use a macro, but its call wasn't written correctly.",datatype:"I tried to use a macro, but was given the wrong type of data to it.",custommacro:"I tried to use a custom macro, but its code hook had a mistake in it.",infinite:"I almost ended up doing the same thing over and over, forever.",property:"I tried to access a value in a string/array/datamap, but I couldn't find it.",unimplemented:"I currently don't have this particular feature. I'm sorry.",javascript:"This error message was reported by your browser's Javascript engine. I don't understand it either, but it usually means that an expression was badly written.",propagated:"Click the 'Open' button to see the code hook as it was executed.",user:"This is a custom error created by (error:). It usually means you used a custom macro incorrectly.",assertion:"This command exists to provide a helpful error if a certain important condition wasn't true."},i={error:[],warning:[]},o={create:function(e,t,r,i){return t&&"string"==typeof t||n("TwineError.create","has a bad message string"),r||e in a||n("TwineError.create","no error explanation given"),"user"!==e&&(t=t[0].toUpperCase()+t.slice(1)),Object.assign(Object.create(this),{type:e,message:t,explanation:r,source:void 0,innerDOM:i,appendTitleText:!1})},fromError:function(e){return o.create("javascript","\u2615 "+e.message)},containsError:function(){for(var e=0;e<arguments.length;e+=1){var t=arguments.length<=e?void 0:arguments[e];if(t instanceof Error)return t;if(o.isPrototypeOf(t))return t;if(Array.isArray(t)){var n=o.containsError.apply(o,_toConsumableArray(t));if(n)return n}}return!1},createWarning:function(e,t){return Object.assign(this.create(e,t),{warning:!0})},render:function(n){var o=this;n=n||this.source||"";var s=e("<tw-error class='"+("javascript"===this.type?"javascript ":"")+(this.warning?"warning":"error")+"' title='"+r(n)+"'>"+r(this.message+(this.appendTitleText?" "+n:""))+"</tw-error>"),c=e("<tw-error-explanation>").text(this.explanation||a[this.type]).hide(),u=e("<tw-folddown tabindex=0>");return this.innerDOM&&e("<tw-open-button>").on("click",function(){var n=e("<tw-backdrop><tw-dialog></tw-backdrop>");n.find("tw-dialog").prepend(o.innerDOM,e("<tw-link tabindex=0>OK</tw-link>").on("click",function(){o.innerDOM.detach(),n.remove()}).wrap("<tw-dialog-links>").parent()),t.storyElement.prepend(n)}).appendTo(s),s.append(u).append(c),s.data("TwineError",this),i.error.forEach(function(e){return e(o,n)}),s},on:function(e,t){if(e in i)return"function"!=typeof t||i[e].includes(t)||i[e].push(t),o;n("TwineError.on","invalid event name")}};return o}),define("renderer",["utils","markup","twinescript/compiler","internaltypes/twineerror"],function(e,t,n,r){var a=e.escape,i=e.impossible,o=e.insensitiveName,s=void 0;function c(e,t){return"<"+t+">"+e+"</"+t+">"}function u(e,t){var n=s.render(e.children);return n&&c(n,t)}var l,p,f="text-align: center; max-width:50%; ",d=RegExp(t.Patterns.macroFront+t.Patterns.macroName,"ig");return s={options:{debug:!1,blockerMacros:[],metadataMacros:[]},preprocess:function(e){var a=s.options.metadataMacros;if(!(e.match(d)||[]).some(function(e){return a.some(function(t){return o(e.slice(1,-1))===t})}))return{};var i=!1,c={};return t.lex(e).children.forEach(function e(t){if("macro"===t.type){if(a.some(function(e){return t.name===e})){if(r.isPrototypeOf(c[t.name]))return;if(i)return void(c[t.name]=r.create("syntax","The ("+t.name+":) macro can't appear after non-metadata macros."));if(c[t.name])return void(c[t.name]=r.create("syntax","There is more than one ("+t.name+":) macro."));c[t.name]={code:n(t),source:t.text}}else i=!0;t.children.forEach(function e(t){"macro"===t.type&&a.some(function(e){return t.name===e})?c[t.name]=r.create("syntax","The ("+t.name+":) macro can't be inside another macro."):t.children.forEach(e)})}else t.children.forEach(e)}),c},exec:(l=void 0,p=void 0,function(e){return"string"!=typeof e?(i("Renderer.exec","source was not a string, but "+(void 0===e?"undefined":_typeof(e))),""):e===l?p:(l=e,p=s.render(t.lex(e).children))}),render:function e(i){var l="",p=[];if(!i)return l;for(var d=i.length,h=0;h<d;h+=1){var y=i[h];switch(y.type){case"error":l+=r.create("syntax",y.message,y.explanation).render(a(y.text))[0].outerHTML;break;case"numbered":case"bulleted":var m="numbered"===y.type?"ol":"ul";l+="<"+m+">";for(var g=1;h<d&&i[h];){if("br"===i[h].type){if(l+="</li>",!i[h+1]||i[h+1].type!==y.type)break}else i[h].type===y.type?(l+=("<"+m+">").repeat(Math.max(0,i[h].depth-g)),l+=("</"+m+">").repeat(Math.max(0,g-i[h].depth)),l+="<li>",g=i[h].depth):l+=e([i[h]]);h+=1}l+=("</"+m+">").repeat(g+1);break;case"align":for(;y&&"align"===y.type;){var v=y.align,b=h+=1;if("left"===v){h-=1;break}for(;h<d&&i[h]&&"align"!==i[h].type;)h+=1;var w=e(i.slice(b,h)),T="";switch(v){case"center":T+=f+"margin-left: auto; margin-right: auto;";break;case"justify":case"right":T+="text-align: "+v+";";break;default:+v&&(T+=f+"margin-left: "+v+"%;")}l+="<tw-align "+(T?'style="'+T+'"':"")+">"+w+"</tw-align>\n",y=i[h]}break;case"column":for(var S=[];y&&"column"===y.type;){var x=y.column,k=h+=1;if("none"===x){h-=1;break}for(;h<d&&i[h]&&"column"!==i[h].type;)h+=1;S.push({text:y.text,type:x,body:e(i.slice(k,h)),width:y.width,marginLeft:y.marginLeft,marginRight:y.marginRight}),y=i[h]}S.length&&function(){var e=S.reduce(function(e,t){return e+t.width},0);l+="<tw-columns>"+S.map(function(t){return"<tw-column type="+t.type+'  style="width:'+t.width/e*100+"%; margin-left: "+t.marginLeft+"em; margin-right: "+t.marginRight+'em;">'+t.body+"</tw-column>\n"}).join("")+"</tw-columns>"}();break;case"heading":for(l+="<h"+y.depth+">";++h<d&&i[h];){if("br"===i[h].type){l+="</h"+y.depth+">";break}l+=e([i[h]])}break;case"br":if(!p.length||/td|th/.test(p[0])){l+="<br>";for(var O=i[h+1];O&&("br"===O.type||"tag"===O.type&&/^<br\b/i.test(O.text));)l+="<tw-consecutive-br"+("tag"===O.type?" data-raw":"")+"></tw-consecutive-br>",O=i[(h+=1)+1]}break;case"hr":l+="<hr>";break;case"escapedLine":case"comment":break;case"inlineUrl":l+='<a class="link" href="'+a(y.text)+'">'+y.text+"</a>";break;case"scriptStyleTag":case"tag":var j=y.text.toLowerCase();/^<\/?(?:table|thead|tbody|tr|tfoot|td|th)\b/.test(j)&&p[y.text.startsWith("</")?"shift":"unshift"](j),l+=y.text.startsWith("</")?y.text:y.text.replace(/>$/," data-raw>");break;case"sub":case"sup":case"strong":case"em":l+=u(y,y.type);break;case"strike":l+=u(y,"s");break;case"bold":l+=u(y,"b");break;case"italic":l+=u(y,"i");break;case"twineLink":var A=_slicedToArray(t.lex("(link-goto:"+JSON.stringify(y.innerText)+","+JSON.stringify(y.passage)+")").children,1)[0];l+='<tw-expression type="macro" name="link-goto"'+(s.options.debug?' title="'+a(y.text)+'"':"")+' js="'+a(n(A))+'"></tw-expression>';break;case"hook":l+="<tw-hook "+(y.hidden?"hidden ":"")+(y.name?'name="'+o(y.name)+'"':"")+(s.options.debug&&y.name?' title="Hook: ?'+y.name+'"':"")+' source="'+a(y.innerText)+'"></tw-hook>';break;case"unclosedHook":return l+="<tw-hook "+(y.hidden?"hidden ":"")+(y.name?'name="'+o(y.name)+'"':"")+'source="'+a(i.slice(h+1,d).map(function(e){return e.text}).join(""))+'"></tw-hook>';case"verbatim":l+=c(a(y.innerText).replace(/\n/g,"<br>"),"tw-verbatim");break;case"collapsed":l+=u(y,"tw-collapsed");break;case"unclosedCollapsed":return l+="<tw-collapsed>"+e(i.slice(h+1,d))+"</tw-collapsed>";case"variable":case"tempVariable":case"macro":var C=function(){var t=[],i=[];if("macro"===y.type&&function n(r){"string"!==r.type&&"hook"!==r.type&&r.children.every(n);var a=r.firstChild();if("macro"===r.type&&a&&"macroName"===a.type&&s.options.blockerMacros.includes(o(a.text.slice(0,-1))))t.push(r);else if("hook"===r.type){if(!r.everyLeaf(function(e){return"error"!==e.type||(i.push(e),!1)}))return!1;r.html=e(r.children)}return!0}(y),i.length)return{v:r.create("syntax","This code hook's markup contained "+i.length+" error"+(i.length?"s":"")+":<br>\u2014"+i.map(function(e){return e.message}).join("<br>\u2014")).render(a(y.text))[0].outerHTML};var c=t.length&&t.map(function(e){var t=n(e);return e.type="blockedValue",t});l+='<tw-expression type="'+y.type+'" name="'+a(y.name||y.text)+'"'+(s.options.debug?' title="'+a(y.text)+'"':"")+(t.length?' blockers="'+a(JSON.stringify(c))+'"':"")+' js="'+a(n(y))+'"></tw-expression>',t.forEach(function(e){return e.type="macro"})}();if("object"===(void 0===C?"undefined":_typeof(C)))return C.v;break;default:l+=y.children&&y.children.length?e(y.children):y.text}}return l}},Object.freeze(s)}),define("passages",["jquery","utils/naturalsort","utils","markup","renderer","internaltypes/twineerror"],function(e,t,n,r,a,i){var o=n.unescape,s=n.onStartup,c=Object.assign;function u(e){var t=o(e.html()),n=a.preprocess(t);return c(new Map([["source",t],["tags",(e.attr("tags")||"").split(/\s/)||[]],["name",e.attr("name")]]),{TwineScript_TypeName:"a passage datamap",TwineScript_ObjectName:"a passage datamap",metadata:n})}var l=c(new Map,{TwineScript_ObjectName:"the Passages datamap",getTagged:function(e){var n=t("en",function(e){return e.get("name")}),r=[];return this.forEach(function(t){var n=t instanceof Map&&t.get("tags");Array.isArray(n)&&n.includes(e)&&r.push(t)}),r.sort(n)},getStorylets:function(e,n){var r=n?n.filter(e,[].concat(_toConsumableArray(l.values()))):[].concat(_toConsumableArray(l.values()));if(i.containsError(r))return r;var a=[],o=-1/0,s=r.reduce(function(t,n){if(t)return t;var r=n.get("storylet");if(r){var s=e.speculate(r,n.get("name"),"a (storylet:) macro");if(i.containsError(s))return s.message="There's an error in the storylet passage \""+n.get("name")+'":\n'+s.message,s.source=r.TwineScript_ToSource(),s;if(s){var c=n.get("exclusivity");o=Math.max(o,"number"==typeof c?c:0),a.push(n)}}},void 0);if(s)return s;var c=t("en");return a.filter(function(e){var t=e.get("exclusivity");return(t="number"==typeof t?t:0)===o}).sort(function(e,t){var n=e.get("urgency"),r=t.get("urgency");return(n="number"==typeof n?n:0)!==(r="number"==typeof r?r:0)?r-n:c(e.get("name"),t.get("name"))})},allStorylets:function(){return[].concat(_toConsumableArray(l.values())).filter(function(e){return e.get("storylet")})},loadMetadata:function(e){var t=[];return l.forEach(function(n){n.metadata&&Object.keys(n.metadata).forEach(function(r){if(i.containsError(n.metadata[r]))t.push(n.metadata[r]);else{var a=n.metadata[r],o=a.code,s=a.source,c=e.speculate(o,n.get("name"),"a ("+r+":) macro"),u='In "'+n.get("name")+'":\n';if(i.containsError(c))return c.message=u+c.message,c.source=s,void t.push(c);c instanceof Map?c.forEach(function(e,t){return l(t,e)}):l(r,c)}function l(e,r){n.has(e)?t.push(i.create("syntax","This passage's datamap already has a '"+JSON.stringify(e)+"' data name.")):n.set(e,r)}}),n.metadata=void 0}),t},hasValid:function(e){var t=this.get(e);return t&&t instanceof Map&&t.has("source")},create:u});return s(function(){Array.from(e("tw-storydata > tw-passagedata")).forEach(function(t){t=e(t),l.set(t.attr("name"),new u(t))})}),l}),define("utils/operationutils",["utils/naturalsort","utils","internaltypes/twineerror","patterns"],function(e,t,n,r){var a=t.impossible,i=t.nth,o=t.insensitiveName,s=t.permutations,c=r.validPropertyName,u="object",l="boolean",p="string",f="number",d="function";function h(e){return!!e&&((void 0===e?"undefined":_typeof(e))===u||(void 0===e?"undefined":_typeof(e))===d)}function y(e){return e&&Object.getPrototypeOf(e)===Object.prototype}function m(e){return Array.isArray(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":(void 0===e?"undefined":_typeof(e))===p?p:e&&(void 0===e?"undefined":_typeof(e))===u?u:""}function g(e){if(!h(e))return e;if(_typeof(e.TwineScript_Clone)===d)return e.TwineScript_Clone();if(Array.isArray(e))return[].concat(_toConsumableArray(e));if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if((void 0===e?"undefined":_typeof(e))===d)return Object.assign(e.bind(),e);switch(Object.getPrototypeOf(e)){case Object.prototype:return Object.assign({},e);case null:return Object.assign(Object.create(null),e)}return a("OperationUtils.clone","The value "+e+" cannot be cloned!"),e}function v(e){return h(e)&&"TwineScript_ObjectName"in e?e.TwineScript_ObjectName:Array.isArray(e)?"an array":e instanceof Map?"a datamap":e instanceof Set?"a dataset":(void 0===e?"undefined":_typeof(e))===l?"the boolean value '"+e+"'":(void 0===e?"undefined":_typeof(e))===p||(void 0===e?"undefined":_typeof(e))===f?"the "+(void 0===e?"undefined":_typeof(e))+" "+JSON.stringify(e):void 0===e?"an empty variable":"...whatever this is"}function b(e,t){return(void 0===e?"undefined":_typeof(e))!==u&&(void 0===t?"undefined":_typeof(t))!==u?e===t:Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&e.every(function(e,n){return b(t[n],e)}):e instanceof Map&&t instanceof Map?b(Array.from(e.entries()).sort(),Array.from(t.entries()).sort()):e instanceof Set&&t instanceof Set?b([].concat(_toConsumableArray(e)),[].concat(_toConsumableArray(t))):e&&_typeof(e.TwineScript_is)===d?e.TwineScript_is(t):e&&(void 0===e?"undefined":_typeof(e))===u&&t&&(void 0===t?"undefined":_typeof(t))===u&&y(e)&&y(t)?b(Object.getOwnPropertyNames(e).map(function(t){return[t,e[t]]}),Object.getOwnPropertyNames(t).map(function(e){return[e,t[e]]})):Object.is(e,t)}return Object.freeze({isObject:h,isPureObject:y,singleTypeCheck:function e(t,n){if(null===n)return void 0===t;var r=void 0===t?"undefined":_typeof(t);if((void 0===n?"undefined":_typeof(n))!==d&&n.pattern){if("optional"===n.pattern||"zero or more"===n.pattern)return void 0===t||e(t,n.innerType);if("either"===n.pattern)return n.innerType.some(function(n){return e(t,n)});if("lambda"===n.pattern&&e(t,n.innerType))return n.clauses.includes("where")==="where"in t&&n.clauses.includes("making")==="making"in t&&n.clauses.includes("via")==="via"in t&&n.clauses.includes("with")==="with"in t;if("insensitive set"===n.pattern)return n.innerType.includes(o(t));if("range"===n.pattern)return n.range(t);if("wrapped"===n.pattern)return e(t,n.innerType)}return(void 0===n||void 0!==t)&&("anything"===n.TwineScript_TypeName&&void 0!==t&&!t.TwineScript_Unstorable||"everything"===n.TwineScript_TypeName&&void 0!==t||(n===String?r===p:n===Boolean?r===l:n===parseInt?r===f&&!Number.isNaN(t)&&!(t+"").includes("."):n===Number?r===f&&!Number.isNaN(t):n===Array?Array.isArray(t):n===Map||n===Set?t instanceof n:Object.isPrototypeOf.call(n,t)))},isValidDatamapName:function(e,t){if(e instanceof Map||a("isValidDatamapName","called with non-Map"),n.containsError(t))return t;if((void 0===t?"undefined":_typeof(t))!==p&&(void 0===t?"undefined":_typeof(t))!==f)return n.create("property","Only strings and numbers can be used as data names for "+v(e)+", not "+v(t)+".");var r=(void 0===t?"undefined":_typeof(t))===p?+t:""+t;return!(!Number.isNaN(r)&&e.has(r))||n.create("property","You mustn't use both "+v(t)+" and "+v(r)+" as data names in the same datamap.")},collectionType:m,isSequential:function(e){return(void 0===e?"undefined":_typeof(e))===p||Array.isArray(e)||_typeof(e.hooks)===d},unstorableValue:function e(t){return t&&t.TwineScript_Unstorable&&t||Array.isArray(t)&&t.find(e)||t instanceof Map&&[].concat(_toConsumableArray(t.values())).find(e)||t instanceof Set&&[].concat(_toConsumableArray(t)).find(e)},clone:g,objectName:v,typeName:function e(t){var n=y(t);if(n&&t.innerType)return t.typeName?t.typeName:"insensitive set"===t.pattern?"a case-insensitive string name":"either"===t.pattern?(Array.isArray(t.innerType)||a("typeName",'"either" pattern had non-array inner type'),t.innerType.map(e).join(" or ")):"optional"===t.pattern?"(optional) "+e(t.innerType):e(t.innerType);if(n&&t.pattern&&"range"===t.pattern){if(t.name)return t.name;var r=t.min,i=t.max;return"a"+(r>0?" positive":"")+(t.integer?" whole":"")+" number"+(0===r?" between 0 and "+i:i<1/0?" up to "+i:"")}return t===String||t===Number||t===Boolean?"a "+_typeof(t()):t===parseInt?"a whole number":t===Map?"a datamap":t===Set?"a dataset":t===Array?"an array":h(t)&&"TwineScript_TypeName"in t?t.TwineScript_TypeName:v(t)},typeID:function(e){var t=void 0===e?"undefined":_typeof(e);return[l,p,f].includes(t)?t:Array.isArray(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":e.TwineScript_TypeID||""},toSource:function t(r,o){var s=n.containsError(r);return s&&a("toSource","received a TwineError: "+s.message),_typeof(r.TwineScript_ToSource)===d?r.TwineScript_ToSource():y(r)&&"first"in r&&"last"in r?(r.first<0?(-1!==r.first?i(-r.first):"")+"last":i(r.first+1))+"to"+(r.last<0?(-1!==r.last?i(-r.last):"")+"last":i(r.last+1)):Array.isArray(r)?"(a:"+("property"===o?r.map(function(e){return e+(e>0)}):r).map(t)+")":r instanceof Map?"(dm:"+Array.from(r.entries()).sort(function(t,n){return[t[0],n[0]].sort(e("en"))[0]===t[0]?-1:1}).map(function(e){return e.map(t)})+")":r instanceof Set?"(ds:"+Array.from(r).sort(e("en")).map(t)+")":(void 0===r?"undefined":_typeof(r))===f&&"property"===o?r<0?-1===r?"last":i(-r)+"last":i(r+1):(void 0===r?"undefined":_typeof(r))===p&&"property"===o?RegExp(c).test(r)?r:"("+JSON.stringify(r)+")":JSON.stringify(r)},is:b,contains:function(e,t){if(e||""===e){if((void 0===e?"undefined":_typeof(e))===p)return(void 0===t?"undefined":_typeof(t))!==p?n.create("operation",v(e)+" can only contain strings, not "+v(t)+"."):e.includes(t);if(Array.isArray(e))return e.some(function(e){return b(e,t)});if(e instanceof Set||e instanceof Map)return Array.from(e.keys()).some(function(e){return b(e,t)})}return n.create("operation",v(e)+" cannot contain any values, let alone "+v(t))},isA:function(e,t){return _typeof(t.TwineScript_IsTypeOf)===d?t.TwineScript_IsTypeOf(e):n.create("operation",'"is a" should only be used to compare type names, not '+v(t)+".")},matches:function e(t,r){var a=!1;if(t&&_typeof(t.TwineScript_IsTypeOf)===d){var i=t.TwineScript_IsTypeOf(r);if(n.containsError(i))return i;a|=i}if(r&&_typeof(r.TwineScript_IsTypeOf)===d){var o=r.TwineScript_IsTypeOf(t);if(n.containsError(o))return o;a|=o}if(a)return!0;if(Array.isArray(t)&&Array.isArray(r)){for(var c=0,u=0,l=!0;l&&c<t.length&&u<r.length;){var p=t[c],f=r[u];if(p.rest){for(;u<r.length&&e(p,f);)f=r[u+=1];c+=1}else if(f.rest){for(;c<t.length&&e(p,f);)p=t[c+=1];u+=1}else e(p,f)?(c+=1,u+=1):l=!1}return l&&c>=t.length&&u>=r.length}return t instanceof Map&&r instanceof Map?e(Array.from(t.entries()).sort(),Array.from(r.entries()).sort()):t instanceof Set&&r instanceof Set?(t=[].concat(_toConsumableArray(t)),s.apply(void 0,_toConsumableArray(r)).some(function(n){return e(t,n)})):b(t,r)},subset:function e(t,r,a){if(!r||!a)return n.create("macrocall","The sub"+m(t)+" index value must not be "+(r&&a)+".");var i=(void 0===t?"undefined":_typeof(t))===p;if(i&&(t=Array.from(t)),r<0&&(r=Math.max(0,t.length+r+1)),a<0&&(a=Math.max(0,t.length+a+1)),r>a)return e(arguments[0],a,r);var o=t.slice(r>0?r-1:r,a).map(g);return i?o.join(""):o},range:function e(t,n){if(t>n)return e(n,t);var r=[t];for(n-=t;n-- >0;)r.push(++t);return r},printBuiltinValue:function e(t){return n.containsError(t)?t:t&&_typeof(t.TwineScript_Print)===d?t.TwineScript_Print():t instanceof Map?(t=Array.from(t.entries()),n.containsError(t)?t:t.reduce(function(t,n){var r=_slicedToArray(n,2),a=r[0],i=r[1];return t+"<tr><td>`"+e(a)+"`</td><td>`"+e(i)+"`</td></tr>"},"<table class=datamap>")+"</table>"):t instanceof Set?Array.from(t.values()).map(e)+"":Array.isArray(t)?t.map(e)+"":t&&_typeof(t.jquery)===p?t:h(t)?n.create("unimplemented","I don't know how to print this value yet."):t+""},unique:function(e,t,n){return!n.slice(t+1).some(function(t){return b(e,t)})}})}),define("utils/renderutils",["jquery","utils","renderer"],function(e,t,n){var r=RegExp(t.realWhitespace+"+"),a=RegExp(t.realWhitespace+"+","g");function i(e,t,n){var r=e.textContent.length;if(!(t>=r)){var a=void 0,i=[a=0===t?e:e.splitText(t)];return n&&(n<=0&&(n=r-n),n<r&&i.push(a.splitText(n-t))),i}}var o,s=(o=void 0,function(){if(void 0!==o)return o;var t=e("<p>");return t[0].normalize?(t.append(document.createTextNode("0-"),document.createTextNode("2"),document.createTextNode(""))[0].normalize(),o=1===t.contents().length):o=!1});var c="tw-collapsed,[collapsing=true]";var u=/^(=*)([^=]+)=*$/;return Object.freeze({dialog:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.section,i=r.parent,o=void 0===i?t.storyElement:i,s=r.cd,c=r.message,u=void 0===c?"":c,l=r.defaultValue,p=r.buttons,f=void 0===p?[{name:"OK",confirm:!0,callback:Object}]:p,d=e("<tw-backdrop><tw-dialog>"+(l||""===l?"<input type=text style='display:block;margin:0 auto'></input>\n":"")+"<tw-dialog-links>"+(f.length?f.reduce(function(e,t,n){var r=t.name;return e+"<tw-link style='margin:0 "+(n===f.length-1?"0 0 0.5em":0===n?"0.5em 0 0":"0.5em")+"' tabindex=0>"+r+"</tw-link>"},""):"<tw-link tabindex=0>"+f[0].name+"</tw-link>")+"</tw-dialog-links></tw-dialog></tw-backdrop>"),h=d.find("tw-dialog");if(o.append(d),a){a.renderInto(u,h,Object.assign({},s,{append:"prepend"}));var y=s&&s.transition&&d.find("tw-dialog > tw-transition-container");y&&y.length&&y.appendTo(d).append(h.prepend(y.contents().detach()))}else h.prepend(n.exec(u));if(l){var m=d.find("input").last();m.val(l).on("keypress",function(e){13===e.which&&(d.remove(),f.filter(function(e){return e.confirm}).forEach(function(e){return e.callback()}))}),setTimeout(function(){return m.focus()},100)}return f.reverse().forEach(function(t,n){e(d.find("tw-link").get(-n-1)).on("click",function(){d.remove(),t.callback()})}),d},realWhitespace:r,textNodeToChars:function(e){var t=[].concat(_toConsumableArray(e.textContent));return 1===t.length?[e]:t.reduce(function(e,t){return t.match(r)&&e.length&&e[e.length-1].match(r)?e[e.length-1]+=t:e.push(t),e},[]).reduce(function(t,n){var r=e;return n.length<e.textContent.length&&(e=e.splitText(n.length)),t.concat(r)},[])},findTextInNodes:function e(t,n){var r=[],a="",o=[];if(!t.length||!n)return o;for(;t.length>0;){r.push(t[0]),a+=t[0].textContent,t.shift();var s=a.indexOf(n);if(s>-1){for(var c,u=a.length-(s+n.length);s>=r[0].textContent.length;)s-=r[0].textContent.length,r.shift();if(1===r.length){var l=i(r[0],s,s+n.length);o.push(l[0]),l[1]&&t.unshift(l[1]);break}o.push(i(r[0],s,r[0].length)[0]),(c=o).push.apply(c,_toConsumableArray(r.slice(1,-1)));var p=i(r[r.length-1],0,r[r.length-1].textContent.length-u);o.push(p[0]),p[1]&&t.unshift(p[1]),o=o.filter(Boolean);break}}return[o].concat(_toConsumableArray(e(t,n)))},collapse:function(t){function n(t){return 0===e(this||t).parentsUntil(c).filter("tw-verbatim, tw-expression, [collapsing=false]").length}var r=function e(t){var n=t[0],r=t.parent();if(!r.length||t.findAndFilter("tw-story").length)return null;var a=r.textNodes().filter(function(e){var t=e.compareDocumentPosition(n);return 4&t&&!(8&t)});return(a=a[a.length-1])||e(r)}(t);e(r).parents(c).length||(r=null);var i=function e(t){var n=t[0],r=t.parent();if(!r.length||t.findAndFilter("tw-story").length)return null;var a=r.textNodes().filter(function(e){var t=e.compareDocumentPosition(n);return 2&t&&!(8&t)})[0];return a||e(r)}(t);e(i).parents(c).length||(i=null);var o="br:not([data-raw]),tw-consecutive-br:not([data-raw])";t.find(o).filter(n).replaceWith(document.createTextNode(" "));var u=(t=e(t.get().map(function(t){return e(t).filter(n).is(o)?e(document.createTextNode(" ")).replaceAll(t)[0]:t}))).textNodes(),l=0;u.reduce(function(e,t){return n(t)?(t.textContent=t.textContent.replace(a," ")," "!==t.textContent[0]||e&&e.textContent&&!(e.textContent.search(/\s$/)>-1)||(t.textContent=t.textContent.slice(1)),t):document.createTextNode("A")},r),[].concat(_toConsumableArray(u)).reverse().every(function(e){return!!n(e)&&(e.textContent.match(/^\s*$/)?(l+=e.textContent.length,e.textContent="",!0):(e.textContent=e.textContent.replace(/\s+$/,function(e){return l+=e.length,""}),!1))}),l>0&&i&&(u[u.length-1].textContent+=" "),t[0]&&s()&&t[0].normalize()},geomStringRegExp:u,geomParse:function(e){var t=e.length,n=u.exec(e)||[],r=_slicedToArray(n,3),a=r[0],i=r[1],o=r[2];return a?{marginLeft:i.length/t*100,size:o.length/t*100}:{marginLeft:0,size:0}}})}),define("datatypes/hookset",["jquery","utils","utils/renderutils","utils/operationutils"],function(e,t,n,r){var a=n.textNodeToChars,i=n.realWhitespace,o=n.findTextInNodes,s=r.toSource;function c(n){var r=n.dom,s=e();this.next&&(s=s.add(c.call(this.next,n)));var u=function(t,n){if(Array.isArray(n))return n.reduce(function(e,n){return e.add(t.get(n))},e());if(n&&"object"===(void 0===n?"undefined":_typeof(n))&&"first"in n&&"last"in n){var r=n.first,o=n.last,s=t.length;r<0&&(r+=s),o<0&&(o+=s);for(var c=[t.get(r)];r!==o;)r+=Math.sign(o-r),c.push(t.get(r));return e(c)}if("string"==typeof n){if("chars"===n){var u=[],l=!0,p=!1,f=void 0;try{for(var d,h=t.textNodes(":not(tw-error, tw-error *)")[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var y=d.value,m=!0,g=!1,v=void 0;try{for(var b,w=a(y)[Symbol.iterator]();!(m=(b=w.next()).done);m=!0){var T=b.value;T.textContent.match(i)||u.push(T)}}catch(e){g=!0,v=e}finally{try{!m&&w.return&&w.return()}finally{if(g)throw v}}}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return e(u)}if("links"===n)return t.findAndFilter("tw-link, .enchantment-link");if("visited"===n)return t.findAndFilter("tw-link.visited");if("lines"===n){var S=t.findAndFilter("br:not(tw-sidebar *),tw-consecutive-br:not(tw-sidebar *)").get(),x=[[]];return t.textNodes(":not(tw-error, tw-error *):not(tw-sidebar, tw-sidebar *)").forEach(function(e){S.length&&2&e.compareDocumentPosition(S[0])&&(S.shift(),x.push([])),x[x.length-1]=x[x.length-1].concat(e)}),x=x.map(function(t){return t.map(function(n){for(var r=n.parentNode;e(r).textNodes().every(function(e){return t.includes(e)})&&!t.every(function(t){return e(r).has(t).length});){r=(n=r).parentNode}return n})}),e(x.map(function(t){return e(t).wrapAll("<tw-pseudo-hook>").parent()[0]}))}}return e(t.get(n))};if(this.selector){var l=void 0;if("string"===this.selector.type)l=function(t,n){var r=o(n.textNodes(),t),a=e();return r.forEach(function(t){a=a.add(e(t).wrapAll("<tw-pseudo-hook>").parent())}),a}(this.selector.data,r);else{if("base"===this.selector.type)return s.add(u(c.call(this.selector.data,n),this.property));var p=function(e){var n='tw-hook[name="'+(e=t.insensitiveName(e).replace(/"/g,"&quot;"))+'"],tw-enchantment[name="'+e+'"]';return n+={page:", tw-story",passage:", tw-passage",sidebar:", tw-sidebar",link:", tw-link, .enchantment-link"}[e]||""}(this.selector.data);l=r.findAndFilter(p).add(r.parentsUntil(t.storyElement.parent())).filter(p)}s=this.property?s.add(u(l,this.property)):s.add(l)}return s}function u(e){if(!e)return[];var n=e.selector,r=e.property,a=e.next;return[JSON.stringify(["base"===n.type?u(n.data):t.insensitiveName(n.data),r])].concat(_toConsumableArray(u(a))).sort()}var l=Object.freeze({forEach:function(t,n){var r=c.call(this,t).each(function(t){n(e(this),t)});return t.dom.findAndFilter("tw-pseudo-hook").contents().unwrap(),r},hooks:function(e){return c.call(this,e)},get TwineScript_ObjectName(){return this.property||this.next?"a complex hook name":"?"+this.selector.data+" (a hook name)"},TwineScript_TypeID:"hookName",TwineScript_TypeName:"a hook name (like ?this)",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){var e="",n=this.selector,r=n.type,a=n.data;return"name"===r?a.match(RegExp("^"+t.anyRealLetter+"+$"))?e+="?"+a:e+="(hooks-named:"+JSON.stringify(a)+")":"string"===r?e+=JSON.stringify(a):"base"===r&&(e+=a.TwineScript_ToSource()+"'s "+s(this.property,"property")),this.next&&(e+=" + "+this.next.TwineScript_ToSource()),e},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t},TwineScript_is:function(e){return u(this)+""==u(e)+""},TwineScript_GetProperty:function(e){return l.create({type:"base",data:this},e,void 0)},TwineScript_Properties:["chars","links","lines","visited"],TwineScript_Clone:function(){return l.create(this.selector,this.property,this.next)},create:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return Object.assign(Object.create(this||l),{selector:Object.freeze(e),property:t,next:n})},from:function(e){return l.isPrototypeOf(e)||"string"==typeof e||t.impossible("HookSet.from() was given a non-HookSet non-string."),l.isPrototypeOf(e)?e:l.create({type:"string",data:e})}});return l}),define("internaltypes/changedescriptor",["jquery","utils","renderer","datatypes/hookset"],function(e,t,n,r){var a=t.assertOnlyHas,i=t.impossible,o=t.transitionIn,s=n.exec,c=Object.assign,u=Object.keys,l=Object.create,p=Object.seal,f=function(e){return e.split(/\n/g).reduce(function(e,t,n,r){var a=r.length;return e.concat(document.createTextNode(t),n!==a-1&&document.createElement(t.length?"br":"tw-consecutive-br"))},[])},d=void 0,h={source:"",appendSource:null,enabled:!0,enablers:null,verbatim:!1,target:null,append:"",newTargets:null,transition:"",transitionTime:null,transitionDeferred:!1,transitionDelay:0,transitionSkip:0,transitionOrigin:null,loopVars:null,styles:null,attr:null,data:null,innerEnchantments:null,section:null,timestamp:0,summary:function(){var e=this;return["source","appendSource","enabled","verbatim","target","append","newTargets","transition","transitionTime","transitionDeferred","transitionDelay","transitionSkip","transitionOrigin","innerEnchantments","enablers"].filter(function(t){return e.hasOwnProperty(t)}).concat([this.attr.length&&"attr",this.styles.length&&"styles",u(this.loopVars).length&&"loopVars",u(this.data).length&&"data"].filter(Boolean))},create:function(e,t){var n=c(l(this),{attr:[].concat(this.attr||[]),styles:[].concat(this.styles||[]),loopVars:this.loopVars||{},data:this.data||{}},e);return t&&t.run(n),n},update:function(){var e=this,t=this.section,n=this.newTargets,a=this.transition,i=this.transitionDeferred,s=this.append,c=this.target;"function"==typeof c&&(c=c());var l=function(t){if(Array.isArray(e.styles)&&e.styles.length>0){var n=e.styles.reduce(function(e,t){return u(t).forEach(function(n){var r=t[n];e[+("function"==typeof r)].push(_defineProperty({},n,r))}),e},[[],[]]),r=_slicedToArray(n,2),a=r[0],i=r[1];a.forEach(function(e){return t.css(e)}),setTimeout(function(){i.forEach(function(e){return t.css(e)})})}e.attr&&e.attr.forEach(function(e){return t.attr(e)}),e.data&&t.data(e.data)};if(Array.isArray(n)&&n.length&&(c=n.map(function(e){return e.target})),[].concat(c).forEach(function(e){r.isPrototypeOf(e)?e.forEach(t,l):l(e)}),a&&!i&&!s){var p=c,f=void 0;do{!(f=p.data("timestamp"))&&(p=p.parent())}while(!f&&p.length);o(c,a,this.transitionTime,this.transitionDelay,this.transitionSkip,f?Date.now()-f:0,this.transitionOrigin)}},render:function(){var t=this,n=this.source,u=this.transition,l=this.transitionTime,p=this.transitionDeferred,y=this.enabled,m=this.enablers,g=this.data,v=this.section,b=this.newTargets,w=this.innerEnchantments,T=this.appendSource,S=this.target,x=this.target,k=this.append;if("function"==typeof S&&(S=S()),a(this,d),!k)return i("ChangeDescriptor.render","This doesn't have an 'append' method chosen."),e();if(m&&m.length){var O=m[0],j=O.descriptor,A=O.changer,C=j.render();if(A){var E=h.create({section:v,target:C});A.run(E),E.update()}return C}if(!y||void 0!==S.attr("hidden"))return h.create({target:S,attr:this.attr.filter(function(e){return!("style"in e)}),data:c({},g,{originalSource:n,hidden:!0})}).update(),e();if(Array.isArray(b)&&b.length&&(S=b),!S)return i("ChangeDescriptor.render","ChangeDescriptor has source but not a target!"),e();var _=e();if([].concat(S).filter(function(e){return!e.jquery}).map(function(e){var t=k,n=void 0;if(e.target&&e.append){var r=e;t=r.append,n=r.before,e=e.target}return{elements:e.hooks(v,x).filter(function(){return!(n&&1&this.compareDocumentPosition(document)&&2&this.compareDocumentPosition(x[0]))}),append:t}},[]).forEach(function(n){var r=n.elements,a=n.append;r.each(function(n,r){r=e(r),_=_.add(t.create({target:r,append:a,newTargets:null}).render()),r.filter("tw-pseudo-hook").contents().unwrap()})}),_.length||Array.isArray(S)||r.isPrototypeOf(S))return _;if(!(k in S)){if("replace"!==k)return i("ChangeDescriptor.render","The target doesn't have a '"+k+"' method."),e();S[0]instanceof Text?k="replaceWith":(S.empty(),k="append")}return S[0]instanceof Text&&("append"===k&&(k="after"),"prepend"===k&&(k="before")),_=e(n&&(this.verbatim?f(n):e.parseHTML(s(n),document,!0))),Array.isArray(T)&&T.forEach(function(n){var r=n.source,a=n.append,i=e(t.verbatim?f(r):e.parseHTML(s(r),document,!0));_="append"===a?_.add(i):"prepend"===a?i.add(_):i}),S[k](_.length?_:void 0),S.data("timestamp",Date.now()),this.update(),u&&!p&&o("replace"===k?S:_,u,l,this.transitionDelay,this.transitionSkip,this.expedite,this.transitionOrigin),w&&w.map(function(e){return e(S)}).forEach(function(e){return v.addEnchantment(e)}),_}};return d=u(h),p(h)}),define("datatypes/changercommand",["utils","utils/operationutils","internaltypes/changedescriptor","internaltypes/twineerror"],function(e,t,n,r){var a=e.impossible,i=t.is,o=t.toSource,s={},c={TwineScript_TypeID:"changer",TwineScript_TypeName:"a changer",TwineScript_Print:function(){return"`[A ("+this.macroName+":) changer]`"},TwineScript_ToSource:function(){return"("+this.macroName+":"+("else"===this.name?"":this.params.map(o))+")"+(this.next?"+"+this.next.TwineScript_ToSource():"")},summary:function(){var e=n.create();return this.run(e),e.summary()},create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Array.isArray(t)||a("ChangerCommand.create","params was not an array but "+t),Object.assign(Object.create(this),{macroName:e,params:t,next:n,TwineScript_ObjectName:"a ("+e+":) changer"})},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t},TwineScript_is:function(e){if(c.isPrototypeOf(e))return this.macroName===e.macroName&&i(this.params,e.params)&&i(this.next,e.next)},TwineScript_Clone:function(){for(var e=this.create(this.macroName,this.params,this.next),t=e;t.next;)t=t.next=t.next.TwineScript_Clone();return e},run:function(e){var t=s[this.macroName].apply(s,[e].concat(_toConsumableArray(this.params)));if(r.containsError(t))return t;this.next&&this.next.run(e)},register:function(e,t){s[e]=t}};return Object.freeze(c)}),define("state",["utils","passages","datatypes/changercommand","internaltypes/twineerror","utils/operationutils","markup","twinescript/compiler"],function(e,t,n,r,a,i,o){var s=e.impossible,c=a.objectName,u=a.toSource,l=i.lex,p=Object.assign,f=Object.create,d=Object.defineProperty;d(Map.prototype,"toJSON",{value:void 0}),d(Set.prototype,"toJSON",{value:void 0});var h=["localStorage","sessionStorage"].map(function(e){try{return!!window[e]&&(window[e].setItem("test","1"),window[e].removeItem("test"),!0)}catch(e){return!1}}),y=p(f(null),{TwineScript_ObjectName:"this story's variables",TwineScript_TypeDefs:f(null),TwineScript_VariableStore:!0,TwineScript_MockVisits:null}),m={passage:"",variables:y,create:function(e,t){var n=f(m);return n.passage=e||"",n.variables=p(f(this.variables),t),n}},g=[],v=-1,b=m.create(),w=void 0,T={forward:[],back:[],load:[]},S=void 0;function x(e){b=(g[v]||m).create(e),function(){if(S.hasSessionStorage){var e=S.serialise();if("string"==typeof e)try{sessionStorage.setItem("Saved Session",e)}catch(e){return}}}()}return S=p({get passage(){return b.passage},get variables(){return b.variables},get pastLength(){return v},get futureLength(){return g.length-1-v},get mockVisits(){return b.variables.TwineScript_MockVisits||[]},set mockVisits(e){b.variables.TwineScript_MockVisits=e},passageNameVisited:function(e){var n=0;if(!t.get(e))return 0;for(var r=0;r<=v;r++)n+=+(e===g[r].passage);return n},passageNameLastVisited:function(e){if(!t.get(e))return 1/0;if(e===b.passage)return 0;for(var n=v;n>0;n--)if(g[n].passage===e)return v-n+1;return 1/0},pastPassageNames:function(){for(var e=[],t=v-1;t>=0;t--)e.unshift(g[t].passage);return e},timelinePassageNames:function(){return g.map(function(e){return e.passage})},play:function(e){b||s("State.play","present is undefined!"),b.passage=e,g=g.slice(0,v+1).concat(b),v+=1,x(e),T.forward.forEach(function(t){return t(e)})},rewind:function(e){var t=1,n=!1;if(e)if("string"==typeof e){if((t=this.passageNameLastVisited(e))===1/0)return}else"number"==typeof e&&(t=e);for(;t>0&&v>0;t--)n=!0,v-=1;return n&&(x(g[v].passage),T.back.forEach(function(e){return e()})),n},fastForward:function(e){var t=1,n=!1;for("number"==typeof e&&(t=e);t>0&&g.length>0;t--)n=!0,v+=1;return n&&(x(g[v].passage),T.forward.forEach(function(e){return e(g[v].passage,"fastForward")})),n},on:function(e,t){if(e in T)return"function"!=typeof t||T[e].includes(t)||T[e].push(t),S;s("State.on","invalid event name")},reset:function(){g=[],v=-1,b=m.create(),w=void 0,T.load.forEach(function(e){return e(g)})},hasStorage:h[0],hasSessionStorage:h[1]},function(){function e(e,t){Object.keys(t).forEach(function(n){return!n.startsWith("TwineScript_")&&(t[n]=e.eval(o(l(t[n],0,"macro"))))})}return{serialise:function(){var e=g.slice(0,v+1),t=e.map(function(e){return Object.keys(e.variables).filter(function(t){return e.variables[t]&&(n=e.variables[t],a=void 0===n?"undefined":_typeof(n),!(!r.containsError(n)&&("function"==typeof n.TwineScript_ToSource||Array.isArray(n)||n instanceof Map||n instanceof Set||"string"===a||"number"===a||"boolean"===a||Object.isPrototypeOf.call(y.TwineScript_TypeDefs,n))));var n,a}).map(function(t){return[t,e.variables[t]]})});if(w||(w=t.reduce(function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1];return e||a&&[a,i,n+1]},void 0)),w){var n=_slicedToArray(w,3),a=n[0],i=n[1],o=n[2];return r.create("saving","The variable $"+a+" holds "+c(i)+" (which is, or contains, a complex data value) on turn "+o+"; the game can no longer be saved.")}try{return JSON.stringify(e,function(e,t){return this.TwineScript_VariableStore?"TwineScript_TypeDefs"===e?Object.keys(t).reduce(function(e,n){return e[n]=u(t[n]),e},{}):"TwineScript_MockVisits"===e?t:u(t):t})}catch(e){return!1}},deserialise:function(n,r){var a,i=void 0,o=y,s="The save data is unintelligible.";try{i=JSON.parse(r)}catch(e){return Error(s)}return Array.isArray(i)?(a=(i=i.map(function(r){if("object"!==(void 0===r?"undefined":_typeof(r))||!r.hasOwnProperty("passage")||!r.hasOwnProperty("variables"))return Error(s);if(!t.hasValid(r.passage))return Error("The data refers to a passage named '"+r.passage+"', but it isn't in this story.");if(r.variables=p(f(o),r.variables),Object.hasOwnProperty.call(r.variables,"TwineScript_TypeDefs")){var a=r.variables.TwineScript_TypeDefs=p(f(o.TwineScript_TypeDefs),r.variables.TwineScript_TypeDefs);try{e(n,a)}catch(e){return Error(s)}}try{e(n,r.variables)}catch(e){return Error(s)}return o=r.variables,p(f(m),r)})).find(function(e){return e instanceof Error}))?a:(g=i,T.load.forEach(function(e){return e(g)}),v=g.length-1,x(g[v].passage),!0):Error(s)}}}()),Object.seal(m),Object.freeze(S)}),define("internaltypes/varref",["state","internaltypes/twineerror","utils","utils/operationutils","datatypes/hookset"],function(e,t,n,r,a){var i=n.impossible,o=n.andList,s=n.nth,c=r.is,u=r.isObject,l=r.toSource,p=r.isSequential,f=r.objectName,d=r.typeName,h=r.clone,y=r.isValidDatamapName,m=r.subset,g=r.collectionType,v=r.unstorableValue,b=r.matches,w=void 0,T=0,S={set:[],delete:[]},x="You can only access position strings/numbers ('4th', 'last', '2ndlast', (2), etc.) or slices ('1stTo2ndlast', '3rdTo5th'), ",k="You can't access the '0th' or '0thlast' position of ";function O(e,n){var r=void 0;if(t.containsError(n))return r;if(e instanceof Map&&(r=t.containsError(y(e,n))))return r;if(p(e)){var i=void 0;if("number"==typeof n){if(0===n)return t.create("property","You can't access elements at position 0 of "+f(e)+".","Only positive and negative position values exist.");n>0&&(n-=1)}else if("string"==typeof n&&(i=/^(\d+)(?:st|[nr]d|th)last$/i.exec(n))){if("0"===i[1])return t.create("property",k+f(e)+".");n=-i[1]}else if("string"==typeof n&&(i=/^(\d+)(?:st|[nr]d|th)$/i.exec(n))){if("0"===i[1])return t.create("property",k+f(e)+".");n=i[1]-1}else if("string"==typeof n&&(i=/^(?:(\d+)(?:st|[nr]d|th)(last)?|last)to(?:(\d+)(?:st|[nr]d|th)(last)?|last)$/i.exec(n))){var s=_slicedToArray(i,5),c=s[1],u=void 0===c?0:c,l=s[2],d=s[3],h=void 0===d?0:d;n={last:h=s[4]?-h:h-1,first:u=l?-u:u-1}}else if("last"===n)n=-1;else if("random"===n){if(!e.length)return t.create("property","I can't get a random value from "+f(e)+", because it's empty");n=Math.random()*Array.from(e).length|0}else{if(a.isPrototypeOf(e)&&!a.TwineScript_Properties.includes(n))return t.create("property",x+o(a.TwineScript_Properties.map(function(e){return"'"+e+"'"}))+" of "+f(e)+", not "+f(n)+".");if(!["length","any","all","start","end","random"].includes(n)&&!a.isPrototypeOf(e))return t.create("property",x+"'length', 'any', 'all', 'start', 'end', and 'random' of "+f(e)+", not "+f(n)+".")}}else if(e instanceof Set){if(!["length","any","all"].includes(n))return t.create("property","You can only get the 'length', 'any' and 'all' of "+f(e)+".","To check contained values, use the 'contains' operator.");"length"===n&&(n="size")}else{if(Array.isArray(e.TwineScript_Properties)&&!e.TwineScript_Properties.includes(n))return t.create("property","You can only get the "+o(e.TwineScript_Properties.map(function(e){return"'"+e+"'"}))+" of "+f(e)+", not "+f(n)+".");if("number"==typeof e||"boolean"==typeof e)return t.create("property","You can't get data values from "+f(e)+".")}return n}function j(e,t){return t-0<0&&Math.abs(t)<=e.length?e.length+(t-0):t}var A=/[^\x0000-\xFFFF]/,C=new Map;function E(e,t){if(void 0===e)return e;if(e instanceof Map||w.isPrototypeOf(e))return e.get(t);if(("any"===t||"all"===t||"start"===t||"end"===t)&&!e.TwineScript_VariableStoreName)return function(e,t){var n="'"+t+"' value"+("any"===t?"":"s")+" of ";return{determiner:t,array:[].concat(_toConsumableArray(e)),string:"string"==typeof e&&e,TwineScript_ObjectName:n+f(e),TwineScript_TypeName:n+"a data structure",TwineScript_Unstorable:!0,TwineScript_Print:function(){return"`["+this.TwineScript_TypeName+"]`"}}}(e,t);if("string"==typeof e)if(C.has(e))e=C.get(e);else if(A.test(e)){var n=[].concat(_toConsumableArray(e));C.set(e,n),e=n}else C.set(e,e);if(p(e)&&Number.isFinite(t)&&(t=j(e,t)),e.TwineScript_GetProperty)return e.TwineScript_GetProperty(t);var r=e[t];return"function"!=typeof r?r:void 0}function _(e){if(e.computed){var t=e.value;return w.isPrototypeOf(t)&&(t=t.get()),"string"==typeof t?"('"+t+"')":"("+t+")"}return"number"==typeof e?s(e):"'"+e+"'"}function N(n,r,i){if(n.TwineScript_VariableStore){if(n.TwineScript_TypeDefs&&r in n.TwineScript_TypeDefs){var o=n.TwineScript_TypeDefs[r];if("const"===o.name){if(void 0!==n[r])return t.create("operation","I can't alter "+(n===e.variables?"$":"_")+r+" because it's been restricted to a constant value.","This variable can't be changed for the rest of the story.")}else if(!b(o,i))return t.create("operation","I can't set "+(n===e.variables?"$":"_")+r+" to "+d(i)+" because it's been restricted to "+l(o)+"-type data.","You can restrict a variable or data name by giving a typed variable to (set:) or (put:).")}return!0}return Array.isArray(r)?r.map(function(e){return N(n,e)}):n instanceof Map?"string"==typeof r||t.create("operation",f(n)+" can only have string data names, not "+f(r)+"."):p(n)?["length","random","any","all","start","end"].includes(r)?t.create("operation","I can't forcibly alter the '"+r+"' of "+f(n)+".","start"===r||"end"===r?"Alter the values at actual positions, like 1st or 2ndlast, rather than just the '"+r+"'.":void 0):+r==(0|r)||t.create("property",f(n)+" can only have position keys ('3rd', '1st', (5), etc.), not "+_(r)+"."):n.TwineScript_Identifiers&&r in n?t.create("keyword","I can't alter the value of the '"+r+"' identifier.","You can only alter data in variables and hooks, not fixed identifiers."):t.create("operation","I can't modify "+f(n),n instanceof Set?"You should use an (array:) if you need to modify the data inside this dataset.":a.isPrototypeOf(n)?"You should alter hooks indirectly using macros like (replace:) or (enchant:).":void 0)}function P(e,t,n){var r=t;e instanceof Map?e.set(t,n):(p(e)&&(t=j(e,t)),e.TwineScript_Set?e.TwineScript_Set(t):e[t]=n),S.set.forEach(function(t){return t(e,r,n)})}function I(e,t){var n=t;p(e)&&(t=j(e,t)),Array.isArray(e)&&/^(?:[1-9]\d*|0)$/.exec(t)?e.splice(t,1):e instanceof Map||e instanceof Set?e.delete(t):delete e[t],S.delete.forEach(function(t){return t(e,n)})}function M(e){return Object.assign(Object.create(w),{error:e})}function D(n,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r;if(r&&"object"===(void 0===r?"undefined":_typeof(r))&&"last"in r&&"first"in r){if(a.isPrototypeOf(n))return n.TwineScript_GetProperty(r);var s=r.first,c=r.last;return m(n,s+(s>=0),c+(c>=0))}if(Array.isArray(r))return a.isPrototypeOf(n)?n.TwineScript_GetProperty(r):r.map(function(e){return D(n,e,e)})["string"==typeof n?"join":"valueOf"]("");var u=E(n,r);if(void 0===u){if(n===e.variables)return T;if(n.TwineScript_VariableStore)return t.create("property","There isn't a temp variable named _"+i+" in this place.","Temp variables only exist inside the same passage and hook in which they're (set:).");if(Array.isArray(n)&&"number"==typeof r)return t.create("property","This array of "+n.length+" elements doesn't have a "+_(i)+" element.",n.length?"It contains: "+o(n.map(f))+".":"The array is empty.");var l=Array.from("function"==typeof n.keys&&n.keys());return t.create("property","I can't find a "+_(i)+" data name in "+f(n),n instanceof Map&&l.length?"Its names include: "+o(l)+".":void 0)}return u}function R(e,n){var r=this,a=this.compiledPropertyChain.reduce(function(e,t){var n=void 0;return n=0===e.length?r.object:D.apply(void 0,_toConsumableArray(e[e.length-1])),e.push([n,t])&&e},[]).reduceRight(e,n);return t.containsError(a)?a:void 0}return w=Object.freeze({get:function(){if(this.error)return this.error;for(var e=this.object,t=0;t<this.compiledPropertyChain.length-1;t+=1)e=D(e,this.compiledPropertyChain[t]);return D(e,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0])},set:function(n){var r=this;return this.error?this.error:!this.object||this.object.TwineScript_VariableStore||this.object.TwineScript_Identifiers?R.call(this,function(n,a,i){var o,s=_slicedToArray(a,2),c=s[0],l=s[1];if(o=t.containsError(n,c,l)||t.containsError(N(c,l,n)))return o;var d;if(d=v(n))return t.create("operation",f(n)+" can't be stored"+(g(n)?" because it holds "+f(d)+".":""));if(i>0)c=h(c);else if(c.TwineScript_VariableStore&&c!==e.variables){for(var y=c;y.TwineScript_VariableStore&&!y.hasOwnProperty(l);)y=Object.getPrototypeOf(y);y.TwineScript_VariableStore&&(c=y)}if("string"==typeof c){if("string"!=typeof n)return t.create("datatype","I can't put this non-string value, "+f(n)+", in a string.");if(n.length!==(Array.isArray(l)?l.length:1))return t.create("datatype",f(n)+"is not the right length to fit into this string location.");c=[].concat(_toConsumableArray(c));var m=[].concat(_toConsumableArray(n));[].concat(l).forEach(function(e){0+e<0&&(e=c.length+(0+e)),c=[].concat(_toConsumableArray(c.slice(0,e)),[m.shift()],_toConsumableArray(c.slice(e+1)))}),c=c.join("")}else u(c)&&(void 0!==n.TwineScript_KnownName&&(n.TwineScript_KnownName=r.TwineScript_ObjectName),Array.isArray(l)&&p(n)?("string"==typeof n&&(n=[].concat(_toConsumableArray(n))),l.map(function(e,t){return[e,n[t]]}).forEach(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return P(c,n,r)})):P(c,l,n));return c},n):t.create("macrocall","I can't (set:) "+f(this)+", if the "+(f(this.object).match(/ (.+$)/)||["","value"])[1]+" isn't stored in a variable.","Modifying data structures that aren't in variables won't change the game state at all.")},delete:function(){return this.error?this.error:R.call(this,function(e,n,r){var a,i=_slicedToArray(n,2),o=i[0],s=i[1];if(a=t.containsError(e,o,s)||t.containsError(N(o,s)))return a;if(r>0&&(o=h(o)),null===e){var c="string"==typeof o;c&&(o=[].concat(_toConsumableArray(o))),Array.isArray(s)?(p(o)&&(s=[].concat(_toConsumableArray(new Set(s)))).sort(function(e,t){return j(o,t)-j(o,e)}),s.forEach(function(e){return I(o,e)})):I(o,s),c&&(o=o.join(""))}else P(o,s,e);return o},null)},defineType:function(e){var n=this.object,r=this.compiledPropertyChain;if(!n||!n.TwineScript_VariableStore||1!==r.length||!n.TwineScript_TypeDefs)return t.create("unimplemented","I can only restrict the datatypes of variables, not data names or anything else.");var a=r[0];Object.hasOwnProperty.call(n,"TwineScript_TypeDefs")||(n.TwineScript_TypeDefs=Object.create(n.TwineScript_TypeDefs));var i=n.TwineScript_TypeDefs,o=i[a];if(o&&!c(o,e))return t.create("operation","I can't redefine the type of "+f(this)+" to "+(e.TwineScript_ObjectName||d(e))+", as it is already "+(o.TwineScript_ObjectName||d(o))+".");i[a]=e,"const"===e.name&&(n[a]=void 0)},matches:function(e,t){return this.object===e&&this.compiledPropertyChain[0]===t},getName:function(){return this.compiledPropertyChain[0]},create:function(e,n){var r=void 0;if(r=t.containsError(e))return M(r);if(n=[].concat(n),w.isPrototypeOf(e)){if(u(e.error))return e;n=e.propertyChain.concat(n),e=e.object}var a=function(e,n){return n.reduce(function(r,a,i){var o;return a.computed&&(a=a.value),w.isPrototypeOf(a)&&(a=a.get()),a=Array.isArray(a)?a.map(function(t){return O(e,t)}):O(e,a),(o=t.containsError(r,a))?o:(i<n.length-1&&(e=D(e,a)),r.push(a),r)},[])}(e,n);return(r=t.containsError(a))?M(r):Object.assign(Object.create(w),{object:e,propertyChain:n,compiledPropertyChain:a})},TwineScript_ToSource:function(){var t=this,n=function(e,n){return!n&&t.object.TwineScript_VariableStore?e:_(e)};return(this.object===e.variables?"$":this.object.TwineScript_VariableStore?"_":f(this.object)+"'s ")+(1===this.propertyChain.length?n(this.propertyChain[0]):this.propertyChain.reduce(function(e,t,r){return e+"'s "+n(t,r)}))},get TwineScript_ObjectName(){return this.TwineScript_ToSource()+(this.object.TwineScript_VariableStoreName?" in "+this.object.TwineScript_VariableStoreName:"")},on:function(e,t){if(e in S)return"function"!=typeof t||S[e].includes(t)||S[e].push(t),w;i("VarRef.on","invalid event name")}})}),define("internaltypes/varscope",[],function(){return Object.seal({TwineScript_ObjectName:"the temporary variables",TwineScript_VariableStore:!0,TwineScript_TypeDefs:Object.create(null)})}),define("internaltypes/twinenotifier",["jquery","utils"],function(e,t){var n=t.impossible,r={create:function(e){return e||n("TwineNotifier.create","called with only 1 string."),Object.assign(Object.create(r),{message:e})},render:function(){return e("<tw-notifier>").attr("message",this.message)}};return r}),define("datatypes/custommacro",["jquery","utils/operationutils","internaltypes/changedescriptor","internaltypes/varref","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(e,t,n,r,a,i,o){var s=t.objectName,c=t.typeName,u=t.matches,l=Object.assign,p=Object.create,f=function(t){return function(c){for(var u=arguments.length,f=Array(u>1?u-1:0),d=1;d<u;d++)f[d-1]=arguments[d];t.called+=1;var h=t.varNames,y=t.params,m=t.body,g=l(p(a),{TwineScript_VariableStoreName:t.TwineScript_ObjectName+" call #"+t.called,TwineScript_TypeDefs:p(null)}),v=[],b=0;f.forEach(function(e,t){var n=h[b];g.TwineScript_TypeDefs[n]=y[b].datatype.rest?y[b].datatype.create("array"):y[b].datatype;var a=r.create(g,n);if(y[b].datatype.rest){var i=(g[n]||[]).concat([e]);if(t<f.length-1)return void(g[n]=i);a.set(i)}else a.set(e),b+=1;v.push(o.create(s(a)+" is now "+s(g[n])))}),f.length&&(b+=1),y[b]&&y[b].datatype.rest&&(r.create(g,h[b]).set([]),g.TwineScript_TypeDefs[name]=y[b].datatype.create("array"));var w=void 0,T=e("<p>").append(m.html),S=c.stack.length;for(c.stack.unshift({tempVariables:g,dom:T,output:function(e){w=e}}),c.execute();c.stack.length>S;)c.stack.shift();var x,k,O=T.find("tw-error");return O.length?(T.prepend(v.map(function(e){return e.render()}),"<br>"),i.create("propagated",O.length+" error"+(O.length>1?"s":"")+" occurred when running "+t.TwineScript_ObjectName+".",void 0,T)):void 0===w?i.create("custommacro",t.TwineScript_ObjectName+" didn't output any data or hooks using (output:) or (output-data:)."):n.isPrototypeOf(w)?(x=w,k=l({TwineScript_TypeID:"command",TwineScript_ObjectName:"a custom command",TwineScript_TypeName:"a custom command",TwineScript_Print:function(){return"`[a custom command]`"},TwineScript_Attach:function(e){return e.run(x),k},TwineScript_Run:function(){return x}})):w}},d=Object.freeze({TwineScript_TypeID:"macro",TwineScript_TypeName:"a custom macro",get TwineScript_ObjectName(){return this.TwineScript_KnownName?"the "+this.TwineScript_KnownName+" macro":"a custom macro"},TwineScript_GetProperty:function(e){if("params"===e)return[].concat(_toConsumableArray(this.params))},TwineScript_Properties:["params"],TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},TwineScript_Clone:function(){return l(p(d),this)},TwineScript_ToSource:function(){return"(macro:"+this.params.map(function(e){return e.TwineScript_ToSource()}).concat("")+this.body.TwineScript_ToSource()+")"},create:function(e,t){var n=l(p(this),{params:e,called:0,varNames:e.map(function(e){return e.varRef.propertyChain[0]}),typeSignature:e.map(function(e){var t=void 0;return t=e.datatype.toTypeSignatureObject?e.datatype.toTypeSignatureObject({rest:e.rest}):{pattern:"range",range:function(t){return u(e.datatype,t)},name:c(e.datatype)},e.rest?{pattern:"zero or more",innerType:t}:t}),body:t,TwineScript_KnownName:""});return n.fn=f(n),n}});return d}),define("datatypes/lambda",["utils/operationutils","internaltypes/varscope","internaltypes/varref","internaltypes/twineerror"],function(e,t,n,r){var a=e.objectName,i=Object.freeze({TwineScript_TypeID:"lambda",TwineScript_TypeName:"a lambda",get TwineScript_ObjectName(){return'a "'+("making"in this?"making ... ":"")+("where"in this?"where ... ":"")+("when"in this?"when ... ":"")+("via"in this?"via ... ":"")+'" lambda'},TwineScript_Print:function(){return"`[A lambda]`"},TwineScript_is:function(e){return e===this},TwineScript_ToSource:function(){return this.source},TypeSignature:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"lambda",innerType:i,clauses:t,typeName:'a "'+t.concat("").join(" ...")+'" lambda'}},TwineScript_Clone:function(){return Object.assign(Object.create(i),this)},create:function(e,o,s,c){var u=void 0;function l(e){var r=e&&e.varRef?e.varRef:e;return void 0===r||r&&n.isPrototypeOf(r)&&t.isPrototypeOf(r.object)&&1===r.propertyChain.length}if("making"===o&&!l(s))return r.create("syntax","I need a temp variable, or typed temp variable, to the right of '"+o+"', not "+a(s)+".");if(r.containsError(e))return e;if(i.isPrototypeOf(e)){if("when"===o||"when"in e)return r.create("syntax","A 'when' lambda cannot have any other clauses, such as '"+o+"'.");if(o in e&&("where"!==o||"true"!==e[o]))return r.create("syntax","This lambda has two '"+o+"' clauses.");u=e}else{if("when"===o&&void 0!==e)return r.create("syntax","A 'when' lambda shouldn't begin with a temp variable (just use 'when' followed by the condition).");if(!l(e))return r.create("syntax","This lambda needs to start with a single temp variable, or typed temp variable, not "+a(e)+".");(u=Object.create(this)).loop=e||""}return u.source=c.trim(),u[o]=s,u.making&&u.making.getName()===(u.loop&&u.loop.getName())?r.create("syntax","This lambda has two variables named '"+u.loop.getName()+"'.","Lambdas should have all-unique parameter names."):u},apply:function(e,n){var a=n.loop,i=n.pos,o=n.making,s=n.ignoreVia,c=n.tempVariables;function u(e,t){if(e)if("datatype"in e&&"varRef"in e){var n=e.varRef.create(c,e.varRef.propertyChain);n.defineType(e.datatype);var a=n.set(t);if(r.containsError(a))return a}else c[e.getName()]=t}c=c||Object.create(e.stack.length?e.stackTop.tempVariables:t);var l=u(this.loop,a)||u(this.making,o);if(r.containsError(l))return l;e.stack.unshift(Object.assign(Object.create(e.stackTop||null),{tempVariables:c,lambdaPos:this.when?void 0:i}));var p=e.eval("Operations");!a||this.making||this.when?p.initialiseIt(r.create("operation","I can't use 'it', or an implied 'it', in "+this.TwineScript_ObjectName)):p.initialiseIt(a);var f=!s&&this.via,d=e.eval("where"in this||"when"in this?"Operations.where("+(this.where||this.when)+","+(f||"true")+",null)":f||"true");return e.stack.shift(),d},filter:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=void 0,o=t.reduce(function(t,o,s){if(i=r.containsError(t))return i;var c=n.apply(e,{loop:o,pos:s+1,ignoreVia:!0,tempVariables:a});return(i=r.containsError(c))?i:t.concat(c?[o]:[])},[]);return(i=r.containsError(o))?i:o}});return i}),define("datatypes/codehook",["internaltypes/twineerror","renderer"],function(e,t){var n=t.exec;return Object.freeze({TwineScript_TypeName:"a code hook",TwineScript_ObjectName:"a code hook",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return"["+this.source+"]"},create:function(t,r){r||(r=n(t));var a=e.containsError(r);return a||Object.assign(Object.create(this),{source:t,html:r})}})}),define("datatypes/colour",["jquery","utils"],function(e,t){var n=t.matMul,r=Math.max,a=Math.min,i=Math.sin,o=Math.cos,s=Math.pow,c=Math.round,u=Math.floor,l=Math.atan2,p=Math.cbrt,f=Math.sqrt,d=Math.PI,h=Object.assign,y=Object.create,m=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,g=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,v=y(null);function b(e){var t=e.r,n=e.g,i=e.b,o=e.a,s=r(t/=255,n/=255,i/=255),u=a(t,n,i),l=(s+u)/2,p=s-u;if(s===u)return{h:0,s:0,l:l};var f=void 0;switch(s){case t:f=(n-i)/p+(n<i?6:0);break;case n:f=(i-t)/p+2;break;case i:f=(t-n)/p+4}return{h:f=c(60*f),s:l>.5?p/(2-s-u):p/(s+u),l:l,a:o}}var w=[.96422,1,.82521],T=24389/27,S=216/24389,x=function(e){return e.map(function(e){return[e]})},k=function(e){return e.map(function(e){return e[0]})};function O(e){var t=e.l,r=e.c,a=e.h,c=e.a;t*=100;var u=[];u[1]=(t+16)/116,u[0]=r*o(a*d/180)/500+u[1],u[2]=u[1]-r*i(a*d/180)/200;var l=[s(u[0],3)>S?s(u[0],3):(116*u[0]-16)/T,t>T*S?s((t+16)/116,3):t/T,s(u[2],3)>S?s(u[2],3):(116*u[2]-16)/T].map(function(e,t){return e*w[t]}),p=k(n([[.9555766,-.0230393,.0631636],[-.0282895,1.0099416,.0210077],[.0122982,-.020483,1.3299098]],n([[3.2404542,-1.5371385,-.4985314],[-.969266,1.8760108,.041556],[.0556434,-.2040259,1.0572252]],x(l)))).map(function(e){return 255*e}),f=_slicedToArray(p,3);return{r:f[0],g:f[1],b:f[2],a:c}}function j(e){var t=O(e);return[t.r,t.g,t.b].every(function(e){return e>=0&&e<=255})}var A=Object.freeze({TwineScript_TypeID:"colour",TwineScript_TypeName:"a colour",TwineScript_ObjectName:"a colour",TwineScript_DebugName:function(){return"a colour "+this.TwineScript_Print()},"TwineScript_+":function(e){var t=this.toRGBA(),n=e.toRGBA();return A.create({r:Math.min(Math.round(.6*(t.r+n.r)),255),g:Math.min(Math.round(.6*(t.g+n.g)),255),b:Math.min(Math.round(.6*(t.b+n.b)),255),a:(t.a+n.a)/2})},TwineScript_Print:function(){var e=this.toRGBA();return"<tw-colour style='background-color:rgba("+[e.r,e.g,e.b,e.a]+");'></tw-colour>"},TwineScript_is:function(e){if(!A.isPrototypeOf(e))return!1;if(e.lcha&&this.lcha)return e.lcha.l===this.lcha.l&&e.lcha.c===this.lcha.c&&e.lcha.h===this.lcha.h&&e.a===this.a;var t=this.toRGBA();return(e=e.toRGBA()).r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a},TwineScript_Clone:function(){return A.create(this)},toRGBAString:function(){var e=this.toRGBA();return"rgba("+e.r+", "+e.g+", "+e.b+", "+e.a+")"},toHSLA:function(){return b(this.toRGBA())},toRGBA:function(){return this.lch?O(function(e){if(j(e))return e;var t=(e=h({},e)).c,n=0;for(e.c/=2;t-n>1e-5;)j(e)?n=e.c:t=e.c,e.c=(t+n)/2;return e}(h({},this.lch,{a:this.a}))):this},toLCHA:function(){return this.lch?h({},this.lch):(t=(e=this).r,r=e.g,a=e.b,i=e.a,o=k(n([[1.0478112,.0228866,-.050127],[.0295424,.9904844,-.0170491],[-.0092345,.0150436,.7521316]],n([[.4124564,.3575761,.1804375],[.2126729,.7151522,.072175],[.0193339,.119192,.9503041]],x([t/255,r/255,a/255])))).map(function(e,t){return e/w[t]}).map(function(e){return e>S?p(e):(T*e+16)/116}),c=[116*o[1]-16,500*(o[0]-o[1]),200*(o[1]-o[2])],u=180*l(c[2],c[1])/d,{l:c[0]/100,c:f(s(c[1],2)+s(c[2],2)),h:u>=0?u:u+360,a:i});var e,t,r,a,i,o,c,u},LCHRotate:function(e){e<0&&(e=360+e);var t=this.toLCHA();return t.h=(t.h+e)%360,t.a=this.a,A.create(t)},TwineScript_GetProperty:function(e){if("lch"===e){var t=this.toLCHA();return new Map([["l",t.l],["c",t.c],["h",t.h]])}var n=this.toRGBA();return"h"===e||"s"===e||"l"===e?b(n)[e]:"r"===e||"g"===e||"b"===e||"a"===e?n[e]:void 0},TwineScript_Properties:["h","s","l","r","g","b","a","lch"],TwineScript_ToSource:function(){var e=!this.lch&&b(this);if(e&&!e.h&&!e.s){if(1===e.l)return"white";if(0===e.l)return"black"}return"("+(this.lch?"lch":"hsl")+":"+(this.lch?[this.lch.l,this.lch.c,this.lch.h]:[e.h,e.s,e.l])+(1!==this.a?","+this.a:"")+")"},create:function(t){return"string"==typeof t?this.create((A.isHexString(t)?function(e){return"string"!=typeof e?e:(e=(e=e.replace("#","")).replace(m,"$1$1$2$2$3$3"),{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)})}:function(t){if(t in v)return v[t];var n=e("<p>").css("background-color",t).css("background-color");return n="transparent"===n?{r:0,g:0,b:0,a:0}:n.startsWith("rgb")?n.match(/\d+/g).reduce(function(e,t,n){return e["rgb"[n]]=+t,e},{}):{r:192,g:192,b:192},v[t]=n,n})(t)):!("h"in t&&"s"in t&&"l"in t)||"r"in t||"g"in t||"b"in t?("a"in t&&"number"==typeof t.a||(t.a=1),h(y(this),"h"in t&&"c"in t&&!("s"in t)&&"l"in t?{a:t.a,lch:{l:t.l,c:t.c,h:t.h}}:t)):this.create(function(e){var t=e.h,n=e.s,r=e.l,a=e.a;if(0===n){var i=u(255*r);return{r:i,g:i,b:i}}var o=r<.5?r*(1+n):r+n-r*n,s=2*r-o;function c(e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?s+6*(o-s)*e:e<.5?o:e<2/3?s+(o-s)*(2/3-e)*6:s}return{r:u(255*c((t/=360)+1/3)),g:u(255*c(t)),b:u(255*c(t-1/3)),a:a}}(t))},isHexString:function(e){return"string"==typeof e&&"#"===e[0]&&(e.slice(1).match(m)||e.slice(1).match(g))},isCSS3Function:function(e){return"string"==typeof e&&/^(?:rgb|hsl)a?\(\s*\d+\s*,\s*\d+%?\s*,\s*\d+%?(?:,\s*\d+(?:\.\d+)?\s*)?\)$/.test(e)}});return A}),define("datatypes/gradient",["utils/operationutils"],function(e){var t=e.toSource,n=Object.freeze({TwineScript_TypeID:"gradient",TwineScript_TypeName:"a gradient",TwineScript_ObjectName:"a gradient",TwineScript_DebugName:function(){return"a gradient "+this.TwineScript_Print()},TwineScript_GetProperty:function(e){var t=this;return"angle"===e?this.angle:"stops"===e?this.stops.map(function(e){return new Map([[t.repeating?"pixels":"percent",e.stop],["colour",e.colour.TwineScript_Clone()]])}):void 0},TwineScript_Properties:["angle","stops"],TwineScript_ToSource:function(){return"(gradient:"+this.angle+","+this.stops.map(function(e){return t(e.stop)+","+t(e.colour)})+")"},TwineScript_is:function(e){var t=this;return e.angle===this.angle&&e.stops.length===this.stops.length&&e.stops.every(function(e,n){var r=e.colour,a=e.stop;return t.stops[n].stop===a&&t.stops[n].colour.TwineScript_is(r)})},TwineScript_Clone:function(){return n.create(this.angle,[].concat(_toConsumableArray(this.stops)))},TwineScript_Print:function(){return"<tw-colour style='background:"+this.toLinearGradientString()+"'></tw-colour>"},create:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object.assign(Object.create(this),{angle:e,stops:t.sort(function(e,t){return e.stop-t.stop}),repeating:n})},multiply:function(e){return n.create(this.angle,this.stops.map(function(t){return{colour:t.colour,stop:t.stop*e}}))},toLinearGradientString:function(){var e=this;return(this.repeating?"repeating-":"")+"linear-gradient("+this.angle+"deg, "+this.stops.reduce(function(t,n){var r=n.colour,a=n.stop;return t+r.toRGBAString()+" "+a*(e.repeating?1:100)+(e.repeating?"px,":"%,")},"").slice(0,-1)+")"}});return n}),define("datatypes/datatype",["utils","utils/operationutils","datatypes/changercommand","datatypes/colour","datatypes/gradient","datatypes/lambda","datatypes/custommacro","internaltypes/twineerror"],function(e,t,n,r,a,i,o,s){var c=e.realWhitespace,u=e.anyRealLetter,l=e.anyCasedLetter,p=e.anyNewline,f=t.objectName,d=Object.assign,h=Object.seal,y=Object.keys,m=Math.floor,g=Math.abs,v=void 0,b=void 0,w={TwineScript_TypeID:"datatype",TwineScript_TypeName:"a datatype",TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},get TwineScript_ObjectName(){return"the "+(this.rest?"...":"")+this.name+" datatype"},TwineScript_is:function(e){return w.isPrototypeOf(e)&&e.name===this.name},TwineScript_Clone:function(){return this.rest?this:Object.create(this)},TwineScript_ToSource:function(){return(this.rest?"...":"")+this.name},TwineScript_IsTypeOf:function(e){var t=this.name,n=this.rest;return!!v[t]&&v[t](e,n)},toTypeSignatureObject:function(){var e=this.name,t={pattern:"range",range:v[e],name:"a "+("dm"===e?"datamap":"ds"===e?"dataset":"num"===e?e+"ber":"str"===e?e+"ing":"color"===e?"colour":"bool"===e?e+"ean":"alnum"===e?"alphanumeric character":"int"===e?e+"eger":"even"===e||"odd"===e?e+" number":e.endsWith("case")||"whitespace"===e?e+" character":"empty"===e?e+" value":e)};return this.rest?{pattern:"zero or more",innerType:t}:t},create:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e="datamap"===e?"dm":"dataset"===e?"ds":"number"===e?"num":"string"===e?"str":"color"===e?"colour":"boolean"===e?"bool":"alphanumeric"===e?"alnum":"integer"===e?"int":"newline"===e?"linebreak":e;var n=Object.create(this);return n.name=e,n.rest=t,n},from:function(e){var t=y(b).find(function(t){return b[t](e)});return t?w.create(t):s.create("datatype",f(e)+" doesn't correspond to a datatype value.")}};return b={array:Array.isArray,dm:function(e){return e instanceof Map},ds:function(e){return e instanceof Set},datatype:function(e){return w.isPrototypeOf(e)},changer:function(e){return n.isPrototypeOf(e)},colour:function(e){return r.isPrototypeOf(e)},gradient:function(e){return a.isPrototypeOf(e)},lambda:function(e){return i.isPrototypeOf(e)},macro:function(e){return o.isPrototypeOf(e)},str:function(e){return"string"==typeof e},num:function(e){return"number"==typeof e},bool:function(e){return"boolean"==typeof e}},v=d({},b,{even:function(e){return!isNaN(e)&&m(g(e))%2==0},odd:function(e){return!isNaN(e)&&m(g(e))%2==1},empty:function(e){return e instanceof Map||e instanceof Set?!e.size:!(!Array.isArray(e)&&"string"!=typeof e)&&!e.length},int:function(e){return"number"==typeof e&&e===(0|e)},uppercase:function(e){return"string"==typeof e&&1===[].concat(_toConsumableArray(e)).length&&[].concat(_toConsumableArray(e)).every(function(e){return e!==e.toLowerCase()})},lowercase:function(e){return"string"==typeof e&&1===[].concat(_toConsumableArray(e)).length&&[].concat(_toConsumableArray(e)).every(function(e){return e!==e.toUpperCase()})},whitespace:function(e){return"string"==typeof e&&!!e.match("^"+c+"$")},digit:function(e){return"string"==typeof e&&!!e.match("^\\d$")},alnum:function(e){return"string"==typeof e&&!!e.match("^"+u+"$")},anycase:function(e){return"string"==typeof e&&!!e.match("^"+l+"$")},linebreak:function(e){return"string"==typeof e&&!!e.match("^"+p+"$")},any:function(){return!0},const:function(){return!0}}),h(w)}),define("datatypes/typedvar",["utils/operationutils","datatypes/datatype","internaltypes/varref","internaltypes/twineerror"],function(e,t,n,r){var a=e.typeName,i=e.matches,o=e.toSource,s=e.unstorableValue,c=Object.freeze,u=Object.assign,l=Object.create,p=c({TwineScript_TypeName:"a typed variable name",get TwineScript_ObjectName(){return this.TwineScript_ToSource()},TwineScript_Print:function(){return"`[A typed variable name]`"},TwineScript_Unstorable:!0,TwineScript_Clone:function(){return u(l(p),{datatype:this.datatype.TwineScript_Clone(),varRef:this.varRef})},TwineScript_ToSource:function(){return o(this.datatype)+"-type "+this.varRef.TwineScript_ToSource()},TwineScript_GetProperty:function(e){return"name"===e?this.getName():this[e]},TwineScript_Properties:["datatype","name"],TwineScript_IsTypeOf:function(e){return i(this.datatype,e)},get:function(){var e;return(e=this.varRef).get.apply(e,arguments)},getName:function(){return this.varRef.getName()},defineType:function(){if("any"!==this.datatype.name)return this.varRef.defineType(this.datatype)},create:function(e,t){var n;if(n=r.containsError(t)||r.containsError(e)||t.error)return n;var i=s(e);return i&&!p.isPrototypeOf(i)?r.create("syntax","The -type syntax can't have "+a(i)+" to its left."):u(l(this),{datatype:e,varRef:t})}});return p}),define("macros",["jquery","utils/naturalsort","utils","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/lambda","datatypes/hookset","datatypes/codehook","datatypes/typedvar","datatypes/datatype","internaltypes/changedescriptor","internaltypes/twineerror"],function(e,t,n,r,a,i,o,s,c,u,l,p,f){var d=n.insensitiveName,h=n.nth,y=n.plural,m=n.andList,g=n.lockProperty,v=(r.clone,r.objectName),b=r.typeName,w=r.singleTypeCheck,T=r.toSource,S=void 0,x={};function k(e,n,r){var a=n.fn,i=n.typeSignature,s=n.isChanger,u=void 0!==s&&s,l=r[0];r=function(e){return e.reduce(function(e,n){if(n&&!0===n.spreader){var r=n.value,a=f.containsError(r);if(a)e.push(a);else if(Array.isArray(r)||"string"==typeof r)for(var i=0;i<r.length;i++)e.push(r[i]);else r instanceof Set?e.push.apply(e,_toConsumableArray(Array.from(r).sort(t("en")))):e.push(f.create("operation","I can't spread out "+v(r)+", because it is not a string, dataset, or array."))}else e.push(n);return e},[])}(r.slice(1)),i=[].concat(i||[]);var p=!e,d=p?"":"("+(Array.isArray(e)&&e.length>1?e[0]:e)+":)";e=p?"this custom macro":"the "+d+" macro";var g=void 0;g=i.length>0?e+" must only be given "+m(i.map(b))+(i.length>1?", in that order":"."):e+" must not be given any data."+(p?"":" Just write "+d);for(var T=void 0,x=function(t,n){var a=i[t],s=r[t];if(f.containsError(s))return{v:s};if(c.isPrototypeOf(s)&&u)return{v:f.create("syntax","Please put this hook outside the parentheses of the changer macro, not inside it.","Hooks should appear after a macro"+(p?".":": "+d+"[Some text]"))};if(t>=i.length&&!T)return{v:f.create("datatype",r.length-i.length+" too many values were given to "+e+".",g)};if(a||(a=T),!a.innerType||"rest"!==a.pattern&&"zero or more"!==a.pattern||(T=a.innerType,"rest"===a.pattern&&(a=a.innerType)),!w(s,a)){if(void 0===s){var l=i.filter(function(e){return!("optional"===e.pattern||"zero or more"===e.pattern)}).length;return{v:f.create("datatype",e+" needs "+y(l-t,"more value")+".",g)}}return s&&s.TwineScript_Unstorable&&(a===S.TypeSignature.Any||a.innerType&&a.innerType===S.TypeSignature.Any)?{v:f.create("datatype",e+"'s "+h(t+1)+" value, "+v(s)+", is not valid data for this macro.",g)}:s&&o.isPrototypeOf(s)&&"lambda"===a.pattern?{v:f.create("datatype",e+"'s "+h(t+1)+" value (a lambda) should have "+m(["where","when","making","via","with"].filter(function(e){return a.clauses.includes(e)}).map(function(e){return"a '"+e+"' clause"}))+", not "+m(["where","when","making","via","with"].filter(function(e){return e in s}).map(function(e){return"a '"+e+"' clause"}))+".")}:"insensitive set"===a.pattern?{v:f.create("datatype",v(s)+" is not a valid name string for "+e+".","Only the following names are recognised (capitalisation and hyphens ignored): "+m(a.innerType)+".")}:{v:f.create("datatype",e+"'s "+h(t+1)+" value is "+v(s)+", but should be "+b(a)+".",a.message||g)}}},k=0,O=Math.max(r.length,i.length);k<O;k+=1){var j=x(k);if("object"===(void 0===j?"undefined":_typeof(j)))return j.v}return a.apply(void 0,[l].concat(_toConsumableArray(r)))}function O(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={fn:t,typeSignature:n};r&&(a.isChanger=!0),Object.freeze(a),Array.isArray(e)?e.forEach(function(e){return g(x,d(e),a)}):g(x,d(e),a)}return S={has:function(e){return e=d(e),x.hasOwnProperty(e)},get:function(e){return e=d(e),x.hasOwnProperty(e)&&x[e]},add:function e(t,n,r){return O(t,n,r),e},addChanger:function e(t,n,r,i){return O(t,n,i,!0),a.register(Array.isArray(t)?t[0]:t,r),e},addCommand:function e(t,n,r,a){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return O(t,function(e,t,n,r){return function(a){for(var i=arguments.length,o=Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];var c=t.apply(void 0,o);if(c)return c;var u=p.create(),l=Object.assign({TwineScript_TypeID:"command",TwineScript_ObjectName:"a ("+e+":) command",TwineScript_TypeName:"a ("+e+":) command",TwineScript_Print:function(){return"`[A ("+e+":) command]`"},TwineScript_ToSource:function(){return"("+e+":"+o.map(T)+")"},TwineScript_is:function(e){return T(this)===T(e)}},r?{TwineScript_Attach:function(e,t){return u.section=e,t.run(u),l},TwineScript_Run:function(e){return n.apply(void 0,[u,e].concat(o))}}:{TwineScript_Run:function(e){return n.apply(void 0,[e].concat(o))}});return l}}([].concat(t)[0],n,r,i),a),e},TypeSignature:{optional:function(e){return{pattern:"optional",innerType:e}},zeroOrMore:function(e){return{pattern:"zero or more",innerType:e}},either:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"either",innerType:t}},rest:function(e){return{pattern:"rest",innerType:e}},insensitiveSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"insensitive set",innerType:t}},numberRange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;return{pattern:"range",min:e,max:t,range:function(n){return"number"==typeof n&&!Number.isNaN(n)&&n>=e&&n<=t}}},nonNegativeInteger:{pattern:"range",integer:!0,min:0,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&e>=0&&!(e+"").includes(".")}},positiveInteger:{pattern:"range",integer:!0,min:1,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&e>=1&&!(e+"").includes(".")}},wrapped:function(e,t){return{pattern:"wrapped",innerType:e,message:t}},Any:{TwineScript_TypeName:"anything"},Everything:{TwineScript_TypeName:"everything"}},run:function(e,t){return S.has(e)?k(e,S.get(e),t):f.create("macrocall","I can't run the macro '"+e+"' because it doesn't exist.","Did you mean to run a macro? If you have a word written like (this:), it is regarded as a macro name.")},runCustom:function(e,t){return i.isPrototypeOf(e)?k("",e,t):f.create("macrocall","I can't call "+v(e)+" because it isn't a custom macro.")}},Object.assign(S.TypeSignature,{positiveNumber:S.TypeSignature.numberRange(Math.pow(2,-52),1/0),nonNegativeNumber:S.TypeSignature.numberRange(0,1/0),percent:S.TypeSignature.numberRange(0,1)}),Object.freeze(S)}),define("datatypes/varbind",["jquery","utils","utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(e,t,n,r,a){var i=n.objectName;return r.on("set",function(n,r){n.TwineScript_VariableStore&&e(t.storyElement).find("[data-2bind]").each(function(t,a){var i=(a=e(a)).data("twoWayBindEvent");"function"==typeof i&&i(a,n,r)})}),Object.freeze({TwineScript_TypeName:"a bound variable",TwineScript_ObjectName:"a bound variable",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return("two way"===this.bind?"2":"")+"bind "+this.varRef.TwineScript_ToSource()},set:function(e){var t,n=this.varRef.set(e);if(t=a.containsError(n))return t},create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"one way";return r.isPrototypeOf(e)?e.error?e.error:Object.assign(Object.create(this),{varRef:e,bind:t}):a.create("operation","I can only 'bind' a variable, not "+i(e)+".")}})}),define("datatypes/assignmentrequest",["utils/operationutils","datatypes/typedvar","datatypes/datatype","internaltypes/varref","internaltypes/twineerror"],function(e,t,n,r,a){var i=e.objectName,o=e.matches;return Object.freeze({assignmentRequest:!0,TwineScript_TypeName:"a 'to' or 'into' expression",TwineScript_ObjectName:"a 'to' or 'into' expression",TwineScript_Unstorable:!0,set:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=void 0,c=[],u=function e(s,c){var u,l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],p=[],f=void 0;if(f=c&&r.isPrototypeOf(c)?c.get():c,u=a.containsError(f))return u;if(Array.isArray(f)&&Array.isArray(s)){for(var d=0,h=0;d<s.length&&h<f.length;){var y=s[d],m=f[h];if(t.isPrototypeOf(y)&&y.datatype.rest||n.isPrototypeOf(y)&&y.rest){for(var g=h;h<f.length&&o(y,m);)m=f[h+=1];t.isPrototypeOf(y)?y.datatype=[y.datatype]:n.isPrototypeOf(y)&&(y=n.create("array")),p=p.concat(e(y,r.isPrototypeOf(c)?r.create(c,{first:g+1,last:h+1}):f.slice(g,h)))}else p=p.concat(e(y,r.isPrototypeOf(c)?r.create(c,h+1):m)),h+=1;d+=1}return d<s.length?l&&a.create("operation","I can't unpack this array because it needs "+(s.length-d)+" more value"+(s.length-d>0?"s":"")+"."):p}if(s instanceof Map&&f instanceof Map){var v=!0,b=!1,w=void 0;try{for(var T,S=s.entries()[Symbol.iterator]();!(v=(T=S.next()).done);v=!0){var x=_slicedToArray(T.value,2),k=x[0],O=x[1];if(!f.has(k))return l&&a.create("operation","I can't unpack this datamap because it needs a '"+k+"' data name.");p=p.concat(e(O,r.isPrototypeOf(c)?r.create(c,k):f.get(k)))}}catch(e){b=!0,w=e}finally{try{!v&&S.return&&S.return()}finally{if(b)throw w}}return p}if(t.isPrototypeOf(s)){if("function"==typeof s.datatype.destructure)return[{dest:s,value:f,src:c}].concat(s.datatype.destructure(f));if(!o(f,s.datatype))return[l&&a.create("operation","I can't unpack "+i(f)+" into "+s.varRef.TwineScript_ToSource()+" because it doesn't match "+i(s.datatype)+".")];p=p.concat(e(s.datatype,f))}return r.isPrototypeOf(s)||t.isPrototypeOf(s)?p.concat({dest:s,value:f,src:c}):"function"==typeof s.destructure?p.concat(s.destructure(f)):o(f,s)?p:l&&a.create("operation","I tried to unpack, but "+i(s)+" in the pattern didn't match "+i(f)+".")}(this.dest,this.src);if(s=a.containsError(u))return s;if(!u.length)return a.create("operation","I can't store a new value inside "+i(this.dest)+" that isn't in a variable.","You need a variable, or a data structure containing variables at certain positions, to store the value.");var l=!0,p=!1,f=void 0;try{for(var d,h=u.reverse()[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var y=d.value,m=y.dest,g=y.value,v=y.src;if(t.isPrototypeOf(m)){if(s=a.containsError(m.defineType()))return s;m=m.varRef}if(s=m.set(g),a.isPrototypeOf(s))return s;e&&v&&v.delete(),c.shift(i(m)+" is now "+i(g))}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return c.join("; ")},create:function(e,t,n){return Object.assign(Object.create(this),{dest:e,src:t,operator:n})}})}),define("twinescript/operations",["jquery","state","datatypes/assignmentrequest","utils/operationutils","internaltypes/varref","datatypes/typedvar","datatypes/datatype","internaltypes/twineerror"],function(e,t,n,r,a,i,o,s){var c=r.isObject,u=r.collectionType,l=r.is,p=r.isA,f=r.clone,d=r.unique,h=r.contains,y=r.matches,m=r.objectName,g=void 0,v=0;function b(e,t,n,r){return n=n||"do this to",function(a,i){1===t.length&&(i=a);var o;return(o=s.containsError(a,i))?o:(void 0===a?"undefined":_typeof(a))!==e||(void 0===i?"undefined":_typeof(i))!==e?s.create("operation","I can only "+n+" "+e+"s, not "+m((void 0===a?"undefined":_typeof(a))!==e?a:i)+".",r):t(a,i)}}function w(e){return function(t,n){var r;if(r=s.containsError(t,n))return r;if((void 0===t?"undefined":_typeof(t))!==(void 0===n?"undefined":_typeof(n))||c(t)&&"TwineScript_TypeName"in t&&c(n)&&"TwineScript_TypeName"in n&&t.TwineScript_TypeName!==n.TwineScript_TypeName||u(t)!==u(n)){var a=m(t)+" isn't the same type of data as "+m(n);return s.create("operation",a[0].toUpperCase()+a.slice(1))}return e(t,n)}}function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function r(a,i){var o=void 0;if(o=s.containsError(a,i))return o;v=a;var c=a.determiner?[a,i]:i.determiner?[i,a]:[],u=_slicedToArray(c,2),l=u[0],p=u[1];if(l){var f=l.determiner;if("start"===f||"end"===f){if(t)return s.create("operation","I can't use '"+t+"' with the 'start' or 'end' of "+m(l)+".");if(p.determiner){if("start"===p.determiner||"end"===p.determiner)return s.create("operation","I can't compare one value's 'start' or 'end' with another value's 'start' or 'end'.","Please change one of them to use an exact range, such as '1stto4th' or '2ndlasttolast'.");var d=[p,l];l=d[0],p=d[1]}for(var h=l.string||l.array,y=0;y<h.length+1;y+=1){var g=y?"end"===f?h.slice(-y):h.slice(0,y):h.constructor(),b=l===a?r(g,i):r(a,g);if(o=s.containsError(b))return o;if(b!==n)return b}return n}var w="all"===f;return l.array.reduce(function(e,t){var n,o=l===a?r(t,i):r(a,t);return(n=s.containsError(e,o))?n:w?e&&o:e||o},w)}return e(a,i)}}function S(e,t){return T(function(t,n){var r=e(t,n);return s.containsError(r)?r:!r},t,!0)}var x="If one of these values is a number, you may want to write a check that it 'is not 0'. Also, if one is a string, you may want to write a check that it 'is not \"\" '.";return g={create:function(n){var r=Object.create(this);return r.Identifiers={TwineScript_Identifiers:!0,get it(){return v},get time(){return n.stackTop&&n.stackTop.evaluateOnly?s.create("operation","'time' can't be used in "+n.stackTop.evaluateOnly+"."):Date.now()-n.timestamp},get visits(){var e=n.stackTop.speculativePassage,r=function(n){return n===(e||t.passage)};return t.pastPassageNames().filter(r).length+t.mockVisits.filter(r).length+(!e||e===t.passage)},get visit(){return r.Identifiers.visits},get exits(){return n.stackTop&&n.stackTop.evaluateOnly?s.create("operation","'exit' and 'exits' can't be used in "+n.stackTop.evaluateOnly+"."):n.dom.find("tw-enchantment, tw-link").filter(function(t,n){return e(n).data("enchantmentEvent")||e(n).parent().data("linkPassageName")||e(n).parent().data("clickEvent")}).length},get exit(){return r.Identifiers.exits},get pos(){return n.stackTop&&!n.stackTop.evaluateOnly&&n.stackTop.lambdaPos?+n.stackTop.lambdaPos||1:s.create("operation","'pos' can only be used in lambdas that aren't 'when' lambdas.")}},r},elidedComparisonOperator:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return r.reduce(function(n,r){return"boolean"==typeof r?r:g[e](n,g[t](v,r))},"and"===e)},and:b("boolean",w(function(e,t){return e&&t}),"use 'and' to join",x),or:b("boolean",w(function(e,t){return e||t}),"use 'or' to join",x),not:b("boolean",function(e){return!e},"use 'not' to invert",x),"+":w(function(e,t){if(Array.isArray(e))return[].concat(_toConsumableArray(e),_toConsumableArray(t));var n=void 0;return e instanceof Map?(n=new Map(e),t.forEach(function(e,t){return n.set(t,e)}),n):e instanceof Set?new Set([].concat(_toConsumableArray(e),_toConsumableArray(t)).filter(d).map(f)):"function"==typeof e["TwineScript_+"]?e["TwineScript_+"](t):"string|number|boolean".includes(void 0===e?"undefined":_typeof(e))?e+t:s.create("operation","I can't use + on "+m(e)+".")}),"-":w(function(e,t){if(Array.isArray(e))return e.filter(function(e){return!t.some(function(t){return l(e,t)})});if(e instanceof Set){var n=[].concat(_toConsumableArray(t));return new Set([].concat(_toConsumableArray(e)).filter(function(e){return!n.some(function(t){return l(e,t)})}))}return"string"==typeof e?e.split(t).join(""):"number"==typeof e?e-t:s.create("operation","I can't use - on "+m(e)+".")}),"*":b("number",w(function(e,t){return e*t}),"multiply"),"/":b("number",w(function(e,t){return 0===t?s.create("operation","I can't divide "+m(e)+" by zero."):e/t}),"divide"),"%":b("number",w(function(e,t){return 0===t?s.create("operation","I can't modulo "+m(e)+" by zero."):e%t}),"modulus"),"<":T(b("number",w(function(e,t){return e<t}),"do < to"),"<"),">":T(b("number",w(function(e,t){return e>t}),"do > to"),">"),"<=":T(b("number",w(function(e,t){return e<=t}),"do <= to"),"<="),">=":T(b("number",w(function(e,t){return e>=t}),"do >= to"),">="),is:T(l),isNot:S(l),contains:T(h,"contains"),doesNotContain:S(h,"does not contain"),isIn:T(function(e,t){return h(t,e)},"is in"),isNotIn:S(function(e,t){return h(t,e)},"is not in"),isA:T(p,"is a"),isNotA:S(p,"is not a"),typifies:T(function(e,t){return p(t,e)}),untypifies:S(function(e,t){return p(t,e)}),matches:T(y),doesNotMatch:S(y),where:function(e,t,n){var r;return(r=s.containsError(e))?r:"boolean"!=typeof e?s.create("operation","This lambda's 'where' clause must evaluate to true or false, not "+m(e)+"."):e?t:n},makeSpreader:function(e){if(i.isPrototypeOf(e)||o.isPrototypeOf(e)){var t=f(e);return(i.isPrototypeOf(e)?t.datatype:t).rest=!0,t}return{value:e,spreader:!0,TwineScript_TypeName:"a spreaded '...' value",TwineScript_ObjectName:"a spreaded '...' value",TwineScript_Unstorable:!0}},makeAssignmentRequest:function(e,t,r){var a=s.containsError(e,t);return a||n.create(e,t,r)},setIt:function(e){return a.isPrototypeOf(e)||i.isPrototypeOf(e)?(v=e.get(),e):e},initialiseIt:function(e){v=e}},Object.freeze(g)}),define("twinescript/environ",["macros","state","utils","datatypes/colour","datatypes/hookset","datatypes/lambda","datatypes/datatype","datatypes/varbind","datatypes/codehook","datatypes/typedvar","internaltypes/varref","internaltypes/twineerror","twinescript/operations"],function(Macros,State,Utils,Colour,HookSet,Lambda,Datatype,VarBind,CodeHook,TypedVar,VarRef,TwineError,OperationsProto){return function(section){"object"===(void 0===section?"undefined":_typeof(section))&&section||Utils.impossible("TwineScript.environ","no Section argument was given!");var Operations=OperationsProto.create(section);return section.eval=function(){try{return eval(arguments[0])}catch(e){return e}},section}}),define("section",["jquery","utils","renderer","twinescript/environ","twinescript/operations","state","utils/operationutils","utils/renderutils","datatypes/changercommand","datatypes/hookset","datatypes/colour","datatypes/lambda","internaltypes/changedescriptor","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(e,t,n,r,a,i,o,s,c,u,l,p,f,d,h,y){var m,g=o.printBuiltinValue,v=o.objectName,b=o.typeID,w=o.isObject,T=s.collapse;function S(e,n,r){if(n&&"object"===(void 0===n?"undefined":_typeof(n))&&c.isPrototypeOf(n)){if(r.data("originalSource",r.popAttr("source")),!this.renderInto(r.data("originalSource"),r,n)){var a=t.insensitiveName(e.attr("name"));if(["if","elseif","unless","else","testfalse"].includes(a)&&(e.addClass("false"),"elseif"!==a&&(this.stackTop.lastHookShown=!1)),r.data("live")){var i=r.data("live"),o=i.delay,s=i.event;(function(e,n){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;i&&t.assertMustHave(i,["when"]);var o=n.data("originalSource")||"",s=_slicedToArray(this.stack,1)[0].tempVariables,c=this.whenUnblocked.bind(this,function(){if(r.inDOM()){var t=i&&i.filter(r,[!0],s);h.containsError(t)?t.render(e.attr("title")).replaceAll(e):!i||t[0]?(r.renderInto(o,n,{append:"replace"}),t||n.find("tw-expression[name='stop']").length||r.inDOM()&&setTimeout(c,a)):setTimeout(c,a)}});setTimeout(c,a)}).call(this,e,r,o,s)}return}}else{if(!1===n)return r.attr("source")&&(r.data("originalSource",r.popAttr("source")),r.data("hidden",!0)),e.addClass("false"),void(this.stackTop.lastHookShown=!1);!0!==n&&e.replaceWith(h.create("datatype",v(n)+" cannot be attached to this hook.","Only Booleans and changers can be attached to hooks.").render(e.attr("title")))}this.stackTop.lastHookShown=!0}function x(t){var n=(t instanceof e?t[0]:t).nextSibling;if(n&&(n instanceof Text&&!n.textContent.trim()||["br","tw-consecutive-br"].includes((n.tagName||"").toLowerCase()))){var r=x(n),a=r.whitespace,i=r.nextElem;return{whitespace:e(n).add(a),nextElem:i}}return{whitespace:e(),nextElem:e(n)}}var k={add:[],remove:[]};return m={create:function(e){var n=Object.assign(Object.create(this),{timestamp:Date.now(),dom:e||t.storyElement,stack:[],enchantments:[],unblockCallbacks:[]});return n=r(n)},get stackTop(){return this.stack[0]},inDOM:function(){return e(t.storyElement).find(this.dom).length>0},evaluateTwineMarkup:function(t,n){var r=e("<p>");this.stack.unshift({desc:f.create({target:r,source:t,section:this,append:"append"}),tempVariables:this.stackTop.tempVariables,evaluateOnly:n,finalIter:!0}),this.execute();var a;return(a=r.find("tw-error")).length>0?a:r},speculate:function(e,t,n){this.stack.unshift({evaluateOnly:n,finalIter:!0,tempVariables:Object.assign(Object.create(d),{TwineScript_VariableStoreName:n}),speculativePassage:t});var r=void 0;return r=p.isPrototypeOf(e)?e.apply(this,{fail:!1,pass:!0}):this.eval(e),this.stack.shift(),r},renderInto:function(t,n,r){var a=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=f.create({target:n,source:t,section:this,append:"append"});if(r)if(c.isPrototypeOf(r)){var s=r.run(o);if(h.containsError(s))return s.render(n.attr("title")).replaceAll(n),!1}else Object.assign(o,r);if((n=o.target,this.stack.length>=50)&&this.stack.reduce(function(e,t){return e+!!t.finalIter},0)>=50)return h.create("infinite","Printing this expression may have trapped me in an infinite loop.").render(n.attr("title")).replaceAll(n),!1;var u=function(t,r,i){var o=n instanceof e&&n.is("tw-hook")&&n.parents("tw-collapsed,[collapsing=true]").length>0;a.stack.unshift({desc:t,finalIter:i,tempVariables:r,collapses:o,evaluateOnly:a.stackTop&&a.stackTop.evaluateOnly})};if(i||(i=Object.create(this.stack.length?this.stackTop.tempVariables:d)),!i.hasOwnProperty("TwineScript_VariableStoreName")){var l=n&&n.tag();i.TwineScript_VariableStoreName="tw-hook"===l?n.attr("name")?"?"+n.attr("name"):"an unnamed hook":"tw-expression"===l?"a "+n.attr("type")+" expression":"tw-passage"===l?"this passage":"an unknown scope"}return Object.keys(o.loopVars).length?function(){var e=Object.assign({},o.loopVars),t=Math.min.apply(Math,_toConsumableArray(Object.keys(e).map(function(t){return e[t].length})));if(y.create(t+" loop"+(1!==t?"s":"")).render().prependTo(n),t){for(var r=function(n){u(o,Object.keys(e).reduce(function(t,r){return t[r]=e[r][n],t},Object.create(i),n===t-1))},s=t-1;s>=0;s-=1)r(s);for(s=t-1;s>=0&&!a.stackTop.blocked;s-=1)a.execute()}}():(u(o,i,!0),this.execute()),0===this.stack.length&&this.updateEnchantments(),o.enabled},execute:function(){var n=this,r=this.stackTop,i=r.desc,o=r.dom,s=r.collapses,u=r.evaluateOnly;i&&!o&&(o=i.render(),this.stackTop.dom=o,this.stackTop.desc=void 0),o.findAndFilter("tw-hook,tw-expression").each(function(r,i){if(n.stackTop.blocked)return!1;switch((i=e(i)).tag()){case"tw-hook":var o=i.popAttr("source")||"";if(o&&i.data("originalSource",o),i.data("tempVariables",n.stackTop.tempVariables),i.popAttr("hidden")){i.data("hidden",!0);break}o&&n.renderInto(o,i);break;case"tw-expression":if(i.attr("blockers")){if(u)return void i.removeAttr("blockers").removeAttr("js").replaceWith(h.create("syntax","I can't use a macro like (prompt:) or (confirm:) in "+u+".","Please rewrite this without putting such macros here.").render(i.attr("title"),i));var s=[];try{s=JSON.parse(i.popAttr("blockers")),i.data("blockers",s)}catch(e){t.impossible("Section.execute","JSON.parse blockers failed.")}}if(i.data("blockers")){var p=i.data("blockers");if(p.length){n.stackTop.blocked=!0;var d=n.eval(p.shift());return h.containsError(d)&&(n.stackTop.blocked=!1,i.removeData("blockers").replaceWith(d.render(i.attr("title"),i))),!1}i.removeData("blockers")}i.attr("js")&&function(n){var r=this.eval(n.popAttr("js")||"");this.stackTop.evaluateOnly&&r&&(c.isPrototypeOf(r)||"function"==typeof r.TwineScript_Run)&&(r=h.create("syntax","I can't work out what "+this.stackTop.evaluateOnly+" should evaluate to, because it contains a "+(c.isPrototypeOf(r)?"changer.":"command."),"Please rewrite this without putting changers or commands here."));var i=void 0,o=void 0,s=e();for(o=n;c.isPrototypeOf(r);){var u=x(o);if(i=u.whitespace,(o=u.nextElem)[0]instanceof Text&&"+"===o[0].textContent.trim()){var p,d=o,m=x(d);if(p=m.whitespace,(o=m.nextElem).is("tw-expression")){var T=this.eval(o.popAttr("js"));if(h.containsError(T)){r=T;break}var k=a["+"](r,T);e(i).add(d).add(p).remove(),r=h.containsError(k)?h.create("operation","I can't combine "+v(r)+" with "+v(T)+".","function"==typeof T.TwineScript_Run?"If you want to attach this changer to "+v(T)+", remove the + between them.":"Changers can only be added to other changers."):k;continue}}if(o.is("tw-expression")){var O=this.eval(o.popAttr("js"));if(h.containsError(O)){r=O;break}if(O&&"object"===(void 0===O?"undefined":_typeof(O))&&"function"==typeof O.TwineScript_Attach){r=O.TwineScript_Attach(this,r);break}return c.isPrototypeOf(O)?void n.replaceWith(h.create("operation","Changers like ("+r.macroName+":) need to be combined using + between them.","Place the + between the changer macros, or the variables holding them. The + is absent only between a changer and its attached hook or command.").render(n.attr("title"))):void n.replaceWith(h.create("operation",v(O)+" can't have changers like ("+r.macroName+":) attached.","Changers placed just before hooks, links and commands will attempt to attach, but in this case it didn't work.").render(n.attr("title")))}if(o.is("tw-hook")){i.remove(),s=o;break}r.macroName||t.impossible("Section.runExpression","changer has no macroName");var j=n.attr("title")||"("+r.macroName+": ...)";return void n.replaceWith(h.create("syntax","The ("+r.macroName+":) changer should be stored in a variable or attached to a hook.","Macros like this should appear before a hook: "+j+"[Some text]").render(n.attr("title")))}n.attr("return",b(r)),s=s.length?s:x(n).nextElem.filter("tw-hook");var A=void 0;if(A=h.containsError(r))A instanceof Error&&(A=h.fromError(A)),n.replaceWith(A.render(n.attr("title"),n));else if(y.isPrototypeOf(r))n.append(r.render());else if(r&&"function"==typeof r.TwineScript_Run)if(r=r.TwineScript_Run(this),h.containsError(r))n.replaceWith(r.render(n.attr("title")));else if(f.isPrototypeOf(r)){if(r.data&&r.data.live)return void n.replaceWith(h.create("unimplemented","I currently can't attach (live:) or (event:) macros to commands - only hooks.").render(n.attr("title")));r.section=this,r.target=o,this.renderInto("",o,r)}else{if(w(r)&&r.blocked)return this.stackTop.blocked=r.blocked,void n.attr("js","section.blockedValue()");r&&t.impossible("Section.runExpression","TwineScript_Run() returned a non-ChangeDescriptor "+(void 0===r?"undefined":_typeof(r))+': "'+r+'"')}else!s.length&&("string"==typeof r||"number"==typeof r||r instanceof Map||r instanceof Set||Array.isArray(r)||l.isPrototypeOf(r))||r&&"function"==typeof r.TwineScript_Print&&!c.isPrototypeOf(r)?(r=g(r),h.containsError(r)?(r instanceof Error&&(r=h.fromError(r)),n.replaceWith(r.render(n.attr("title")))):"string"!=typeof r?t.impossible("printBuiltinValue() produced a non-string "+(void 0===r?"undefined":_typeof(r))):this.renderInto(r,n)):s.length?S.call(this,n,r,s):c.isPrototypeOf(r)||"boolean"==typeof r||t.impossible("Section.runExpression","The expression evaluated to an unknown value: "+r)}.call(n,i)}}),this.stackTop.blocked||(o.length&&s&&T(o),o.findAndFilter("tw-collapsed,[collapsing=true]").each(function(){T(e(this))}),this.stack.shift())},updateEnchantments:function(){this.enchantments.forEach(function(e){e.disenchant(),e.enchantScope()})},on:function(e,t){return k[e].push(t),this},addEnchantment:function(e){var t=this;this.enchantments.push(e),k.add.forEach(function(n){return n(t,e)})},removeEnchantment:function(e){var t=this,n=this.enchantments.indexOf(e);this.enchantments.splice(n,1),e.disenchant(),k.remove.forEach(function(n){return n(t,e)})},unblock:function(e){for(this.stack.length||t.impossible("Section.unblock","stack is empty"),this.stackTop.blocked=!1,void 0!==e&&(this.stackTop.blockedValues=(this.stackTop.blockedValues||[]).concat(e));this.stack.length&&!this.stackTop.blocked;)this.execute();if(!this.stack.length)for(;this.unblockCallbacks.length>0;){if(this.unblockCallbacks.shift()(),this.stackTop&&this.stackTop.blocked)return}},whenUnblocked:function(e){this.stack.length&&this.stackTop.blocked?this.unblockCallbacks=this.unblockCallbacks.concat(e):e()},blockedValue:function(){var e=this.stackTop;return e||t.impossible("Section.blockedValue","stack is empty"),e.blockedValues&&e.blockedValues.length||t.impossible("Section.blockedValue","blockedValues is missing or empty"),e.blockedValues.shift()}},Object.preventExtensions(m)}),define("engine",["jquery","utils","state","section","passages"],function(e,t,n,r,a){var i,o=t.escape,s=t.impossible,c=t.passageSelector,u=t.transitionOut,l=Object.create(null);function p(e,t){return"<tw-include type="+e+" name='"+o(t.get("name"))+"'>"+t.get("source")+"</tw-include>"}function f(i){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.assertOnlyHas(o,["stretch","transition"]);var f=a.get(i),d=t.storyElement,h=d.parent(),y=o.stretch,m=o.transition,g=(m=void 0===m?{}:m).depart,v=void 0===g?"instant":g,b=m.arrive,w=void 0===b?"dissolve":b,T=m.departOrigin,S=m.arriveOrigin,x=m.time;h.findAndFilter("tw-enchantment").each(function(t,n){var r=(n=e(n)).data("enchantedProperties");r&&d.css(r.reduce(function(e,t){return e[t]="",e},{})),n[0]===h[0]&&(h=d.unwrap().parent())}),a.hasValid(i)||s("Engine.showPassage","There's no passage with the name \""+i+'"!');var k,O,j,A,C=d.children(c).not(".transition-out, .transition-out *"),E=(f.get("tags")||[]).join(" "),_=(k=e("<tw-passage><tw-sidebar>"),O=k.children("tw-sidebar"),j=e('<tw-icon tabindex=0 alt="Undo" title="Undo">&#8630;</tw-icon>'),A=e('<tw-icon tabindex=0 alt="Redo" title="Redo">&#8631;</tw-icon>'),n.pastLength<=0&&j.css("visibility","hidden"),n.futureLength<=0&&A.css("visibility","hidden"),O.append(j,A),k);"function"==typeof T&&(T=T.call(C)),"function"==typeof S&&(S=S.call(_)),d.detach(),_.appendTo(d).attr({tags:E}),!y&&v&&(u(C,v,x,0,0,0,T),C.css("position","absolute")),d.attr({tags:E});var N=r.create(_),P=f.get("source");P=a.getTagged("header").map(p.bind(0,"header")).join("")+(l.debug?a.getTagged("debug-header").map(p.bind(0,"debug-header")).join(""):"")+P+a.getTagged("footer").map(p.bind(0,"footer")).join("")+(l.debug?a.getTagged("debug-footer").map(p.bind(0,"debug-footer")).join(""):""),n.pastLength<=0&&(l.debug&&(P=a.getTagged("debug-startup").map(p.bind(0,"debug-startup")).join("")+P),P=a.getTagged("startup").map(p.bind(0,"startup")).join("")+P),N.renderInto(P,_,{transition:w,transitionTime:x,transitionOrigin:S}),h.append(d.parents().length?d.parents().last():d),scroll(0,y?_.offset().top-.05*e(window).height():d.offset().top)}return i={goBack:function(e){n.rewind()&&f(n.passage,e)},goForward:function(e){n.fastForward()&&f(n.passage,e)},goToPassage:function(e,t){n.play(e),f(e,t)},toggleFullscreen:function(){var e=document.documentElement;document.fullscreenElement?document.exitFullscreen():document.msFullscreenElement?document.msExitFullscreen():(e.msRequestFullscreen||e.requestFullscreen).call(e)},showPassage:f,options:l},Object.freeze(i)}),define("debugmode/panel",["jquery"],function(e){return Object.freeze({create:function(t){var n=t.className,r=t.rowWrite,a=t.rowCheck,i=t.columnHead,o=t.tabName,s=t.tabUpdate,c=e("<div class='panel panel-"+n+"' hidden><table class='panel-rows'></table></div>"),u=e("<button class='tab tab-"+n+"'>0 "+o+"s</button>");return u.click(function(){u.toggleClass("enabled"),u.parent().siblings(".panel").attr("hidden",""),u.is(".enabled")&&(u.siblings(".tab:not(.tab-"+n+")").removeClass("enabled"),c.removeAttr("hidden"))}),s||(s=function(e){return u.text(e+" "+o+(1!==e?"s":""))}),Object.assign(Object.create(this),{tabName:o,tab:u,panel:c,panelRows:c.find(".panel-rows"),rowWrite:r,rowCheck:a,columnHead:i,tabUpdate:s})},update:function(t,n){var r=this.rowCheck,a=this.rowWrite,i=this.panelRows,o=this.columnHead,s=[],c=i.children();t.forEach(function(t){var n=c.filter(function(n,a){return r(t,e(a))}),o=a(t,n.length&&n);n.length||i.append(o),s.push.apply(s,_toConsumableArray(o.get()))}),c.filter(function(e,t){return!s.includes(t)&&!t.className.includes("panel-head")}).remove(),this.tabUpdate(n),n>0&&!i.find(".panel-head").length?i.prepend(o()):0===n&&i.find(".panel-head").remove()}})}),define("debugmode/mode",["jquery","utils","state","internaltypes/varref","internaltypes/twineerror","utils/operationutils","engine","passages","section","debugmode/panel"],function(e,t,n,r,a,i,o,s,c,u){var l=t.escape,p=t.nth,f=t.storyElement,d=t.debounce,h=i.objectName,y=i.isObject,m=i.toSource;return function(t,i){var g=e(document.documentElement),v=e("<tw-debugger>\n\t\t<div class='panel panel-errors' hidden><table></table></div>\n\t\t<div class='tabs'></div>\n\t\t<label style='user-select:none'>Turns: </label><select class='turns' disabled></select><button class='show-invisibles'>Debug View</button><button class='show-dom'>DOM View</button>\n\t\t<div class='resizer'>\n\t\t</tw-debugger>"),b=v.find(".tabs"),w=v.find(".show-dom"),T=v.find(".show-invisibles"),S=v.find(".turns");v.find(".resizer").mousedown(function(e){if(1!==e.which)return!0;e.stopPropagation();var t=e.pageX,n=v.width();g.on("mousemove.debugger-resizer",function(e){var r=e.pageX;v.width((n+t-r|0)+"px")}).on("mouseup.debugger-resizer",function(){g.off(".debugger-resizer")})}),T.click(function(){g.toggleClass("debug-mode").removeClass("dom-debug-mode"),T.toggleClass("enabled"),w.removeClass("enabled")}),w.click(function(){g.toggleClass("dom-debug-mode").removeClass("debug-mode"),w.toggleClass("enabled"),T.removeClass("enabled")}),n.timelinePassageNames().forEach(function(e,t){S.append("<option value="+t+">"+(t+1)+": "+e+"</option>")}),S.val(n.pastLength),n.pastLength>0&&S.removeAttr("disabled"),S.change(function(e){var t=e.target.value-n.pastLength;0!==t&&(n[t<0?"rewind":"fastForward"](Math.abs(t)),o.showPassage(n.passage))}),n.on("forward",function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=n.pastLength;a>=1&&S.removeAttr("disabled"),r?(S.find("[selected]").removeAttr("selected"),S.val(a)):(S.children().each(function(t,n){t>=a&&e(n).remove()}),S.append("<option value="+a+">"+(a+1)+": "+t+"</option>").val(a))}).on("back",function(){n.pastLength<=1&&S.attr("disabled"),S.find("[selected]").removeAttr("selected"),S.val(n.pastLength)}).on("load",function(e){S.empty(),S[e.length<=1?"attr":"removeAttr"]("disabled"),e.forEach(function(e,t){return S.append("<option value="+t+">"+(t+1)+": "+e.passage+"</option>")})});var x=new Set,k=u.create({className:"variables",tabName:"Variable",rowWrite:function(t,n){var r=t.name,a=t.dataset,i=t.path,o=t.value,s=t.tempScope,c=t.type,u=o&&o.length>48&&!o.TwineScript_DebugName,p=y(o)&&o.TwineScript_DebugName?o.TwineScript_DebugName():l(h(o).slice(0,48)+(u?"\u2026":"")),f="";i.length&&(f=i.reduce(function(e,t){return e+t+"'s "},"")),a&&(r="???");var d=c?m(c):"",g="object"===(void 0===o?"undefined":_typeof(o))||u;return n?(n.find(".variable-type").html(d?d+"-type ":""),f&&n.find(".variable-path").html((s?"_":"$")+l(f)),n.find(".variable-name").html((f?"":s?"_":"$")+l(r+"")),n.find(".temporary-variable-scope").html(s||""),n.find(".variable-value").html(p),n.find("tw-folddown")[g?"show":"hide"](),n.next(".panel-row-source td").html(g?l(m(o)):""),n.add(n.next(".panel-row-source"))):e('<div class="variable-row">').attr("data-name",r).attr("data-path",i+"").attr("data-scope",s||"").css("padding-left",Math.min(5,i.length)+"em").append("<td class='variable-type'>"+(d?d+"-type ":"")+"</td>","<td class='variable-name'>"+(f?"<span class='variable-path'>"+(s?"_":"$")+l(f)+"</span> ":"")+(f?"":s?"_":"$")+l(r+"")+"</td>","<td class='temporary-variable-scope'>"+(s||"")+"</td>","<td class='variable-value'>"+p+"</td><td class='panel-row-buttons'><tw-folddown tabindex=0 style='display:"+(g?"visible":"none")+"'>(source:) </tw-folddown></td>").add("<tr class='variable-row panel-row-source' style='display:none'><td colspan='5'>"+(g?l(m(o)):"")+"</td></tr>")},rowCheck:function(e,t){var n=e.name,r=e.path,a=e.tempScope;return t.attr("data-name")===n&&t.attr("data-path")===r+""&&t.attr("data-scope")===a},columnHead:function(){return'<tr class="panel-head"><th>Type</th><th>Name</th><th>Scope</th><th>Value</th></tr>'}}),O=d(function(){var e=[],t=n.variables,r=e.length;function a(t){if(!(e.length>500)){e.push(t);var n=t.path.concat(t.name),r=t.value,i=t.tempScope;Array.isArray(r)?r.forEach(function(e,t){return a({name:p(t+1),path:n,value:e,tempScope:i})}):r instanceof Map?[].concat(_toConsumableArray(r)).forEach(function(e){var t=_slicedToArray(e,2),r=t[0],o=t[1];return a({name:r,path:n,value:o,tempScope:i})}):r instanceof Set&&[].concat(_toConsumableArray(r)).forEach(function(e,t){return a({name:t,dataset:!0,path:n,value:e,tempScope:i})})}}for(var i in t)i.startsWith("TwineScript")||(r+=1,a({name:i,path:[],value:t[i],tempScope:"",type:t.TwineScript_TypeDefs&&t.TwineScript_TypeDefs[i]}));e.push.apply(e,_toConsumableArray(x)),r+=x.size,k.update(e,r),k.panel[(r?"remove":"add")+"Class"]("panel-variables-empty")}),j=void 0;r.on("set",function(e,t,r){if(e!==n.variables&&e.TwineScript_VariableStoreName&&!e.TwineScript_VariableStoreName.match(/#\d+$/)){var a=e.TwineScript_VariableStoreName,i=e.TwineScript_TypeDefs&&e.TwineScript_TypeDefs[t],o=[].concat(_toConsumableArray(x)).find(function(e){return e.name===t&&e.tempScope===a});o?o.value=r:x.add({name:t,path:[],value:r,tempScope:a,type:i})}O(),j()}).on("delete",function(){O(),j()}),k.panel.append("<div class='panel-variables-bottom'>\n\t\t\t<button class='panel-variables-copy'>Copy $ variables as (set:) call</button>\n\t\t\t<input class='clipboard' type=\"text\" style='opacity:0;pointer-events:none;position:absolute;'></input>\n\t\t</div>").removeAttr("hidden"),k.tab.addClass("enabled");var A=k.panel.find(".clipboard");g.on("click",".panel-variables-copy",function(){var e=[];for(var t in n.variables)t.startsWith("TwineScript")||e.push("$"+t+" to "+m(n.variables[t]));A.val("(set:"+e+")")[0].select(),document.execCommand("copy")});var C=u.create({className:"enchantments",tabName:"Enchantment",rowWrite:function(t,n){var r=t.scope,a=t.changer,i=t.name,o=t.localHook,s=void 0;return s=a?l(h(a)):"<em>enchanted via ("+i+":)</em>",n||e('<div class="enchantment-row">').data("enchantment",t).append("<td><span class='enchantment-name'>"+m(r)+(o?"</span><span class=enchantment-local>"+("function"==typeof o.TwineScript_ToSource?o.TwineScript_ToSource():o.attr("name")?"?"+o.attr("name"):"an unnamed hook"):"")+"</span></td><td class='enchantment-value'>"+s+"</td>"+(a?"<td class='panel-row-buttons'><tw-folddown tabindex=0>(source:)</tw-folddown></td>":"")).add(a?"<tr class='panel-row-source' style='display:none'><td colspan='3'>"+l(m(a))+"</td></tr>":"")},rowCheck:function(e,t){return t.data("enchantment")===e},columnHead:function(){return'<tr class="panel-head"><th>Scope</th><th>Value</th></div>'}}),E=d(function(e){C.update(e.enchantments,e.enchantments.length)});c.on("add",E).on("remove",E);var _=c.create(f),N=u.create({className:"storylets",tabName:"Storylet",rowWrite:function(t,n){var r=t.name,a=t.active,i=t.storyletSource,o=t.exclusive,s=t.urgent;return n?(n[(a?"remove":"add")+"Class"]("storylet-closed"),n):e('<tr class="storylet-row '+(a?"":"storylet-closed")+'">').attr("data-name",r).append("<td class='storylet-name'>"+r+"</td><td class='storylet-lambda'>"+i+"</td><td class='storylet-exclusive'>"+o+"</td><td class='storylet-urgent'>"+s+"</td>")},rowCheck:function(e,t){var n=e.name;return t.attr("data-name")===l(n+"")},columnHead:function(){return"<tr class=\"panel-head\"><th>Name</th><th>Condition</th><th class='storylet-exclusive'>Exclusivity</th><th class='storylet-urgent'>Urgency</th></tr>"}});N.tab.hide(),j=d(function(){var e=s.getStorylets(_),t=a.containsError(e),n=s.allStorylets();N.update(n.map(function(n){return{name:n.get("name"),storyletSource:n.get("storylet").TwineScript_ToSource(),active:!t&&e.some(function(e){return e.get("name")===n.get("name")}),exclusive:"number"==typeof n.get("exclusivity")?n.get("exclusivity"):0,urgent:"number"==typeof n.get("urgency")?n.get("urgency"):0}}),t?0:e.length),N.panel[(t?"add":"remove")+"Class"]("storylet-error");var r=n.some(function(e){return e.get("exclusivity")&&"number"==typeof e.get("exclusivity")}),i=n.some(function(e){return e.get("urgency")&&"number"==typeof e.get("urgency")});N.panel[(r?"add":"remove")+"Class"]("panel-exclusive"),N.panel[(i?"add":"remove")+"Class"]("panel-urgent"),n.length&&N.tab.show()});var P=u.create({className:"source",tabName:"Source",rowWrite:e.noop,rowCheck:e.noop,tabUpdate:e.noop,columnHead:e.noop});P.tab.text("Source");var I=u.create({className:"errors",tabName:"Error",rowWrite:e.noop,rowCheck:e.noop,columnHead:e.noop,tabUpdate:function(e){return I.tab.css({background:e?"rgba(230,101,204,0.3)":""}).text(e+" Error"+(1!==e?"s":""))}}),M=function(t,r){if("propagated"!==t.type){I.panelRows.children().length>500&&I.panelRows.children(":first-child").remove();var a=e('<tr class="error-row"><td class="error-passage">'+n.passage+'</td><td class="error-message">'+t.message+"</td></tr>");a.find(".error-message").attr("title",r),I.panelRows.append(a),I.tabUpdate(I.panelRows.children().length)}};function D(){if(x=new Set,O(),j(),C.panelRows.empty(),C.tabUpdate(0),n.passage){var e=s.get(n.passage);e&&P.panelRows.text(e.get("source"))}}a.on("error",M),v.prepend(k.panel,C.panel,I.panel,N.panel,P.panel),b.prepend(k.tab,C.tab,I.tab,N.tab,P.tab),n.on("forward",D).on("back",D).on("load",D),t&&(M(t,i),D()),e(document.body).append(v)}}),define("macrolib/values",["macros","utils","utils/operationutils","datatypes/colour","datatypes/gradient","datatypes/datatype","datatypes/hookset","internaltypes/twineerror"],function(e,t,n,r,a,i,o,s){var c=t.realWhitespace,u=t.nth,l=t.anyRealLetter,p=n.subset,f=n.objectName,d=n.clone,h=n.toSource,y=e.TypeSignature,m=y.rest,g=y.zeroOrMore,v=y.either,b=y.optional,w=y.insensitiveSet,T=y.numberRange,S=y.percent,x=y.nonNegativeInteger,k=y.positiveInteger,O=y.Any,j=Math.max,A=Math.min,C=Math.round,E=Math.floor,_=Math.ceil;function N(e){return function(){var t=e.apply(void 0,arguments);return"number"!=typeof t||isNaN(t)?s.create("macrocall","This mathematical expression doesn't compute!"):t}}e.add(["str","string","text"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.join("")},[g(e.TypeSignature.either(String,Number,Boolean,Array))])("source",function(e,t){return t&&"command"===t.TwineScript_TypeID&&!t.TwineScript_ToSource?s.create("datatype","I can't construct the source code of a command created by a custom macro."):h(t)},[O])("substring",function(e,t,n,r){return p(t,n,r)},[String,parseInt,parseInt])("lowercase",function(e,t){return t.toLowerCase()},[String])("uppercase",function(e,t){return t.toUpperCase()},[String])("lowerfirst",function(e,t){return t.replace(RegExp(l+"+"),function(e){return(e=Array.from(e))[0].toLowerCase()+e.slice(1).join("").toLowerCase()})},[String])("upperfirst",function(e,t){return t.replace(RegExp(l+"+"),function(e){return(e=Array.from(e))[0].toUpperCase()+e.slice(1).join("").toLowerCase()})},[String])("words",function(e,t){return t.split(RegExp(c+"+")).filter(Boolean)},[String])(["str-repeated","string-repeated"],function(e,t,n){return 0===n.length?s.create("macrocall","I can't repeat an empty string."):n.repeat(t)},[x,String])(["str-reversed","string-reversed"],function(e,t){return[].concat(_toConsumableArray(t)).reverse().join("")},[String])("joined",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return r.join(t)},[m(String)])("plural",function(e,t,n,r){return n&&""!==r?t+" "+(1!==Math.abs(t)?r||n+"s":n):s.create("macrocall","The (plural:) macro can't be given empty strings.")},[parseInt,String,b(String)])(["str-nth","string-nth"],function(e,t){return u(t)},[parseInt])(["num","number"],function(e,t){return Number.isNaN(+t)?s.create("macrocall","I couldn't convert "+f(t)+" to a number."):+t},[String])("datatype",function(e,t){return i.from(t)},[O])("datapattern",function(e,t){return function e(t){var n,r=void 0;return Array.isArray(t)?r=t.map(e):t instanceof Map?(r=new Map,[].concat(_toConsumableArray(t)).forEach(function(t){var n=_slicedToArray(t,2),a=n[0],i=n[1];return r.set(a,e(i))})):r=i.from(t),(n=s.containsError(r))?n:r}(t)},[O])(["rgb","rgba"],function(e){return r.create({r:arguments.length<=1?void 0:arguments[1],g:arguments.length<=2?void 0:arguments[2],b:arguments.length<=3?void 0:arguments[3],a:arguments.length<=4?void 0:arguments[4]})},[T(0,255),T(0,255),T(0,255),b(S)])(["hsl","hsla"],function(e,t,n,a,i){return(t=C(t)%360)<0&&(t+=360),r.create({h:t,s:n,l:a,a:i})},[Number,S,S,b(S)])(["lch","lcha"],function(e,t,n,a,i){return(a=C(a)%360)<0&&(a+=360),r.create({l:t,c:n,h:a,a:i})},[S,T(0,132),Number,b(S)])("complement",function(e,t){return t.LCHRotate(180)},[r])("palette",function(e,t,n){var a=n.toLCHA(),i=a.l,o={l:i<=.75?.75+i/3:.75-3*(1-i),c:80,h:a.h,a:1},s=void 0,c=void 0,u=void 0;return s=r.create(o),o.l+=i<=.75?-.1:.1,o.l<.5&&(o.l*=.5/o.l),c=r.create(o),o.l+=i<=.85?.15:-.15,u=r.create(o),"adjacent"===t?(c=(s=s.LCHRotate(-30)).LCHRotate(30),u=s.LCHRotate(60)):"triad"===t&&(u=s.LCHRotate(180),c=s.LCHRotate(140),s=s.LCHRotate(-140)),[n,s,c,u]},[w("mono","adjacent","triad"),r])("gradient",function(e,t){for(var n=arguments.length,i=Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];if((t=C(t)%360)<0&&(t+=360),i.length<4)return s.create("datatype","(gradient:) must be given at least 2 colour-stop pairs of numbers and colours.");var c=void 0,u=[],l=i.reduce(function(e,t){if(s.containsError(e))return e;if(void 0===c)c=t;else{if("number"!=typeof c||!r.isPrototypeOf(t))return s.create("datatype","(gradient:) colour-stops should be pairs of numbers and colours, not colours and numbers.");u.push({stop:c,colour:d(t)}),c=void 0}return e},!0);return s.containsError(l)?l:void 0!==c?s.create("macrocall","This gradient has a colour-stop percent without a colour."):a.create(t,u)},[Number,m(v(S,r))])("stripes",function(e,t,n){for(var r=arguments.length,i=Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];(t=C(t)%360)<0&&(t+=360);var s=0,c=[];return i.forEach(function(e){c.push({stop:s,colour:d(e)}),s+=n,c.push({stop:s,colour:d(e)})}),a.create(t,c,!0)},[Number,k,r,m(r)])("hooks-named",function(e,t){return t?o.create({type:"name",data:t}):s.create("datatype","(hooks-named:) can't be given an empty string.")},[String])("cond",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=2){var n=arguments.length<=t+1?void 0:arguments[t+1];if(t===(arguments.length<=1?0:arguments.length-1)-1||s.containsError(n))return n;if("boolean"!=typeof n)return s.create("datatype","(cond:)'s "+u(t+1)+" value is "+f(n)+", but should be a boolean.");if(n)return arguments.length<=t+1+1?void 0:arguments[t+1+1]}return s.create("macrocall","An odd number of values must be given to (cond:), not "+(arguments.length<=1?0:arguments.length-1),"(cond:) must be given one or more pairs of booleans and values, as well as one final value.")},[Boolean,O,m(O)]),{weekday:[function(){return["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur"][(new Date).getDay()]+"day"},null],monthday:[function(){return(new Date).getDate()},null],currenttime:[function(){var e=new Date,t=e.getHours()<12;return(e.getHours()%12||12)+":"+((e.getMinutes()<10?"0":"")+e.getMinutes())+" "+(t?"A":"P")+"M"},null],currentdate:[function(){return(new Date).toDateString()},null],min:[A,m(Number)],max:[j,m(Number)],abs:[Math.abs,Number],sign:[Math.sign,Number],sin:[Math.sin,Number],cos:[Math.cos,Number],tan:[Math.tan,Number],floor:[E,Number],round:[C,Number],trunc:[function(e){return e>0?E(e):_(e)},Number],ceil:[_,Number],pow:[N(Math.pow),[Number,Number]],exp:[Math.exp,Number],sqrt:[N(Math.sqrt),Number],log:[N(Math.log),Number],log10:[N(Math.log10),Number],log2:[N(Math.log2),Number],random:[function(e,t){var n=void 0,r=void 0;return t?(n=A(e,t),r=j(e,t)):(n=0,r=e),r+=1,~~(Math.random()*(r-n))+n},[parseInt,e.TypeSignature.optional(parseInt)]],either:[function(){var e;return e=~~(Math.random()*arguments.length),arguments.length<=e?void 0:arguments[e]},m(O)],nth:[function(e){var t;return e<=0?s.create("datatype","(nth:)'s first value should be a positive whole number, not "+e):(t=(e-1)%(arguments.length<=1?0:arguments.length-1)+1,arguments.length<=t?void 0:arguments[t])},[parseInt,m(O)]],"":function(){var t=this;Object.keys(this).forEach(function(n){if(n){var r=t[n][0],a=t[n][1];e.add(n,function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return r.apply(void 0,n)},a)}})}}[""]()}),define("macrolib/commands",["jquery","macros","utils","state","passages","renderer","engine","internaltypes/twineerror","internaltypes/twinenotifier","datatypes/assignmentrequest","datatypes/hookset","datatypes/codehook","datatypes/lambda","datatypes/colour","datatypes/gradient","internaltypes/varref","datatypes/typedvar","datatypes/varbind","utils/operationutils","utils/renderutils"],function(e,t,n,r,a,i,o,s,c,u,l,p,f,d,h,y,m,g,v,b){var w=v.printBuiltinValue,T=v.objectName,S=v.clone,x=v.toSource,k=b.dialog,O=b.geomParse,j=b.geomStringRegExp,A=t.TypeSignature,C=A.Any,E=A.Everything,_=A.rest,N=A.either,P=A.optional,I=A.zeroOrMore,M=A.positiveInteger,D=A.positiveNumber,R=Object.assign,L=Math.floor,F=Math.ceil,q=Math.abs,V=Math.max,H=Math.min,z=e.noop;function W(e){return"("+e+" "+o.options.ifid+") "}["set","put","unpack"].forEach(function(e){return t.add(e,function(t){for(var n=0;n<(arguments.length<=1?0:arguments.length-1);n+=1){var r=arguments.length<=n+1?void 0:arguments[n+1];if("into"===r.operator&&"set"===e)return s.create("macrocall","Please say 'to' when using the (set:) macro.");if("to"===r.operator&&"set"!==e)return s.create("macrocall","Please say 'into' when using the (put:) or (unpack:) macro.");if((y.isPrototypeOf(r.dest)||m.isPrototypeOf(r.dest))===("unpack"===e))return s.create("macrocall","unpack"===e?"Please use the (unpack:) macro with arrays, datamaps or (p:) patterns containing variables to the right of 'into'.":"Please use the ("+e+":) macro with just single variables and typed variables to the "+("set"===e?"left of 'to'.":"right of 'into'."));var a=r.set();if(s.containsError(a))return a}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a ("+e+":) operation",TwineScript_ObjectName:"a ("+e+":) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return o.options.debug,""}}},[_(u)])}),t.add("move",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=arguments.length<=t+1?void 0:arguments[t+1];if("into"!==n.operator)return s.create("macrocall","Please say 'into' when using the (move:) macro.");var r=n.set(!0);if(s.containsError(r))return r}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a (move:) operation",TwineScript_ObjectName:"a (move:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return o.options.debug,""}}},[_(u)]),t.addCommand("display",function(e){if(!a.hasValid(e))return s.create("macrocall","I can't (display:) the passage '"+e+"' because it doesn't exist.")},function(e,t,r){return R(e,{source:n.unescape(a.get(r).get("source"))})},[String])("print",z,function(e,t,n){return R(e,{source:w(n)})},[C])(["verbatim-print","v6m-print"],z,function(e,t,n){return R(e,{verbatim:!0,source:w(n)})},[C])(["verbatim-source","v6m-source"],function(e){if(e&&"command"===e.TwineScript_TypeID&&!e.TwineScript_ToSource)return s.create("datatype","I can't construct the source code of a command created by a custom macro.")},function(e,t,n){return R(e,{verbatim:!0,source:w(x(n))})},[C])("go-to",function(e){if(!a.hasValid(e))return s.create("macrocall","I can't (go-to:) the passage '"+e+"' because it doesn't exist.")},function(e,t,n){return requestAnimationFrame(function(){return o.goToPassage(n,{transition:e.data.passageT8n})}),{blocked:!0}},[String])("undo",z,function(e){return r.pastLength<1?s.create("macrocall","I can't (undo:) on the first turn."):(requestAnimationFrame(function(){return o.goBack({transition:e.data.passageT8n})}),{blocked:!0})},[]),n.onStartup(function(){return e(n.storyElement).on("click.icon","tw-icon",function(t){var n=e(this),a=n.data("clickEvent"),i=n.attr("alt");a&&a(n),"Undo"===i&&(t.stopPropagation(),o.goBack()),"Redo"===i&&(t.stopPropagation(),o.goForward()),"Fullscreen"===i&&(t.stopPropagation(),o.toggleFullscreen()),"Restart"===i&&(r.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload())})}),[["Undo","&#8630;",function(){return r.pastLength>0}],["Redo","&#8631;",function(){return r.futureLength>0}],["Fullscreen","&#9974;",function(){return document.fullscreenEnabled||document.msFullscreenEnabled}],["Restart","&#10226;",Object]].forEach(function(e){var n=_slicedToArray(e,3),r=n[0],a=n[1],i=n[2];t.addCommand("icon-"+r.toLowerCase(),function(e,t){if("string"==typeof e&&"string"==typeof t){var n=[].concat(_toConsumableArray(e)).length,a=[].concat(_toConsumableArray(t)).length;if(n>1&&a>1)return s.create("datatype","One of the two strings given to (icon-"+r.toLowerCase()+":) should be 1 character long, for its icon.");if(1===n&&1===a)return s.create("datatype","One of the two strings given to (icon-"+r.toLowerCase()+":) should be 2 or more characters long, for its label.")}},function(e,t,n,o){if("string"==typeof o&&1===[].concat(_toConsumableArray(o)).length||"string"==typeof n&&[].concat(_toConsumableArray(n)).length>1){var s=[o,n];n=s[0],o=s[1]}return R(e,{source:'<tw-icon tabindex=0 alt="'+r+'" '+(o?'data-label="'+o.replace('"',"&quot;")+'"':"")+' title="'+r+'" '+(i()?"":'style="visibility:hidden"')+">"+(n||a)+"</tw-icon>"})},[P(String),P(String)])}),t.addCommand("icon-counter",function(e,t,n){var r=" label string given to (icon-counter:) can't be empty or only whitespace.";return t&&t.trim()?"string"!=typeof n||n.trim()?void 0:s.create("datatype","The 2nd "+r):s.create("datatype","The 1st "+r)},function(e,t,r,a,i){e.attr.push({"data-2bind":!0}),e.data.twoWayBindEvent=function(t,n,o){if(r.varRef.matches(n,o)){var s=r.varRef.get();if("number"==typeof s)e.target.children("tw-icon").text(s>0?L(s):F(s)).attr("data-label",1!==q(s)&&void 0!==i?i:a)}};var o=r.varRef.get();return"number"!=typeof o?s.create("datatype","(icon-counter:) can only be bound to a variable holding a number, not "+T(o)+"."):R(e,{source:'<tw-icon data-label="'+n.escape(1!==q(o)&&void 0!==i?i:a)+'">'+(o>0?L(o):F(o))+"</tw-icon>"})},[g,String,P(String)]),t.addCommand("meter",function(e,t,n,r){return"string"!=typeof r||r.trim()?-1===n.search(j)||!n.includes("=")&&n.length>1?s.create("datatype",'The (meter:) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not '+JSON.stringify(n)+"."):void 0:s.create("datatype","The label string given to (meter:) can't be empty or only whitespace.")},function(e,t,n,r,a,i,o){i&&"string"!=typeof i&&(o=i,i=void 0),o||(o=d.create({h:0,s:0,l:.5,a:.5})),d.isPrototypeOf(o)&&(o=h.create(90,[{colour:o,stop:0},{colour:o,stop:1}]));var c=O(a),u=c.marginLeft,l=c.size,p=u>0&&Math.ceil(u+l)<100,f=function(e){var t=V(0,H(1,e/r)),n=o.repeating?o:o.multiply(r/e);return"height:100%;background-repeat:no-repeat;background-image:"+(p?R(n,n.repeating?{}:{angle:270}).toLinearGradientString()+", ":"")+R(n,n.repeating?{}:{angle:p||0===u?90:270}).toLinearGradientString()+";background-size:"+(p?Array(2).fill(50*t+"%"):100*t+"%")+";background-position-x:"+(p?-100/(2-t)+100+"%,"+100/(2-t)+"%":0===u?"left":"right")+";text-align:"+(p?"center":0===u?"left":"right")};e.styles.push({"margin-left":u+"%",width:l+"%",height:"1.5em",display:"block"}),e.attr.push({"data-2bind":!0});var y=i&&t.stackTop.tempVariables;e.data.twoWayBindEvent=function(t,r,a){if(n.varRef.matches(r,a)){var o=n.varRef.get();if("number"==typeof o){var s=e.target.children("tw-meter");s.attr("style",f(o)),i&&e.section.renderInto("",null,{source:i,target:s,append:"replace",transitionDeferred:!1},y)}}};var m=n.varRef.get();return"number"!=typeof m?s.create("datatype","(meter:) can only be bound to a variable holding a number, not "+T(m)+"."):R(e,{source:'<tw-meter style="'+f(m)+'">'+(i||"")+"</tw-meter>"})},[g,D,String,P(N(String,d,h)),P(N(d,h))]),[["cycling-link"],["seq-link","sequence-link"]].forEach(function(e,n){return t.addCommand(e,function(){return""===(arguments.length<=0?void 0:arguments[0])?s.create("datatype","The first string in a ("+e[0]+":) can't be empty."):arguments.length<=(g.isPrototypeOf(arguments.length<=0?void 0:arguments[0])?2:1)?s.create("datatype","I need two or more strings to "+(n?"sequence":"cycle")+" through, not just '"+(t=arguments.length-1,arguments.length<=t?void 0:arguments[t])+"'."):void 0;var t},function(e,t){for(var r=arguments.length,a=Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];var o=void 0;g.isPrototypeOf(a[0])&&(o=a.shift());var c=0;if(o&&"two way"===o.bind){e.attr.push({"data-2bind":!0});var u=a.indexOf(o.varRef.get());u>-1&&(c=u)}var l=t.stackTop.tempVariables;function p(t,r){var i=c>=a.length-1&&n,u=""===a[c]?"":i?a[c]:"<tw-link>"+a[c]+"</tw-link>";if(i&&(e.data.clickEvent=void 0),o&&!r){var p=o.set(a[c]);if(s.containsError(p))return void t.replaceWith(p.render(a[c]))}var f=R({},e,{source:u,transitionDeferred:!1});e.section.renderInto("",null,f,l)}a[c]&&(e.data.clickEvent=function(e){c=(c+1)%a.length,p(e,!1)})&&(e.data.twoWayBindEvent=function(e,t,n){if(o.varRef.matches(t,n)){var r=o.varRef.get(),i=a.indexOf(r);i>-1&&i!==c&&(c=i,p(e,!0))}});var f="<tw-link>"+a[c]+"</tw-link>";if(o){var d=o.set(a[c]);if(s.containsError(d))return d}return R(e,{source:f,append:"replace",transitionDeferred:!0})},[N(g,String),_(String)])}),n.onStartup(function(){return e(n.storyElement).on("change.dropdown-macro","select",function(){var t=e(this),n=t.closest("tw-expression, tw-hook").data("dropdownEvent");n&&n(t)})}),t.addCommand("dropdown",function(e){var t;return""===(arguments.length<=1?void 0:arguments[1])||""===(t=(arguments.length<=1?0:arguments.length-1)-1+1,arguments.length<=t?void 0:arguments[t])?s.create("datatype","The first or last strings in a (dropdown:) can't be empty.","Because empty strings create separators within (dropdown:)s, having them at the start or end doesn't make sense."):(arguments.length<=1?0:arguments.length-1)<=1?s.create("datatype","I need two or more strings to create a (dropdown:) menu, not just "+(arguments.length<=1?0:arguments.length-1)+"."):void 0},function(t,r,a){for(var i=arguments.length,o=Array(i>3?i-3:0),c=3;c<i;c++)o[c-3]=arguments[c];var u=0;if("two way"===a.bind){t.attr.push({"data-2bind":!0});var l=o.indexOf(a.varRef.get());l>-1&&(u=l)}var p=Math.max.apply(Math,_toConsumableArray(o.map(function(e){return[].concat(_toConsumableArray(e)).length}))),f="<select>"+o.map(function(e,t){return"<option"+(t===u?" selected":"")+(""===e?" disabled":"")+">"+n.escape(e||"\u2500".repeat(p))+"</option>"}).join("\n")+"</select>";t.data.dropdownEvent=function(e){var t=e.val(),n=a.set(t);s.containsError(n)&&e.replaceWith(n.render(t))},t.data.twoWayBindEvent=function(e,t,n){if(a.varRef.matches(t,n)){var r=a.varRef.get(),i=o.indexOf(r);i>-1&&i!==u&&(e.find("select").val(r),u=i)}},t.styles.push({"background-color":function(){return n.parentColours(e(this)).backgroundColour}});var d=a.set(o[u]);return s.containsError(d)?d:R(t,{source:f,append:"replace"})},[g,String,_(String)]),n.onStartup(function(){return e(n.storyElement).on("input.checkbox-macro","input[type=checkbox]",function(){var t=e(this),n=t.closest("tw-expression").data("checkboxEvent");n&&n(t)})});var $=1;t.addCommand("checkbox",function(){},function(e,t,n,r){var a=!1,i="checkbox-"+ ++$;if("two way"===n.bind){e.attr.push({"data-2bind":!0});var o=n.varRef.get();"boolean"==typeof o&&(a=o),e.data.twoWayBindEvent=function(e,t,r){if(n.varRef.matches(t,r)){var a=n.varRef.get();"boolean"==typeof a&&e.children("input[type=checkbox]").prop("checked",a)}}}return e.data.checkboxEvent=function(e){var t=e.is(":checked"),r=n.set(t);s.containsError(r)&&e.replaceWith(r.render(""))},R(e,{source:'<input id="'+i+'" type="checkbox" '+(a?"checked":"")+'><label for="'+i+'">'+r+"</label>",append:"replace"})},[g,String]),n.onStartup(function(){return e(document).on("fullscreenchange",function(){e("input[type=checkbox][id^=fullscreen]",n.storyElement).each(function(t,n){(e(n).closest("tw-expression").data("fullscreenEvent")||Object)(n)})})}),t.addCommand("checkbox-fullscreen",function(){},function(t,n,r){var a="fullscreenCheckbox-"+ ++$;return t.data.fullscreenEvent=function(t){return e(t).prop("checked",!(!document.fullscreenElement&&!document.msFullscreenElement))},t.data.checkboxEvent=function(){return o.toggleFullscreen()},R(t,{source:'<input id="'+a+'" type="checkbox" '+(document.fullscreenEnabled||document.msFullscreenEnabled?" ":"disabled ")+(document.fullscreenElement||document.msFullscreenElement?"checked":"")+'><label for="'+a+'">'+r+"</label>",append:"replace"})},[String]),n.onStartup(function(){return e(n.storyElement).on("input.input-box-macro","textarea",function(){var t=e(this),n=t.closest("tw-expression").data("inputBoxEvent");n&&n(t)})}),["input-box","force-input-box"].forEach(function(e){return t.addCommand(e,function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=g.isPrototypeOf(n[0]),i="number"==typeof n[1+a],o="string"==typeof n[1+a+i],c=n[+a];if("string"!=typeof c||-1===c.search(j)||!c.includes("=")&&c.length>1)return s.create("datatype","The ("+e+':) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not '+JSON.stringify(c)+".");if("force-input-box"===e&&!o)return s.create("datatype","The ("+e+":) macro requires a string of text to forcibly input.");var u=1+a+i+o;return n.length>u?s.create("datatype","An incorrect combination of values was given to this ("+e+":) macro."):void 0},function(t,r){for(var a=arguments.length,i=Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=arguments[o];var c="force-input-box"===e,u=g.isPrototypeOf(i[0]),l="number"==typeof i[1+u],p=u&&i[0],f=l?i[1+u]:3,d=O(i[+u]),h=d.marginLeft,y=d.size,m="string"==typeof i[1+u+l]?i[1+u+l]:"",v=c?"":m;if("two way"===p.bind){t.attr.push({"data-2bind":!0});var b=p.varRef.get();if("string"==typeof b){v=c?m.slice(0,b.length):b;var w=p.set(v);if(s.containsError(w))return w}t.data.twoWayBindEvent=function(e,t,n){if(p.varRef.matches(t,n)){var r=p.varRef.get();"string"==typeof r&&e.find("textarea").val(c?m.slice(0,r.length):r)}}}else if(p){var T=p.set(c?"":m);if(s.containsError(T))return T}!c&&p&&(t.data.inputBoxEvent=function(e){var t=e.val(),n=p.set(t);s.containsError(n)&&e.replaceWith(n.render(""))});var S='<textarea style="width:100%" rows='+f+">"+n.escape(v)+"</textarea>";if(c){var x=Array.from(m);t.data.inputBoxEvent=function(e){var t=e.val().length,n=x.slice(0,t).join("");if(e.val(n),p){var r=p.set(n);s.containsError(r)&&e.replaceWith(r.render(""))}return!0}}return t.styles.push({display:"block","margin-left":h+"%",width:y+"%","border-style":function(){return this.style.borderStyle||"solid"}}),R(t,{source:S,append:"replace"})},[N(g,String),P(N(M,String)),P(N(M,String)),P(String)])}),["show","rerun"].forEach(function(n){return t.addCommand(n,z,function(t,r){for(var a=arguments.length,i=Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=arguments[o];return i.forEach(function(a){return a.forEach(r,function(a){var i=a.data("hidden");if(void 0!==i!=("rerun"===n))if(a.removeData("hidden"),i instanceof e)a.empty().append(i);else{var o=a.data("tempVariables");r.renderInto("",null,R({},t,{append:"replace",source:a.data("originalSource")||"",target:a}),o&&Object.create(o))}})}),t},[_(l)])});var B=function(e){return["I can't use a dialog macro in "+e+".","Please rewrite this without putting such macros here."]};t.addCommand("hide",z,function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach(function(t){return t.forEach(e,function(e){Boolean(e.data("hidden"))||e.data("hidden",e.contents().detach())})})},[_(l)],!1)("stop",z,z,[],!1)("load-game",z,function(e,t){var n=localStorage.getItem(W("Saved Game")+t);if(!n)return s.create("saving","I can't find a save slot named '"+t+"'!");var a=r.deserialise(e,n);if(a instanceof Error){var i=k({message:"Sorry to interrupt... The story tried to load saved data, but there was a problem.\n"+a.message+"\n\nThat data might have been saved from a different version of this story. Should I delete it?\n(Type 'delete' and choose Yes to delete it.)\n\nEither way, the story will now continue without loading the data.",defaultValue:"",buttons:[{name:"Yes",confirm:!0,callback:function(){"delete"===i.find("input").last().val()&&localStorage.removeItem(W("Saved Game")+t),e.unblock("")}},{name:"No",cancel:!0,callback:function(){return e.unblock()}}]});return{blocked:i}}requestAnimationFrame(o.showPassage.bind(o,r.passage,!1))},[String],!1)("mock-visits",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!o.options.debug)return s.create("operation","(mock-visits:) cannot be used outside of debug mode.","This macro is not meant to be used outside of debugging your story.");var r=t.find(function(e){return!a.hasValid(e)});return r?s.create("datatype","I can't mock-visit '"+r+"' because no passage with that name exists."):void 0},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];r.mockVisits=S(n)},[_(String)],!1)(["dialog","alert"],function(e,t){for(var r=arguments.length,a=Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];if(g.isPrototypeOf(e)){if("two way"===e.bind)return s.create("datatype","(dialog:) shouldn't be given two-way bound variables.");if(void 0===t)return s.create("datatype","(dialog:) needs a message string to display.")}else void 0!==t&&a.unshift(t);var o=a.findIndex(function(e){return""===e});if(o>-1)return s.create("datatype","(dialog:)'s "+n.nth(o+1)+" link text shouldn't be an empty string.")},function(e,t,n,r){for(var a=arguments.length,i=Array(a>4?a-4:0),o=4;o<a;o++)i[o-4]=arguments[o];return g.isPrototypeOf(n)||(void 0!==r&&i.unshift(r),r=n,n=void 0),i.length||(i=["OK"]),{blocked:k({section:t,message:r,cd:e,buttons:i.map(function(e){return{name:e,callback:function(){t.unblock(n&&n.set(e)||"")}}})})}},[N(g,String),I(String)])("open-url",z,function(e,t){window.open(t,"")},[String],!1)(["restart","reload"],z,function(){if(r.pastLength<1)return s.create("infinite","I mustn't (restart:) the story in the starting passage.");r.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload()},[],!1)("goto-url",z,function(e,t){window.location.assign(t)},[String],!1)("ignore",z,z,[I(E)])("assert-exists",function(e){if(""===e)return s.create("datatype","(assert-exists:) mustn't be given an empty string.")},function(e,t,n){var r=0;return("string"==typeof n?l.create({type:"string",data:n}):n).forEach(t,function(){++r}),r?e:s.create("assertion","I didn't see any "+("string"==typeof n?"text occurrences of":"hooks matching")+" "+x(n)+" in this passage.")},[N(l,String)]),t.add("assert",function(e,t){return t?{TwineScript_TypeID:"instant",TwineScript_TypeName:"an (assert:) operation",TwineScript_ObjectName:"an (assert:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}:R(s.create("assertion","An assertion failed: "),{appendTitleText:!0})},[Boolean])("save-game",function(e,t,n){if(n=n||"",!r.hasStorage)return!1;var a=r.serialise();if(s.containsError(a))return a;if(!1===a)return!1;try{return localStorage.setItem(W("Saved Game")+t,a),localStorage.setItem(W("Saved Game Filename")+t,n),!0}catch(e){return!1}},[String,P(String)])("prompt",function(e,t,n,r,a){if(e.stackTop&&e.stackTop.evaluateOnly)return s.create.apply(s,["macrocall"].concat(_toConsumableArray(B(e.stackTop.evaluateOnly))));if(""===a)return s.create("datatype","The text for (prompt:)'s confirm link can't be blank.");var i=k({section:e,message:t,defaultValue:n,buttons:[{name:a||"OK",confirm:!0,callback:function(){return e.unblock(i.find("input").last().val())}}].concat(""===r?[]:{name:r||"Cancel",cancel:!0,callback:function(){return e.unblock(n)}})});e.stackTop.blocked=i,setTimeout(function(){return i.find("input").last().focus()},100)},[String,String,P(String),P(String)])("confirm",function(e,t,n,r){if(e.stackTop&&e.stackTop.evaluateOnly)return s.create.apply(s,["macrocall"].concat(_toConsumableArray(B(e.stackTop.evaluateOnly))));if(""===r)return s.create("datatype","The text for (confirm:)'s confirm link can't be blank.");var a=k({section:e,message:t,defaultValue:!1,buttons:[{name:r||"OK",confirm:!0,callback:function(){return e.unblock(!0)}}].concat(""===n?[]:{name:n||"Cancel",cancel:!0,callback:function(){return e.unblock(!1)}})});e.stackTop.blocked=a},[String,P(String),P(String)])("page-url",function(){return window.location.href},[]),i.options.blockerMacros.push("prompt","confirm")}),define("macrolib/datastructures",["jquery","utils","utils/naturalsort","macros","utils/operationutils","state","engine","passages","datatypes/lambda","datatypes/datatype","datatypes/typedvar","internaltypes/varref","internaltypes/twineerror"],function(e,t,n,r,a,i,o,s,c,u,l,p,f){var d=t.shuffled,h=t.permutations,y=a.objectName,m=a.subset,g=a.collectionType,v=a.isValidDatamapName,b=a.is,w=a.unique,T=a.clone,S=a.range,x=r.TypeSignature,k=x.optional,O=x.rest,j=x.either,A=x.zeroOrMore,C=x.Any,E=x.nonNegativeInteger;r.add(["a","array"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n},A(j(l,C)))("range",function(e,t,n){return S(t,n)},[parseInt,parseInt])("subarray",function(e,t,n,r){return m(t,n,r)},[Array,parseInt,parseInt])("reversed",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reverse().map(T)},A(C))("shuffled",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return d.apply(void 0,n).map(T)},[C,O(C)])("sorted",function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return r.sort(n("en"))},[j(Number,String),O(j(Number,String))])("rotated",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return 0===(t*=-1)?f.create("macrocall","I can't rotate these values by 0 positions."):Math.abs(t)>=r.length?f.create("macrocall","I can't rotate these "+r.length+" values by "+t+" positions."):r.slice(t).concat(r.slice(0,t)).map(T)},[parseInt,C,O(C)])("rotated-to",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var i=t.filter(e,r);if(f.containsError(i))return i;if(!i.length)return f.create("macrocall","None of these "+r.length+" values matched the lambda, so I can't rotate them.");var o=r.indexOf(i[0]);return r.slice(o).concat(r.slice(0,o)).map(T)},[c.TypeSignature("where"),C,O(C)])("repeated",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];for(var i=[];t-- >0;)i.push.apply(i,r);return i.map(T)},[E,O(C)])("interlaced",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=Math.min.apply(Math,_toConsumableArray(n.map(function(e){return e.length}))),i=[],o=0;o<a;o+=1)for(var s=0;s<n.length;s+=1)i.push(T(n[s][o]));return i},[Array,O(Array)])("permutations",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.length?h.apply(void 0,n):[]},[A(C)]),r.add("altered",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return r.map(function(n,r){return t.apply(e,{loop:n,pos:r+1})})},[c.TypeSignature("via"),A(C)])("find",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return t.filter(e,r)},[c.TypeSignature("where"),A(C)])(["all-pass","pass"],function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var i=t.filter(e,r);return f.containsError(i)||i.length===r.length},[c.TypeSignature("where"),A(C)])("some-pass",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var i=t.filter(e,r);return f.containsError(i)||i.length>0},[c.TypeSignature("where"),A(C)])("none-pass",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var i=t.filter(e,r);return f.containsError(i)||0===i.length},[c.TypeSignature("where"),A(C)])("folded",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return"where"in t&&(r=t.filter(e,r)),f.containsError(r)||r.reduce(function(n,r,a){return t.apply(e,{making:n,loop:r,pos:a+1})})},[j(c.TypeSignature("where","via","making"),c.TypeSignature("via","making")),O(C)]),r.add("datanames",function(e,t){return Array.from(t.keys()).sort(n("en"))},[Map])("datavalues",function(e,t){return Array.from(t.entries()).sort(n("en",function(e){return String(e[0])})).map(function(e){return T(e[1])})},[Map])("dataentries",function(e,t){return Array.from(t.entries()).sort(function(e,t){return[e[0],t[0]].sort(n("en"))[0]===e[0]?-1:1}).map(function(e){return new Map([["name",e[0]],["value",T(e[1])]])})},[Map])("history",function(e,t){var n=i.mockVisits.concat(i.pastPassageNames());if(!t)return n;var r=t.filter(e,n.map(function(e){return s.get(e)}));return f.containsError(r)?r:r.map(function(e){return e.get("name")})},[k(c.TypeSignature("where"))])("passage",function(e,t){return T(s.get(t||i.passage))||f.create("macrocall","There's no passage named '"+t+"' in this story.")},[k(String)])("passages",function(e,t){var r=n("en"),a=[].concat(_toConsumableArray(s.values())).map(function(e){return T(e)}),i=t?t.filter(e,a):a,o=f.containsError(i);return o||i.sort(function(e,t){return r(e.get("name"),t.get("name"))})},[k(c.TypeSignature("where"))])("open-storylets",function(e,t){if(e.stackTop.evaluateOnly)return f.create("macrocall","(open-storylets:) can't be used in "+e.stackTop.evaluateOnly+".");var n=s.getStorylets(e,t),r=f.containsError(n);return r||n.map(T)},[k(c.TypeSignature("where"))])("savedgames",function(){function e(e){return"("+e+" "+o.options.ifid+") "}var t=0,n=void 0,r=new Map;do{if(!i.hasStorage)break;n=localStorage.key(t),t+=1;var a=e("Saved Game");n&&n.startsWith(a)&&(n=n.slice(a.length),r.set(n,localStorage.getItem(e("Saved Game Filename")+n)))}while(n);return r},[])(["datamap","dm"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=void 0,i=new Map,o=n.reduce(function(e,t){var n=void 0;if(f.containsError(e))return e;if(void 0===a)a=t;else{if(n=f.containsError(v(i,a)))return n;if(i.has(a))return f.create("macrocall","You used the same data name ("+y(a)+") twice in the same (datamap:) call.");i.set(a,T(t)),a=void 0}return e},!0);return f.containsError(o)?o:void 0!==a?f.create("macrocall","This datamap has a data name without a value."):i},A(j(l,C)))(["dataset","ds"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Set(n.filter(w).map(T))},A(C))("count",function e(t,n){for(var r=arguments.length,a=Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];if(a.length>1){var o,s=a.map(function(r){return e(t,n,r)});return(o=f.containsError(s))?o:s.reduce(function(e,t){return e+t},0)}var c=a[0];switch(g(n)){case"dataset":case"datamap":return f.create("macrocall","(count:) shouldn't be given a datamap or dataset.","You should use the 'contains' operator instead. For instance, write: $variable contains 'value'.");case"string":return"string"!=typeof c?f.create("macrocall",y(n)+" can't contain  "+y(c)+" because it isn't also a string."):c?n.split(c).length-1:0;case"array":return n.reduce(function(e,t){return e+b(t,c)},0);default:return f.create("macrocall",y(n)+" can't contain values, let alone "+y(c)+".")}},[C,O(C)])}),define("macrolib/stylechangers",["jquery","macros","utils","utils/renderutils","datatypes/colour","datatypes/hookset","datatypes/gradient","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/twineerror"],function(e,t,n,r,a,i,o,s,c,u,l){var p=r.geomParse,f=r.geomStringRegExp,d=Object.assign,h=t.TypeSignature,y=h.either,m=h.wrapped,g=h.optional,v=h.Any,b=h.Everything,w=h.zeroOrMore,T=h.rest,S=h.insensitiveSet,x=h.positiveNumber,k=h.positiveInteger,O=h.nonNegativeNumber,j=h.percent,A=[m(Boolean,'If you gave a number, you may instead want to check that the number is not 0. If you gave a string, you may instead want to check that the string is not "".')];n.onStartup(function(){return e(n.storyElement).on("mouseenter.hover-macro","[hover=false]",function(){var t=e(this),n=t.data("hoverChanger");t.data({mouseoutStyle:t.attr("style")||""}),u.create({target:t},n).update(),t.attr("hover",!0)}).on("mouseleave.hover-macro","[hover=true]",function(){var t=e(this),n=t.data("mouseoutStyle");t.attr("style",n).removeData("mouseoutStyle").attr("hover",!1)})});var C,E,_=S("instant","dissolve","fade","rumble","shudder","pulse","zoom","flicker","slideleft","slideright","slideup","slidedown","fadeleft","faderight","fadeup","fadedown","blur"),N=S("dotted","dashed","solid","double","groove","ridge","inset","outset","none");t.addChanger("if",function(e,t){return s.create("if",[t])},function(e,t){return e.enabled=e.enabled&&t},A)("unless",function(e,t){return s.create("unless",[t])},function(e,t){return e.enabled=e.enabled&&!t},A)("elseif",function(e,t){return"lastHookShown"in e.stack[0]?s.create("elseif",[!1===e.stack[0].lastHookShown&&!!t]):l.create("macrocall","There's no (if:) or something else before this to do (else-if:) with.")},function(e,t){return e.enabled=e.enabled&&t},A)("else",function(e){return"lastHookShown"in e.stack[0]?s.create("else",[!1===e.stack[0].lastHookShown]):l.create("macrocall","There's nothing before this to do (else:) with.")},function(e,t){return e.enabled=e.enabled&&t},null)("hidden",function(){return s.create("hidden")},function(e){return e.enabled=!1},null)(["verbatim","v6m"],function(){return s.create("verbatim")},function(e){return e.verbatim=!0},null)("live",function(e,t){return s.create("live",[t])},function(e,t){e.enabled=!1,e.data.live={delay:t}},g(Number))("event",function(e,t){return s.create("event",[t])},function(e,t){e.enabled=!1,e.data.live={event:t}},c.TypeSignature("when"))("more",function(){return s.create("more")},function(e){e.enabled=!1,e.data.live={event:{when:!0,filter:function(e){return 0!==e.eval("Operations").Identifiers.exits?[]:[!0]}}}},null)("after",function(e,t,n){return s.create("after",[t].concat(void 0!==n?[n]:[]))},function(e,t,r){e.enabled=!1,e.data.live={event:{when:!0,filter:function(e){return n.anyInputDown()&&r&&(t-=r),e.eval("Operations").Identifiers.time>t?[!0]:[]}}}},[x,g(O)])("hook",function(e,t){return t?s.create("hook",[t]):l.create("datatype","(hook:) names can't be empty strings.")},function(e,t){return e.attr.push({name:t})},[String])(["for","loop"],function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return t.loop?s.create("for",[t].concat(r)):l.create("datatype","The lambda provided to (for:) must refer to a temp variable, not just 'it'.")},function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var i,o=t.filter(e.section,r);if(i=l.containsError(o))return i;e.loopVars[t.loop.getName()]=o||[]},[c.TypeSignature("where"),w(v)])(["transition","t8n"],function(e,t){return s.create("transition",[n.insensitiveName(t)])},function(t,r){return t.transition=r,"zoom"===r&&(t.transitionOrigin=function(){var t=e(this).offset(),r=t.left,a=t.top;return n.mouseCoords.x-r+"px "+(n.mouseCoords.y-a)+"px"}),t},[_])(["transition-time","t8n-time"],function(e,t){return s.create("transition-time",[t])},function(e,t){return e.transitionTime=t,e.data.passageT8n=d(e.data.passageT8n||{},{time:t}),e},[x])(["transition-delay","t8n-delay"],function(e,t){return s.create("transition-delay",[t])},function(e,t){return e.transitionDelay=t,e},[O])(["transition-skip","t8n-skip"],function(e,t){return s.create("transition-skip",[t])},function(e,t){return e.transitionSkip=t,e},[x])(["transition-depart","t8n-depart"],function(e,t){return s.create("transition-depart",[n.insensitiveName(t)])},function(t,r){return t.data.passageT8n=d(t.data.passageT8n||{},{depart:r}),"zoom"===r&&(t.data.passageT8n.departOrigin=function(){var t=e(this).offset(),r=t.left,a=t.top;return n.mouseCoords.x-r+"px "+(n.mouseCoords.y-a)+"px"}),t},[_])(["transition-arrive","t8n-arrive"],function(e,t){return s.create("transition-arrive",[n.insensitiveName(t)])},function(t,r){return t.data.passageT8n=d(t.data.passageT8n||{},{arrive:r}),"zoom"===r&&(t.data.passageT8n.arriveOrigin=function(){var t=e(this),r=t.offset(),a=r.left,i=r.top,o=t.height();return{"transform-origin":100*(n.mouseCoords.x-a)/t.width()+"% "+100*(n.mouseCoords.y-i)/o+"%",height:o+"px"}}),t},[_])("button",function(){return s.create("button",[])},function(e){return e.attr.push({class:function(){return this.className+(this.classList.contains("enchantment-button")?"":" ".repeat(this.className.length>0)+"enchantment-button")}}),e},[])(["border","b4r"],function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return s.create("border",r.map(n.insensitiveName))},function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return t.styles.push({display:function(){var t=e(this).css("display");return r.every(function(e){return"none"===e})||!t.includes("inline")?t:"inline-block"},"border-style":r.join(" "),"border-width":function(){return this.style.borderWidth||"2px"}}),t},[N].concat(_toConsumableArray(Array(3).fill(g(N)))))(["border-size","b4r-size"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.create("border-size",n)},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-width":n.map(function(e){return e+"px"}).join(" ")}),e},[O].concat(_toConsumableArray(Array(3).fill(g(O)))))("corner-radius",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.create("corner-radius",n)},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-radius":n.map(function(e){return e+"px"}).join(" "),padding:function(){return this.style.padding||n.map(function(e){return e+"px"}).join(" ")}}),e},[O].concat(_toConsumableArray(Array(3).fill(g(O)))))(["border-colour","b4r-colour","border-color","b4r-color"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.create("border-colour",n.map(function(e){return a.isPrototypeOf(e)?e.toRGBAString(e):e}))},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-color":n.join(" ")}),e},[y(String,a)].concat(_toConsumableArray(Array(3).fill(g(y(String,a))))))("opacity",function(e,t){return s.create("opacity",[t])},function(e,t){return e.styles.push({opacity:t})},[j])("font",function(e,t){return s.create("font",[t])},function(e,t){return e.styles.push({"font-family":t}),e},[String])("align",function(e,t){var n=void 0,r=t.indexOf("><");if(!/^(==+>|<=+|=+><=+|<==+>)$/.test(t))return l.create("datatype",'The (align:) macro requires an alignment arrow ("==>", "<==", "==><=" etc.) be provided, not "'+t+'"');if(~r){var a=Math.round(r/(t.length-2)*50);n=d({"text-align":"center","max-width":"50%"},25===a?{"margin-left":"auto","margin-right":"auto"}:{"margin-left":a+"%"})}else n="<"===t[0]&&">"===t.slice(-1)?{"text-align":"justify","max-width":"50%"}:t.includes(">")?{"text-align":"right"}:{"text-align":"left"};return n.display="inline-block",s.create("align",[n])},function(e,t){e.styles.push(t)},[String])(["text-colour","text-color","color","colour"],function(e,t){return s.create("text-colour",[t])},function(e,t){return a.isPrototypeOf(t)&&(t=t.toRGBAString(t)),e.styles.push({color:t}),e},[y(String,a)])(["text-size","size"],function(e,t){return s.create("text-size",[t])},function(e,t){return e.styles.push({"font-size":24*t+"px","line-height":36*t+"px"}),e},[O])("text-indent",function(e,t){return s.create("text-indent",[t])},function(e,t){return e.styles.push({"text-indent":t+"px",display:"inline-block"}),e},[O])(["text-rotate-z","text-rotate"],function(e,t){return s.create("text-rotate-z",[t])},function(t,n){return t.styles.push({display:"inline-block",transform:function(){var t=e(this).css("transform")||"";return"none"===t&&(t=""),t+" rotate("+n+"deg)"}}),t},[Number])("text-rotate-y",function(e,t){return s.create("text-rotate-y",[t])},function(t,n){return t.styles.push({display:"inline-block",transform:function(){var t=e(this).css("transform")||"";return"none"===t&&(t=""),t+" perspective(50vw) rotateY("+n+"deg)"}}),t},[Number])("text-rotate-x",function(e,t){return s.create("text-rotate-x",[t])},function(t,n){return t.styles.push({display:"inline-block",transform:function(){var t=e(this).css("transform")||"";return"none"===t&&(t=""),t+" perspective(50vw) rotateX("+n+"deg)"}}),t},[Number])(["background","bg"],function(e,t){return s.create("background",[t])},function(t,r){var i=void 0;return a.isPrototypeOf(r)?r=r.toRGBAString(r):o.isPrototypeOf(r)&&(r=r.toLinearGradientString(r)),i=a.isHexString(r)||a.isCSS3Function(r)?{"background-color":r}:r.startsWith("linear-gradient(")||r.startsWith("repeating-linear-gradient(")?{"background-image":r}:{"background-size":"cover","background-image":"url("+r+")"},t.styles.push(i,{display:function(){var t=e(this);return!t.children().length||n.childrenProbablyInline(t)?e(this).css("display"):"block"}}),t},[y(String,a,o)]).apply(void 0,_toConsumableArray((C={color:function(){return"transparent"}},E=d(Object.create(null),{none:{},bold:{"font-weight":"bold"},italic:{"font-style":"italic"},underline:{"text-decoration":"underline"},doubleunderline:{"text-decoration":"underline","text-decoration-style":"double"},wavyunderline:{"text-decoration":"underline","text-decoration-style":"wavy"},strike:{"text-decoration":"line-through"},doublestrike:{"text-decoration":"line-through","text-decoration-style":"double"},wavystrike:{"text-decoration":"line-through","text-decoration-style":"wavy"},superscript:{"vertical-align":"super","font-size":".83em"},subscript:{"vertical-align":"sub","font-size":".83em"},blink:{animation:"fade-in-out 1s steps(1,end) infinite alternate"},shudder:{animation:"shudder linear 0.1s 0s infinite"},mark:{"background-color":"hsla(60, 100%, 50%, 0.6)"},condense:{"letter-spacing":"-0.08em"},expand:{"letter-spacing":"0.1em"},outline:[{"text-shadow":function(){var t=e(this).css("color");return"-1px -1px 0 "+t+", 1px -1px 0 "+t+",-1px  1px 0 "+t+", 1px  1px 0 "+t}},{color:function(){return n.parentColours(e(this)).backgroundColour}}],shadow:{"text-shadow":function(){return"0.08em 0.08em 0.08em "+e(this).css("color")}},emboss:{"text-shadow":function(){return"0.04em 0.04em 0em "+e(this).css("color")}},smear:[{"text-shadow":function(){var t=e(this).css("color");return"0em   0em 0.02em "+t+",-0.2em 0em  0.5em "+t+", 0.2em 0em  0.5em "+t}},C],blur:[{"text-shadow":function(){return"0em 0em 0.08em "+e(this).css("color")}},C],blurrier:[{"text-shadow":function(){return"0em 0em 0.2em "+e(this).css("color")},"user-select":"none"},C],mirror:{display:"inline-block",transform:"scaleX(-1)"},upsidedown:{display:"inline-block",transform:"scaleY(-1)"},fadeinout:{animation:"fade-in-out 2s ease-in-out infinite alternate"},rumble:{animation:"rumble linear 0.1s 0s infinite"},sway:{animation:"sway linear 2.5s 0s infinite"},buoy:{animation:"buoy linear 2.5s 0s infinite"},fidget:{animation:function(){return"fidget step-end 60s "+60*-Math.random()+"s infinite"+(Math.random()<.5?" reverse":"")}}}),["text-style",function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return s.create("text-style",r.map(n.insensitiveName))},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0;a<n.length;a+=1)"none"===n[a]?e.styles=[]:e.styles=e.styles.concat(E[n[a]]);return e},[T(S.apply(void 0,_toConsumableArray(Object.keys(E))))]])))("collapse",function(){return s.create("collapse")},function(e){return e.attr.push({collapsing:!0}),e},[])("hover-style",function(e,t){var n=u.create(),r=(t.run(n),n.summary());return r+""=="styles"||r.every(function(e){return"styles"===e||"attr"===e})&&n.attr.every(function(e){return Object.keys(e)+""=="style"})?s.create("hover-style",[t]):l.create("datatype","The changer given to (hover-style:) must only change the hook's style.")},function(e,t){return e.data.hoverChanger=t,e.attr.push({hover:function(e,t){return void 0!==t&&t}}),e},[s])("css",function(e,t){return t.trim().endsWith(";")||(t+=";"),s.create("css",[t])},function(t,n){return t.attr.push({style:function(){return(e(this).attr("style")||"")+n}}),t},[String])("test-true",function(){return s.create("test-true",[])},function(e){return e.enabled=!0},w(b))("test-false",function(){return s.create("test-false",[])},function(e){return e.enabled=!1},w(b)),t.addCommand("animate",e.noop,function(e,t,r,a,i){r.forEach(t,function(t){var r=void 0;if("zoom"===name){var o=t.offset(),s=o.left,c=o.top;r=n.mouseCoords.x-s+"px "+(n.mouseCoords.y-c)+"px"}n.transitionIn(t,a,e.transitionTime||i,e.transitionDelay,e.transitionSkip,0,r)})},[T(i),S.apply(void 0,_toConsumableArray(_.innerType.filter(function(e){return"instant"!==e}))),g(x)]),["box","float-box"].forEach(function(r){return t.addChanger(r,function(e,t,n){var a=-1===t.search(f)||t.length>1&&!t.includes("="),i="float-box"===r&&(-1===n.search(f)||n.length>1&&!n.includes("="));return a||i?l.create("datatype","The ("+r+':) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not "'+(a?t:n)+'".'):s.create(r,[t,n].filter(function(e){return void 0!==e}))},function(t,a,i){var o,s=p(a),c=s.marginLeft,u=s.size,l=void 0;if("float-box"===r){var f=p(i);l=f.marginLeft,i=f.size}var h="box"===r?"%":"vw",y=(_defineProperty(o={display:"block",width:u+h,"max-width":u+h},"box"===r?"margin-left":"left",c+h),_defineProperty(o,"box-sizing","content-box"),_defineProperty(o,"overflow-y","auto"),_defineProperty(o,"padding",function(){var t=e(this).css("padding");return t&&"0px"!==t?t:"1em"}),o);return void 0!==i&&(y.height=i+("box"===r?"em":"vh")),"float-box"===r&&d(y,{position:"fixed",top:l+"vh","background-color":function(){return n.parentColours(e(this)).backgroundColour}}),t.styles.push(y),t},[String,"box"===r?g(k):String])})}),define("internaltypes/enchantment",["jquery","utils","internaltypes/changedescriptor","datatypes/changercommand","utils/operationutils","internaltypes/twineerror","utils/renderutils"],function(e,t,n,r,a,i,o){var s=a.objectName,c=o.collapse,u={create:function(n){return t.assertOnlyHas(n,["scope","localHook","section","attr","data","changer","functions","lambda","name"]),Object.assign(Object.create(this),{enchantments:e()},n)},enchantScope:function(){var a=this,o=this.attr,u=this.data,l=this.functions,p=this.section,f=this.scope,d=this.localHook,h=this.lambda,y=[];f.forEach(p,function(m,g){if(!d||(d.jquery?d:d.hooks(p)).has(m[0]).length){var v=void 0;if(h)if(v=h.apply(p,{loop:f.TwineScript_GetProperty(g),pos:g+1}),i.containsError(v))m.replaceWith(v.render("")),h=v=null;else if(r.isPrototypeOf(v)){var b=v.summary();(b.includes("newTargets")||b.includes("target"))&&(m.replaceWith(i.create("macrocall","The changer produced by the 'via' lambda given to enchantment macros can't include a revision or enchantment changer like (replace:) or (click:).").render("")),h=v=null)}else m.replaceWith(i.create("macrocall","The 'via' lambda given to enchantment macros must return a changer, not "+s(v)+".").render("")),h=v=null;else v=a.changer;var w=!o&&!u&&(!v||v.summary().every(function(e){return e.startsWith("transition")})),T=w?m:m.wrap("<tw-enchantment>").parent();if(o&&T.attr(o),u&&T.data(u),l&&l.forEach(function(e){return e(T)}),v){var S=n.create({section:p,target:T});if(v.run(S),S.update(),m.is(t.storyElement)){var x=Object.keys(Object.assign.apply(Object,[{}].concat(_toConsumableArray(S.styles))));m.css(x.reduce(function(e,t){return"background-color"===t||"background-image"===t?e.background="transparent":e[t]="inherit",e},{})),T.data({enchantedProperties:x})}else if(m.is("tw-passage")&&S.styles.some(function(e){return"margin-left"in e||"margin"in e||"margin-right"in e})){var k="padding-left",O="padding-right";t.storyElement.css(k,"0px").css(O,"0px"),T.data({enchantedProperties:[k,O]})}}m.is(t.storyElement)&&T.css({width:"100%",height:"100%"}),"true"===T.attr("collapsing")&&(T.find("[collapsing=false]").each(function(){e(this).removeAttr("collapsing")}),c(T)),w||y.push(T)}}),this.enchantments=e(y)},disenchant:function(){this.enchantments.each(function(){e(this).contents().unwrap();var n=e(this).data("enchantedProperties");n&&t.storyElement.css(n.reduce(function(e,t){return e[t]="",e},{}))})}};return Object.freeze(u)}),define("macrolib/enchantments",["jquery","utils","utils/operationutils","engine","state","passages","macros","datatypes/hookset","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/enchantment","internaltypes/twineerror"],function(e,t,n,r,a,i,o,s,c,u,l,p,f){var d=n.is,h=o.TypeSignature,y=h.either,m=h.rest,g=h.optional;function v(e,t){if(c.isPrototypeOf(t)){var n=t.summary();if(["newTargets","target","appendSource","functions"].some(function(e){return n.includes(e)}))return f.create("datatype","The changer given to ("+e+":) can't include a revision or enchantment changer like (replace:) or (click:).")}}["enchant","change"].forEach(function(e){o.addCommand(e,function(t,n){var r=v(e,n);if(r)return r},function(t,n,r){var a;n=s.from(n);var i=[];if(c.isPrototypeOf(r)){var o=l.create({section:t});if(r.run(o),(o.innerEnchantments||[]).length>0){var u=o.innerEnchantments.map(function(e){return e(n)});i.push.apply(i,_toConsumableArray(u))}}return i.push(p.create((_defineProperty(a={scope:n},c.isPrototypeOf(r)?"changer":"lambda",r),_defineProperty(a,"section",t),a))),i.forEach(function(n){"enchant"===e?(t.addEnchantment(n),t.updateEnchantments()):n.enchantScope()}),""},[y(s,String),y(c,u.TypeSignature("via"))],!1)}),o.addChanger("enchant-in",function(e,t,n){var r=v("enchant-in",n);return r||c.create("enchant-in",[t,n])},function(e,t,n){return e.innerEnchantments=(e.innerEnchantments||[]).concat(function(r){var a;return p.create((_defineProperty(a={scope:s.from(t),localHook:r},c.isPrototypeOf(n)?"changer":"lambda",n),_defineProperty(a,"section",e.section),a))}),e},[y(s,String),y(c,u.TypeSignature("via"))]),[["link-style",s.create({type:"name",data:"link"})],["line-style",s.create({type:"base",data:s.create({type:"name",data:"page"})},"lines",void 0)],["char-style",s.create({type:"base",data:s.create({type:"name",data:"page"})},"chars",void 0)]].forEach(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];o.addChanger(n,function(e,t){var r=v(n,t);return r||c.create(n,[t])},function(e,t){return e.innerEnchantments=(e.innerEnchantments||[]).concat(function(n){var a;return p.create((_defineProperty(a={scope:r,localHook:n},c.isPrototypeOf(t)?"changer":"lambda",t),_defineProperty(a,"section",e.section),a))}),e},[y(c,u.TypeSignature("via"))])});var b=["replace","append","prepend"];function w(n,a){return t.onStartup(function(){var r=n.classList.replace(/ /g,"."),a=n.blockClassList?n.blockClassList.replace(/ /g,"."):"",i="."+r+(a?",."+a:"");t.storyElement.on(n.event.map(function(e){return e+".enchantment"}).join(" "),i,function(){var t=e(Array.from(e(this).parents(i).add(this)).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0]),n=t.data("enchantmentEvent");n&&n(t)})}),[function(e,t,n){if(!t)return f.create("datatype","A string given to this ("+a+":) macro was empty.");if(n){var r=v(a,n);if(r)return r}return c.create(a,[s.from(t)].concat(n?[n]:[]))},function(e,t,i){e.enabled=!1,e.transitionDeferred=!0,n.rerender&&(e.newTargets=(e.newTargets||[]).concat({target:t,append:n.rerender}));var o=e.section&&e.section.stackTop?e.section.stackTop.tempVariables:Object.create(null),s=p.create(_defineProperty({functions:[function(e){e.attr("class",e.children().is("tw-story, tw-sidebar, tw-passage")||"block"===e.children().css("display")?n.blockClassList:n.classList)}],attr:(n.classList+"").match(/\b(?:link|enchantment-clickblock)\b/)?{tabIndex:"0"}:{},data:{enchantmentEvent:function(){e.section.stackTop&&e.section.stackTop.blocked||(n.once&&e.section.removeEnchantment(s),n.goto?r.goToPassage(n.goto,{transition:n.transition}):n.undo?r.goBack({transition:n.transition}):e.section.renderInto(e.source,null,Object.assign({},e,{enabled:!0,transitionDeferred:!1}),o))}},scope:t,section:e.section,name:a},c.isPrototypeOf(i)?"changer":"lambda",i));return e.section&&(e.section.addEnchantment(s),s.enchantScope()),e},[y(s,String),g(y(c,u.TypeSignature("via")))]]}b.forEach(function(t){o.addChanger(t,function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.every(Boolean)?c.create(t,r.map(s.from)):f.create("datatype","A string given to this ("+t+":) macro was empty.")},function(n){for(var r,a=arguments.length,i=Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];return e(n.target).parents().filter("tw-collapsed,[collapsing=true]").length>0||n.attr.some(function(e){return e.collapsing})||(n.attr=[].concat(_toConsumableArray(n.attr),[{collapsing:!1}])),n.newTargets=n.newTargets||[],(r=n.newTargets).push.apply(r,_toConsumableArray(i.filter(function(e){return!n.newTargets.some(function(n){var r=n.target,a=n.append;return d(e,r)&&t===a})}).map(function(e){return{target:e,append:t,before:!0}}))),n},m(y(s,String)))(t+"-with",function(e,n){return c.create(t+"-with",[n])},function(e,n){return e.appendSource=(e.appendSource||[]).concat({source:n,append:t}),e},String)});var T="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,S=[{name:"click",enchantDesc:{event:["click"],once:!0,rerender:"",classList:"link enchantment-link",blockClassList:"enchantment-clickblock"}},{name:"mouseover",enchantDesc:{event:["mouseenter",T?"click":""].filter(Boolean),once:!0,rerender:"",classList:"enchantment-mouseover",blockClassList:"enchantment-mouseoverblock"}},{name:"mouseout",enchantDesc:{event:["mouseleave",T?"click":""].filter(Boolean),once:!0,rerender:"",classList:"enchantment-mouseout",blockClassList:"enchantment-mouseoutblock"}}];S.forEach(function(e){return o.addChanger.apply(o,[e.name].concat(_toConsumableArray(w(e.enchantDesc,e.name))))}),t.onStartup(function(){S.forEach(function(n){var r=n.enchantDesc;r.blockClassList&&t.storyElement.on(r.event.map(function(e){return e+".enchantment"}).join(" "),function(){var t=e(Array.from(e(this).parents("."+r.blockClassList.replace(/ /g,"."))).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0]),n=t.data("enchantmentEvent");n&&n(t)})})}),b.forEach(function(e){S.forEach(function(t){var n=Object.assign({},t.enchantDesc,{rerender:e}),r=t.name+"-"+e;o.addChanger.apply(o,[r].concat(_toConsumableArray(w(n,r))))})}),S.forEach(function(e){["goto","undo"].forEach(function(t){var n=e.name+"-"+t;o.addCommand(n,function(e,r){return!e||!r&&"goto"===t?f.create("datatype","A string given to this ("+n+":) macro was empty."):"goto"!==t||i.hasValid(r)?void 0:f.create("macrocall","I can't ("+n+":) the passage '"+r+"' because it doesn't exist.")},function(r,i,o,c){if("undo"===t&&a.pastLength<1)return f.create("macrocall","I can't (undo:) on the first turn.");var u=w(Object.assign({},e.enchantDesc,{transition:r.data.passageT8n},"undo"===t?{undo:!0}:{goto:c}),n);return(0,_slicedToArray(u,2)[1])({section:i},s.from(o)),Object.assign(r,{source:""})},[y(s,String)].concat("undo"===t?[]:String))})})}),define("macrolib/metadata",["macros","renderer","utils/operationutils","datatypes/lambda","internaltypes/twineerror"],function(e,t,n,r,a){var i=n.clone,o=n.objectName,s=n.isValidDatamapName,c=e.TypeSignature,u=c.zeroOrMore,l=c.Any,p=t.options.metadataMacros,f=function(e){return{TwineScript_TypeName:"a ("+e+":) macro",TwineScript_ObjectName:"a ("+e+":) macro",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}};[["storylet",r.TypeSignature("when")],["urgency",Number],["exclusivity",Number]].forEach(function(t){var n=_slicedToArray(t,2),r=n[0],a=n[1];e.add(r,function(e,t){return e.stackTop.speculativePassage?t:f(r)},a),p.push(r)}),e.add("metadata",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var c=void 0,u=new Map,l=n.reduce(function(e,t){var n=void 0;if(a.containsError(e))return e;if(void 0===c)c=t;else{if(n=a.containsError(s(u,c)))return n;if(u.has(c))return a.create("macrocall","You used the same data name ("+o(c)+") twice in the same (metadata:) call.");u.set(c,i(t)),c=void 0}return e},!0);return a.containsError(l)?l:void 0!==c?a.create("macrocall","This (metadata:) macro has a data name without a value."):e.stackTop.speculativePassage?u:f("storylet")},u(l)),p.push("metadata")}),define("macrolib/patterns",["jquery","macros","utils","utils/operationutils","datatypes/datatype","datatypes/typedvar","internaltypes/twineerror"],function(e,t,n,r,a,i,o){var s=n.anyRealLetter,c=n.anyUppercase,u=n.anyLowercase,l=n.anyCasedLetter,p=n.realWhitespace,f=n.impossible,d=r.objectName,h=r.toSource,y=t.TypeSignature,m=y.rest,g=y.either,v=y.optional,b=y.nonNegativeInteger,w=Object.assign,T=Object.create,S=m(g(String,a,i)),x=function e(t){var n,r=t.name,y=t.fullArgs,m=t.args,g=t.makeRegExpString,v=void 0===g?function(e){return e.join("")}:g,b=t.insensitive,S=void 0!==b&&b,x=t.canContainTypedVars,k=void 0===x||x,O=t.canBeUsedAlone,j=void 0===O||O,A=m||y,C=A.map(function e(t){if(i.isPrototypeOf(t)){if(!k)return o.create("operation","Optional string patterns, like ("+r+":)"+("p-many"===r?" with min 0":"")+", can't have typed variables inside them.");var n=e(t.datatype);return o.containsError(n)?n:"("+n+")"}if(a.isPrototypeOf(t)){if(!k&&"typedVars"in t&&t.typedVars().length)return o.create("operation","("+r+":) can't have typed variables inside its pattern.");if(t.regExp)return(t.rest?"(?:":"")+(S?t.insensitive().regExp:t.regExp)+(t.rest?")*":"");var h=t.name,y=t.rest?"*":"";return"alnum"===h?s+y:"whitespace"===h?p+y:"uppercase"===h?(S?l:c)+y:"lowercase"===h?(S?l:u)+y:"anycase"===h?l+y:"digit"===h?"\\d"+y:"linebreak"===h?"(?:\\r|\\n|\\r\\n)"+y:"str"===h?".*?":["even","odd","int","num"].includes(h)?o.create("datatype","Please use string datatypes like 'digit' in ("+r+":) instead of number datatypes."):o.create("datatype","The ("+r+":) macro must only be given string-related datatypes, not "+d(t)+".")}return"string"==typeof t?(t=t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),S&&(t=t.replace(RegExp("("+c+"|"+u+")","g"),function(e){return"["+e.toUpperCase()+e.toLowerCase()+"]"})),t):(f("createPattern","mapper() was given a non-string non-datatype "+t),"")});if(n=o.containsError(C))return n;var E=v(C),_=w(T(a),{name:r,regExp:E,insensitive:function(){return S?_:e({name:r,fullArgs:y,args:A.map(function(e){return a.isPrototypeOf(e)&&"function"==typeof e.insensitive?e.insensitive():e}),makeRegExpString:v,insensitive:!0,canContainTypedVars:k,canBeUsedAlone:j})},typedVars:function(){return A.reduce(function(t,n){return i.isPrototypeOf(n)&&(t=t.concat(S?i.create(e({name:"p-ins",fullArgs:[n.datatype],insensitive:!0}),n.varRef):n),n=n.datatype),a.isPrototypeOf(n)&&"function"==typeof n.typedVars&&(t=t.concat(n.typedVars())),t},[])},destructure:function(t){if("string"!=typeof t)return[o.create("operation","I can't unpack "+d(t)+" into "+this.TwineScript_ToSource()+" because it isn't a string.")];var n=this.typedVars();if(!n.length)return[];var r=(RegExp("^"+(this.rest?"(?:":"")+E+(this.rest?")*":"")+"$").exec(t)||[]).slice(1);return r.length?r.map(function(t,r){var a=n[r];if(a)return a.datatype.rest&&!a.datatype.regExp&&((a=a.TwineScript_Clone()).datatype=e({name:"p",fullArgs:[a.datatype]})),{dest:a,value:t||"",src:void 0}}).filter(Boolean):[o.create("operation","I can't unpack "+d(t)+" because it doesn't match the pattern "+this.TwineScript_ToSource()+".")]},TwineScript_IsTypeOf:function(e){return j?"string"==typeof e&&!!e.match("^"+(this.rest?"(?:":"")+E+(this.rest?")*":"")+"$"):o.create("operation","A ("+r+":) datatype must only be used with a (p:) macro.")},TwineScript_toTypeSignatureObject:function(){var e=this;return{pattern:"range",name:r,range:function(t){return e.TwineScript_IsTypeOf(t)}}},TwineScript_ToSource:function(){return(this.rest?"...":"")+"("+r+":"+y.map(h)+")"}});return Object.defineProperty(_,"TwineScript_ObjectName",{get:function(){return"a ("+r+":) datatype"}}),_};t.add(["p","pattern"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return x({name:"p",fullArgs:n})},S)(["p-either","pattern-either"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return x({name:"p-either",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("|")+")"}})},S)(["p-opt","pattern-opt","p-optional","pattern-optional"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return x({name:"p-opt",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("")+")?"}})},S)(["p-not","pattern-not"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.find(function(e){return"string"==typeof e?1!==[].concat(_toConsumableArray(e)).length:e.rest||e.regExp||["str","empty"].includes(e.name)})?o.create("datatype","(p-not:) should only be given single character"):x({name:"p-not",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"[^"+e.map(function(e){return e.startsWith("[")&&e.endsWith("]")?e.slice(1,-1):e}).join("")+"]"}})},S)(["p-many","pattern-many"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var s=n.slice(),c=void 0,u=void 0;if("number"==typeof n[0]&&(c=n.shift(),u="number"==typeof n[0]?n.shift():1/0),void 0!==u&&u<c)return o.create("datatype","The (p-many:) macro needs to be given string patterns, not just min and max numbers.");if(!n.length)return o.create("datatype","The (p-many:) macro needs to be given string patterns, not just min and max numbers.");var l=n.find(function(e){return"string"!=typeof e&&!a.isPrototypeOf(e)&&!i.isPrototypeOf(e)});return l?o.create("datatype","This (p-many:) macro can only be given a min and max number followed by datatypes or strings, but was also given "+d(l)+"."):x({name:"p-many",args:n,fullArgs:s,canContainTypedVars:c>0,makeRegExpString:function(e){return"(?:"+e.join("")+")"+(void 0!==c?"{"+c+(u===1/0?",":u!==c?","+u:"")+"}":"+")}})},[m(g(b,String,a,i))])(["p-ins","pattern-ins","p-insensitive","pattern-insensitive"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return x({name:"p-ins",fullArgs:n,insensitive:!0})},S)(["split","splitted"],function(e,t,n){if(t=x({name:"split",fullArgs:[t],canContainTypedVars:!1}),o.containsError(t))return t;if(!n)return[""];if(!t.regExp)return[].concat(_toConsumableArray(n));for(var r=RegExp(t.regExp),a=[],i=void 0;n&&(i=r.exec(n));){if(i.index+i[0].length===0)return a;a.push(n.slice(0,i.index)),n=n.slice(i.index+i[0].length)}return a.concat(n||[])},[g(String,a),String])("trimmed",function(e,t,n){return void 0===n||a.isPrototypeOf(t)&&"whitespace"===t.name?t.trim():(t=x({name:"trimmed",fullArgs:[t],canContainTypedVars:!1}),o.containsError(t)?t:t.regExp?n.replace(RegExp("^("+t.regExp+")*|("+t.regExp+")*$","g"),""):n)},[g(String,a),v(String)])}),define("macrolib/links",["jquery","macros","utils","state","passages","engine","datatypes/changercommand","internaltypes/changedescriptor","datatypes/hookset","datatypes/lambda","internaltypes/twineerror"],function(e,t,n,r,a,i,o,s,c,u,l){var p=t.TypeSignature,f=p.optional,d=p.rest,h=p.either,y=["Links can't have empty strings for their displayed text.","In the link syntax, a link's displayed text is inside the [[ and ]], and on the non-pointy side of the -> or <- arrow if it's there."],m=Object.assign;function g(e,t,r){r=r||t;var i=a.hasValid(t)&&t===r,o=e.evaluateTwineMarkup(n.unescape(r),"a link's passage name"),s=void 0;if(i){var c=o.children().length>0?"`".repeat((r.match(/`+/)||[]).reduce(function(e,t){return Math.max(e,t.length+1)},1)):"";t=c+"\0".repeat(!!c)+t+"\0".repeat(!!c)+c}else o.findAndFilter("tw-error").length&&(s=o.findAndFilter("tw-error").data("TwineError")),r=o.text();return{text:t,passage:r,error:s}}n.onStartup(function(){e(n.storyElement).on("click.passage-link","tw-link",function(t){var n=e(this),r=n.closest("tw-expression"),a=n.closest("tw-expression, tw-hook"),o=a.data("clickEvent"),s=a.data("section");if(!(s&&s.stackTop&&s.stackTop.blocked)||s.stackTop.blocked instanceof e&&s.stackTop.blocked.find(n).length){if(o){if(n.find("tw-error").length>0)return;return t.stopPropagation(),void o(n)}var c=r.data("linkPassageName"),u=Object.assign({},r.data("passageT8n")||{});return r.find("tw-enchantment").each(function(t,n){Object.assign(u,e(n).data("passageT8n")||{})}),c?(t.stopPropagation(),void i.goToPassage(c,{transition:u})):n.is("[undo]")?(t.stopPropagation(),void i.goBack({transition:u})):n.is("[fullscreen]")?(t.stopPropagation(),void i.toggleFullscreen()):void 0}}),e(document).on("fullscreenchange",function(){e("tw-link[fullscreen]",n.storyElement).each(function(t,n){(e(n).closest("tw-expression, tw-hook").data("fullscreenEvent")||Object)(n)})})}),[["link","link-replace"],["link-reveal"],["link-repeat"],["link-rerun"]].forEach(function(e){return t.addChanger(e,function(t,n,r){if(!n)return l.create("datatype",y[0]);if(r){var a=r.summary();if(["newTargets","target","appendSource","functions"].some(function(e){return a.includes(e)}))return l.create("datatype","The changer given to ("+e[0]+":) can't include a revision or enchantment changer like (replace:) or (click:).")}return o.create(e[0],[n].concat(r||[]))},function(t,n,r){var a=e[0],i=t.section&&t.section.stackTop?t.section.stackTop.tempVariables:Object.create(null),o=s.create({source:"<tw-link tabindex=0>"+n+"</tw-link>",target:function(){return t.target},append:"replace",data:{section:t.section,clickEvent:function(e){t.enablers=t.enablers.filter(function(e){return e.descriptor!==o}),"link-reveal"===a&&e.contents().unwrap();var n=e.parentsUntil(":not(tw-enchantment)").parent();if(n.length||(n=e.parent()),"link-rerun"===a){var r=e.parentsUntil(":not(tw-enchantment)");e.detach(),r.remove()}"link"!==a&&"link-rerun"!==a||n.empty(),t.section.renderInto("",null,t,i),"link-rerun"===a&&n.prepend(e)}}});return t.enablers=(t.enablers||[]).concat({descriptor:o,changer:r}),t},[String,f(o)])}),t.addCommand("link-goto",function(e){if(!e)return l.create.apply(l,["datatype"].concat(y))},function(e,t,i,o){var s,c=g(t,i,o);if(i=c.text,o=c.passage,s=c.error)return s;if(e.transition){var u="transition";return l.create("datatype","Please attach ("+u+"-depart:) or ("+u+"-arrive:) to a passage link, not ("+u+":).")}var p=void 0;return a.hasValid(o)||(p='<tw-broken-link passage-name="'+n.escape(o)+'">'+i+"</tw-broken-link>"),p=p||"<tw-link tabindex=0 "+(r.passageNameVisited(o)>0?'class="visited" ':"")+">"+i+"</tw-link>",e.data.linkPassageName=o,e.data.section=t,m(e,{source:p,transitionDeferred:!0})},[String,f(String)])("link-storylet",function(){var e,t=(e=1===arguments.length||"string"!=typeof(arguments.length<=0?void 0:arguments[0])?0:1,arguments.length<=e?void 0:arguments[e]);if(!t||"string"==typeof t)return l.create("datatype","(link-storylet:) should be given one index number or one 'where' lambda, after the optional link text string.")},function(e,t){var n,i,o,s=(n=2+(1==(arguments.length<=2?0:arguments.length-2)?0:3==(arguments.length<=2?0:arguments.length-2)||"string"==typeof(arguments.length<=2?void 0:arguments[2])?1:2),arguments.length<=n?void 0:arguments[n]),c="string"==typeof(arguments.length<=2?void 0:arguments[2])&&(arguments.length<=2?void 0:arguments[2]),p=(i=(arguments.length<=2?0:arguments.length-2)-1+2,(arguments.length<=i?void 0:arguments[i])!==s&&(o=(arguments.length<=2?0:arguments.length-2)-1+2,arguments.length<=o?void 0:arguments[o]));if(e.transition){var f="transition";return l.create("datatype","Please attach ("+f+"-depart:) or ("+f+"-arrive:) to (link-storylet:), not ("+f+":).")}var d=u.isPrototypeOf(s),h=a.getStorylets(t,d&&s),y=l.containsError(h);if(y)return y;var g=h[d?0:s<0?h.length+s:s-1],v=void 0;if(g)g=g.get("name"),c=c||g,v=v||"<tw-link tabindex=0 "+(r.passageNameVisited(g)>0?'class="visited" ':"")+">"+c+"</tw-link>",e.data.linkPassageName=g,e.data.section=t;else{if(!p)return e;v=p}return m(e,{source:v,transitionDeferred:!0})},[h(parseInt,String,u.TypeSignature("where")),f(h(parseInt,String,u.TypeSignature("where"))),f(String)])("link-undo",function(e){if(!e)return l.create("datatype",y[0])},function(e,t,n){return r.pastLength<1?l.create("macrocall","I can't use (link-undo:) on the first turn."):(e.data.section=t,m(e,{source:"<tw-link tabindex=0 undo>"+n+"</tw-link>",transitionDeferred:!0}))},[String])("link-show",function(e){if(!e)return l.create("datatype",y[0])},function(t,n,r){for(var a=arguments.length,i=Array(a>3?a-3:0),o=3;o<a;o++)i[o-3]=arguments[o];return t.data.section=n,t.data.clickEvent=function(r){r.contents().unwrap(),i.forEach(function(r){return r.forEach(n,function(r){var a=r.data("originalSource")||"",i=r.data("hidden");if(i)if(r.removeData("hidden"),i instanceof e)r.empty().append(i);else{var o=r.data("tempVariables");n.renderInto("",null,m({},t,{source:a,target:r,transitionDeferred:!1}),o&&Object.create(o))}})})},m(t,{source:"<tw-link tabindex=0>"+r+"</tw-link>",transitionDeferred:!0})},[String,d(c)])("link-fullscreen",function(e,t){if(!e||!t)return l.create("datatype",y[0])},function(e,t,n,r){var a=function(){return document.fullscreenEnabled||document.msFullscreenEnabled?"<tw-link tabindex=0 fullscreen>"+(document.fullscreenElement||document.msFullscreenElement?r:n)+"</tw-link>":r?"<tw-broken-link>"+r+"</tw-broken-link>":""},i=t.stackTop.tempVariables;return e.data.section=t,e.data.fullscreenEvent=function(){(document.fullscreenEnabled||document.msFullscreenEnabled)&&e.data.section.whenUnblocked(function(){var t=m({},e,{append:"replace",source:a(),transitionDeferred:!1});e.section.renderInto("",null,t,i)})},m(e,{source:a(),transitionDeferred:!0})},[String,String,f(String)]),t.addChanger(["link-reveal-goto"],function(e,t,n,r){if(!t)return l.create.apply(l,["datatype"].concat(y));if(o.isPrototypeOf(n)){if(o.isPrototypeOf(r))return l.create("datatype","You mustn't give two changers to (link-reveal-goto:)");r=n,n=void 0}if(r){var a=r.summary();if(["newTargets","target","appendSource","functions"].some(function(e){return a.includes(e)}))return l.create("datatype","The changer given to (link-reveal-goto:) can't include a revision or enchantment changer like (replace:) or (click:).")}var i=g(e,t,n);return t=i.text,n=i.passage,i.error||o.create("link-reveal-goto",[t,n,r].filter(function(e){return void 0!==e}))},function(e,t,o,c){if(a.hasValid(o)){var u=r.passageNameVisited(o),l=e.section&&e.section.stackTop?e.section.stackTop.tempVariables:Object.create(null),p=s.create({source:"<tw-link tabindex=0 "+(u>0?'class="visited" ':"")+">"+t+"</tw-link>",target:e.target,append:"replace",data:{section:e.section,append:"replace",clickEvent:function(t){e.enablers=e.enablers.filter(function(e){return e.descriptor!==p}),t.contents().unwrap(),e.section.renderInto("",null,e,l),e.section.whenUnblocked(function(){return i.goToPassage(o,{transition:e.data.passageT8n})})}}});return e.enablers=(e.enablers||[]).concat({descriptor:p,changer:c}),e}e.source='<tw-broken-link passage-name="'+n.escape(o)+'">'+t+"</tw-broken-link>"},[String,f(h(o,String)),f(o)])}),define("macrolib/custommacros",["utils","macros","state","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/codehook","datatypes/typedvar","internaltypes/twineerror"],function(e,t,n,r,a,i,o,s,c){var u=t.add,l=t.addChanger,p=t.addCommand,f=t.TypeSignature,d=f.rest,h=f.either,y=f.Any,m=r.objectName;u("macro",function(t){for(var r=arguments.length,a=Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];var u=void 0,l=[];for(u=0;u<a.length;u+=1){var p=u===a.length-1;if(s.isPrototypeOf(a[u])===p)return c.create("datatype","The "+(p?"":e.nth(a.length-u+1)+"-")+"last value given to (macro:) should be a "+(p?"code hook":"datatyped variable")+", not "+m(a[u]));if(!p){var f="A custom macro";if(a[u].varRef.object===n.variables)return c.create("datatype",f+"'s typed variables must be temp variables (with a '_'), not global variables (with a '$').","Write them with a _ symbol at the start instead of a $ symbol.");if(a[u].varRef.propertyChain.length>1)return c.create("datatype",f+"'s typed variables can't be properties inside a data structure.");if(a[u].datatype.rest&&u!==a.length-2)return c.create("datatype",f+" can only have one spread variable, and it must be its last variable.");var d=a[u].varRef.propertyChain[0];if(l.includes(d))return c.create("datatype",f+"'s typed variables can't both be named '"+d+"'.");l.push(d)}}return i.create(a.slice(0,-1),a[a.length-1])},[d(h(s,o))]);var g=function(e,t,n){if(!t.some(function(e){if("function"==typeof e.output)return e.output(n),!0}))return c.create("macrocall","("+e+":) should only be used inside a code hook passed to (macro:).")};p(["output-data","out-data"],function(){},function(e,t){var n=e.stack;return g("output-data",n,t)||{blocked:!0}},[y],!1),l(["output","out"],function(e){return Object.assign(a.create("output",[e]))},function(e,t){var n=t.stack,r=t.stackTop;return e.loopVars=Object.keys(r.tempVariables).reduce(function(e,t){return e[t]=[r.tempVariables[t]],e},{}),g("output",n,e),r.blocked=!0,e},[]),p("error",function(e){if(!e)return c.create("datatype","This (error:) macro was given an empty string.")},function(e,t){var n=e.stack;return g("error",n,c.create("user",t))||{blocked:!0}},[String],!1)}),define("repl",["utils","engine","markup","twinescript/compiler","twinescript/environ"],function(e,t,n,r,a){e.onStartup(function(){return setTimeout(function(){t.options.debug&&(window.REPL=function(e){var t=r(n.lex("(print:"+e+")"));console.log(t);var i=a({}).eval(t);return i.TwineScript_Run?i.TwineScript_Run().source:i},window.LEX=function(e){var t=n.lex(e);return 1===t.length?t[0]:t})})})}),require.config({paths:{jquery:"../node_modules/jquery/dist/jquery",almond:"../node_modules/almond/almond","es6-shim":"../node_modules/es6-shim/es6-shim",jqueryplugins:"utils/jqueryplugins",markup:"./markup/markup",lexer:"./markup/lexer",patterns:"./markup/patterns"},deps:["es6-shim","jqueryplugins"]}),require(["jquery","debugmode/mode","renderer","state","section","engine","passages","utils","utils/renderutils","internaltypes/varscope","internaltypes/twineerror","macros","macrolib/values","macrolib/commands","macrolib/datastructures","macrolib/stylechangers","macrolib/enchantments","macrolib/metadata","macrolib/patterns","macrolib/links","macrolib/custommacros","repl"],function($,DebugMode,Renderer,State,Section,Engine,Passages,Utils,_ref118,VarScope,TwineError){var dialog=_ref118.dialog;function __HarloweEval(text){return eval(text+"")}var _installHandlers=function(){$(document.documentElement).on("keydown",function(e){13===e.which&&"0"===e.target.getAttribute("tabindex")&&$(e.target).trigger("click")}),Engine.options.debug?DebugMode():TwineError.on("error",function(e,t){return!$("tw-debugger").length&&DebugMode(e,t)}),_installHandlers=null},oldOnError;function printJSError(e){var t=e.name+": "+e.message;if(e.stack){var n=e.stack.split("\n"),r=n.findIndex(function(e){return e.includes("__HarloweEval")});t+="\n"+n.slice(0,r).join("\n").replace(/\([^\)]+\)/g,"")}return"<div style='font-family:monospace;overflow-y:scroll;max-height:30vh'>```"+t+"```</div>"}oldOnError=window.onerror,window.onerror=function(e,t,n,r,a){window.onerror=oldOnError,Utils.storyElement.parent().append(dialog({message:"Sorry to interrupt, but this page's code has got itself in a mess.\n\n"+printJSError(a)+"\n(This is probably due to a bug in the Harlowe game engine.)"})),"function"==typeof oldOnError&&oldOnError.apply(void 0,arguments)},Utils.onStartup(function(){var e=$("tw-storydata");if(0!==e.length){var t=e.attr("options");t&&t.split(/\s/).forEach(function(e){Renderer.options[e]=Engine.options[e]=!0});var n=e.attr("startnode");Renderer.options.ifid=Engine.options.ifid=e.attr("ifid"),n||(n=[].reduce.call($("tw-passagedata"),function(e,t){var n=t.getAttribute("pid");return n<e?n:e},1/0)),n=$("tw-passagedata[pid="+n+"]").attr("name"),_installHandlers();var r=!1;$("[role=script]").each(function(e){try{__HarloweEval($(this).html())}catch(t){r||(r=!0,dialog({parent:Utils.storyElement.parent(),message:"There is a problem with this story's "+Utils.nth(e+1)+" script:\n\n"+printJSError(t)}))}}),$("[role=stylesheet]").each(function(e){$(document.head).append('<style data-title="Story stylesheet '+(e+1)+'">'+$(this).html())});var a=Section.create();a.stack=[{tempVariables:Object.create(VarScope)}];var i=Passages.loadMetadata(a);if(i.length){var o=dialog({parent:Utils.storyElement.parent(),message:"These errors occurred when running the `(metadata:)` macro calls in this story's passages:<p></p>"});i.forEach(function(e){return o.find("p").append(e.render(""))})}var s=!Engine.options.debug&&State.hasSessionStorage&&sessionStorage.getItem("Saved Session");s&&!0===State.deserialise(a,s)?Engine.showPassage(State.passage,!1):Engine.goToPassage(n)}})}),define("harlowe",function(){}),require(["harlowe"])}();
</script>

</body>
</html>
